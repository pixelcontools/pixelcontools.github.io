(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const u of document.querySelectorAll('link[rel="modulepreload"]'))d(u);new MutationObserver(u=>{for(const y of u)if(y.type==="childList")for(const m of y.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&d(m)}).observe(document,{childList:!0,subtree:!0});function a(u){const y={};return u.integrity&&(y.integrity=u.integrity),u.referrerPolicy&&(y.referrerPolicy=u.referrerPolicy),u.crossOrigin==="use-credentials"?y.credentials="include":u.crossOrigin==="anonymous"?y.credentials="omit":y.credentials="same-origin",y}function d(u){if(u.ep)return;u.ep=!0;const y=a(u);fetch(u.href,y)}})();function si(l){return l&&l.__esModule&&Object.prototype.hasOwnProperty.call(l,"default")?l.default:l}var Bl={exports:{}},Yo={},$l={exports:{}},Oe={};var Cu;function Xf(){if(Cu)return Oe;Cu=1;var l=Symbol.for("react.element"),c=Symbol.for("react.portal"),a=Symbol.for("react.fragment"),d=Symbol.for("react.strict_mode"),u=Symbol.for("react.profiler"),y=Symbol.for("react.provider"),m=Symbol.for("react.context"),w=Symbol.for("react.forward_ref"),f=Symbol.for("react.suspense"),p=Symbol.for("react.memo"),v=Symbol.for("react.lazy"),b=Symbol.iterator;function N(x){return x===null||typeof x!="object"?null:(x=b&&x[b]||x["@@iterator"],typeof x=="function"?x:null)}var P={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},j=Object.assign,C={};function M(x,I,ne){this.props=x,this.context=I,this.refs=C,this.updater=ne||P}M.prototype.isReactComponent={},M.prototype.setState=function(x,I){if(typeof x!="object"&&typeof x!="function"&&x!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,x,I,"setState")},M.prototype.forceUpdate=function(x){this.updater.enqueueForceUpdate(this,x,"forceUpdate")};function D(){}D.prototype=M.prototype;function z(x,I,ne){this.props=x,this.context=I,this.refs=C,this.updater=ne||P}var q=z.prototype=new D;q.constructor=z,j(q,M.prototype),q.isPureReactComponent=!0;var U=Array.isArray,R=Object.prototype.hasOwnProperty,k={current:null},F={key:!0,ref:!0,__self:!0,__source:!0};function H(x,I,ne){var K,de={},ue=null,ve=null;if(I!=null)for(K in I.ref!==void 0&&(ve=I.ref),I.key!==void 0&&(ue=""+I.key),I)R.call(I,K)&&!F.hasOwnProperty(K)&&(de[K]=I[K]);var pe=arguments.length-2;if(pe===1)de.children=ne;else if(1<pe){for(var Se=Array(pe),Te=0;Te<pe;Te++)Se[Te]=arguments[Te+2];de.children=Se}if(x&&x.defaultProps)for(K in pe=x.defaultProps,pe)de[K]===void 0&&(de[K]=pe[K]);return{$$typeof:l,type:x,key:ue,ref:ve,props:de,_owner:k.current}}function re(x,I){return{$$typeof:l,type:x.type,key:I,ref:x.ref,props:x.props,_owner:x._owner}}function ee(x){return typeof x=="object"&&x!==null&&x.$$typeof===l}function W(x){var I={"=":"=0",":":"=2"};return"$"+x.replace(/[=:]/g,function(ne){return I[ne]})}var Z=/\/+/g;function J(x,I){return typeof x=="object"&&x!==null&&x.key!=null?W(""+x.key):I.toString(36)}function A(x,I,ne,K,de){var ue=typeof x;(ue==="undefined"||ue==="boolean")&&(x=null);var ve=!1;if(x===null)ve=!0;else switch(ue){case"string":case"number":ve=!0;break;case"object":switch(x.$$typeof){case l:case c:ve=!0}}if(ve)return ve=x,de=de(ve),x=K===""?"."+J(ve,0):K,U(de)?(ne="",x!=null&&(ne=x.replace(Z,"$&/")+"/"),A(de,I,ne,"",function(Te){return Te})):de!=null&&(ee(de)&&(de=re(de,ne+(!de.key||ve&&ve.key===de.key?"":(""+de.key).replace(Z,"$&/")+"/")+x)),I.push(de)),1;if(ve=0,K=K===""?".":K+":",U(x))for(var pe=0;pe<x.length;pe++){ue=x[pe];var Se=K+J(ue,pe);ve+=A(ue,I,ne,Se,de)}else if(Se=N(x),typeof Se=="function")for(x=Se.call(x),pe=0;!(ue=x.next()).done;)ue=ue.value,Se=K+J(ue,pe++),ve+=A(ue,I,ne,Se,de);else if(ue==="object")throw I=String(x),Error("Objects are not valid as a React child (found: "+(I==="[object Object]"?"object with keys {"+Object.keys(x).join(", ")+"}":I)+"). If you meant to render a collection of children, use an array instead.");return ve}function X(x,I,ne){if(x==null)return x;var K=[],de=0;return A(x,K,"","",function(ue){return I.call(ne,ue,de++)}),K}function $(x){if(x._status===-1){var I=x._result;I=I(),I.then(function(ne){(x._status===0||x._status===-1)&&(x._status=1,x._result=ne)},function(ne){(x._status===0||x._status===-1)&&(x._status=2,x._result=ne)}),x._status===-1&&(x._status=0,x._result=I)}if(x._status===1)return x._result.default;throw x._result}var ae={current:null},O={transition:null},oe={ReactCurrentDispatcher:ae,ReactCurrentBatchConfig:O,ReactCurrentOwner:k};function _(){throw Error("act(...) is not supported in production builds of React.")}return Oe.Children={map:X,forEach:function(x,I,ne){X(x,function(){I.apply(this,arguments)},ne)},count:function(x){var I=0;return X(x,function(){I++}),I},toArray:function(x){return X(x,function(I){return I})||[]},only:function(x){if(!ee(x))throw Error("React.Children.only expected to receive a single React element child.");return x}},Oe.Component=M,Oe.Fragment=a,Oe.Profiler=u,Oe.PureComponent=z,Oe.StrictMode=d,Oe.Suspense=f,Oe.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=oe,Oe.act=_,Oe.cloneElement=function(x,I,ne){if(x==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+x+".");var K=j({},x.props),de=x.key,ue=x.ref,ve=x._owner;if(I!=null){if(I.ref!==void 0&&(ue=I.ref,ve=k.current),I.key!==void 0&&(de=""+I.key),x.type&&x.type.defaultProps)var pe=x.type.defaultProps;for(Se in I)R.call(I,Se)&&!F.hasOwnProperty(Se)&&(K[Se]=I[Se]===void 0&&pe!==void 0?pe[Se]:I[Se])}var Se=arguments.length-2;if(Se===1)K.children=ne;else if(1<Se){pe=Array(Se);for(var Te=0;Te<Se;Te++)pe[Te]=arguments[Te+2];K.children=pe}return{$$typeof:l,type:x.type,key:de,ref:ue,props:K,_owner:ve}},Oe.createContext=function(x){return x={$$typeof:m,_currentValue:x,_currentValue2:x,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},x.Provider={$$typeof:y,_context:x},x.Consumer=x},Oe.createElement=H,Oe.createFactory=function(x){var I=H.bind(null,x);return I.type=x,I},Oe.createRef=function(){return{current:null}},Oe.forwardRef=function(x){return{$$typeof:w,render:x}},Oe.isValidElement=ee,Oe.lazy=function(x){return{$$typeof:v,_payload:{_status:-1,_result:x},_init:$}},Oe.memo=function(x,I){return{$$typeof:p,type:x,compare:I===void 0?null:I}},Oe.startTransition=function(x){var I=O.transition;O.transition={};try{x()}finally{O.transition=I}},Oe.unstable_act=_,Oe.useCallback=function(x,I){return ae.current.useCallback(x,I)},Oe.useContext=function(x){return ae.current.useContext(x)},Oe.useDebugValue=function(){},Oe.useDeferredValue=function(x){return ae.current.useDeferredValue(x)},Oe.useEffect=function(x,I){return ae.current.useEffect(x,I)},Oe.useId=function(){return ae.current.useId()},Oe.useImperativeHandle=function(x,I,ne){return ae.current.useImperativeHandle(x,I,ne)},Oe.useInsertionEffect=function(x,I){return ae.current.useInsertionEffect(x,I)},Oe.useLayoutEffect=function(x,I){return ae.current.useLayoutEffect(x,I)},Oe.useMemo=function(x,I){return ae.current.useMemo(x,I)},Oe.useReducer=function(x,I,ne){return ae.current.useReducer(x,I,ne)},Oe.useRef=function(x){return ae.current.useRef(x)},Oe.useState=function(x){return ae.current.useState(x)},Oe.useSyncExternalStore=function(x,I,ne){return ae.current.useSyncExternalStore(x,I,ne)},Oe.useTransition=function(){return ae.current.useTransition()},Oe.version="18.3.1",Oe}var Eu;function Go(){return Eu||(Eu=1,$l.exports=Xf()),$l.exports}var Mu;function Vf(){if(Mu)return Yo;Mu=1;var l=Go(),c=Symbol.for("react.element"),a=Symbol.for("react.fragment"),d=Object.prototype.hasOwnProperty,u=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,y={key:!0,ref:!0,__self:!0,__source:!0};function m(w,f,p){var v,b={},N=null,P=null;p!==void 0&&(N=""+p),f.key!==void 0&&(N=""+f.key),f.ref!==void 0&&(P=f.ref);for(v in f)d.call(f,v)&&!y.hasOwnProperty(v)&&(b[v]=f[v]);if(w&&w.defaultProps)for(v in f=w.defaultProps,f)b[v]===void 0&&(b[v]=f[v]);return{$$typeof:c,type:w,key:N,ref:P,props:b,_owner:u.current}}return Yo.Fragment=a,Yo.jsx=m,Yo.jsxs=m,Yo}var Pu;function Gf(){return Pu||(Pu=1,Bl.exports=Vf()),Bl.exports}var r=Gf(),g=Go();const nd=si(g);var Qs={},Ul={exports:{}},Zt={},Wl={exports:{}},Hl={};var Du;function Zf(){return Du||(Du=1,(function(l){function c(O,oe){var _=O.length;O.push(oe);e:for(;0<_;){var x=_-1>>>1,I=O[x];if(0<u(I,oe))O[x]=oe,O[_]=I,_=x;else break e}}function a(O){return O.length===0?null:O[0]}function d(O){if(O.length===0)return null;var oe=O[0],_=O.pop();if(_!==oe){O[0]=_;e:for(var x=0,I=O.length,ne=I>>>1;x<ne;){var K=2*(x+1)-1,de=O[K],ue=K+1,ve=O[ue];if(0>u(de,_))ue<I&&0>u(ve,de)?(O[x]=ve,O[ue]=_,x=ue):(O[x]=de,O[K]=_,x=K);else if(ue<I&&0>u(ve,_))O[x]=ve,O[ue]=_,x=ue;else break e}}return oe}function u(O,oe){var _=O.sortIndex-oe.sortIndex;return _!==0?_:O.id-oe.id}if(typeof performance=="object"&&typeof performance.now=="function"){var y=performance;l.unstable_now=function(){return y.now()}}else{var m=Date,w=m.now();l.unstable_now=function(){return m.now()-w}}var f=[],p=[],v=1,b=null,N=3,P=!1,j=!1,C=!1,M=typeof setTimeout=="function"?setTimeout:null,D=typeof clearTimeout=="function"?clearTimeout:null,z=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function q(O){for(var oe=a(p);oe!==null;){if(oe.callback===null)d(p);else if(oe.startTime<=O)d(p),oe.sortIndex=oe.expirationTime,c(f,oe);else break;oe=a(p)}}function U(O){if(C=!1,q(O),!j)if(a(f)!==null)j=!0,$(R);else{var oe=a(p);oe!==null&&ae(U,oe.startTime-O)}}function R(O,oe){j=!1,C&&(C=!1,D(H),H=-1),P=!0;var _=N;try{for(q(oe),b=a(f);b!==null&&(!(b.expirationTime>oe)||O&&!W());){var x=b.callback;if(typeof x=="function"){b.callback=null,N=b.priorityLevel;var I=x(b.expirationTime<=oe);oe=l.unstable_now(),typeof I=="function"?b.callback=I:b===a(f)&&d(f),q(oe)}else d(f);b=a(f)}if(b!==null)var ne=!0;else{var K=a(p);K!==null&&ae(U,K.startTime-oe),ne=!1}return ne}finally{b=null,N=_,P=!1}}var k=!1,F=null,H=-1,re=5,ee=-1;function W(){return!(l.unstable_now()-ee<re)}function Z(){if(F!==null){var O=l.unstable_now();ee=O;var oe=!0;try{oe=F(!0,O)}finally{oe?J():(k=!1,F=null)}}else k=!1}var J;if(typeof z=="function")J=function(){z(Z)};else if(typeof MessageChannel<"u"){var A=new MessageChannel,X=A.port2;A.port1.onmessage=Z,J=function(){X.postMessage(null)}}else J=function(){M(Z,0)};function $(O){F=O,k||(k=!0,J())}function ae(O,oe){H=M(function(){O(l.unstable_now())},oe)}l.unstable_IdlePriority=5,l.unstable_ImmediatePriority=1,l.unstable_LowPriority=4,l.unstable_NormalPriority=3,l.unstable_Profiling=null,l.unstable_UserBlockingPriority=2,l.unstable_cancelCallback=function(O){O.callback=null},l.unstable_continueExecution=function(){j||P||(j=!0,$(R))},l.unstable_forceFrameRate=function(O){0>O||125<O?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):re=0<O?Math.floor(1e3/O):5},l.unstable_getCurrentPriorityLevel=function(){return N},l.unstable_getFirstCallbackNode=function(){return a(f)},l.unstable_next=function(O){switch(N){case 1:case 2:case 3:var oe=3;break;default:oe=N}var _=N;N=oe;try{return O()}finally{N=_}},l.unstable_pauseExecution=function(){},l.unstable_requestPaint=function(){},l.unstable_runWithPriority=function(O,oe){switch(O){case 1:case 2:case 3:case 4:case 5:break;default:O=3}var _=N;N=O;try{return oe()}finally{N=_}},l.unstable_scheduleCallback=function(O,oe,_){var x=l.unstable_now();switch(typeof _=="object"&&_!==null?(_=_.delay,_=typeof _=="number"&&0<_?x+_:x):_=x,O){case 1:var I=-1;break;case 2:I=250;break;case 5:I=1073741823;break;case 4:I=1e4;break;default:I=5e3}return I=_+I,O={id:v++,callback:oe,priorityLevel:O,startTime:_,expirationTime:I,sortIndex:-1},_>x?(O.sortIndex=_,c(p,O),a(f)===null&&O===a(p)&&(C?(D(H),H=-1):C=!0,ae(U,_-x))):(O.sortIndex=I,c(f,O),j||P||(j=!0,$(R))),O},l.unstable_shouldYield=W,l.unstable_wrapCallback=function(O){var oe=N;return function(){var _=N;N=oe;try{return O.apply(this,arguments)}finally{N=_}}}})(Hl)),Hl}var Lu;function Kf(){return Lu||(Lu=1,Wl.exports=Zf()),Wl.exports}var Iu;function Qf(){if(Iu)return Zt;Iu=1;var l=Go(),c=Kf();function a(e){for(var t="https://reactjs.org/docs/error-decoder.html?invariant="+e,n=1;n<arguments.length;n++)t+="&args[]="+encodeURIComponent(arguments[n]);return"Minified React error #"+e+"; visit "+t+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var d=new Set,u={};function y(e,t){m(e,t),m(e+"Capture",t)}function m(e,t){for(u[e]=t,e=0;e<t.length;e++)d.add(t[e])}var w=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),f=Object.prototype.hasOwnProperty,p=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,v={},b={};function N(e){return f.call(b,e)?!0:f.call(v,e)?!1:p.test(e)?b[e]=!0:(v[e]=!0,!1)}function P(e,t,n,o){if(n!==null&&n.type===0)return!1;switch(typeof t){case"function":case"symbol":return!0;case"boolean":return o?!1:n!==null?!n.acceptsBooleans:(e=e.toLowerCase().slice(0,5),e!=="data-"&&e!=="aria-");default:return!1}}function j(e,t,n,o){if(t===null||typeof t>"u"||P(e,t,n,o))return!0;if(o)return!1;if(n!==null)switch(n.type){case 3:return!t;case 4:return t===!1;case 5:return isNaN(t);case 6:return isNaN(t)||1>t}return!1}function C(e,t,n,o,s,i,h){this.acceptsBooleans=t===2||t===3||t===4,this.attributeName=o,this.attributeNamespace=s,this.mustUseProperty=n,this.propertyName=e,this.type=t,this.sanitizeURL=i,this.removeEmptyString=h}var M={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(e){M[e]=new C(e,0,!1,e,null,!1,!1)}),[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(e){var t=e[0];M[t]=new C(t,1,!1,e[1],null,!1,!1)}),["contentEditable","draggable","spellCheck","value"].forEach(function(e){M[e]=new C(e,2,!1,e.toLowerCase(),null,!1,!1)}),["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(e){M[e]=new C(e,2,!1,e,null,!1,!1)}),"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(e){M[e]=new C(e,3,!1,e.toLowerCase(),null,!1,!1)}),["checked","multiple","muted","selected"].forEach(function(e){M[e]=new C(e,3,!0,e,null,!1,!1)}),["capture","download"].forEach(function(e){M[e]=new C(e,4,!1,e,null,!1,!1)}),["cols","rows","size","span"].forEach(function(e){M[e]=new C(e,6,!1,e,null,!1,!1)}),["rowSpan","start"].forEach(function(e){M[e]=new C(e,5,!1,e.toLowerCase(),null,!1,!1)});var D=/[\-:]([a-z])/g;function z(e){return e[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(e){var t=e.replace(D,z);M[t]=new C(t,1,!1,e,null,!1,!1)}),"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(e){var t=e.replace(D,z);M[t]=new C(t,1,!1,e,"http://www.w3.org/1999/xlink",!1,!1)}),["xml:base","xml:lang","xml:space"].forEach(function(e){var t=e.replace(D,z);M[t]=new C(t,1,!1,e,"http://www.w3.org/XML/1998/namespace",!1,!1)}),["tabIndex","crossOrigin"].forEach(function(e){M[e]=new C(e,1,!1,e.toLowerCase(),null,!1,!1)}),M.xlinkHref=new C("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1),["src","href","action","formAction"].forEach(function(e){M[e]=new C(e,1,!1,e.toLowerCase(),null,!0,!0)});function q(e,t,n,o){var s=M.hasOwnProperty(t)?M[t]:null;(s!==null?s.type!==0:o||!(2<t.length)||t[0]!=="o"&&t[0]!=="O"||t[1]!=="n"&&t[1]!=="N")&&(j(t,n,s,o)&&(n=null),o||s===null?N(t)&&(n===null?e.removeAttribute(t):e.setAttribute(t,""+n)):s.mustUseProperty?e[s.propertyName]=n===null?s.type===3?!1:"":n:(t=s.attributeName,o=s.attributeNamespace,n===null?e.removeAttribute(t):(s=s.type,n=s===3||s===4&&n===!0?"":""+n,o?e.setAttributeNS(o,t,n):e.setAttribute(t,n))))}var U=l.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,R=Symbol.for("react.element"),k=Symbol.for("react.portal"),F=Symbol.for("react.fragment"),H=Symbol.for("react.strict_mode"),re=Symbol.for("react.profiler"),ee=Symbol.for("react.provider"),W=Symbol.for("react.context"),Z=Symbol.for("react.forward_ref"),J=Symbol.for("react.suspense"),A=Symbol.for("react.suspense_list"),X=Symbol.for("react.memo"),$=Symbol.for("react.lazy"),ae=Symbol.for("react.offscreen"),O=Symbol.iterator;function oe(e){return e===null||typeof e!="object"?null:(e=O&&e[O]||e["@@iterator"],typeof e=="function"?e:null)}var _=Object.assign,x;function I(e){if(x===void 0)try{throw Error()}catch(n){var t=n.stack.trim().match(/\n( *(at )?)/);x=t&&t[1]||""}return`
`+x+e}var ne=!1;function K(e,t){if(!e||ne)return"";ne=!0;var n=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(t)if(t=function(){throw Error()},Object.defineProperty(t.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(t,[])}catch(Q){var o=Q}Reflect.construct(e,[],t)}else{try{t.call()}catch(Q){o=Q}e.call(t.prototype)}else{try{throw Error()}catch(Q){o=Q}e()}}catch(Q){if(Q&&o&&typeof Q.stack=="string"){for(var s=Q.stack.split(`
`),i=o.stack.split(`
`),h=s.length-1,S=i.length-1;1<=h&&0<=S&&s[h]!==i[S];)S--;for(;1<=h&&0<=S;h--,S--)if(s[h]!==i[S]){if(h!==1||S!==1)do if(h--,S--,0>S||s[h]!==i[S]){var E=`
`+s[h].replace(" at new "," at ");return e.displayName&&E.includes("<anonymous>")&&(E=E.replace("<anonymous>",e.displayName)),E}while(1<=h&&0<=S);break}}}finally{ne=!1,Error.prepareStackTrace=n}return(e=e?e.displayName||e.name:"")?I(e):""}function de(e){switch(e.tag){case 5:return I(e.type);case 16:return I("Lazy");case 13:return I("Suspense");case 19:return I("SuspenseList");case 0:case 2:case 15:return e=K(e.type,!1),e;case 11:return e=K(e.type.render,!1),e;case 1:return e=K(e.type,!0),e;default:return""}}function ue(e){if(e==null)return null;if(typeof e=="function")return e.displayName||e.name||null;if(typeof e=="string")return e;switch(e){case F:return"Fragment";case k:return"Portal";case re:return"Profiler";case H:return"StrictMode";case J:return"Suspense";case A:return"SuspenseList"}if(typeof e=="object")switch(e.$$typeof){case W:return(e.displayName||"Context")+".Consumer";case ee:return(e._context.displayName||"Context")+".Provider";case Z:var t=e.render;return e=e.displayName,e||(e=t.displayName||t.name||"",e=e!==""?"ForwardRef("+e+")":"ForwardRef"),e;case X:return t=e.displayName||null,t!==null?t:ue(e.type)||"Memo";case $:t=e._payload,e=e._init;try{return ue(e(t))}catch{}}return null}function ve(e){var t=e.type;switch(e.tag){case 24:return"Cache";case 9:return(t.displayName||"Context")+".Consumer";case 10:return(t._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return e=t.render,e=e.displayName||e.name||"",t.displayName||(e!==""?"ForwardRef("+e+")":"ForwardRef");case 7:return"Fragment";case 5:return t;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return ue(t);case 8:return t===H?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof t=="function")return t.displayName||t.name||null;if(typeof t=="string")return t}return null}function pe(e){switch(typeof e){case"boolean":case"number":case"string":case"undefined":return e;case"object":return e;default:return""}}function Se(e){var t=e.type;return(e=e.nodeName)&&e.toLowerCase()==="input"&&(t==="checkbox"||t==="radio")}function Te(e){var t=Se(e)?"checked":"value",n=Object.getOwnPropertyDescriptor(e.constructor.prototype,t),o=""+e[t];if(!e.hasOwnProperty(t)&&typeof n<"u"&&typeof n.get=="function"&&typeof n.set=="function"){var s=n.get,i=n.set;return Object.defineProperty(e,t,{configurable:!0,get:function(){return s.call(this)},set:function(h){o=""+h,i.call(this,h)}}),Object.defineProperty(e,t,{enumerable:n.enumerable}),{getValue:function(){return o},setValue:function(h){o=""+h},stopTracking:function(){e._valueTracker=null,delete e[t]}}}}function De(e){e._valueTracker||(e._valueTracker=Te(e))}function jt(e){if(!e)return!1;var t=e._valueTracker;if(!t)return!0;var n=t.getValue(),o="";return e&&(o=Se(e)?e.checked?"true":"false":e.value),e=o,e!==n?(t.setValue(e),!0):!1}function Ge(e){if(e=e||(typeof document<"u"?document:void 0),typeof e>"u")return null;try{return e.activeElement||e.body}catch{return e.body}}function Qe(e,t){var n=t.checked;return _({},t,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:n??e._wrapperState.initialChecked})}function Ct(e,t){var n=t.defaultValue==null?"":t.defaultValue,o=t.checked!=null?t.checked:t.defaultChecked;n=pe(t.value!=null?t.value:n),e._wrapperState={initialChecked:o,initialValue:n,controlled:t.type==="checkbox"||t.type==="radio"?t.checked!=null:t.value!=null}}function mt(e,t){t=t.checked,t!=null&&q(e,"checked",t,!1)}function se(e,t){mt(e,t);var n=pe(t.value),o=t.type;if(n!=null)o==="number"?(n===0&&e.value===""||e.value!=n)&&(e.value=""+n):e.value!==""+n&&(e.value=""+n);else if(o==="submit"||o==="reset"){e.removeAttribute("value");return}t.hasOwnProperty("value")?Re(e,t.type,n):t.hasOwnProperty("defaultValue")&&Re(e,t.type,pe(t.defaultValue)),t.checked==null&&t.defaultChecked!=null&&(e.defaultChecked=!!t.defaultChecked)}function Be(e,t,n){if(t.hasOwnProperty("value")||t.hasOwnProperty("defaultValue")){var o=t.type;if(!(o!=="submit"&&o!=="reset"||t.value!==void 0&&t.value!==null))return;t=""+e._wrapperState.initialValue,n||t===e.value||(e.value=t),e.defaultValue=t}n=e.name,n!==""&&(e.name=""),e.defaultChecked=!!e._wrapperState.initialChecked,n!==""&&(e.name=n)}function Re(e,t,n){(t!=="number"||Ge(e.ownerDocument)!==e)&&(n==null?e.defaultValue=""+e._wrapperState.initialValue:e.defaultValue!==""+n&&(e.defaultValue=""+n))}var te=Array.isArray;function ge(e,t,n,o){if(e=e.options,t){t={};for(var s=0;s<n.length;s++)t["$"+n[s]]=!0;for(n=0;n<e.length;n++)s=t.hasOwnProperty("$"+e[n].value),e[n].selected!==s&&(e[n].selected=s),s&&o&&(e[n].defaultSelected=!0)}else{for(n=""+pe(n),t=null,s=0;s<e.length;s++){if(e[s].value===n){e[s].selected=!0,o&&(e[s].defaultSelected=!0);return}t!==null||e[s].disabled||(t=e[s])}t!==null&&(t.selected=!0)}}function be(e,t){if(t.dangerouslySetInnerHTML!=null)throw Error(a(91));return _({},t,{value:void 0,defaultValue:void 0,children:""+e._wrapperState.initialValue})}function xe(e,t){var n=t.value;if(n==null){if(n=t.children,t=t.defaultValue,n!=null){if(t!=null)throw Error(a(92));if(te(n)){if(1<n.length)throw Error(a(93));n=n[0]}t=n}t==null&&(t=""),n=t}e._wrapperState={initialValue:pe(n)}}function Ae(e,t){var n=pe(t.value),o=pe(t.defaultValue);n!=null&&(n=""+n,n!==e.value&&(e.value=n),t.defaultValue==null&&e.defaultValue!==n&&(e.defaultValue=n)),o!=null&&(e.defaultValue=""+o)}function He(e){var t=e.textContent;t===e._wrapperState.initialValue&&t!==""&&t!==null&&(e.value=t)}function at(e){switch(e){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function ut(e,t){return e==null||e==="http://www.w3.org/1999/xhtml"?at(t):e==="http://www.w3.org/2000/svg"&&t==="foreignObject"?"http://www.w3.org/1999/xhtml":e}var xt,lt=(function(e){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(t,n,o,s){MSApp.execUnsafeLocalFunction(function(){return e(t,n,o,s)})}:e})(function(e,t){if(e.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in e)e.innerHTML=t;else{for(xt=xt||document.createElement("div"),xt.innerHTML="<svg>"+t.valueOf().toString()+"</svg>",t=xt.firstChild;e.firstChild;)e.removeChild(e.firstChild);for(;t.firstChild;)e.appendChild(t.firstChild)}});function Et(e,t){if(t){var n=e.firstChild;if(n&&n===e.lastChild&&n.nodeType===3){n.nodeValue=t;return}}e.textContent=t}var yt={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},sn=["Webkit","ms","Moz","O"];Object.keys(yt).forEach(function(e){sn.forEach(function(t){t=t+e.charAt(0).toUpperCase()+e.substring(1),yt[t]=yt[e]})});function Mt(e,t,n){return t==null||typeof t=="boolean"||t===""?"":n||typeof t!="number"||t===0||yt.hasOwnProperty(e)&&yt[e]?(""+t).trim():t+"px"}function Pt(e,t){e=e.style;for(var n in t)if(t.hasOwnProperty(n)){var o=n.indexOf("--")===0,s=Mt(n,t[n],o);n==="float"&&(n="cssFloat"),o?e.setProperty(n,s):e[n]=s}}var Cn=_({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function Bt(e,t){if(t){if(Cn[e]&&(t.children!=null||t.dangerouslySetInnerHTML!=null))throw Error(a(137,e));if(t.dangerouslySetInnerHTML!=null){if(t.children!=null)throw Error(a(60));if(typeof t.dangerouslySetInnerHTML!="object"||!("__html"in t.dangerouslySetInnerHTML))throw Error(a(61))}if(t.style!=null&&typeof t.style!="object")throw Error(a(62))}}function dt(e,t){if(e.indexOf("-")===-1)return typeof t.is=="string";switch(e){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var xr=null;function Kt(e){return e=e.target||e.srcElement||window,e.correspondingUseElement&&(e=e.correspondingUseElement),e.nodeType===3?e.parentNode:e}var Tn=null,an=null,En=null;function ln(e){if(e=Do(e)){if(typeof Tn!="function")throw Error(a(280));var t=e.stateNode;t&&(t=fs(t),Tn(e.stateNode,e.type,t))}}function Zn(e){an?En?En.push(e):En=[e]:an=e}function Qt(){if(an){var e=an,t=En;if(En=an=null,ln(e),t)for(e=0;e<t.length;e++)ln(t[e])}}function yr(e,t){return e(t)}function yn(){}var _n=!1;function Mn(e,t,n){if(_n)return e(t,n);_n=!0;try{return yr(e,t,n)}finally{_n=!1,(an!==null||En!==null)&&(yn(),Qt())}}function An(e,t){var n=e.stateNode;if(n===null)return null;var o=fs(n);if(o===null)return null;n=o[t];e:switch(t){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(o=!o.disabled)||(e=e.type,o=!(e==="button"||e==="input"||e==="select"||e==="textarea")),e=!o;break e;default:e=!1}if(e)return null;if(n&&typeof n!="function")throw Error(a(231,t,typeof n));return n}var cn=!1;if(w)try{var G={};Object.defineProperty(G,"passive",{get:function(){cn=!0}}),window.addEventListener("test",G,G),window.removeEventListener("test",G,G)}catch{cn=!1}function fe(e,t,n,o,s,i,h,S,E){var Q=Array.prototype.slice.call(arguments,3);try{t.apply(n,Q)}catch(ie){this.onError(ie)}}var Ne=!1,Fe=null,ze=!1,$e=null,Ye={onError:function(e){Ne=!0,Fe=e}};function Ze(e,t,n,o,s,i,h,S,E){Ne=!1,Fe=null,fe.apply(Ye,arguments)}function ft(e,t,n,o,s,i,h,S,E){if(Ze.apply(this,arguments),Ne){if(Ne){var Q=Fe;Ne=!1,Fe=null}else throw Error(a(198));ze||(ze=!0,$e=Q)}}function Ke(e){var t=e,n=e;if(e.alternate)for(;t.return;)t=t.return;else{e=t;do t=e,(t.flags&4098)!==0&&(n=t.return),e=t.return;while(e)}return t.tag===3?n:null}function Ue(e){if(e.tag===13){var t=e.memoizedState;if(t===null&&(e=e.alternate,e!==null&&(t=e.memoizedState)),t!==null)return t.dehydrated}return null}function pt(e){if(Ke(e)!==e)throw Error(a(188))}function vt(e){var t=e.alternate;if(!t){if(t=Ke(e),t===null)throw Error(a(188));return t!==e?null:e}for(var n=e,o=t;;){var s=n.return;if(s===null)break;var i=s.alternate;if(i===null){if(o=s.return,o!==null){n=o;continue}break}if(s.child===i.child){for(i=s.child;i;){if(i===n)return pt(s),e;if(i===o)return pt(s),t;i=i.sibling}throw Error(a(188))}if(n.return!==o.return)n=s,o=i;else{for(var h=!1,S=s.child;S;){if(S===n){h=!0,n=s,o=i;break}if(S===o){h=!0,o=s,n=i;break}S=S.sibling}if(!h){for(S=i.child;S;){if(S===n){h=!0,n=i,o=s;break}if(S===o){h=!0,o=i,n=s;break}S=S.sibling}if(!h)throw Error(a(189))}}if(n.alternate!==o)throw Error(a(190))}if(n.tag!==3)throw Error(a(188));return n.stateNode.current===n?e:t}function nt(e){return e=vt(e),e!==null?St(e):null}function St(e){if(e.tag===5||e.tag===6)return e;for(e=e.child;e!==null;){var t=St(e);if(t!==null)return t;e=e.sibling}return null}var Rt=c.unstable_scheduleCallback,Je=c.unstable_cancelCallback,qt=c.unstable_shouldYield,Pn=c.unstable_requestPaint,Ve=c.unstable_now,Wt=c.unstable_getCurrentPriorityLevel,Dn=c.unstable_ImmediatePriority,Ln=c.unstable_UserBlockingPriority,Fr=c.unstable_NormalPriority,sa=c.unstable_LowPriority,Ko=c.unstable_IdlePriority,Kn=null,un=null;function aa(e){if(un&&typeof un.onCommitFiberRoot=="function")try{un.onCommitFiberRoot(Kn,e,void 0,(e.current.flags&128)===128)}catch{}}var Jt=Math.clz32?Math.clz32:zr,la=Math.log,ia=Math.LN2;function zr(e){return e>>>=0,e===0?32:31-(la(e)/ia|0)|0}var Tr=64,_r=4194304;function On(e){switch(e&-e){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return e&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return e&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return e}}function vr(e,t){var n=e.pendingLanes;if(n===0)return 0;var o=0,s=e.suspendedLanes,i=e.pingedLanes,h=n&268435455;if(h!==0){var S=h&~s;S!==0?o=On(S):(i&=h,i!==0&&(o=On(i)))}else h=n&~s,h!==0?o=On(h):i!==0&&(o=On(i));if(o===0)return 0;if(t!==0&&t!==o&&(t&s)===0&&(s=o&-o,i=t&-t,s>=i||s===16&&(i&4194240)!==0))return t;if((o&4)!==0&&(o|=n&16),t=e.entangledLanes,t!==0)for(e=e.entanglements,t&=o;0<t;)n=31-Jt(t),s=1<<n,o|=e[n],t&=~s;return o}function ca(e,t){switch(e){case 1:case 2:case 4:return t+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return t+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function ua(e,t){for(var n=e.suspendedLanes,o=e.pingedLanes,s=e.expirationTimes,i=e.pendingLanes;0<i;){var h=31-Jt(i),S=1<<h,E=s[h];E===-1?((S&n)===0||(S&o)!==0)&&(s[h]=ca(S,t)):E<=t&&(e.expiredLanes|=S),i&=~S}}function V(e){return e=e.pendingLanes&-1073741825,e!==0?e:e&1073741824?1073741824:0}function me(){var e=Tr;return Tr<<=1,(Tr&4194240)===0&&(Tr=64),e}function Ee(e){for(var t=[],n=0;31>n;n++)t.push(e);return t}function Le(e,t,n){e.pendingLanes|=t,t!==536870912&&(e.suspendedLanes=0,e.pingedLanes=0),e=e.eventTimes,t=31-Jt(t),e[t]=n}function rt(e,t){var n=e.pendingLanes&~t;e.pendingLanes=t,e.suspendedLanes=0,e.pingedLanes=0,e.expiredLanes&=t,e.mutableReadLanes&=t,e.entangledLanes&=t,t=e.entanglements;var o=e.eventTimes;for(e=e.expirationTimes;0<n;){var s=31-Jt(n),i=1<<s;t[s]=0,o[s]=-1,e[s]=-1,n&=~i}}function ot(e,t){var n=e.entangledLanes|=t;for(e=e.entanglements;n;){var o=31-Jt(n),s=1<<o;s&t|e[o]&t&&(e[o]|=t),n&=~s}}var _e=0;function en(e){return e&=-e,1<e?4<e?(e&268435455)!==0?16:536870912:4:1}var Bn,Ar,ho,li,ii,da=!1,Qo=[],Qn=null,qn=null,Jn=null,po=new Map,go=new Map,er=[],hd="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function ci(e,t){switch(e){case"focusin":case"focusout":Qn=null;break;case"dragenter":case"dragleave":qn=null;break;case"mouseover":case"mouseout":Jn=null;break;case"pointerover":case"pointerout":po.delete(t.pointerId);break;case"gotpointercapture":case"lostpointercapture":go.delete(t.pointerId)}}function mo(e,t,n,o,s,i){return e===null||e.nativeEvent!==i?(e={blockedOn:t,domEventName:n,eventSystemFlags:o,nativeEvent:i,targetContainers:[s]},t!==null&&(t=Do(t),t!==null&&Ar(t)),e):(e.eventSystemFlags|=o,t=e.targetContainers,s!==null&&t.indexOf(s)===-1&&t.push(s),e)}function pd(e,t,n,o,s){switch(t){case"focusin":return Qn=mo(Qn,e,t,n,o,s),!0;case"dragenter":return qn=mo(qn,e,t,n,o,s),!0;case"mouseover":return Jn=mo(Jn,e,t,n,o,s),!0;case"pointerover":var i=s.pointerId;return po.set(i,mo(po.get(i)||null,e,t,n,o,s)),!0;case"gotpointercapture":return i=s.pointerId,go.set(i,mo(go.get(i)||null,e,t,n,o,s)),!0}return!1}function ui(e){var t=wr(e.target);if(t!==null){var n=Ke(t);if(n!==null){if(t=n.tag,t===13){if(t=Ue(n),t!==null){e.blockedOn=t,ii(e.priority,function(){ho(n)});return}}else if(t===3&&n.stateNode.current.memoizedState.isDehydrated){e.blockedOn=n.tag===3?n.stateNode.containerInfo:null;return}}}e.blockedOn=null}function qo(e){if(e.blockedOn!==null)return!1;for(var t=e.targetContainers;0<t.length;){var n=ha(e.domEventName,e.eventSystemFlags,t[0],e.nativeEvent);if(n===null){n=e.nativeEvent;var o=new n.constructor(n.type,n);xr=o,n.target.dispatchEvent(o),xr=null}else return t=Do(n),t!==null&&Ar(t),e.blockedOn=n,!1;t.shift()}return!0}function di(e,t,n){qo(e)&&n.delete(t)}function gd(){da=!1,Qn!==null&&qo(Qn)&&(Qn=null),qn!==null&&qo(qn)&&(qn=null),Jn!==null&&qo(Jn)&&(Jn=null),po.forEach(di),go.forEach(di)}function xo(e,t){e.blockedOn===t&&(e.blockedOn=null,da||(da=!0,c.unstable_scheduleCallback(c.unstable_NormalPriority,gd)))}function yo(e){function t(s){return xo(s,e)}if(0<Qo.length){xo(Qo[0],e);for(var n=1;n<Qo.length;n++){var o=Qo[n];o.blockedOn===e&&(o.blockedOn=null)}}for(Qn!==null&&xo(Qn,e),qn!==null&&xo(qn,e),Jn!==null&&xo(Jn,e),po.forEach(t),go.forEach(t),n=0;n<er.length;n++)o=er[n],o.blockedOn===e&&(o.blockedOn=null);for(;0<er.length&&(n=er[0],n.blockedOn===null);)ui(n),n.blockedOn===null&&er.shift()}var Or=U.ReactCurrentBatchConfig,Jo=!0;function md(e,t,n,o){var s=_e,i=Or.transition;Or.transition=null;try{_e=1,fa(e,t,n,o)}finally{_e=s,Or.transition=i}}function xd(e,t,n,o){var s=_e,i=Or.transition;Or.transition=null;try{_e=4,fa(e,t,n,o)}finally{_e=s,Or.transition=i}}function fa(e,t,n,o){if(Jo){var s=ha(e,t,n,o);if(s===null)Da(e,t,o,es,n),ci(e,o);else if(pd(s,e,t,n,o))o.stopPropagation();else if(ci(e,o),t&4&&-1<hd.indexOf(e)){for(;s!==null;){var i=Do(s);if(i!==null&&Bn(i),i=ha(e,t,n,o),i===null&&Da(e,t,o,es,n),i===s)break;s=i}s!==null&&o.stopPropagation()}else Da(e,t,o,null,n)}}var es=null;function ha(e,t,n,o){if(es=null,e=Kt(o),e=wr(e),e!==null)if(t=Ke(e),t===null)e=null;else if(n=t.tag,n===13){if(e=Ue(t),e!==null)return e;e=null}else if(n===3){if(t.stateNode.current.memoizedState.isDehydrated)return t.tag===3?t.stateNode.containerInfo:null;e=null}else t!==e&&(e=null);return es=e,null}function fi(e){switch(e){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(Wt()){case Dn:return 1;case Ln:return 4;case Fr:case sa:return 16;case Ko:return 536870912;default:return 16}default:return 16}}var tr=null,pa=null,ts=null;function hi(){if(ts)return ts;var e,t=pa,n=t.length,o,s="value"in tr?tr.value:tr.textContent,i=s.length;for(e=0;e<n&&t[e]===s[e];e++);var h=n-e;for(o=1;o<=h&&t[n-o]===s[i-o];o++);return ts=s.slice(e,1<o?1-o:void 0)}function ns(e){var t=e.keyCode;return"charCode"in e?(e=e.charCode,e===0&&t===13&&(e=13)):e=t,e===10&&(e=13),32<=e||e===13?e:0}function rs(){return!0}function pi(){return!1}function tn(e){function t(n,o,s,i,h){this._reactName=n,this._targetInst=s,this.type=o,this.nativeEvent=i,this.target=h,this.currentTarget=null;for(var S in e)e.hasOwnProperty(S)&&(n=e[S],this[S]=n?n(i):i[S]);return this.isDefaultPrevented=(i.defaultPrevented!=null?i.defaultPrevented:i.returnValue===!1)?rs:pi,this.isPropagationStopped=pi,this}return _(t.prototype,{preventDefault:function(){this.defaultPrevented=!0;var n=this.nativeEvent;n&&(n.preventDefault?n.preventDefault():typeof n.returnValue!="unknown"&&(n.returnValue=!1),this.isDefaultPrevented=rs)},stopPropagation:function(){var n=this.nativeEvent;n&&(n.stopPropagation?n.stopPropagation():typeof n.cancelBubble!="unknown"&&(n.cancelBubble=!0),this.isPropagationStopped=rs)},persist:function(){},isPersistent:rs}),t}var Br={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(e){return e.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},ga=tn(Br),vo=_({},Br,{view:0,detail:0}),yd=tn(vo),ma,xa,wo,os=_({},vo,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:va,button:0,buttons:0,relatedTarget:function(e){return e.relatedTarget===void 0?e.fromElement===e.srcElement?e.toElement:e.fromElement:e.relatedTarget},movementX:function(e){return"movementX"in e?e.movementX:(e!==wo&&(wo&&e.type==="mousemove"?(ma=e.screenX-wo.screenX,xa=e.screenY-wo.screenY):xa=ma=0,wo=e),ma)},movementY:function(e){return"movementY"in e?e.movementY:xa}}),gi=tn(os),vd=_({},os,{dataTransfer:0}),wd=tn(vd),bd=_({},vo,{relatedTarget:0}),ya=tn(bd),jd=_({},Br,{animationName:0,elapsedTime:0,pseudoElement:0}),Sd=tn(jd),Nd=_({},Br,{clipboardData:function(e){return"clipboardData"in e?e.clipboardData:window.clipboardData}}),kd=tn(Nd),Cd=_({},Br,{data:0}),mi=tn(Cd),Ed={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},Md={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Pd={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Dd(e){var t=this.nativeEvent;return t.getModifierState?t.getModifierState(e):(e=Pd[e])?!!t[e]:!1}function va(){return Dd}var Ld=_({},vo,{key:function(e){if(e.key){var t=Ed[e.key]||e.key;if(t!=="Unidentified")return t}return e.type==="keypress"?(e=ns(e),e===13?"Enter":String.fromCharCode(e)):e.type==="keydown"||e.type==="keyup"?Md[e.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:va,charCode:function(e){return e.type==="keypress"?ns(e):0},keyCode:function(e){return e.type==="keydown"||e.type==="keyup"?e.keyCode:0},which:function(e){return e.type==="keypress"?ns(e):e.type==="keydown"||e.type==="keyup"?e.keyCode:0}}),Id=tn(Ld),Rd=_({},os,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),xi=tn(Rd),Fd=_({},vo,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:va}),zd=tn(Fd),Td=_({},Br,{propertyName:0,elapsedTime:0,pseudoElement:0}),_d=tn(Td),Ad=_({},os,{deltaX:function(e){return"deltaX"in e?e.deltaX:"wheelDeltaX"in e?-e.wheelDeltaX:0},deltaY:function(e){return"deltaY"in e?e.deltaY:"wheelDeltaY"in e?-e.wheelDeltaY:"wheelDelta"in e?-e.wheelDelta:0},deltaZ:0,deltaMode:0}),Od=tn(Ad),Bd=[9,13,27,32],wa=w&&"CompositionEvent"in window,bo=null;w&&"documentMode"in document&&(bo=document.documentMode);var $d=w&&"TextEvent"in window&&!bo,yi=w&&(!wa||bo&&8<bo&&11>=bo),vi=" ",wi=!1;function bi(e,t){switch(e){case"keyup":return Bd.indexOf(t.keyCode)!==-1;case"keydown":return t.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function ji(e){return e=e.detail,typeof e=="object"&&"data"in e?e.data:null}var $r=!1;function Ud(e,t){switch(e){case"compositionend":return ji(t);case"keypress":return t.which!==32?null:(wi=!0,vi);case"textInput":return e=t.data,e===vi&&wi?null:e;default:return null}}function Wd(e,t){if($r)return e==="compositionend"||!wa&&bi(e,t)?(e=hi(),ts=pa=tr=null,$r=!1,e):null;switch(e){case"paste":return null;case"keypress":if(!(t.ctrlKey||t.altKey||t.metaKey)||t.ctrlKey&&t.altKey){if(t.char&&1<t.char.length)return t.char;if(t.which)return String.fromCharCode(t.which)}return null;case"compositionend":return yi&&t.locale!=="ko"?null:t.data;default:return null}}var Hd={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function Si(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t==="input"?!!Hd[e.type]:t==="textarea"}function Ni(e,t,n,o){Zn(o),t=cs(t,"onChange"),0<t.length&&(n=new ga("onChange","change",null,n,o),e.push({event:n,listeners:t}))}var jo=null,So=null;function Yd(e){Ui(e,0)}function ss(e){var t=Xr(e);if(jt(t))return e}function Xd(e,t){if(e==="change")return t}var ki=!1;if(w){var ba;if(w){var ja="oninput"in document;if(!ja){var Ci=document.createElement("div");Ci.setAttribute("oninput","return;"),ja=typeof Ci.oninput=="function"}ba=ja}else ba=!1;ki=ba&&(!document.documentMode||9<document.documentMode)}function Ei(){jo&&(jo.detachEvent("onpropertychange",Mi),So=jo=null)}function Mi(e){if(e.propertyName==="value"&&ss(So)){var t=[];Ni(t,So,e,Kt(e)),Mn(Yd,t)}}function Vd(e,t,n){e==="focusin"?(Ei(),jo=t,So=n,jo.attachEvent("onpropertychange",Mi)):e==="focusout"&&Ei()}function Gd(e){if(e==="selectionchange"||e==="keyup"||e==="keydown")return ss(So)}function Zd(e,t){if(e==="click")return ss(t)}function Kd(e,t){if(e==="input"||e==="change")return ss(t)}function Qd(e,t){return e===t&&(e!==0||1/e===1/t)||e!==e&&t!==t}var vn=typeof Object.is=="function"?Object.is:Qd;function No(e,t){if(vn(e,t))return!0;if(typeof e!="object"||e===null||typeof t!="object"||t===null)return!1;var n=Object.keys(e),o=Object.keys(t);if(n.length!==o.length)return!1;for(o=0;o<n.length;o++){var s=n[o];if(!f.call(t,s)||!vn(e[s],t[s]))return!1}return!0}function Pi(e){for(;e&&e.firstChild;)e=e.firstChild;return e}function Di(e,t){var n=Pi(e);e=0;for(var o;n;){if(n.nodeType===3){if(o=e+n.textContent.length,e<=t&&o>=t)return{node:n,offset:t-e};e=o}e:{for(;n;){if(n.nextSibling){n=n.nextSibling;break e}n=n.parentNode}n=void 0}n=Pi(n)}}function Li(e,t){return e&&t?e===t?!0:e&&e.nodeType===3?!1:t&&t.nodeType===3?Li(e,t.parentNode):"contains"in e?e.contains(t):e.compareDocumentPosition?!!(e.compareDocumentPosition(t)&16):!1:!1}function Ii(){for(var e=window,t=Ge();t instanceof e.HTMLIFrameElement;){try{var n=typeof t.contentWindow.location.href=="string"}catch{n=!1}if(n)e=t.contentWindow;else break;t=Ge(e.document)}return t}function Sa(e){var t=e&&e.nodeName&&e.nodeName.toLowerCase();return t&&(t==="input"&&(e.type==="text"||e.type==="search"||e.type==="tel"||e.type==="url"||e.type==="password")||t==="textarea"||e.contentEditable==="true")}function qd(e){var t=Ii(),n=e.focusedElem,o=e.selectionRange;if(t!==n&&n&&n.ownerDocument&&Li(n.ownerDocument.documentElement,n)){if(o!==null&&Sa(n)){if(t=o.start,e=o.end,e===void 0&&(e=t),"selectionStart"in n)n.selectionStart=t,n.selectionEnd=Math.min(e,n.value.length);else if(e=(t=n.ownerDocument||document)&&t.defaultView||window,e.getSelection){e=e.getSelection();var s=n.textContent.length,i=Math.min(o.start,s);o=o.end===void 0?i:Math.min(o.end,s),!e.extend&&i>o&&(s=o,o=i,i=s),s=Di(n,i);var h=Di(n,o);s&&h&&(e.rangeCount!==1||e.anchorNode!==s.node||e.anchorOffset!==s.offset||e.focusNode!==h.node||e.focusOffset!==h.offset)&&(t=t.createRange(),t.setStart(s.node,s.offset),e.removeAllRanges(),i>o?(e.addRange(t),e.extend(h.node,h.offset)):(t.setEnd(h.node,h.offset),e.addRange(t)))}}for(t=[],e=n;e=e.parentNode;)e.nodeType===1&&t.push({element:e,left:e.scrollLeft,top:e.scrollTop});for(typeof n.focus=="function"&&n.focus(),n=0;n<t.length;n++)e=t[n],e.element.scrollLeft=e.left,e.element.scrollTop=e.top}}var Jd=w&&"documentMode"in document&&11>=document.documentMode,Ur=null,Na=null,ko=null,ka=!1;function Ri(e,t,n){var o=n.window===n?n.document:n.nodeType===9?n:n.ownerDocument;ka||Ur==null||Ur!==Ge(o)||(o=Ur,"selectionStart"in o&&Sa(o)?o={start:o.selectionStart,end:o.selectionEnd}:(o=(o.ownerDocument&&o.ownerDocument.defaultView||window).getSelection(),o={anchorNode:o.anchorNode,anchorOffset:o.anchorOffset,focusNode:o.focusNode,focusOffset:o.focusOffset}),ko&&No(ko,o)||(ko=o,o=cs(Na,"onSelect"),0<o.length&&(t=new ga("onSelect","select",null,t,n),e.push({event:t,listeners:o}),t.target=Ur)))}function as(e,t){var n={};return n[e.toLowerCase()]=t.toLowerCase(),n["Webkit"+e]="webkit"+t,n["Moz"+e]="moz"+t,n}var Wr={animationend:as("Animation","AnimationEnd"),animationiteration:as("Animation","AnimationIteration"),animationstart:as("Animation","AnimationStart"),transitionend:as("Transition","TransitionEnd")},Ca={},Fi={};w&&(Fi=document.createElement("div").style,"AnimationEvent"in window||(delete Wr.animationend.animation,delete Wr.animationiteration.animation,delete Wr.animationstart.animation),"TransitionEvent"in window||delete Wr.transitionend.transition);function ls(e){if(Ca[e])return Ca[e];if(!Wr[e])return e;var t=Wr[e],n;for(n in t)if(t.hasOwnProperty(n)&&n in Fi)return Ca[e]=t[n];return e}var zi=ls("animationend"),Ti=ls("animationiteration"),_i=ls("animationstart"),Ai=ls("transitionend"),Oi=new Map,Bi="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function nr(e,t){Oi.set(e,t),y(t,[e])}for(var Ea=0;Ea<Bi.length;Ea++){var Ma=Bi[Ea],ef=Ma.toLowerCase(),tf=Ma[0].toUpperCase()+Ma.slice(1);nr(ef,"on"+tf)}nr(zi,"onAnimationEnd"),nr(Ti,"onAnimationIteration"),nr(_i,"onAnimationStart"),nr("dblclick","onDoubleClick"),nr("focusin","onFocus"),nr("focusout","onBlur"),nr(Ai,"onTransitionEnd"),m("onMouseEnter",["mouseout","mouseover"]),m("onMouseLeave",["mouseout","mouseover"]),m("onPointerEnter",["pointerout","pointerover"]),m("onPointerLeave",["pointerout","pointerover"]),y("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),y("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),y("onBeforeInput",["compositionend","keypress","textInput","paste"]),y("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),y("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),y("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Co="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),nf=new Set("cancel close invalid load scroll toggle".split(" ").concat(Co));function $i(e,t,n){var o=e.type||"unknown-event";e.currentTarget=n,ft(o,t,void 0,e),e.currentTarget=null}function Ui(e,t){t=(t&4)!==0;for(var n=0;n<e.length;n++){var o=e[n],s=o.event;o=o.listeners;e:{var i=void 0;if(t)for(var h=o.length-1;0<=h;h--){var S=o[h],E=S.instance,Q=S.currentTarget;if(S=S.listener,E!==i&&s.isPropagationStopped())break e;$i(s,S,Q),i=E}else for(h=0;h<o.length;h++){if(S=o[h],E=S.instance,Q=S.currentTarget,S=S.listener,E!==i&&s.isPropagationStopped())break e;$i(s,S,Q),i=E}}}if(ze)throw e=$e,ze=!1,$e=null,e}function et(e,t){var n=t[Ta];n===void 0&&(n=t[Ta]=new Set);var o=e+"__bubble";n.has(o)||(Wi(t,e,2,!1),n.add(o))}function Pa(e,t,n){var o=0;t&&(o|=4),Wi(n,e,o,t)}var is="_reactListening"+Math.random().toString(36).slice(2);function Eo(e){if(!e[is]){e[is]=!0,d.forEach(function(n){n!=="selectionchange"&&(nf.has(n)||Pa(n,!1,e),Pa(n,!0,e))});var t=e.nodeType===9?e:e.ownerDocument;t===null||t[is]||(t[is]=!0,Pa("selectionchange",!1,t))}}function Wi(e,t,n,o){switch(fi(t)){case 1:var s=md;break;case 4:s=xd;break;default:s=fa}n=s.bind(null,t,n,e),s=void 0,!cn||t!=="touchstart"&&t!=="touchmove"&&t!=="wheel"||(s=!0),o?s!==void 0?e.addEventListener(t,n,{capture:!0,passive:s}):e.addEventListener(t,n,!0):s!==void 0?e.addEventListener(t,n,{passive:s}):e.addEventListener(t,n,!1)}function Da(e,t,n,o,s){var i=o;if((t&1)===0&&(t&2)===0&&o!==null)e:for(;;){if(o===null)return;var h=o.tag;if(h===3||h===4){var S=o.stateNode.containerInfo;if(S===s||S.nodeType===8&&S.parentNode===s)break;if(h===4)for(h=o.return;h!==null;){var E=h.tag;if((E===3||E===4)&&(E=h.stateNode.containerInfo,E===s||E.nodeType===8&&E.parentNode===s))return;h=h.return}for(;S!==null;){if(h=wr(S),h===null)return;if(E=h.tag,E===5||E===6){o=i=h;continue e}S=S.parentNode}}o=o.return}Mn(function(){var Q=i,ie=Kt(n),ce=[];e:{var le=Oi.get(e);if(le!==void 0){var ye=ga,je=e;switch(e){case"keypress":if(ns(n)===0)break e;case"keydown":case"keyup":ye=Id;break;case"focusin":je="focus",ye=ya;break;case"focusout":je="blur",ye=ya;break;case"beforeblur":case"afterblur":ye=ya;break;case"click":if(n.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ye=gi;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ye=wd;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ye=zd;break;case zi:case Ti:case _i:ye=Sd;break;case Ai:ye=_d;break;case"scroll":ye=yd;break;case"wheel":ye=Od;break;case"copy":case"cut":case"paste":ye=kd;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ye=xi}var ke=(t&4)!==0,gt=!ke&&e==="scroll",B=ke?le!==null?le+"Capture":null:le;ke=[];for(var L=Q,Y;L!==null;){Y=L;var he=Y.stateNode;if(Y.tag===5&&he!==null&&(Y=he,B!==null&&(he=An(L,B),he!=null&&ke.push(Mo(L,he,Y)))),gt)break;L=L.return}0<ke.length&&(le=new ye(le,je,null,n,ie),ce.push({event:le,listeners:ke}))}}if((t&7)===0){e:{if(le=e==="mouseover"||e==="pointerover",ye=e==="mouseout"||e==="pointerout",le&&n!==xr&&(je=n.relatedTarget||n.fromElement)&&(wr(je)||je[$n]))break e;if((ye||le)&&(le=ie.window===ie?ie:(le=ie.ownerDocument)?le.defaultView||le.parentWindow:window,ye?(je=n.relatedTarget||n.toElement,ye=Q,je=je?wr(je):null,je!==null&&(gt=Ke(je),je!==gt||je.tag!==5&&je.tag!==6)&&(je=null)):(ye=null,je=Q),ye!==je)){if(ke=gi,he="onMouseLeave",B="onMouseEnter",L="mouse",(e==="pointerout"||e==="pointerover")&&(ke=xi,he="onPointerLeave",B="onPointerEnter",L="pointer"),gt=ye==null?le:Xr(ye),Y=je==null?le:Xr(je),le=new ke(he,L+"leave",ye,n,ie),le.target=gt,le.relatedTarget=Y,he=null,wr(ie)===Q&&(ke=new ke(B,L+"enter",je,n,ie),ke.target=Y,ke.relatedTarget=gt,he=ke),gt=he,ye&&je)t:{for(ke=ye,B=je,L=0,Y=ke;Y;Y=Hr(Y))L++;for(Y=0,he=B;he;he=Hr(he))Y++;for(;0<L-Y;)ke=Hr(ke),L--;for(;0<Y-L;)B=Hr(B),Y--;for(;L--;){if(ke===B||B!==null&&ke===B.alternate)break t;ke=Hr(ke),B=Hr(B)}ke=null}else ke=null;ye!==null&&Hi(ce,le,ye,ke,!1),je!==null&&gt!==null&&Hi(ce,gt,je,ke,!0)}}e:{if(le=Q?Xr(Q):window,ye=le.nodeName&&le.nodeName.toLowerCase(),ye==="select"||ye==="input"&&le.type==="file")var Ce=Xd;else if(Si(le))if(ki)Ce=Kd;else{Ce=Gd;var Me=Vd}else(ye=le.nodeName)&&ye.toLowerCase()==="input"&&(le.type==="checkbox"||le.type==="radio")&&(Ce=Zd);if(Ce&&(Ce=Ce(e,Q))){Ni(ce,Ce,n,ie);break e}Me&&Me(e,le,Q),e==="focusout"&&(Me=le._wrapperState)&&Me.controlled&&le.type==="number"&&Re(le,"number",le.value)}switch(Me=Q?Xr(Q):window,e){case"focusin":(Si(Me)||Me.contentEditable==="true")&&(Ur=Me,Na=Q,ko=null);break;case"focusout":ko=Na=Ur=null;break;case"mousedown":ka=!0;break;case"contextmenu":case"mouseup":case"dragend":ka=!1,Ri(ce,n,ie);break;case"selectionchange":if(Jd)break;case"keydown":case"keyup":Ri(ce,n,ie)}var Pe;if(wa)e:{switch(e){case"compositionstart":var Ie="onCompositionStart";break e;case"compositionend":Ie="onCompositionEnd";break e;case"compositionupdate":Ie="onCompositionUpdate";break e}Ie=void 0}else $r?bi(e,n)&&(Ie="onCompositionEnd"):e==="keydown"&&n.keyCode===229&&(Ie="onCompositionStart");Ie&&(yi&&n.locale!=="ko"&&($r||Ie!=="onCompositionStart"?Ie==="onCompositionEnd"&&$r&&(Pe=hi()):(tr=ie,pa="value"in tr?tr.value:tr.textContent,$r=!0)),Me=cs(Q,Ie),0<Me.length&&(Ie=new mi(Ie,e,null,n,ie),ce.push({event:Ie,listeners:Me}),Pe?Ie.data=Pe:(Pe=ji(n),Pe!==null&&(Ie.data=Pe)))),(Pe=$d?Ud(e,n):Wd(e,n))&&(Q=cs(Q,"onBeforeInput"),0<Q.length&&(ie=new mi("onBeforeInput","beforeinput",null,n,ie),ce.push({event:ie,listeners:Q}),ie.data=Pe))}Ui(ce,t)})}function Mo(e,t,n){return{instance:e,listener:t,currentTarget:n}}function cs(e,t){for(var n=t+"Capture",o=[];e!==null;){var s=e,i=s.stateNode;s.tag===5&&i!==null&&(s=i,i=An(e,n),i!=null&&o.unshift(Mo(e,i,s)),i=An(e,t),i!=null&&o.push(Mo(e,i,s))),e=e.return}return o}function Hr(e){if(e===null)return null;do e=e.return;while(e&&e.tag!==5);return e||null}function Hi(e,t,n,o,s){for(var i=t._reactName,h=[];n!==null&&n!==o;){var S=n,E=S.alternate,Q=S.stateNode;if(E!==null&&E===o)break;S.tag===5&&Q!==null&&(S=Q,s?(E=An(n,i),E!=null&&h.unshift(Mo(n,E,S))):s||(E=An(n,i),E!=null&&h.push(Mo(n,E,S)))),n=n.return}h.length!==0&&e.push({event:t,listeners:h})}var rf=/\r\n?/g,of=/\u0000|\uFFFD/g;function Yi(e){return(typeof e=="string"?e:""+e).replace(rf,`
`).replace(of,"")}function us(e,t,n){if(t=Yi(t),Yi(e)!==t&&n)throw Error(a(425))}function ds(){}var La=null,Ia=null;function Ra(e,t){return e==="textarea"||e==="noscript"||typeof t.children=="string"||typeof t.children=="number"||typeof t.dangerouslySetInnerHTML=="object"&&t.dangerouslySetInnerHTML!==null&&t.dangerouslySetInnerHTML.__html!=null}var Fa=typeof setTimeout=="function"?setTimeout:void 0,sf=typeof clearTimeout=="function"?clearTimeout:void 0,Xi=typeof Promise=="function"?Promise:void 0,af=typeof queueMicrotask=="function"?queueMicrotask:typeof Xi<"u"?function(e){return Xi.resolve(null).then(e).catch(lf)}:Fa;function lf(e){setTimeout(function(){throw e})}function za(e,t){var n=t,o=0;do{var s=n.nextSibling;if(e.removeChild(n),s&&s.nodeType===8)if(n=s.data,n==="/$"){if(o===0){e.removeChild(s),yo(t);return}o--}else n!=="$"&&n!=="$?"&&n!=="$!"||o++;n=s}while(n);yo(t)}function rr(e){for(;e!=null;e=e.nextSibling){var t=e.nodeType;if(t===1||t===3)break;if(t===8){if(t=e.data,t==="$"||t==="$!"||t==="$?")break;if(t==="/$")return null}}return e}function Vi(e){e=e.previousSibling;for(var t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="$"||n==="$!"||n==="$?"){if(t===0)return e;t--}else n==="/$"&&t++}e=e.previousSibling}return null}var Yr=Math.random().toString(36).slice(2),In="__reactFiber$"+Yr,Po="__reactProps$"+Yr,$n="__reactContainer$"+Yr,Ta="__reactEvents$"+Yr,cf="__reactListeners$"+Yr,uf="__reactHandles$"+Yr;function wr(e){var t=e[In];if(t)return t;for(var n=e.parentNode;n;){if(t=n[$n]||n[In]){if(n=t.alternate,t.child!==null||n!==null&&n.child!==null)for(e=Vi(e);e!==null;){if(n=e[In])return n;e=Vi(e)}return t}e=n,n=e.parentNode}return null}function Do(e){return e=e[In]||e[$n],!e||e.tag!==5&&e.tag!==6&&e.tag!==13&&e.tag!==3?null:e}function Xr(e){if(e.tag===5||e.tag===6)return e.stateNode;throw Error(a(33))}function fs(e){return e[Po]||null}var _a=[],Vr=-1;function or(e){return{current:e}}function tt(e){0>Vr||(e.current=_a[Vr],_a[Vr]=null,Vr--)}function qe(e,t){Vr++,_a[Vr]=e.current,e.current=t}var sr={},Tt=or(sr),Ht=or(!1),br=sr;function Gr(e,t){var n=e.type.contextTypes;if(!n)return sr;var o=e.stateNode;if(o&&o.__reactInternalMemoizedUnmaskedChildContext===t)return o.__reactInternalMemoizedMaskedChildContext;var s={},i;for(i in n)s[i]=t[i];return o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=t,e.__reactInternalMemoizedMaskedChildContext=s),s}function Yt(e){return e=e.childContextTypes,e!=null}function hs(){tt(Ht),tt(Tt)}function Gi(e,t,n){if(Tt.current!==sr)throw Error(a(168));qe(Tt,t),qe(Ht,n)}function Zi(e,t,n){var o=e.stateNode;if(t=t.childContextTypes,typeof o.getChildContext!="function")return n;o=o.getChildContext();for(var s in o)if(!(s in t))throw Error(a(108,ve(e)||"Unknown",s));return _({},n,o)}function ps(e){return e=(e=e.stateNode)&&e.__reactInternalMemoizedMergedChildContext||sr,br=Tt.current,qe(Tt,e),qe(Ht,Ht.current),!0}function Ki(e,t,n){var o=e.stateNode;if(!o)throw Error(a(169));n?(e=Zi(e,t,br),o.__reactInternalMemoizedMergedChildContext=e,tt(Ht),tt(Tt),qe(Tt,e)):tt(Ht),qe(Ht,n)}var Un=null,gs=!1,Aa=!1;function Qi(e){Un===null?Un=[e]:Un.push(e)}function df(e){gs=!0,Qi(e)}function ar(){if(!Aa&&Un!==null){Aa=!0;var e=0,t=_e;try{var n=Un;for(_e=1;e<n.length;e++){var o=n[e];do o=o(!0);while(o!==null)}Un=null,gs=!1}catch(s){throw Un!==null&&(Un=Un.slice(e+1)),Rt(Dn,ar),s}finally{_e=t,Aa=!1}}return null}var Zr=[],Kr=0,ms=null,xs=0,dn=[],fn=0,jr=null,Wn=1,Hn="";function Sr(e,t){Zr[Kr++]=xs,Zr[Kr++]=ms,ms=e,xs=t}function qi(e,t,n){dn[fn++]=Wn,dn[fn++]=Hn,dn[fn++]=jr,jr=e;var o=Wn;e=Hn;var s=32-Jt(o)-1;o&=~(1<<s),n+=1;var i=32-Jt(t)+s;if(30<i){var h=s-s%5;i=(o&(1<<h)-1).toString(32),o>>=h,s-=h,Wn=1<<32-Jt(t)+s|n<<s|o,Hn=i+e}else Wn=1<<i|n<<s|o,Hn=e}function Oa(e){e.return!==null&&(Sr(e,1),qi(e,1,0))}function Ba(e){for(;e===ms;)ms=Zr[--Kr],Zr[Kr]=null,xs=Zr[--Kr],Zr[Kr]=null;for(;e===jr;)jr=dn[--fn],dn[fn]=null,Hn=dn[--fn],dn[fn]=null,Wn=dn[--fn],dn[fn]=null}var nn=null,rn=null,st=!1,wn=null;function Ji(e,t){var n=mn(5,null,null,0);n.elementType="DELETED",n.stateNode=t,n.return=e,t=e.deletions,t===null?(e.deletions=[n],e.flags|=16):t.push(n)}function ec(e,t){switch(e.tag){case 5:var n=e.type;return t=t.nodeType!==1||n.toLowerCase()!==t.nodeName.toLowerCase()?null:t,t!==null?(e.stateNode=t,nn=e,rn=rr(t.firstChild),!0):!1;case 6:return t=e.pendingProps===""||t.nodeType!==3?null:t,t!==null?(e.stateNode=t,nn=e,rn=null,!0):!1;case 13:return t=t.nodeType!==8?null:t,t!==null?(n=jr!==null?{id:Wn,overflow:Hn}:null,e.memoizedState={dehydrated:t,treeContext:n,retryLane:1073741824},n=mn(18,null,null,0),n.stateNode=t,n.return=e,e.child=n,nn=e,rn=null,!0):!1;default:return!1}}function $a(e){return(e.mode&1)!==0&&(e.flags&128)===0}function Ua(e){if(st){var t=rn;if(t){var n=t;if(!ec(e,t)){if($a(e))throw Error(a(418));t=rr(n.nextSibling);var o=nn;t&&ec(e,t)?Ji(o,n):(e.flags=e.flags&-4097|2,st=!1,nn=e)}}else{if($a(e))throw Error(a(418));e.flags=e.flags&-4097|2,st=!1,nn=e}}}function tc(e){for(e=e.return;e!==null&&e.tag!==5&&e.tag!==3&&e.tag!==13;)e=e.return;nn=e}function ys(e){if(e!==nn)return!1;if(!st)return tc(e),st=!0,!1;var t;if((t=e.tag!==3)&&!(t=e.tag!==5)&&(t=e.type,t=t!=="head"&&t!=="body"&&!Ra(e.type,e.memoizedProps)),t&&(t=rn)){if($a(e))throw nc(),Error(a(418));for(;t;)Ji(e,t),t=rr(t.nextSibling)}if(tc(e),e.tag===13){if(e=e.memoizedState,e=e!==null?e.dehydrated:null,!e)throw Error(a(317));e:{for(e=e.nextSibling,t=0;e;){if(e.nodeType===8){var n=e.data;if(n==="/$"){if(t===0){rn=rr(e.nextSibling);break e}t--}else n!=="$"&&n!=="$!"&&n!=="$?"||t++}e=e.nextSibling}rn=null}}else rn=nn?rr(e.stateNode.nextSibling):null;return!0}function nc(){for(var e=rn;e;)e=rr(e.nextSibling)}function Qr(){rn=nn=null,st=!1}function Wa(e){wn===null?wn=[e]:wn.push(e)}var ff=U.ReactCurrentBatchConfig;function Lo(e,t,n){if(e=n.ref,e!==null&&typeof e!="function"&&typeof e!="object"){if(n._owner){if(n=n._owner,n){if(n.tag!==1)throw Error(a(309));var o=n.stateNode}if(!o)throw Error(a(147,e));var s=o,i=""+e;return t!==null&&t.ref!==null&&typeof t.ref=="function"&&t.ref._stringRef===i?t.ref:(t=function(h){var S=s.refs;h===null?delete S[i]:S[i]=h},t._stringRef=i,t)}if(typeof e!="string")throw Error(a(284));if(!n._owner)throw Error(a(290,e))}return e}function vs(e,t){throw e=Object.prototype.toString.call(t),Error(a(31,e==="[object Object]"?"object with keys {"+Object.keys(t).join(", ")+"}":e))}function rc(e){var t=e._init;return t(e._payload)}function oc(e){function t(B,L){if(e){var Y=B.deletions;Y===null?(B.deletions=[L],B.flags|=16):Y.push(L)}}function n(B,L){if(!e)return null;for(;L!==null;)t(B,L),L=L.sibling;return null}function o(B,L){for(B=new Map;L!==null;)L.key!==null?B.set(L.key,L):B.set(L.index,L),L=L.sibling;return B}function s(B,L){return B=pr(B,L),B.index=0,B.sibling=null,B}function i(B,L,Y){return B.index=Y,e?(Y=B.alternate,Y!==null?(Y=Y.index,Y<L?(B.flags|=2,L):Y):(B.flags|=2,L)):(B.flags|=1048576,L)}function h(B){return e&&B.alternate===null&&(B.flags|=2),B}function S(B,L,Y,he){return L===null||L.tag!==6?(L=Fl(Y,B.mode,he),L.return=B,L):(L=s(L,Y),L.return=B,L)}function E(B,L,Y,he){var Ce=Y.type;return Ce===F?ie(B,L,Y.props.children,he,Y.key):L!==null&&(L.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===$&&rc(Ce)===L.type)?(he=s(L,Y.props),he.ref=Lo(B,L,Y),he.return=B,he):(he=Ws(Y.type,Y.key,Y.props,null,B.mode,he),he.ref=Lo(B,L,Y),he.return=B,he)}function Q(B,L,Y,he){return L===null||L.tag!==4||L.stateNode.containerInfo!==Y.containerInfo||L.stateNode.implementation!==Y.implementation?(L=zl(Y,B.mode,he),L.return=B,L):(L=s(L,Y.children||[]),L.return=B,L)}function ie(B,L,Y,he,Ce){return L===null||L.tag!==7?(L=Lr(Y,B.mode,he,Ce),L.return=B,L):(L=s(L,Y),L.return=B,L)}function ce(B,L,Y){if(typeof L=="string"&&L!==""||typeof L=="number")return L=Fl(""+L,B.mode,Y),L.return=B,L;if(typeof L=="object"&&L!==null){switch(L.$$typeof){case R:return Y=Ws(L.type,L.key,L.props,null,B.mode,Y),Y.ref=Lo(B,null,L),Y.return=B,Y;case k:return L=zl(L,B.mode,Y),L.return=B,L;case $:var he=L._init;return ce(B,he(L._payload),Y)}if(te(L)||oe(L))return L=Lr(L,B.mode,Y,null),L.return=B,L;vs(B,L)}return null}function le(B,L,Y,he){var Ce=L!==null?L.key:null;if(typeof Y=="string"&&Y!==""||typeof Y=="number")return Ce!==null?null:S(B,L,""+Y,he);if(typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case R:return Y.key===Ce?E(B,L,Y,he):null;case k:return Y.key===Ce?Q(B,L,Y,he):null;case $:return Ce=Y._init,le(B,L,Ce(Y._payload),he)}if(te(Y)||oe(Y))return Ce!==null?null:ie(B,L,Y,he,null);vs(B,Y)}return null}function ye(B,L,Y,he,Ce){if(typeof he=="string"&&he!==""||typeof he=="number")return B=B.get(Y)||null,S(L,B,""+he,Ce);if(typeof he=="object"&&he!==null){switch(he.$$typeof){case R:return B=B.get(he.key===null?Y:he.key)||null,E(L,B,he,Ce);case k:return B=B.get(he.key===null?Y:he.key)||null,Q(L,B,he,Ce);case $:var Me=he._init;return ye(B,L,Y,Me(he._payload),Ce)}if(te(he)||oe(he))return B=B.get(Y)||null,ie(L,B,he,Ce,null);vs(L,he)}return null}function je(B,L,Y,he){for(var Ce=null,Me=null,Pe=L,Ie=L=0,It=null;Pe!==null&&Ie<Y.length;Ie++){Pe.index>Ie?(It=Pe,Pe=null):It=Pe.sibling;var Xe=le(B,Pe,Y[Ie],he);if(Xe===null){Pe===null&&(Pe=It);break}e&&Pe&&Xe.alternate===null&&t(B,Pe),L=i(Xe,L,Ie),Me===null?Ce=Xe:Me.sibling=Xe,Me=Xe,Pe=It}if(Ie===Y.length)return n(B,Pe),st&&Sr(B,Ie),Ce;if(Pe===null){for(;Ie<Y.length;Ie++)Pe=ce(B,Y[Ie],he),Pe!==null&&(L=i(Pe,L,Ie),Me===null?Ce=Pe:Me.sibling=Pe,Me=Pe);return st&&Sr(B,Ie),Ce}for(Pe=o(B,Pe);Ie<Y.length;Ie++)It=ye(Pe,B,Ie,Y[Ie],he),It!==null&&(e&&It.alternate!==null&&Pe.delete(It.key===null?Ie:It.key),L=i(It,L,Ie),Me===null?Ce=It:Me.sibling=It,Me=It);return e&&Pe.forEach(function(gr){return t(B,gr)}),st&&Sr(B,Ie),Ce}function ke(B,L,Y,he){var Ce=oe(Y);if(typeof Ce!="function")throw Error(a(150));if(Y=Ce.call(Y),Y==null)throw Error(a(151));for(var Me=Ce=null,Pe=L,Ie=L=0,It=null,Xe=Y.next();Pe!==null&&!Xe.done;Ie++,Xe=Y.next()){Pe.index>Ie?(It=Pe,Pe=null):It=Pe.sibling;var gr=le(B,Pe,Xe.value,he);if(gr===null){Pe===null&&(Pe=It);break}e&&Pe&&gr.alternate===null&&t(B,Pe),L=i(gr,L,Ie),Me===null?Ce=gr:Me.sibling=gr,Me=gr,Pe=It}if(Xe.done)return n(B,Pe),st&&Sr(B,Ie),Ce;if(Pe===null){for(;!Xe.done;Ie++,Xe=Y.next())Xe=ce(B,Xe.value,he),Xe!==null&&(L=i(Xe,L,Ie),Me===null?Ce=Xe:Me.sibling=Xe,Me=Xe);return st&&Sr(B,Ie),Ce}for(Pe=o(B,Pe);!Xe.done;Ie++,Xe=Y.next())Xe=ye(Pe,B,Ie,Xe.value,he),Xe!==null&&(e&&Xe.alternate!==null&&Pe.delete(Xe.key===null?Ie:Xe.key),L=i(Xe,L,Ie),Me===null?Ce=Xe:Me.sibling=Xe,Me=Xe);return e&&Pe.forEach(function(Yf){return t(B,Yf)}),st&&Sr(B,Ie),Ce}function gt(B,L,Y,he){if(typeof Y=="object"&&Y!==null&&Y.type===F&&Y.key===null&&(Y=Y.props.children),typeof Y=="object"&&Y!==null){switch(Y.$$typeof){case R:e:{for(var Ce=Y.key,Me=L;Me!==null;){if(Me.key===Ce){if(Ce=Y.type,Ce===F){if(Me.tag===7){n(B,Me.sibling),L=s(Me,Y.props.children),L.return=B,B=L;break e}}else if(Me.elementType===Ce||typeof Ce=="object"&&Ce!==null&&Ce.$$typeof===$&&rc(Ce)===Me.type){n(B,Me.sibling),L=s(Me,Y.props),L.ref=Lo(B,Me,Y),L.return=B,B=L;break e}n(B,Me);break}else t(B,Me);Me=Me.sibling}Y.type===F?(L=Lr(Y.props.children,B.mode,he,Y.key),L.return=B,B=L):(he=Ws(Y.type,Y.key,Y.props,null,B.mode,he),he.ref=Lo(B,L,Y),he.return=B,B=he)}return h(B);case k:e:{for(Me=Y.key;L!==null;){if(L.key===Me)if(L.tag===4&&L.stateNode.containerInfo===Y.containerInfo&&L.stateNode.implementation===Y.implementation){n(B,L.sibling),L=s(L,Y.children||[]),L.return=B,B=L;break e}else{n(B,L);break}else t(B,L);L=L.sibling}L=zl(Y,B.mode,he),L.return=B,B=L}return h(B);case $:return Me=Y._init,gt(B,L,Me(Y._payload),he)}if(te(Y))return je(B,L,Y,he);if(oe(Y))return ke(B,L,Y,he);vs(B,Y)}return typeof Y=="string"&&Y!==""||typeof Y=="number"?(Y=""+Y,L!==null&&L.tag===6?(n(B,L.sibling),L=s(L,Y),L.return=B,B=L):(n(B,L),L=Fl(Y,B.mode,he),L.return=B,B=L),h(B)):n(B,L)}return gt}var qr=oc(!0),sc=oc(!1),ws=or(null),bs=null,Jr=null,Ha=null;function Ya(){Ha=Jr=bs=null}function Xa(e){var t=ws.current;tt(ws),e._currentValue=t}function Va(e,t,n){for(;e!==null;){var o=e.alternate;if((e.childLanes&t)!==t?(e.childLanes|=t,o!==null&&(o.childLanes|=t)):o!==null&&(o.childLanes&t)!==t&&(o.childLanes|=t),e===n)break;e=e.return}}function eo(e,t){bs=e,Ha=Jr=null,e=e.dependencies,e!==null&&e.firstContext!==null&&((e.lanes&t)!==0&&(Xt=!0),e.firstContext=null)}function hn(e){var t=e._currentValue;if(Ha!==e)if(e={context:e,memoizedValue:t,next:null},Jr===null){if(bs===null)throw Error(a(308));Jr=e,bs.dependencies={lanes:0,firstContext:e}}else Jr=Jr.next=e;return t}var Nr=null;function Ga(e){Nr===null?Nr=[e]:Nr.push(e)}function ac(e,t,n,o){var s=t.interleaved;return s===null?(n.next=n,Ga(t)):(n.next=s.next,s.next=n),t.interleaved=n,Yn(e,o)}function Yn(e,t){e.lanes|=t;var n=e.alternate;for(n!==null&&(n.lanes|=t),n=e,e=e.return;e!==null;)e.childLanes|=t,n=e.alternate,n!==null&&(n.childLanes|=t),n=e,e=e.return;return n.tag===3?n.stateNode:null}var lr=!1;function Za(e){e.updateQueue={baseState:e.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function lc(e,t){e=e.updateQueue,t.updateQueue===e&&(t.updateQueue={baseState:e.baseState,firstBaseUpdate:e.firstBaseUpdate,lastBaseUpdate:e.lastBaseUpdate,shared:e.shared,effects:e.effects})}function Xn(e,t){return{eventTime:e,lane:t,tag:0,payload:null,callback:null,next:null}}function ir(e,t,n){var o=e.updateQueue;if(o===null)return null;if(o=o.shared,(We&2)!==0){var s=o.pending;return s===null?t.next=t:(t.next=s.next,s.next=t),o.pending=t,Yn(e,n)}return s=o.interleaved,s===null?(t.next=t,Ga(o)):(t.next=s.next,s.next=t),o.interleaved=t,Yn(e,n)}function js(e,t,n){if(t=t.updateQueue,t!==null&&(t=t.shared,(n&4194240)!==0)){var o=t.lanes;o&=e.pendingLanes,n|=o,t.lanes=n,ot(e,n)}}function ic(e,t){var n=e.updateQueue,o=e.alternate;if(o!==null&&(o=o.updateQueue,n===o)){var s=null,i=null;if(n=n.firstBaseUpdate,n!==null){do{var h={eventTime:n.eventTime,lane:n.lane,tag:n.tag,payload:n.payload,callback:n.callback,next:null};i===null?s=i=h:i=i.next=h,n=n.next}while(n!==null);i===null?s=i=t:i=i.next=t}else s=i=t;n={baseState:o.baseState,firstBaseUpdate:s,lastBaseUpdate:i,shared:o.shared,effects:o.effects},e.updateQueue=n;return}e=n.lastBaseUpdate,e===null?n.firstBaseUpdate=t:e.next=t,n.lastBaseUpdate=t}function Ss(e,t,n,o){var s=e.updateQueue;lr=!1;var i=s.firstBaseUpdate,h=s.lastBaseUpdate,S=s.shared.pending;if(S!==null){s.shared.pending=null;var E=S,Q=E.next;E.next=null,h===null?i=Q:h.next=Q,h=E;var ie=e.alternate;ie!==null&&(ie=ie.updateQueue,S=ie.lastBaseUpdate,S!==h&&(S===null?ie.firstBaseUpdate=Q:S.next=Q,ie.lastBaseUpdate=E))}if(i!==null){var ce=s.baseState;h=0,ie=Q=E=null,S=i;do{var le=S.lane,ye=S.eventTime;if((o&le)===le){ie!==null&&(ie=ie.next={eventTime:ye,lane:0,tag:S.tag,payload:S.payload,callback:S.callback,next:null});e:{var je=e,ke=S;switch(le=t,ye=n,ke.tag){case 1:if(je=ke.payload,typeof je=="function"){ce=je.call(ye,ce,le);break e}ce=je;break e;case 3:je.flags=je.flags&-65537|128;case 0:if(je=ke.payload,le=typeof je=="function"?je.call(ye,ce,le):je,le==null)break e;ce=_({},ce,le);break e;case 2:lr=!0}}S.callback!==null&&S.lane!==0&&(e.flags|=64,le=s.effects,le===null?s.effects=[S]:le.push(S))}else ye={eventTime:ye,lane:le,tag:S.tag,payload:S.payload,callback:S.callback,next:null},ie===null?(Q=ie=ye,E=ce):ie=ie.next=ye,h|=le;if(S=S.next,S===null){if(S=s.shared.pending,S===null)break;le=S,S=le.next,le.next=null,s.lastBaseUpdate=le,s.shared.pending=null}}while(!0);if(ie===null&&(E=ce),s.baseState=E,s.firstBaseUpdate=Q,s.lastBaseUpdate=ie,t=s.shared.interleaved,t!==null){s=t;do h|=s.lane,s=s.next;while(s!==t)}else i===null&&(s.shared.lanes=0);Er|=h,e.lanes=h,e.memoizedState=ce}}function cc(e,t,n){if(e=t.effects,t.effects=null,e!==null)for(t=0;t<e.length;t++){var o=e[t],s=o.callback;if(s!==null){if(o.callback=null,o=n,typeof s!="function")throw Error(a(191,s));s.call(o)}}}var Io={},Rn=or(Io),Ro=or(Io),Fo=or(Io);function kr(e){if(e===Io)throw Error(a(174));return e}function Ka(e,t){switch(qe(Fo,t),qe(Ro,e),qe(Rn,Io),e=t.nodeType,e){case 9:case 11:t=(t=t.documentElement)?t.namespaceURI:ut(null,"");break;default:e=e===8?t.parentNode:t,t=e.namespaceURI||null,e=e.tagName,t=ut(t,e)}tt(Rn),qe(Rn,t)}function to(){tt(Rn),tt(Ro),tt(Fo)}function uc(e){kr(Fo.current);var t=kr(Rn.current),n=ut(t,e.type);t!==n&&(qe(Ro,e),qe(Rn,n))}function Qa(e){Ro.current===e&&(tt(Rn),tt(Ro))}var it=or(0);function Ns(e){for(var t=e;t!==null;){if(t.tag===13){var n=t.memoizedState;if(n!==null&&(n=n.dehydrated,n===null||n.data==="$?"||n.data==="$!"))return t}else if(t.tag===19&&t.memoizedProps.revealOrder!==void 0){if((t.flags&128)!==0)return t}else if(t.child!==null){t.child.return=t,t=t.child;continue}if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return null;t=t.return}t.sibling.return=t.return,t=t.sibling}return null}var qa=[];function Ja(){for(var e=0;e<qa.length;e++)qa[e]._workInProgressVersionPrimary=null;qa.length=0}var ks=U.ReactCurrentDispatcher,el=U.ReactCurrentBatchConfig,Cr=0,ct=null,Nt=null,Dt=null,Cs=!1,zo=!1,To=0,hf=0;function _t(){throw Error(a(321))}function tl(e,t){if(t===null)return!1;for(var n=0;n<t.length&&n<e.length;n++)if(!vn(e[n],t[n]))return!1;return!0}function nl(e,t,n,o,s,i){if(Cr=i,ct=t,t.memoizedState=null,t.updateQueue=null,t.lanes=0,ks.current=e===null||e.memoizedState===null?xf:yf,e=n(o,s),zo){i=0;do{if(zo=!1,To=0,25<=i)throw Error(a(301));i+=1,Dt=Nt=null,t.updateQueue=null,ks.current=vf,e=n(o,s)}while(zo)}if(ks.current=Ps,t=Nt!==null&&Nt.next!==null,Cr=0,Dt=Nt=ct=null,Cs=!1,t)throw Error(a(300));return e}function rl(){var e=To!==0;return To=0,e}function Fn(){var e={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Dt===null?ct.memoizedState=Dt=e:Dt=Dt.next=e,Dt}function pn(){if(Nt===null){var e=ct.alternate;e=e!==null?e.memoizedState:null}else e=Nt.next;var t=Dt===null?ct.memoizedState:Dt.next;if(t!==null)Dt=t,Nt=e;else{if(e===null)throw Error(a(310));Nt=e,e={memoizedState:Nt.memoizedState,baseState:Nt.baseState,baseQueue:Nt.baseQueue,queue:Nt.queue,next:null},Dt===null?ct.memoizedState=Dt=e:Dt=Dt.next=e}return Dt}function _o(e,t){return typeof t=="function"?t(e):t}function ol(e){var t=pn(),n=t.queue;if(n===null)throw Error(a(311));n.lastRenderedReducer=e;var o=Nt,s=o.baseQueue,i=n.pending;if(i!==null){if(s!==null){var h=s.next;s.next=i.next,i.next=h}o.baseQueue=s=i,n.pending=null}if(s!==null){i=s.next,o=o.baseState;var S=h=null,E=null,Q=i;do{var ie=Q.lane;if((Cr&ie)===ie)E!==null&&(E=E.next={lane:0,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null}),o=Q.hasEagerState?Q.eagerState:e(o,Q.action);else{var ce={lane:ie,action:Q.action,hasEagerState:Q.hasEagerState,eagerState:Q.eagerState,next:null};E===null?(S=E=ce,h=o):E=E.next=ce,ct.lanes|=ie,Er|=ie}Q=Q.next}while(Q!==null&&Q!==i);E===null?h=o:E.next=S,vn(o,t.memoizedState)||(Xt=!0),t.memoizedState=o,t.baseState=h,t.baseQueue=E,n.lastRenderedState=o}if(e=n.interleaved,e!==null){s=e;do i=s.lane,ct.lanes|=i,Er|=i,s=s.next;while(s!==e)}else s===null&&(n.lanes=0);return[t.memoizedState,n.dispatch]}function sl(e){var t=pn(),n=t.queue;if(n===null)throw Error(a(311));n.lastRenderedReducer=e;var o=n.dispatch,s=n.pending,i=t.memoizedState;if(s!==null){n.pending=null;var h=s=s.next;do i=e(i,h.action),h=h.next;while(h!==s);vn(i,t.memoizedState)||(Xt=!0),t.memoizedState=i,t.baseQueue===null&&(t.baseState=i),n.lastRenderedState=i}return[i,o]}function dc(){}function fc(e,t){var n=ct,o=pn(),s=t(),i=!vn(o.memoizedState,s);if(i&&(o.memoizedState=s,Xt=!0),o=o.queue,al(gc.bind(null,n,o,e),[e]),o.getSnapshot!==t||i||Dt!==null&&Dt.memoizedState.tag&1){if(n.flags|=2048,Ao(9,pc.bind(null,n,o,s,t),void 0,null),Lt===null)throw Error(a(349));(Cr&30)!==0||hc(n,t,s)}return s}function hc(e,t,n){e.flags|=16384,e={getSnapshot:t,value:n},t=ct.updateQueue,t===null?(t={lastEffect:null,stores:null},ct.updateQueue=t,t.stores=[e]):(n=t.stores,n===null?t.stores=[e]:n.push(e))}function pc(e,t,n,o){t.value=n,t.getSnapshot=o,mc(t)&&xc(e)}function gc(e,t,n){return n(function(){mc(t)&&xc(e)})}function mc(e){var t=e.getSnapshot;e=e.value;try{var n=t();return!vn(e,n)}catch{return!0}}function xc(e){var t=Yn(e,1);t!==null&&Nn(t,e,1,-1)}function yc(e){var t=Fn();return typeof e=="function"&&(e=e()),t.memoizedState=t.baseState=e,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:_o,lastRenderedState:e},t.queue=e,e=e.dispatch=mf.bind(null,ct,e),[t.memoizedState,e]}function Ao(e,t,n,o){return e={tag:e,create:t,destroy:n,deps:o,next:null},t=ct.updateQueue,t===null?(t={lastEffect:null,stores:null},ct.updateQueue=t,t.lastEffect=e.next=e):(n=t.lastEffect,n===null?t.lastEffect=e.next=e:(o=n.next,n.next=e,e.next=o,t.lastEffect=e)),e}function vc(){return pn().memoizedState}function Es(e,t,n,o){var s=Fn();ct.flags|=e,s.memoizedState=Ao(1|t,n,void 0,o===void 0?null:o)}function Ms(e,t,n,o){var s=pn();o=o===void 0?null:o;var i=void 0;if(Nt!==null){var h=Nt.memoizedState;if(i=h.destroy,o!==null&&tl(o,h.deps)){s.memoizedState=Ao(t,n,i,o);return}}ct.flags|=e,s.memoizedState=Ao(1|t,n,i,o)}function wc(e,t){return Es(8390656,8,e,t)}function al(e,t){return Ms(2048,8,e,t)}function bc(e,t){return Ms(4,2,e,t)}function jc(e,t){return Ms(4,4,e,t)}function Sc(e,t){if(typeof t=="function")return e=e(),t(e),function(){t(null)};if(t!=null)return e=e(),t.current=e,function(){t.current=null}}function Nc(e,t,n){return n=n!=null?n.concat([e]):null,Ms(4,4,Sc.bind(null,t,e),n)}function ll(){}function kc(e,t){var n=pn();t=t===void 0?null:t;var o=n.memoizedState;return o!==null&&t!==null&&tl(t,o[1])?o[0]:(n.memoizedState=[e,t],e)}function Cc(e,t){var n=pn();t=t===void 0?null:t;var o=n.memoizedState;return o!==null&&t!==null&&tl(t,o[1])?o[0]:(e=e(),n.memoizedState=[e,t],e)}function Ec(e,t,n){return(Cr&21)===0?(e.baseState&&(e.baseState=!1,Xt=!0),e.memoizedState=n):(vn(n,t)||(n=me(),ct.lanes|=n,Er|=n,e.baseState=!0),t)}function pf(e,t){var n=_e;_e=n!==0&&4>n?n:4,e(!0);var o=el.transition;el.transition={};try{e(!1),t()}finally{_e=n,el.transition=o}}function Mc(){return pn().memoizedState}function gf(e,t,n){var o=fr(e);if(n={lane:o,action:n,hasEagerState:!1,eagerState:null,next:null},Pc(e))Dc(t,n);else if(n=ac(e,t,n,o),n!==null){var s=Ut();Nn(n,e,o,s),Lc(n,t,o)}}function mf(e,t,n){var o=fr(e),s={lane:o,action:n,hasEagerState:!1,eagerState:null,next:null};if(Pc(e))Dc(t,s);else{var i=e.alternate;if(e.lanes===0&&(i===null||i.lanes===0)&&(i=t.lastRenderedReducer,i!==null))try{var h=t.lastRenderedState,S=i(h,n);if(s.hasEagerState=!0,s.eagerState=S,vn(S,h)){var E=t.interleaved;E===null?(s.next=s,Ga(t)):(s.next=E.next,E.next=s),t.interleaved=s;return}}catch{}n=ac(e,t,s,o),n!==null&&(s=Ut(),Nn(n,e,o,s),Lc(n,t,o))}}function Pc(e){var t=e.alternate;return e===ct||t!==null&&t===ct}function Dc(e,t){zo=Cs=!0;var n=e.pending;n===null?t.next=t:(t.next=n.next,n.next=t),e.pending=t}function Lc(e,t,n){if((n&4194240)!==0){var o=t.lanes;o&=e.pendingLanes,n|=o,t.lanes=n,ot(e,n)}}var Ps={readContext:hn,useCallback:_t,useContext:_t,useEffect:_t,useImperativeHandle:_t,useInsertionEffect:_t,useLayoutEffect:_t,useMemo:_t,useReducer:_t,useRef:_t,useState:_t,useDebugValue:_t,useDeferredValue:_t,useTransition:_t,useMutableSource:_t,useSyncExternalStore:_t,useId:_t,unstable_isNewReconciler:!1},xf={readContext:hn,useCallback:function(e,t){return Fn().memoizedState=[e,t===void 0?null:t],e},useContext:hn,useEffect:wc,useImperativeHandle:function(e,t,n){return n=n!=null?n.concat([e]):null,Es(4194308,4,Sc.bind(null,t,e),n)},useLayoutEffect:function(e,t){return Es(4194308,4,e,t)},useInsertionEffect:function(e,t){return Es(4,2,e,t)},useMemo:function(e,t){var n=Fn();return t=t===void 0?null:t,e=e(),n.memoizedState=[e,t],e},useReducer:function(e,t,n){var o=Fn();return t=n!==void 0?n(t):t,o.memoizedState=o.baseState=t,e={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:e,lastRenderedState:t},o.queue=e,e=e.dispatch=gf.bind(null,ct,e),[o.memoizedState,e]},useRef:function(e){var t=Fn();return e={current:e},t.memoizedState=e},useState:yc,useDebugValue:ll,useDeferredValue:function(e){return Fn().memoizedState=e},useTransition:function(){var e=yc(!1),t=e[0];return e=pf.bind(null,e[1]),Fn().memoizedState=e,[t,e]},useMutableSource:function(){},useSyncExternalStore:function(e,t,n){var o=ct,s=Fn();if(st){if(n===void 0)throw Error(a(407));n=n()}else{if(n=t(),Lt===null)throw Error(a(349));(Cr&30)!==0||hc(o,t,n)}s.memoizedState=n;var i={value:n,getSnapshot:t};return s.queue=i,wc(gc.bind(null,o,i,e),[e]),o.flags|=2048,Ao(9,pc.bind(null,o,i,n,t),void 0,null),n},useId:function(){var e=Fn(),t=Lt.identifierPrefix;if(st){var n=Hn,o=Wn;n=(o&~(1<<32-Jt(o)-1)).toString(32)+n,t=":"+t+"R"+n,n=To++,0<n&&(t+="H"+n.toString(32)),t+=":"}else n=hf++,t=":"+t+"r"+n.toString(32)+":";return e.memoizedState=t},unstable_isNewReconciler:!1},yf={readContext:hn,useCallback:kc,useContext:hn,useEffect:al,useImperativeHandle:Nc,useInsertionEffect:bc,useLayoutEffect:jc,useMemo:Cc,useReducer:ol,useRef:vc,useState:function(){return ol(_o)},useDebugValue:ll,useDeferredValue:function(e){var t=pn();return Ec(t,Nt.memoizedState,e)},useTransition:function(){var e=ol(_o)[0],t=pn().memoizedState;return[e,t]},useMutableSource:dc,useSyncExternalStore:fc,useId:Mc,unstable_isNewReconciler:!1},vf={readContext:hn,useCallback:kc,useContext:hn,useEffect:al,useImperativeHandle:Nc,useInsertionEffect:bc,useLayoutEffect:jc,useMemo:Cc,useReducer:sl,useRef:vc,useState:function(){return sl(_o)},useDebugValue:ll,useDeferredValue:function(e){var t=pn();return Nt===null?t.memoizedState=e:Ec(t,Nt.memoizedState,e)},useTransition:function(){var e=sl(_o)[0],t=pn().memoizedState;return[e,t]},useMutableSource:dc,useSyncExternalStore:fc,useId:Mc,unstable_isNewReconciler:!1};function bn(e,t){if(e&&e.defaultProps){t=_({},t),e=e.defaultProps;for(var n in e)t[n]===void 0&&(t[n]=e[n]);return t}return t}function il(e,t,n,o){t=e.memoizedState,n=n(o,t),n=n==null?t:_({},t,n),e.memoizedState=n,e.lanes===0&&(e.updateQueue.baseState=n)}var Ds={isMounted:function(e){return(e=e._reactInternals)?Ke(e)===e:!1},enqueueSetState:function(e,t,n){e=e._reactInternals;var o=Ut(),s=fr(e),i=Xn(o,s);i.payload=t,n!=null&&(i.callback=n),t=ir(e,i,s),t!==null&&(Nn(t,e,s,o),js(t,e,s))},enqueueReplaceState:function(e,t,n){e=e._reactInternals;var o=Ut(),s=fr(e),i=Xn(o,s);i.tag=1,i.payload=t,n!=null&&(i.callback=n),t=ir(e,i,s),t!==null&&(Nn(t,e,s,o),js(t,e,s))},enqueueForceUpdate:function(e,t){e=e._reactInternals;var n=Ut(),o=fr(e),s=Xn(n,o);s.tag=2,t!=null&&(s.callback=t),t=ir(e,s,o),t!==null&&(Nn(t,e,o,n),js(t,e,o))}};function Ic(e,t,n,o,s,i,h){return e=e.stateNode,typeof e.shouldComponentUpdate=="function"?e.shouldComponentUpdate(o,i,h):t.prototype&&t.prototype.isPureReactComponent?!No(n,o)||!No(s,i):!0}function Rc(e,t,n){var o=!1,s=sr,i=t.contextType;return typeof i=="object"&&i!==null?i=hn(i):(s=Yt(t)?br:Tt.current,o=t.contextTypes,i=(o=o!=null)?Gr(e,s):sr),t=new t(n,i),e.memoizedState=t.state!==null&&t.state!==void 0?t.state:null,t.updater=Ds,e.stateNode=t,t._reactInternals=e,o&&(e=e.stateNode,e.__reactInternalMemoizedUnmaskedChildContext=s,e.__reactInternalMemoizedMaskedChildContext=i),t}function Fc(e,t,n,o){e=t.state,typeof t.componentWillReceiveProps=="function"&&t.componentWillReceiveProps(n,o),typeof t.UNSAFE_componentWillReceiveProps=="function"&&t.UNSAFE_componentWillReceiveProps(n,o),t.state!==e&&Ds.enqueueReplaceState(t,t.state,null)}function cl(e,t,n,o){var s=e.stateNode;s.props=n,s.state=e.memoizedState,s.refs={},Za(e);var i=t.contextType;typeof i=="object"&&i!==null?s.context=hn(i):(i=Yt(t)?br:Tt.current,s.context=Gr(e,i)),s.state=e.memoizedState,i=t.getDerivedStateFromProps,typeof i=="function"&&(il(e,t,i,n),s.state=e.memoizedState),typeof t.getDerivedStateFromProps=="function"||typeof s.getSnapshotBeforeUpdate=="function"||typeof s.UNSAFE_componentWillMount!="function"&&typeof s.componentWillMount!="function"||(t=s.state,typeof s.componentWillMount=="function"&&s.componentWillMount(),typeof s.UNSAFE_componentWillMount=="function"&&s.UNSAFE_componentWillMount(),t!==s.state&&Ds.enqueueReplaceState(s,s.state,null),Ss(e,n,s,o),s.state=e.memoizedState),typeof s.componentDidMount=="function"&&(e.flags|=4194308)}function no(e,t){try{var n="",o=t;do n+=de(o),o=o.return;while(o);var s=n}catch(i){s=`
Error generating stack: `+i.message+`
`+i.stack}return{value:e,source:t,stack:s,digest:null}}function ul(e,t,n){return{value:e,source:null,stack:n??null,digest:t??null}}function dl(e,t){try{console.error(t.value)}catch(n){setTimeout(function(){throw n})}}var wf=typeof WeakMap=="function"?WeakMap:Map;function zc(e,t,n){n=Xn(-1,n),n.tag=3,n.payload={element:null};var o=t.value;return n.callback=function(){_s||(_s=!0,Cl=o),dl(e,t)},n}function Tc(e,t,n){n=Xn(-1,n),n.tag=3;var o=e.type.getDerivedStateFromError;if(typeof o=="function"){var s=t.value;n.payload=function(){return o(s)},n.callback=function(){dl(e,t)}}var i=e.stateNode;return i!==null&&typeof i.componentDidCatch=="function"&&(n.callback=function(){dl(e,t),typeof o!="function"&&(ur===null?ur=new Set([this]):ur.add(this));var h=t.stack;this.componentDidCatch(t.value,{componentStack:h!==null?h:""})}),n}function _c(e,t,n){var o=e.pingCache;if(o===null){o=e.pingCache=new wf;var s=new Set;o.set(t,s)}else s=o.get(t),s===void 0&&(s=new Set,o.set(t,s));s.has(n)||(s.add(n),e=Ff.bind(null,e,t,n),t.then(e,e))}function Ac(e){do{var t;if((t=e.tag===13)&&(t=e.memoizedState,t=t!==null?t.dehydrated!==null:!0),t)return e;e=e.return}while(e!==null);return null}function Oc(e,t,n,o,s){return(e.mode&1)===0?(e===t?e.flags|=65536:(e.flags|=128,n.flags|=131072,n.flags&=-52805,n.tag===1&&(n.alternate===null?n.tag=17:(t=Xn(-1,1),t.tag=2,ir(n,t,1))),n.lanes|=1),e):(e.flags|=65536,e.lanes=s,e)}var bf=U.ReactCurrentOwner,Xt=!1;function $t(e,t,n,o){t.child=e===null?sc(t,null,n,o):qr(t,e.child,n,o)}function Bc(e,t,n,o,s){n=n.render;var i=t.ref;return eo(t,s),o=nl(e,t,n,o,i,s),n=rl(),e!==null&&!Xt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Vn(e,t,s)):(st&&n&&Oa(t),t.flags|=1,$t(e,t,o,s),t.child)}function $c(e,t,n,o,s){if(e===null){var i=n.type;return typeof i=="function"&&!Rl(i)&&i.defaultProps===void 0&&n.compare===null&&n.defaultProps===void 0?(t.tag=15,t.type=i,Uc(e,t,i,o,s)):(e=Ws(n.type,null,o,t,t.mode,s),e.ref=t.ref,e.return=t,t.child=e)}if(i=e.child,(e.lanes&s)===0){var h=i.memoizedProps;if(n=n.compare,n=n!==null?n:No,n(h,o)&&e.ref===t.ref)return Vn(e,t,s)}return t.flags|=1,e=pr(i,o),e.ref=t.ref,e.return=t,t.child=e}function Uc(e,t,n,o,s){if(e!==null){var i=e.memoizedProps;if(No(i,o)&&e.ref===t.ref)if(Xt=!1,t.pendingProps=o=i,(e.lanes&s)!==0)(e.flags&131072)!==0&&(Xt=!0);else return t.lanes=e.lanes,Vn(e,t,s)}return fl(e,t,n,o,s)}function Wc(e,t,n){var o=t.pendingProps,s=o.children,i=e!==null?e.memoizedState:null;if(o.mode==="hidden")if((t.mode&1)===0)t.memoizedState={baseLanes:0,cachePool:null,transitions:null},qe(oo,on),on|=n;else{if((n&1073741824)===0)return e=i!==null?i.baseLanes|n:n,t.lanes=t.childLanes=1073741824,t.memoizedState={baseLanes:e,cachePool:null,transitions:null},t.updateQueue=null,qe(oo,on),on|=e,null;t.memoizedState={baseLanes:0,cachePool:null,transitions:null},o=i!==null?i.baseLanes:n,qe(oo,on),on|=o}else i!==null?(o=i.baseLanes|n,t.memoizedState=null):o=n,qe(oo,on),on|=o;return $t(e,t,s,n),t.child}function Hc(e,t){var n=t.ref;(e===null&&n!==null||e!==null&&e.ref!==n)&&(t.flags|=512,t.flags|=2097152)}function fl(e,t,n,o,s){var i=Yt(n)?br:Tt.current;return i=Gr(t,i),eo(t,s),n=nl(e,t,n,o,i,s),o=rl(),e!==null&&!Xt?(t.updateQueue=e.updateQueue,t.flags&=-2053,e.lanes&=~s,Vn(e,t,s)):(st&&o&&Oa(t),t.flags|=1,$t(e,t,n,s),t.child)}function Yc(e,t,n,o,s){if(Yt(n)){var i=!0;ps(t)}else i=!1;if(eo(t,s),t.stateNode===null)Is(e,t),Rc(t,n,o),cl(t,n,o,s),o=!0;else if(e===null){var h=t.stateNode,S=t.memoizedProps;h.props=S;var E=h.context,Q=n.contextType;typeof Q=="object"&&Q!==null?Q=hn(Q):(Q=Yt(n)?br:Tt.current,Q=Gr(t,Q));var ie=n.getDerivedStateFromProps,ce=typeof ie=="function"||typeof h.getSnapshotBeforeUpdate=="function";ce||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(S!==o||E!==Q)&&Fc(t,h,o,Q),lr=!1;var le=t.memoizedState;h.state=le,Ss(t,o,h,s),E=t.memoizedState,S!==o||le!==E||Ht.current||lr?(typeof ie=="function"&&(il(t,n,ie,o),E=t.memoizedState),(S=lr||Ic(t,n,S,o,le,E,Q))?(ce||typeof h.UNSAFE_componentWillMount!="function"&&typeof h.componentWillMount!="function"||(typeof h.componentWillMount=="function"&&h.componentWillMount(),typeof h.UNSAFE_componentWillMount=="function"&&h.UNSAFE_componentWillMount()),typeof h.componentDidMount=="function"&&(t.flags|=4194308)):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),t.memoizedProps=o,t.memoizedState=E),h.props=o,h.state=E,h.context=Q,o=S):(typeof h.componentDidMount=="function"&&(t.flags|=4194308),o=!1)}else{h=t.stateNode,lc(e,t),S=t.memoizedProps,Q=t.type===t.elementType?S:bn(t.type,S),h.props=Q,ce=t.pendingProps,le=h.context,E=n.contextType,typeof E=="object"&&E!==null?E=hn(E):(E=Yt(n)?br:Tt.current,E=Gr(t,E));var ye=n.getDerivedStateFromProps;(ie=typeof ye=="function"||typeof h.getSnapshotBeforeUpdate=="function")||typeof h.UNSAFE_componentWillReceiveProps!="function"&&typeof h.componentWillReceiveProps!="function"||(S!==ce||le!==E)&&Fc(t,h,o,E),lr=!1,le=t.memoizedState,h.state=le,Ss(t,o,h,s);var je=t.memoizedState;S!==ce||le!==je||Ht.current||lr?(typeof ye=="function"&&(il(t,n,ye,o),je=t.memoizedState),(Q=lr||Ic(t,n,Q,o,le,je,E)||!1)?(ie||typeof h.UNSAFE_componentWillUpdate!="function"&&typeof h.componentWillUpdate!="function"||(typeof h.componentWillUpdate=="function"&&h.componentWillUpdate(o,je,E),typeof h.UNSAFE_componentWillUpdate=="function"&&h.UNSAFE_componentWillUpdate(o,je,E)),typeof h.componentDidUpdate=="function"&&(t.flags|=4),typeof h.getSnapshotBeforeUpdate=="function"&&(t.flags|=1024)):(typeof h.componentDidUpdate!="function"||S===e.memoizedProps&&le===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&le===e.memoizedState||(t.flags|=1024),t.memoizedProps=o,t.memoizedState=je),h.props=o,h.state=je,h.context=E,o=Q):(typeof h.componentDidUpdate!="function"||S===e.memoizedProps&&le===e.memoizedState||(t.flags|=4),typeof h.getSnapshotBeforeUpdate!="function"||S===e.memoizedProps&&le===e.memoizedState||(t.flags|=1024),o=!1)}return hl(e,t,n,o,i,s)}function hl(e,t,n,o,s,i){Hc(e,t);var h=(t.flags&128)!==0;if(!o&&!h)return s&&Ki(t,n,!1),Vn(e,t,i);o=t.stateNode,bf.current=t;var S=h&&typeof n.getDerivedStateFromError!="function"?null:o.render();return t.flags|=1,e!==null&&h?(t.child=qr(t,e.child,null,i),t.child=qr(t,null,S,i)):$t(e,t,S,i),t.memoizedState=o.state,s&&Ki(t,n,!0),t.child}function Xc(e){var t=e.stateNode;t.pendingContext?Gi(e,t.pendingContext,t.pendingContext!==t.context):t.context&&Gi(e,t.context,!1),Ka(e,t.containerInfo)}function Vc(e,t,n,o,s){return Qr(),Wa(s),t.flags|=256,$t(e,t,n,o),t.child}var pl={dehydrated:null,treeContext:null,retryLane:0};function gl(e){return{baseLanes:e,cachePool:null,transitions:null}}function Gc(e,t,n){var o=t.pendingProps,s=it.current,i=!1,h=(t.flags&128)!==0,S;if((S=h)||(S=e!==null&&e.memoizedState===null?!1:(s&2)!==0),S?(i=!0,t.flags&=-129):(e===null||e.memoizedState!==null)&&(s|=1),qe(it,s&1),e===null)return Ua(t),e=t.memoizedState,e!==null&&(e=e.dehydrated,e!==null)?((t.mode&1)===0?t.lanes=1:e.data==="$!"?t.lanes=8:t.lanes=1073741824,null):(h=o.children,e=o.fallback,i?(o=t.mode,i=t.child,h={mode:"hidden",children:h},(o&1)===0&&i!==null?(i.childLanes=0,i.pendingProps=h):i=Hs(h,o,0,null),e=Lr(e,o,n,null),i.return=t,e.return=t,i.sibling=e,t.child=i,t.child.memoizedState=gl(n),t.memoizedState=pl,e):ml(t,h));if(s=e.memoizedState,s!==null&&(S=s.dehydrated,S!==null))return jf(e,t,h,o,S,s,n);if(i){i=o.fallback,h=t.mode,s=e.child,S=s.sibling;var E={mode:"hidden",children:o.children};return(h&1)===0&&t.child!==s?(o=t.child,o.childLanes=0,o.pendingProps=E,t.deletions=null):(o=pr(s,E),o.subtreeFlags=s.subtreeFlags&14680064),S!==null?i=pr(S,i):(i=Lr(i,h,n,null),i.flags|=2),i.return=t,o.return=t,o.sibling=i,t.child=o,o=i,i=t.child,h=e.child.memoizedState,h=h===null?gl(n):{baseLanes:h.baseLanes|n,cachePool:null,transitions:h.transitions},i.memoizedState=h,i.childLanes=e.childLanes&~n,t.memoizedState=pl,o}return i=e.child,e=i.sibling,o=pr(i,{mode:"visible",children:o.children}),(t.mode&1)===0&&(o.lanes=n),o.return=t,o.sibling=null,e!==null&&(n=t.deletions,n===null?(t.deletions=[e],t.flags|=16):n.push(e)),t.child=o,t.memoizedState=null,o}function ml(e,t){return t=Hs({mode:"visible",children:t},e.mode,0,null),t.return=e,e.child=t}function Ls(e,t,n,o){return o!==null&&Wa(o),qr(t,e.child,null,n),e=ml(t,t.pendingProps.children),e.flags|=2,t.memoizedState=null,e}function jf(e,t,n,o,s,i,h){if(n)return t.flags&256?(t.flags&=-257,o=ul(Error(a(422))),Ls(e,t,h,o)):t.memoizedState!==null?(t.child=e.child,t.flags|=128,null):(i=o.fallback,s=t.mode,o=Hs({mode:"visible",children:o.children},s,0,null),i=Lr(i,s,h,null),i.flags|=2,o.return=t,i.return=t,o.sibling=i,t.child=o,(t.mode&1)!==0&&qr(t,e.child,null,h),t.child.memoizedState=gl(h),t.memoizedState=pl,i);if((t.mode&1)===0)return Ls(e,t,h,null);if(s.data==="$!"){if(o=s.nextSibling&&s.nextSibling.dataset,o)var S=o.dgst;return o=S,i=Error(a(419)),o=ul(i,o,void 0),Ls(e,t,h,o)}if(S=(h&e.childLanes)!==0,Xt||S){if(o=Lt,o!==null){switch(h&-h){case 4:s=2;break;case 16:s=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:s=32;break;case 536870912:s=268435456;break;default:s=0}s=(s&(o.suspendedLanes|h))!==0?0:s,s!==0&&s!==i.retryLane&&(i.retryLane=s,Yn(e,s),Nn(o,e,s,-1))}return Il(),o=ul(Error(a(421))),Ls(e,t,h,o)}return s.data==="$?"?(t.flags|=128,t.child=e.child,t=zf.bind(null,e),s._reactRetry=t,null):(e=i.treeContext,rn=rr(s.nextSibling),nn=t,st=!0,wn=null,e!==null&&(dn[fn++]=Wn,dn[fn++]=Hn,dn[fn++]=jr,Wn=e.id,Hn=e.overflow,jr=t),t=ml(t,o.children),t.flags|=4096,t)}function Zc(e,t,n){e.lanes|=t;var o=e.alternate;o!==null&&(o.lanes|=t),Va(e.return,t,n)}function xl(e,t,n,o,s){var i=e.memoizedState;i===null?e.memoizedState={isBackwards:t,rendering:null,renderingStartTime:0,last:o,tail:n,tailMode:s}:(i.isBackwards=t,i.rendering=null,i.renderingStartTime=0,i.last=o,i.tail=n,i.tailMode=s)}function Kc(e,t,n){var o=t.pendingProps,s=o.revealOrder,i=o.tail;if($t(e,t,o.children,n),o=it.current,(o&2)!==0)o=o&1|2,t.flags|=128;else{if(e!==null&&(e.flags&128)!==0)e:for(e=t.child;e!==null;){if(e.tag===13)e.memoizedState!==null&&Zc(e,n,t);else if(e.tag===19)Zc(e,n,t);else if(e.child!==null){e.child.return=e,e=e.child;continue}if(e===t)break e;for(;e.sibling===null;){if(e.return===null||e.return===t)break e;e=e.return}e.sibling.return=e.return,e=e.sibling}o&=1}if(qe(it,o),(t.mode&1)===0)t.memoizedState=null;else switch(s){case"forwards":for(n=t.child,s=null;n!==null;)e=n.alternate,e!==null&&Ns(e)===null&&(s=n),n=n.sibling;n=s,n===null?(s=t.child,t.child=null):(s=n.sibling,n.sibling=null),xl(t,!1,s,n,i);break;case"backwards":for(n=null,s=t.child,t.child=null;s!==null;){if(e=s.alternate,e!==null&&Ns(e)===null){t.child=s;break}e=s.sibling,s.sibling=n,n=s,s=e}xl(t,!0,n,null,i);break;case"together":xl(t,!1,null,null,void 0);break;default:t.memoizedState=null}return t.child}function Is(e,t){(t.mode&1)===0&&e!==null&&(e.alternate=null,t.alternate=null,t.flags|=2)}function Vn(e,t,n){if(e!==null&&(t.dependencies=e.dependencies),Er|=t.lanes,(n&t.childLanes)===0)return null;if(e!==null&&t.child!==e.child)throw Error(a(153));if(t.child!==null){for(e=t.child,n=pr(e,e.pendingProps),t.child=n,n.return=t;e.sibling!==null;)e=e.sibling,n=n.sibling=pr(e,e.pendingProps),n.return=t;n.sibling=null}return t.child}function Sf(e,t,n){switch(t.tag){case 3:Xc(t),Qr();break;case 5:uc(t);break;case 1:Yt(t.type)&&ps(t);break;case 4:Ka(t,t.stateNode.containerInfo);break;case 10:var o=t.type._context,s=t.memoizedProps.value;qe(ws,o._currentValue),o._currentValue=s;break;case 13:if(o=t.memoizedState,o!==null)return o.dehydrated!==null?(qe(it,it.current&1),t.flags|=128,null):(n&t.child.childLanes)!==0?Gc(e,t,n):(qe(it,it.current&1),e=Vn(e,t,n),e!==null?e.sibling:null);qe(it,it.current&1);break;case 19:if(o=(n&t.childLanes)!==0,(e.flags&128)!==0){if(o)return Kc(e,t,n);t.flags|=128}if(s=t.memoizedState,s!==null&&(s.rendering=null,s.tail=null,s.lastEffect=null),qe(it,it.current),o)break;return null;case 22:case 23:return t.lanes=0,Wc(e,t,n)}return Vn(e,t,n)}var Qc,yl,qc,Jc;Qc=function(e,t){for(var n=t.child;n!==null;){if(n.tag===5||n.tag===6)e.appendChild(n.stateNode);else if(n.tag!==4&&n.child!==null){n.child.return=n,n=n.child;continue}if(n===t)break;for(;n.sibling===null;){if(n.return===null||n.return===t)return;n=n.return}n.sibling.return=n.return,n=n.sibling}},yl=function(){},qc=function(e,t,n,o){var s=e.memoizedProps;if(s!==o){e=t.stateNode,kr(Rn.current);var i=null;switch(n){case"input":s=Qe(e,s),o=Qe(e,o),i=[];break;case"select":s=_({},s,{value:void 0}),o=_({},o,{value:void 0}),i=[];break;case"textarea":s=be(e,s),o=be(e,o),i=[];break;default:typeof s.onClick!="function"&&typeof o.onClick=="function"&&(e.onclick=ds)}Bt(n,o);var h;n=null;for(Q in s)if(!o.hasOwnProperty(Q)&&s.hasOwnProperty(Q)&&s[Q]!=null)if(Q==="style"){var S=s[Q];for(h in S)S.hasOwnProperty(h)&&(n||(n={}),n[h]="")}else Q!=="dangerouslySetInnerHTML"&&Q!=="children"&&Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&Q!=="autoFocus"&&(u.hasOwnProperty(Q)?i||(i=[]):(i=i||[]).push(Q,null));for(Q in o){var E=o[Q];if(S=s?.[Q],o.hasOwnProperty(Q)&&E!==S&&(E!=null||S!=null))if(Q==="style")if(S){for(h in S)!S.hasOwnProperty(h)||E&&E.hasOwnProperty(h)||(n||(n={}),n[h]="");for(h in E)E.hasOwnProperty(h)&&S[h]!==E[h]&&(n||(n={}),n[h]=E[h])}else n||(i||(i=[]),i.push(Q,n)),n=E;else Q==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,S=S?S.__html:void 0,E!=null&&S!==E&&(i=i||[]).push(Q,E)):Q==="children"?typeof E!="string"&&typeof E!="number"||(i=i||[]).push(Q,""+E):Q!=="suppressContentEditableWarning"&&Q!=="suppressHydrationWarning"&&(u.hasOwnProperty(Q)?(E!=null&&Q==="onScroll"&&et("scroll",e),i||S===E||(i=[])):(i=i||[]).push(Q,E))}n&&(i=i||[]).push("style",n);var Q=i;(t.updateQueue=Q)&&(t.flags|=4)}},Jc=function(e,t,n,o){n!==o&&(t.flags|=4)};function Oo(e,t){if(!st)switch(e.tailMode){case"hidden":t=e.tail;for(var n=null;t!==null;)t.alternate!==null&&(n=t),t=t.sibling;n===null?e.tail=null:n.sibling=null;break;case"collapsed":n=e.tail;for(var o=null;n!==null;)n.alternate!==null&&(o=n),n=n.sibling;o===null?t||e.tail===null?e.tail=null:e.tail.sibling=null:o.sibling=null}}function At(e){var t=e.alternate!==null&&e.alternate.child===e.child,n=0,o=0;if(t)for(var s=e.child;s!==null;)n|=s.lanes|s.childLanes,o|=s.subtreeFlags&14680064,o|=s.flags&14680064,s.return=e,s=s.sibling;else for(s=e.child;s!==null;)n|=s.lanes|s.childLanes,o|=s.subtreeFlags,o|=s.flags,s.return=e,s=s.sibling;return e.subtreeFlags|=o,e.childLanes=n,t}function Nf(e,t,n){var o=t.pendingProps;switch(Ba(t),t.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return At(t),null;case 1:return Yt(t.type)&&hs(),At(t),null;case 3:return o=t.stateNode,to(),tt(Ht),tt(Tt),Ja(),o.pendingContext&&(o.context=o.pendingContext,o.pendingContext=null),(e===null||e.child===null)&&(ys(t)?t.flags|=4:e===null||e.memoizedState.isDehydrated&&(t.flags&256)===0||(t.flags|=1024,wn!==null&&(Pl(wn),wn=null))),yl(e,t),At(t),null;case 5:Qa(t);var s=kr(Fo.current);if(n=t.type,e!==null&&t.stateNode!=null)qc(e,t,n,o,s),e.ref!==t.ref&&(t.flags|=512,t.flags|=2097152);else{if(!o){if(t.stateNode===null)throw Error(a(166));return At(t),null}if(e=kr(Rn.current),ys(t)){o=t.stateNode,n=t.type;var i=t.memoizedProps;switch(o[In]=t,o[Po]=i,e=(t.mode&1)!==0,n){case"dialog":et("cancel",o),et("close",o);break;case"iframe":case"object":case"embed":et("load",o);break;case"video":case"audio":for(s=0;s<Co.length;s++)et(Co[s],o);break;case"source":et("error",o);break;case"img":case"image":case"link":et("error",o),et("load",o);break;case"details":et("toggle",o);break;case"input":Ct(o,i),et("invalid",o);break;case"select":o._wrapperState={wasMultiple:!!i.multiple},et("invalid",o);break;case"textarea":xe(o,i),et("invalid",o)}Bt(n,i),s=null;for(var h in i)if(i.hasOwnProperty(h)){var S=i[h];h==="children"?typeof S=="string"?o.textContent!==S&&(i.suppressHydrationWarning!==!0&&us(o.textContent,S,e),s=["children",S]):typeof S=="number"&&o.textContent!==""+S&&(i.suppressHydrationWarning!==!0&&us(o.textContent,S,e),s=["children",""+S]):u.hasOwnProperty(h)&&S!=null&&h==="onScroll"&&et("scroll",o)}switch(n){case"input":De(o),Be(o,i,!0);break;case"textarea":De(o),He(o);break;case"select":case"option":break;default:typeof i.onClick=="function"&&(o.onclick=ds)}o=s,t.updateQueue=o,o!==null&&(t.flags|=4)}else{h=s.nodeType===9?s:s.ownerDocument,e==="http://www.w3.org/1999/xhtml"&&(e=at(n)),e==="http://www.w3.org/1999/xhtml"?n==="script"?(e=h.createElement("div"),e.innerHTML="<script><\/script>",e=e.removeChild(e.firstChild)):typeof o.is=="string"?e=h.createElement(n,{is:o.is}):(e=h.createElement(n),n==="select"&&(h=e,o.multiple?h.multiple=!0:o.size&&(h.size=o.size))):e=h.createElementNS(e,n),e[In]=t,e[Po]=o,Qc(e,t,!1,!1),t.stateNode=e;e:{switch(h=dt(n,o),n){case"dialog":et("cancel",e),et("close",e),s=o;break;case"iframe":case"object":case"embed":et("load",e),s=o;break;case"video":case"audio":for(s=0;s<Co.length;s++)et(Co[s],e);s=o;break;case"source":et("error",e),s=o;break;case"img":case"image":case"link":et("error",e),et("load",e),s=o;break;case"details":et("toggle",e),s=o;break;case"input":Ct(e,o),s=Qe(e,o),et("invalid",e);break;case"option":s=o;break;case"select":e._wrapperState={wasMultiple:!!o.multiple},s=_({},o,{value:void 0}),et("invalid",e);break;case"textarea":xe(e,o),s=be(e,o),et("invalid",e);break;default:s=o}Bt(n,s),S=s;for(i in S)if(S.hasOwnProperty(i)){var E=S[i];i==="style"?Pt(e,E):i==="dangerouslySetInnerHTML"?(E=E?E.__html:void 0,E!=null&&lt(e,E)):i==="children"?typeof E=="string"?(n!=="textarea"||E!=="")&&Et(e,E):typeof E=="number"&&Et(e,""+E):i!=="suppressContentEditableWarning"&&i!=="suppressHydrationWarning"&&i!=="autoFocus"&&(u.hasOwnProperty(i)?E!=null&&i==="onScroll"&&et("scroll",e):E!=null&&q(e,i,E,h))}switch(n){case"input":De(e),Be(e,o,!1);break;case"textarea":De(e),He(e);break;case"option":o.value!=null&&e.setAttribute("value",""+pe(o.value));break;case"select":e.multiple=!!o.multiple,i=o.value,i!=null?ge(e,!!o.multiple,i,!1):o.defaultValue!=null&&ge(e,!!o.multiple,o.defaultValue,!0);break;default:typeof s.onClick=="function"&&(e.onclick=ds)}switch(n){case"button":case"input":case"select":case"textarea":o=!!o.autoFocus;break e;case"img":o=!0;break e;default:o=!1}}o&&(t.flags|=4)}t.ref!==null&&(t.flags|=512,t.flags|=2097152)}return At(t),null;case 6:if(e&&t.stateNode!=null)Jc(e,t,e.memoizedProps,o);else{if(typeof o!="string"&&t.stateNode===null)throw Error(a(166));if(n=kr(Fo.current),kr(Rn.current),ys(t)){if(o=t.stateNode,n=t.memoizedProps,o[In]=t,(i=o.nodeValue!==n)&&(e=nn,e!==null))switch(e.tag){case 3:us(o.nodeValue,n,(e.mode&1)!==0);break;case 5:e.memoizedProps.suppressHydrationWarning!==!0&&us(o.nodeValue,n,(e.mode&1)!==0)}i&&(t.flags|=4)}else o=(n.nodeType===9?n:n.ownerDocument).createTextNode(o),o[In]=t,t.stateNode=o}return At(t),null;case 13:if(tt(it),o=t.memoizedState,e===null||e.memoizedState!==null&&e.memoizedState.dehydrated!==null){if(st&&rn!==null&&(t.mode&1)!==0&&(t.flags&128)===0)nc(),Qr(),t.flags|=98560,i=!1;else if(i=ys(t),o!==null&&o.dehydrated!==null){if(e===null){if(!i)throw Error(a(318));if(i=t.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(a(317));i[In]=t}else Qr(),(t.flags&128)===0&&(t.memoizedState=null),t.flags|=4;At(t),i=!1}else wn!==null&&(Pl(wn),wn=null),i=!0;if(!i)return t.flags&65536?t:null}return(t.flags&128)!==0?(t.lanes=n,t):(o=o!==null,o!==(e!==null&&e.memoizedState!==null)&&o&&(t.child.flags|=8192,(t.mode&1)!==0&&(e===null||(it.current&1)!==0?kt===0&&(kt=3):Il())),t.updateQueue!==null&&(t.flags|=4),At(t),null);case 4:return to(),yl(e,t),e===null&&Eo(t.stateNode.containerInfo),At(t),null;case 10:return Xa(t.type._context),At(t),null;case 17:return Yt(t.type)&&hs(),At(t),null;case 19:if(tt(it),i=t.memoizedState,i===null)return At(t),null;if(o=(t.flags&128)!==0,h=i.rendering,h===null)if(o)Oo(i,!1);else{if(kt!==0||e!==null&&(e.flags&128)!==0)for(e=t.child;e!==null;){if(h=Ns(e),h!==null){for(t.flags|=128,Oo(i,!1),o=h.updateQueue,o!==null&&(t.updateQueue=o,t.flags|=4),t.subtreeFlags=0,o=n,n=t.child;n!==null;)i=n,e=o,i.flags&=14680066,h=i.alternate,h===null?(i.childLanes=0,i.lanes=e,i.child=null,i.subtreeFlags=0,i.memoizedProps=null,i.memoizedState=null,i.updateQueue=null,i.dependencies=null,i.stateNode=null):(i.childLanes=h.childLanes,i.lanes=h.lanes,i.child=h.child,i.subtreeFlags=0,i.deletions=null,i.memoizedProps=h.memoizedProps,i.memoizedState=h.memoizedState,i.updateQueue=h.updateQueue,i.type=h.type,e=h.dependencies,i.dependencies=e===null?null:{lanes:e.lanes,firstContext:e.firstContext}),n=n.sibling;return qe(it,it.current&1|2),t.child}e=e.sibling}i.tail!==null&&Ve()>so&&(t.flags|=128,o=!0,Oo(i,!1),t.lanes=4194304)}else{if(!o)if(e=Ns(h),e!==null){if(t.flags|=128,o=!0,n=e.updateQueue,n!==null&&(t.updateQueue=n,t.flags|=4),Oo(i,!0),i.tail===null&&i.tailMode==="hidden"&&!h.alternate&&!st)return At(t),null}else 2*Ve()-i.renderingStartTime>so&&n!==1073741824&&(t.flags|=128,o=!0,Oo(i,!1),t.lanes=4194304);i.isBackwards?(h.sibling=t.child,t.child=h):(n=i.last,n!==null?n.sibling=h:t.child=h,i.last=h)}return i.tail!==null?(t=i.tail,i.rendering=t,i.tail=t.sibling,i.renderingStartTime=Ve(),t.sibling=null,n=it.current,qe(it,o?n&1|2:n&1),t):(At(t),null);case 22:case 23:return Ll(),o=t.memoizedState!==null,e!==null&&e.memoizedState!==null!==o&&(t.flags|=8192),o&&(t.mode&1)!==0?(on&1073741824)!==0&&(At(t),t.subtreeFlags&6&&(t.flags|=8192)):At(t),null;case 24:return null;case 25:return null}throw Error(a(156,t.tag))}function kf(e,t){switch(Ba(t),t.tag){case 1:return Yt(t.type)&&hs(),e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 3:return to(),tt(Ht),tt(Tt),Ja(),e=t.flags,(e&65536)!==0&&(e&128)===0?(t.flags=e&-65537|128,t):null;case 5:return Qa(t),null;case 13:if(tt(it),e=t.memoizedState,e!==null&&e.dehydrated!==null){if(t.alternate===null)throw Error(a(340));Qr()}return e=t.flags,e&65536?(t.flags=e&-65537|128,t):null;case 19:return tt(it),null;case 4:return to(),null;case 10:return Xa(t.type._context),null;case 22:case 23:return Ll(),null;case 24:return null;default:return null}}var Rs=!1,Ot=!1,Cf=typeof WeakSet=="function"?WeakSet:Set,we=null;function ro(e,t){var n=e.ref;if(n!==null)if(typeof n=="function")try{n(null)}catch(o){ht(e,t,o)}else n.current=null}function vl(e,t,n){try{n()}catch(o){ht(e,t,o)}}var eu=!1;function Ef(e,t){if(La=Jo,e=Ii(),Sa(e)){if("selectionStart"in e)var n={start:e.selectionStart,end:e.selectionEnd};else e:{n=(n=e.ownerDocument)&&n.defaultView||window;var o=n.getSelection&&n.getSelection();if(o&&o.rangeCount!==0){n=o.anchorNode;var s=o.anchorOffset,i=o.focusNode;o=o.focusOffset;try{n.nodeType,i.nodeType}catch{n=null;break e}var h=0,S=-1,E=-1,Q=0,ie=0,ce=e,le=null;t:for(;;){for(var ye;ce!==n||s!==0&&ce.nodeType!==3||(S=h+s),ce!==i||o!==0&&ce.nodeType!==3||(E=h+o),ce.nodeType===3&&(h+=ce.nodeValue.length),(ye=ce.firstChild)!==null;)le=ce,ce=ye;for(;;){if(ce===e)break t;if(le===n&&++Q===s&&(S=h),le===i&&++ie===o&&(E=h),(ye=ce.nextSibling)!==null)break;ce=le,le=ce.parentNode}ce=ye}n=S===-1||E===-1?null:{start:S,end:E}}else n=null}n=n||{start:0,end:0}}else n=null;for(Ia={focusedElem:e,selectionRange:n},Jo=!1,we=t;we!==null;)if(t=we,e=t.child,(t.subtreeFlags&1028)!==0&&e!==null)e.return=t,we=e;else for(;we!==null;){t=we;try{var je=t.alternate;if((t.flags&1024)!==0)switch(t.tag){case 0:case 11:case 15:break;case 1:if(je!==null){var ke=je.memoizedProps,gt=je.memoizedState,B=t.stateNode,L=B.getSnapshotBeforeUpdate(t.elementType===t.type?ke:bn(t.type,ke),gt);B.__reactInternalSnapshotBeforeUpdate=L}break;case 3:var Y=t.stateNode.containerInfo;Y.nodeType===1?Y.textContent="":Y.nodeType===9&&Y.documentElement&&Y.removeChild(Y.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(a(163))}}catch(he){ht(t,t.return,he)}if(e=t.sibling,e!==null){e.return=t.return,we=e;break}we=t.return}return je=eu,eu=!1,je}function Bo(e,t,n){var o=t.updateQueue;if(o=o!==null?o.lastEffect:null,o!==null){var s=o=o.next;do{if((s.tag&e)===e){var i=s.destroy;s.destroy=void 0,i!==void 0&&vl(t,n,i)}s=s.next}while(s!==o)}}function Fs(e,t){if(t=t.updateQueue,t=t!==null?t.lastEffect:null,t!==null){var n=t=t.next;do{if((n.tag&e)===e){var o=n.create;n.destroy=o()}n=n.next}while(n!==t)}}function wl(e){var t=e.ref;if(t!==null){var n=e.stateNode;e.tag,e=n,typeof t=="function"?t(e):t.current=e}}function tu(e){var t=e.alternate;t!==null&&(e.alternate=null,tu(t)),e.child=null,e.deletions=null,e.sibling=null,e.tag===5&&(t=e.stateNode,t!==null&&(delete t[In],delete t[Po],delete t[Ta],delete t[cf],delete t[uf])),e.stateNode=null,e.return=null,e.dependencies=null,e.memoizedProps=null,e.memoizedState=null,e.pendingProps=null,e.stateNode=null,e.updateQueue=null}function nu(e){return e.tag===5||e.tag===3||e.tag===4}function ru(e){e:for(;;){for(;e.sibling===null;){if(e.return===null||nu(e.return))return null;e=e.return}for(e.sibling.return=e.return,e=e.sibling;e.tag!==5&&e.tag!==6&&e.tag!==18;){if(e.flags&2||e.child===null||e.tag===4)continue e;e.child.return=e,e=e.child}if(!(e.flags&2))return e.stateNode}}function bl(e,t,n){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?n.nodeType===8?n.parentNode.insertBefore(e,t):n.insertBefore(e,t):(n.nodeType===8?(t=n.parentNode,t.insertBefore(e,n)):(t=n,t.appendChild(e)),n=n._reactRootContainer,n!=null||t.onclick!==null||(t.onclick=ds));else if(o!==4&&(e=e.child,e!==null))for(bl(e,t,n),e=e.sibling;e!==null;)bl(e,t,n),e=e.sibling}function jl(e,t,n){var o=e.tag;if(o===5||o===6)e=e.stateNode,t?n.insertBefore(e,t):n.appendChild(e);else if(o!==4&&(e=e.child,e!==null))for(jl(e,t,n),e=e.sibling;e!==null;)jl(e,t,n),e=e.sibling}var Ft=null,jn=!1;function cr(e,t,n){for(n=n.child;n!==null;)ou(e,t,n),n=n.sibling}function ou(e,t,n){if(un&&typeof un.onCommitFiberUnmount=="function")try{un.onCommitFiberUnmount(Kn,n)}catch{}switch(n.tag){case 5:Ot||ro(n,t);case 6:var o=Ft,s=jn;Ft=null,cr(e,t,n),Ft=o,jn=s,Ft!==null&&(jn?(e=Ft,n=n.stateNode,e.nodeType===8?e.parentNode.removeChild(n):e.removeChild(n)):Ft.removeChild(n.stateNode));break;case 18:Ft!==null&&(jn?(e=Ft,n=n.stateNode,e.nodeType===8?za(e.parentNode,n):e.nodeType===1&&za(e,n),yo(e)):za(Ft,n.stateNode));break;case 4:o=Ft,s=jn,Ft=n.stateNode.containerInfo,jn=!0,cr(e,t,n),Ft=o,jn=s;break;case 0:case 11:case 14:case 15:if(!Ot&&(o=n.updateQueue,o!==null&&(o=o.lastEffect,o!==null))){s=o=o.next;do{var i=s,h=i.destroy;i=i.tag,h!==void 0&&((i&2)!==0||(i&4)!==0)&&vl(n,t,h),s=s.next}while(s!==o)}cr(e,t,n);break;case 1:if(!Ot&&(ro(n,t),o=n.stateNode,typeof o.componentWillUnmount=="function"))try{o.props=n.memoizedProps,o.state=n.memoizedState,o.componentWillUnmount()}catch(S){ht(n,t,S)}cr(e,t,n);break;case 21:cr(e,t,n);break;case 22:n.mode&1?(Ot=(o=Ot)||n.memoizedState!==null,cr(e,t,n),Ot=o):cr(e,t,n);break;default:cr(e,t,n)}}function su(e){var t=e.updateQueue;if(t!==null){e.updateQueue=null;var n=e.stateNode;n===null&&(n=e.stateNode=new Cf),t.forEach(function(o){var s=Tf.bind(null,e,o);n.has(o)||(n.add(o),o.then(s,s))})}}function Sn(e,t){var n=t.deletions;if(n!==null)for(var o=0;o<n.length;o++){var s=n[o];try{var i=e,h=t,S=h;e:for(;S!==null;){switch(S.tag){case 5:Ft=S.stateNode,jn=!1;break e;case 3:Ft=S.stateNode.containerInfo,jn=!0;break e;case 4:Ft=S.stateNode.containerInfo,jn=!0;break e}S=S.return}if(Ft===null)throw Error(a(160));ou(i,h,s),Ft=null,jn=!1;var E=s.alternate;E!==null&&(E.return=null),s.return=null}catch(Q){ht(s,t,Q)}}if(t.subtreeFlags&12854)for(t=t.child;t!==null;)au(t,e),t=t.sibling}function au(e,t){var n=e.alternate,o=e.flags;switch(e.tag){case 0:case 11:case 14:case 15:if(Sn(t,e),zn(e),o&4){try{Bo(3,e,e.return),Fs(3,e)}catch(ke){ht(e,e.return,ke)}try{Bo(5,e,e.return)}catch(ke){ht(e,e.return,ke)}}break;case 1:Sn(t,e),zn(e),o&512&&n!==null&&ro(n,n.return);break;case 5:if(Sn(t,e),zn(e),o&512&&n!==null&&ro(n,n.return),e.flags&32){var s=e.stateNode;try{Et(s,"")}catch(ke){ht(e,e.return,ke)}}if(o&4&&(s=e.stateNode,s!=null)){var i=e.memoizedProps,h=n!==null?n.memoizedProps:i,S=e.type,E=e.updateQueue;if(e.updateQueue=null,E!==null)try{S==="input"&&i.type==="radio"&&i.name!=null&&mt(s,i),dt(S,h);var Q=dt(S,i);for(h=0;h<E.length;h+=2){var ie=E[h],ce=E[h+1];ie==="style"?Pt(s,ce):ie==="dangerouslySetInnerHTML"?lt(s,ce):ie==="children"?Et(s,ce):q(s,ie,ce,Q)}switch(S){case"input":se(s,i);break;case"textarea":Ae(s,i);break;case"select":var le=s._wrapperState.wasMultiple;s._wrapperState.wasMultiple=!!i.multiple;var ye=i.value;ye!=null?ge(s,!!i.multiple,ye,!1):le!==!!i.multiple&&(i.defaultValue!=null?ge(s,!!i.multiple,i.defaultValue,!0):ge(s,!!i.multiple,i.multiple?[]:"",!1))}s[Po]=i}catch(ke){ht(e,e.return,ke)}}break;case 6:if(Sn(t,e),zn(e),o&4){if(e.stateNode===null)throw Error(a(162));s=e.stateNode,i=e.memoizedProps;try{s.nodeValue=i}catch(ke){ht(e,e.return,ke)}}break;case 3:if(Sn(t,e),zn(e),o&4&&n!==null&&n.memoizedState.isDehydrated)try{yo(t.containerInfo)}catch(ke){ht(e,e.return,ke)}break;case 4:Sn(t,e),zn(e);break;case 13:Sn(t,e),zn(e),s=e.child,s.flags&8192&&(i=s.memoizedState!==null,s.stateNode.isHidden=i,!i||s.alternate!==null&&s.alternate.memoizedState!==null||(kl=Ve())),o&4&&su(e);break;case 22:if(ie=n!==null&&n.memoizedState!==null,e.mode&1?(Ot=(Q=Ot)||ie,Sn(t,e),Ot=Q):Sn(t,e),zn(e),o&8192){if(Q=e.memoizedState!==null,(e.stateNode.isHidden=Q)&&!ie&&(e.mode&1)!==0)for(we=e,ie=e.child;ie!==null;){for(ce=we=ie;we!==null;){switch(le=we,ye=le.child,le.tag){case 0:case 11:case 14:case 15:Bo(4,le,le.return);break;case 1:ro(le,le.return);var je=le.stateNode;if(typeof je.componentWillUnmount=="function"){o=le,n=le.return;try{t=o,je.props=t.memoizedProps,je.state=t.memoizedState,je.componentWillUnmount()}catch(ke){ht(o,n,ke)}}break;case 5:ro(le,le.return);break;case 22:if(le.memoizedState!==null){cu(ce);continue}}ye!==null?(ye.return=le,we=ye):cu(ce)}ie=ie.sibling}e:for(ie=null,ce=e;;){if(ce.tag===5){if(ie===null){ie=ce;try{s=ce.stateNode,Q?(i=s.style,typeof i.setProperty=="function"?i.setProperty("display","none","important"):i.display="none"):(S=ce.stateNode,E=ce.memoizedProps.style,h=E!=null&&E.hasOwnProperty("display")?E.display:null,S.style.display=Mt("display",h))}catch(ke){ht(e,e.return,ke)}}}else if(ce.tag===6){if(ie===null)try{ce.stateNode.nodeValue=Q?"":ce.memoizedProps}catch(ke){ht(e,e.return,ke)}}else if((ce.tag!==22&&ce.tag!==23||ce.memoizedState===null||ce===e)&&ce.child!==null){ce.child.return=ce,ce=ce.child;continue}if(ce===e)break e;for(;ce.sibling===null;){if(ce.return===null||ce.return===e)break e;ie===ce&&(ie=null),ce=ce.return}ie===ce&&(ie=null),ce.sibling.return=ce.return,ce=ce.sibling}}break;case 19:Sn(t,e),zn(e),o&4&&su(e);break;case 21:break;default:Sn(t,e),zn(e)}}function zn(e){var t=e.flags;if(t&2){try{e:{for(var n=e.return;n!==null;){if(nu(n)){var o=n;break e}n=n.return}throw Error(a(160))}switch(o.tag){case 5:var s=o.stateNode;o.flags&32&&(Et(s,""),o.flags&=-33);var i=ru(e);jl(e,i,s);break;case 3:case 4:var h=o.stateNode.containerInfo,S=ru(e);bl(e,S,h);break;default:throw Error(a(161))}}catch(E){ht(e,e.return,E)}e.flags&=-3}t&4096&&(e.flags&=-4097)}function Mf(e,t,n){we=e,lu(e)}function lu(e,t,n){for(var o=(e.mode&1)!==0;we!==null;){var s=we,i=s.child;if(s.tag===22&&o){var h=s.memoizedState!==null||Rs;if(!h){var S=s.alternate,E=S!==null&&S.memoizedState!==null||Ot;S=Rs;var Q=Ot;if(Rs=h,(Ot=E)&&!Q)for(we=s;we!==null;)h=we,E=h.child,h.tag===22&&h.memoizedState!==null?uu(s):E!==null?(E.return=h,we=E):uu(s);for(;i!==null;)we=i,lu(i),i=i.sibling;we=s,Rs=S,Ot=Q}iu(e)}else(s.subtreeFlags&8772)!==0&&i!==null?(i.return=s,we=i):iu(e)}}function iu(e){for(;we!==null;){var t=we;if((t.flags&8772)!==0){var n=t.alternate;try{if((t.flags&8772)!==0)switch(t.tag){case 0:case 11:case 15:Ot||Fs(5,t);break;case 1:var o=t.stateNode;if(t.flags&4&&!Ot)if(n===null)o.componentDidMount();else{var s=t.elementType===t.type?n.memoizedProps:bn(t.type,n.memoizedProps);o.componentDidUpdate(s,n.memoizedState,o.__reactInternalSnapshotBeforeUpdate)}var i=t.updateQueue;i!==null&&cc(t,i,o);break;case 3:var h=t.updateQueue;if(h!==null){if(n=null,t.child!==null)switch(t.child.tag){case 5:n=t.child.stateNode;break;case 1:n=t.child.stateNode}cc(t,h,n)}break;case 5:var S=t.stateNode;if(n===null&&t.flags&4){n=S;var E=t.memoizedProps;switch(t.type){case"button":case"input":case"select":case"textarea":E.autoFocus&&n.focus();break;case"img":E.src&&(n.src=E.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(t.memoizedState===null){var Q=t.alternate;if(Q!==null){var ie=Q.memoizedState;if(ie!==null){var ce=ie.dehydrated;ce!==null&&yo(ce)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(a(163))}Ot||t.flags&512&&wl(t)}catch(le){ht(t,t.return,le)}}if(t===e){we=null;break}if(n=t.sibling,n!==null){n.return=t.return,we=n;break}we=t.return}}function cu(e){for(;we!==null;){var t=we;if(t===e){we=null;break}var n=t.sibling;if(n!==null){n.return=t.return,we=n;break}we=t.return}}function uu(e){for(;we!==null;){var t=we;try{switch(t.tag){case 0:case 11:case 15:var n=t.return;try{Fs(4,t)}catch(E){ht(t,n,E)}break;case 1:var o=t.stateNode;if(typeof o.componentDidMount=="function"){var s=t.return;try{o.componentDidMount()}catch(E){ht(t,s,E)}}var i=t.return;try{wl(t)}catch(E){ht(t,i,E)}break;case 5:var h=t.return;try{wl(t)}catch(E){ht(t,h,E)}}}catch(E){ht(t,t.return,E)}if(t===e){we=null;break}var S=t.sibling;if(S!==null){S.return=t.return,we=S;break}we=t.return}}var Pf=Math.ceil,zs=U.ReactCurrentDispatcher,Sl=U.ReactCurrentOwner,gn=U.ReactCurrentBatchConfig,We=0,Lt=null,wt=null,zt=0,on=0,oo=or(0),kt=0,$o=null,Er=0,Ts=0,Nl=0,Uo=null,Vt=null,kl=0,so=1/0,Gn=null,_s=!1,Cl=null,ur=null,As=!1,dr=null,Os=0,Wo=0,El=null,Bs=-1,$s=0;function Ut(){return(We&6)!==0?Ve():Bs!==-1?Bs:Bs=Ve()}function fr(e){return(e.mode&1)===0?1:(We&2)!==0&&zt!==0?zt&-zt:ff.transition!==null?($s===0&&($s=me()),$s):(e=_e,e!==0||(e=window.event,e=e===void 0?16:fi(e.type)),e)}function Nn(e,t,n,o){if(50<Wo)throw Wo=0,El=null,Error(a(185));Le(e,n,o),((We&2)===0||e!==Lt)&&(e===Lt&&((We&2)===0&&(Ts|=n),kt===4&&hr(e,zt)),Gt(e,o),n===1&&We===0&&(t.mode&1)===0&&(so=Ve()+500,gs&&ar()))}function Gt(e,t){var n=e.callbackNode;ua(e,t);var o=vr(e,e===Lt?zt:0);if(o===0)n!==null&&Je(n),e.callbackNode=null,e.callbackPriority=0;else if(t=o&-o,e.callbackPriority!==t){if(n!=null&&Je(n),t===1)e.tag===0?df(fu.bind(null,e)):Qi(fu.bind(null,e)),af(function(){(We&6)===0&&ar()}),n=null;else{switch(en(o)){case 1:n=Dn;break;case 4:n=Ln;break;case 16:n=Fr;break;case 536870912:n=Ko;break;default:n=Fr}n=wu(n,du.bind(null,e))}e.callbackPriority=t,e.callbackNode=n}}function du(e,t){if(Bs=-1,$s=0,(We&6)!==0)throw Error(a(327));var n=e.callbackNode;if(ao()&&e.callbackNode!==n)return null;var o=vr(e,e===Lt?zt:0);if(o===0)return null;if((o&30)!==0||(o&e.expiredLanes)!==0||t)t=Us(e,o);else{t=o;var s=We;We|=2;var i=pu();(Lt!==e||zt!==t)&&(Gn=null,so=Ve()+500,Pr(e,t));do try{If();break}catch(S){hu(e,S)}while(!0);Ya(),zs.current=i,We=s,wt!==null?t=0:(Lt=null,zt=0,t=kt)}if(t!==0){if(t===2&&(s=V(e),s!==0&&(o=s,t=Ml(e,s))),t===1)throw n=$o,Pr(e,0),hr(e,o),Gt(e,Ve()),n;if(t===6)hr(e,o);else{if(s=e.current.alternate,(o&30)===0&&!Df(s)&&(t=Us(e,o),t===2&&(i=V(e),i!==0&&(o=i,t=Ml(e,i))),t===1))throw n=$o,Pr(e,0),hr(e,o),Gt(e,Ve()),n;switch(e.finishedWork=s,e.finishedLanes=o,t){case 0:case 1:throw Error(a(345));case 2:Dr(e,Vt,Gn);break;case 3:if(hr(e,o),(o&130023424)===o&&(t=kl+500-Ve(),10<t)){if(vr(e,0)!==0)break;if(s=e.suspendedLanes,(s&o)!==o){Ut(),e.pingedLanes|=e.suspendedLanes&s;break}e.timeoutHandle=Fa(Dr.bind(null,e,Vt,Gn),t);break}Dr(e,Vt,Gn);break;case 4:if(hr(e,o),(o&4194240)===o)break;for(t=e.eventTimes,s=-1;0<o;){var h=31-Jt(o);i=1<<h,h=t[h],h>s&&(s=h),o&=~i}if(o=s,o=Ve()-o,o=(120>o?120:480>o?480:1080>o?1080:1920>o?1920:3e3>o?3e3:4320>o?4320:1960*Pf(o/1960))-o,10<o){e.timeoutHandle=Fa(Dr.bind(null,e,Vt,Gn),o);break}Dr(e,Vt,Gn);break;case 5:Dr(e,Vt,Gn);break;default:throw Error(a(329))}}}return Gt(e,Ve()),e.callbackNode===n?du.bind(null,e):null}function Ml(e,t){var n=Uo;return e.current.memoizedState.isDehydrated&&(Pr(e,t).flags|=256),e=Us(e,t),e!==2&&(t=Vt,Vt=n,t!==null&&Pl(t)),e}function Pl(e){Vt===null?Vt=e:Vt.push.apply(Vt,e)}function Df(e){for(var t=e;;){if(t.flags&16384){var n=t.updateQueue;if(n!==null&&(n=n.stores,n!==null))for(var o=0;o<n.length;o++){var s=n[o],i=s.getSnapshot;s=s.value;try{if(!vn(i(),s))return!1}catch{return!1}}}if(n=t.child,t.subtreeFlags&16384&&n!==null)n.return=t,t=n;else{if(t===e)break;for(;t.sibling===null;){if(t.return===null||t.return===e)return!0;t=t.return}t.sibling.return=t.return,t=t.sibling}}return!0}function hr(e,t){for(t&=~Nl,t&=~Ts,e.suspendedLanes|=t,e.pingedLanes&=~t,e=e.expirationTimes;0<t;){var n=31-Jt(t),o=1<<n;e[n]=-1,t&=~o}}function fu(e){if((We&6)!==0)throw Error(a(327));ao();var t=vr(e,0);if((t&1)===0)return Gt(e,Ve()),null;var n=Us(e,t);if(e.tag!==0&&n===2){var o=V(e);o!==0&&(t=o,n=Ml(e,o))}if(n===1)throw n=$o,Pr(e,0),hr(e,t),Gt(e,Ve()),n;if(n===6)throw Error(a(345));return e.finishedWork=e.current.alternate,e.finishedLanes=t,Dr(e,Vt,Gn),Gt(e,Ve()),null}function Dl(e,t){var n=We;We|=1;try{return e(t)}finally{We=n,We===0&&(so=Ve()+500,gs&&ar())}}function Mr(e){dr!==null&&dr.tag===0&&(We&6)===0&&ao();var t=We;We|=1;var n=gn.transition,o=_e;try{if(gn.transition=null,_e=1,e)return e()}finally{_e=o,gn.transition=n,We=t,(We&6)===0&&ar()}}function Ll(){on=oo.current,tt(oo)}function Pr(e,t){e.finishedWork=null,e.finishedLanes=0;var n=e.timeoutHandle;if(n!==-1&&(e.timeoutHandle=-1,sf(n)),wt!==null)for(n=wt.return;n!==null;){var o=n;switch(Ba(o),o.tag){case 1:o=o.type.childContextTypes,o!=null&&hs();break;case 3:to(),tt(Ht),tt(Tt),Ja();break;case 5:Qa(o);break;case 4:to();break;case 13:tt(it);break;case 19:tt(it);break;case 10:Xa(o.type._context);break;case 22:case 23:Ll()}n=n.return}if(Lt=e,wt=e=pr(e.current,null),zt=on=t,kt=0,$o=null,Nl=Ts=Er=0,Vt=Uo=null,Nr!==null){for(t=0;t<Nr.length;t++)if(n=Nr[t],o=n.interleaved,o!==null){n.interleaved=null;var s=o.next,i=n.pending;if(i!==null){var h=i.next;i.next=s,o.next=h}n.pending=o}Nr=null}return e}function hu(e,t){do{var n=wt;try{if(Ya(),ks.current=Ps,Cs){for(var o=ct.memoizedState;o!==null;){var s=o.queue;s!==null&&(s.pending=null),o=o.next}Cs=!1}if(Cr=0,Dt=Nt=ct=null,zo=!1,To=0,Sl.current=null,n===null||n.return===null){kt=1,$o=t,wt=null;break}e:{var i=e,h=n.return,S=n,E=t;if(t=zt,S.flags|=32768,E!==null&&typeof E=="object"&&typeof E.then=="function"){var Q=E,ie=S,ce=ie.tag;if((ie.mode&1)===0&&(ce===0||ce===11||ce===15)){var le=ie.alternate;le?(ie.updateQueue=le.updateQueue,ie.memoizedState=le.memoizedState,ie.lanes=le.lanes):(ie.updateQueue=null,ie.memoizedState=null)}var ye=Ac(h);if(ye!==null){ye.flags&=-257,Oc(ye,h,S,i,t),ye.mode&1&&_c(i,Q,t),t=ye,E=Q;var je=t.updateQueue;if(je===null){var ke=new Set;ke.add(E),t.updateQueue=ke}else je.add(E);break e}else{if((t&1)===0){_c(i,Q,t),Il();break e}E=Error(a(426))}}else if(st&&S.mode&1){var gt=Ac(h);if(gt!==null){(gt.flags&65536)===0&&(gt.flags|=256),Oc(gt,h,S,i,t),Wa(no(E,S));break e}}i=E=no(E,S),kt!==4&&(kt=2),Uo===null?Uo=[i]:Uo.push(i),i=h;do{switch(i.tag){case 3:i.flags|=65536,t&=-t,i.lanes|=t;var B=zc(i,E,t);ic(i,B);break e;case 1:S=E;var L=i.type,Y=i.stateNode;if((i.flags&128)===0&&(typeof L.getDerivedStateFromError=="function"||Y!==null&&typeof Y.componentDidCatch=="function"&&(ur===null||!ur.has(Y)))){i.flags|=65536,t&=-t,i.lanes|=t;var he=Tc(i,S,t);ic(i,he);break e}}i=i.return}while(i!==null)}mu(n)}catch(Ce){t=Ce,wt===n&&n!==null&&(wt=n=n.return);continue}break}while(!0)}function pu(){var e=zs.current;return zs.current=Ps,e===null?Ps:e}function Il(){(kt===0||kt===3||kt===2)&&(kt=4),Lt===null||(Er&268435455)===0&&(Ts&268435455)===0||hr(Lt,zt)}function Us(e,t){var n=We;We|=2;var o=pu();(Lt!==e||zt!==t)&&(Gn=null,Pr(e,t));do try{Lf();break}catch(s){hu(e,s)}while(!0);if(Ya(),We=n,zs.current=o,wt!==null)throw Error(a(261));return Lt=null,zt=0,kt}function Lf(){for(;wt!==null;)gu(wt)}function If(){for(;wt!==null&&!qt();)gu(wt)}function gu(e){var t=vu(e.alternate,e,on);e.memoizedProps=e.pendingProps,t===null?mu(e):wt=t,Sl.current=null}function mu(e){var t=e;do{var n=t.alternate;if(e=t.return,(t.flags&32768)===0){if(n=Nf(n,t,on),n!==null){wt=n;return}}else{if(n=kf(n,t),n!==null){n.flags&=32767,wt=n;return}if(e!==null)e.flags|=32768,e.subtreeFlags=0,e.deletions=null;else{kt=6,wt=null;return}}if(t=t.sibling,t!==null){wt=t;return}wt=t=e}while(t!==null);kt===0&&(kt=5)}function Dr(e,t,n){var o=_e,s=gn.transition;try{gn.transition=null,_e=1,Rf(e,t,n,o)}finally{gn.transition=s,_e=o}return null}function Rf(e,t,n,o){do ao();while(dr!==null);if((We&6)!==0)throw Error(a(327));n=e.finishedWork;var s=e.finishedLanes;if(n===null)return null;if(e.finishedWork=null,e.finishedLanes=0,n===e.current)throw Error(a(177));e.callbackNode=null,e.callbackPriority=0;var i=n.lanes|n.childLanes;if(rt(e,i),e===Lt&&(wt=Lt=null,zt=0),(n.subtreeFlags&2064)===0&&(n.flags&2064)===0||As||(As=!0,wu(Fr,function(){return ao(),null})),i=(n.flags&15990)!==0,(n.subtreeFlags&15990)!==0||i){i=gn.transition,gn.transition=null;var h=_e;_e=1;var S=We;We|=4,Sl.current=null,Ef(e,n),au(n,e),qd(Ia),Jo=!!La,Ia=La=null,e.current=n,Mf(n),Pn(),We=S,_e=h,gn.transition=i}else e.current=n;if(As&&(As=!1,dr=e,Os=s),i=e.pendingLanes,i===0&&(ur=null),aa(n.stateNode),Gt(e,Ve()),t!==null)for(o=e.onRecoverableError,n=0;n<t.length;n++)s=t[n],o(s.value,{componentStack:s.stack,digest:s.digest});if(_s)throw _s=!1,e=Cl,Cl=null,e;return(Os&1)!==0&&e.tag!==0&&ao(),i=e.pendingLanes,(i&1)!==0?e===El?Wo++:(Wo=0,El=e):Wo=0,ar(),null}function ao(){if(dr!==null){var e=en(Os),t=gn.transition,n=_e;try{if(gn.transition=null,_e=16>e?16:e,dr===null)var o=!1;else{if(e=dr,dr=null,Os=0,(We&6)!==0)throw Error(a(331));var s=We;for(We|=4,we=e.current;we!==null;){var i=we,h=i.child;if((we.flags&16)!==0){var S=i.deletions;if(S!==null){for(var E=0;E<S.length;E++){var Q=S[E];for(we=Q;we!==null;){var ie=we;switch(ie.tag){case 0:case 11:case 15:Bo(8,ie,i)}var ce=ie.child;if(ce!==null)ce.return=ie,we=ce;else for(;we!==null;){ie=we;var le=ie.sibling,ye=ie.return;if(tu(ie),ie===Q){we=null;break}if(le!==null){le.return=ye,we=le;break}we=ye}}}var je=i.alternate;if(je!==null){var ke=je.child;if(ke!==null){je.child=null;do{var gt=ke.sibling;ke.sibling=null,ke=gt}while(ke!==null)}}we=i}}if((i.subtreeFlags&2064)!==0&&h!==null)h.return=i,we=h;else e:for(;we!==null;){if(i=we,(i.flags&2048)!==0)switch(i.tag){case 0:case 11:case 15:Bo(9,i,i.return)}var B=i.sibling;if(B!==null){B.return=i.return,we=B;break e}we=i.return}}var L=e.current;for(we=L;we!==null;){h=we;var Y=h.child;if((h.subtreeFlags&2064)!==0&&Y!==null)Y.return=h,we=Y;else e:for(h=L;we!==null;){if(S=we,(S.flags&2048)!==0)try{switch(S.tag){case 0:case 11:case 15:Fs(9,S)}}catch(Ce){ht(S,S.return,Ce)}if(S===h){we=null;break e}var he=S.sibling;if(he!==null){he.return=S.return,we=he;break e}we=S.return}}if(We=s,ar(),un&&typeof un.onPostCommitFiberRoot=="function")try{un.onPostCommitFiberRoot(Kn,e)}catch{}o=!0}return o}finally{_e=n,gn.transition=t}}return!1}function xu(e,t,n){t=no(n,t),t=zc(e,t,1),e=ir(e,t,1),t=Ut(),e!==null&&(Le(e,1,t),Gt(e,t))}function ht(e,t,n){if(e.tag===3)xu(e,e,n);else for(;t!==null;){if(t.tag===3){xu(t,e,n);break}else if(t.tag===1){var o=t.stateNode;if(typeof t.type.getDerivedStateFromError=="function"||typeof o.componentDidCatch=="function"&&(ur===null||!ur.has(o))){e=no(n,e),e=Tc(t,e,1),t=ir(t,e,1),e=Ut(),t!==null&&(Le(t,1,e),Gt(t,e));break}}t=t.return}}function Ff(e,t,n){var o=e.pingCache;o!==null&&o.delete(t),t=Ut(),e.pingedLanes|=e.suspendedLanes&n,Lt===e&&(zt&n)===n&&(kt===4||kt===3&&(zt&130023424)===zt&&500>Ve()-kl?Pr(e,0):Nl|=n),Gt(e,t)}function yu(e,t){t===0&&((e.mode&1)===0?t=1:(t=_r,_r<<=1,(_r&130023424)===0&&(_r=4194304)));var n=Ut();e=Yn(e,t),e!==null&&(Le(e,t,n),Gt(e,n))}function zf(e){var t=e.memoizedState,n=0;t!==null&&(n=t.retryLane),yu(e,n)}function Tf(e,t){var n=0;switch(e.tag){case 13:var o=e.stateNode,s=e.memoizedState;s!==null&&(n=s.retryLane);break;case 19:o=e.stateNode;break;default:throw Error(a(314))}o!==null&&o.delete(t),yu(e,n)}var vu;vu=function(e,t,n){if(e!==null)if(e.memoizedProps!==t.pendingProps||Ht.current)Xt=!0;else{if((e.lanes&n)===0&&(t.flags&128)===0)return Xt=!1,Sf(e,t,n);Xt=(e.flags&131072)!==0}else Xt=!1,st&&(t.flags&1048576)!==0&&qi(t,xs,t.index);switch(t.lanes=0,t.tag){case 2:var o=t.type;Is(e,t),e=t.pendingProps;var s=Gr(t,Tt.current);eo(t,n),s=nl(null,t,o,e,s,n);var i=rl();return t.flags|=1,typeof s=="object"&&s!==null&&typeof s.render=="function"&&s.$$typeof===void 0?(t.tag=1,t.memoizedState=null,t.updateQueue=null,Yt(o)?(i=!0,ps(t)):i=!1,t.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,Za(t),s.updater=Ds,t.stateNode=s,s._reactInternals=t,cl(t,o,e,n),t=hl(null,t,o,!0,i,n)):(t.tag=0,st&&i&&Oa(t),$t(null,t,s,n),t=t.child),t;case 16:o=t.elementType;e:{switch(Is(e,t),e=t.pendingProps,s=o._init,o=s(o._payload),t.type=o,s=t.tag=Af(o),e=bn(o,e),s){case 0:t=fl(null,t,o,e,n);break e;case 1:t=Yc(null,t,o,e,n);break e;case 11:t=Bc(null,t,o,e,n);break e;case 14:t=$c(null,t,o,bn(o.type,e),n);break e}throw Error(a(306,o,""))}return t;case 0:return o=t.type,s=t.pendingProps,s=t.elementType===o?s:bn(o,s),fl(e,t,o,s,n);case 1:return o=t.type,s=t.pendingProps,s=t.elementType===o?s:bn(o,s),Yc(e,t,o,s,n);case 3:e:{if(Xc(t),e===null)throw Error(a(387));o=t.pendingProps,i=t.memoizedState,s=i.element,lc(e,t),Ss(t,o,null,n);var h=t.memoizedState;if(o=h.element,i.isDehydrated)if(i={element:o,isDehydrated:!1,cache:h.cache,pendingSuspenseBoundaries:h.pendingSuspenseBoundaries,transitions:h.transitions},t.updateQueue.baseState=i,t.memoizedState=i,t.flags&256){s=no(Error(a(423)),t),t=Vc(e,t,o,n,s);break e}else if(o!==s){s=no(Error(a(424)),t),t=Vc(e,t,o,n,s);break e}else for(rn=rr(t.stateNode.containerInfo.firstChild),nn=t,st=!0,wn=null,n=sc(t,null,o,n),t.child=n;n;)n.flags=n.flags&-3|4096,n=n.sibling;else{if(Qr(),o===s){t=Vn(e,t,n);break e}$t(e,t,o,n)}t=t.child}return t;case 5:return uc(t),e===null&&Ua(t),o=t.type,s=t.pendingProps,i=e!==null?e.memoizedProps:null,h=s.children,Ra(o,s)?h=null:i!==null&&Ra(o,i)&&(t.flags|=32),Hc(e,t),$t(e,t,h,n),t.child;case 6:return e===null&&Ua(t),null;case 13:return Gc(e,t,n);case 4:return Ka(t,t.stateNode.containerInfo),o=t.pendingProps,e===null?t.child=qr(t,null,o,n):$t(e,t,o,n),t.child;case 11:return o=t.type,s=t.pendingProps,s=t.elementType===o?s:bn(o,s),Bc(e,t,o,s,n);case 7:return $t(e,t,t.pendingProps,n),t.child;case 8:return $t(e,t,t.pendingProps.children,n),t.child;case 12:return $t(e,t,t.pendingProps.children,n),t.child;case 10:e:{if(o=t.type._context,s=t.pendingProps,i=t.memoizedProps,h=s.value,qe(ws,o._currentValue),o._currentValue=h,i!==null)if(vn(i.value,h)){if(i.children===s.children&&!Ht.current){t=Vn(e,t,n);break e}}else for(i=t.child,i!==null&&(i.return=t);i!==null;){var S=i.dependencies;if(S!==null){h=i.child;for(var E=S.firstContext;E!==null;){if(E.context===o){if(i.tag===1){E=Xn(-1,n&-n),E.tag=2;var Q=i.updateQueue;if(Q!==null){Q=Q.shared;var ie=Q.pending;ie===null?E.next=E:(E.next=ie.next,ie.next=E),Q.pending=E}}i.lanes|=n,E=i.alternate,E!==null&&(E.lanes|=n),Va(i.return,n,t),S.lanes|=n;break}E=E.next}}else if(i.tag===10)h=i.type===t.type?null:i.child;else if(i.tag===18){if(h=i.return,h===null)throw Error(a(341));h.lanes|=n,S=h.alternate,S!==null&&(S.lanes|=n),Va(h,n,t),h=i.sibling}else h=i.child;if(h!==null)h.return=i;else for(h=i;h!==null;){if(h===t){h=null;break}if(i=h.sibling,i!==null){i.return=h.return,h=i;break}h=h.return}i=h}$t(e,t,s.children,n),t=t.child}return t;case 9:return s=t.type,o=t.pendingProps.children,eo(t,n),s=hn(s),o=o(s),t.flags|=1,$t(e,t,o,n),t.child;case 14:return o=t.type,s=bn(o,t.pendingProps),s=bn(o.type,s),$c(e,t,o,s,n);case 15:return Uc(e,t,t.type,t.pendingProps,n);case 17:return o=t.type,s=t.pendingProps,s=t.elementType===o?s:bn(o,s),Is(e,t),t.tag=1,Yt(o)?(e=!0,ps(t)):e=!1,eo(t,n),Rc(t,o,s),cl(t,o,s,n),hl(null,t,o,!0,e,n);case 19:return Kc(e,t,n);case 22:return Wc(e,t,n)}throw Error(a(156,t.tag))};function wu(e,t){return Rt(e,t)}function _f(e,t,n,o){this.tag=e,this.key=n,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=t,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=o,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function mn(e,t,n,o){return new _f(e,t,n,o)}function Rl(e){return e=e.prototype,!(!e||!e.isReactComponent)}function Af(e){if(typeof e=="function")return Rl(e)?1:0;if(e!=null){if(e=e.$$typeof,e===Z)return 11;if(e===X)return 14}return 2}function pr(e,t){var n=e.alternate;return n===null?(n=mn(e.tag,t,e.key,e.mode),n.elementType=e.elementType,n.type=e.type,n.stateNode=e.stateNode,n.alternate=e,e.alternate=n):(n.pendingProps=t,n.type=e.type,n.flags=0,n.subtreeFlags=0,n.deletions=null),n.flags=e.flags&14680064,n.childLanes=e.childLanes,n.lanes=e.lanes,n.child=e.child,n.memoizedProps=e.memoizedProps,n.memoizedState=e.memoizedState,n.updateQueue=e.updateQueue,t=e.dependencies,n.dependencies=t===null?null:{lanes:t.lanes,firstContext:t.firstContext},n.sibling=e.sibling,n.index=e.index,n.ref=e.ref,n}function Ws(e,t,n,o,s,i){var h=2;if(o=e,typeof e=="function")Rl(e)&&(h=1);else if(typeof e=="string")h=5;else e:switch(e){case F:return Lr(n.children,s,i,t);case H:h=8,s|=8;break;case re:return e=mn(12,n,t,s|2),e.elementType=re,e.lanes=i,e;case J:return e=mn(13,n,t,s),e.elementType=J,e.lanes=i,e;case A:return e=mn(19,n,t,s),e.elementType=A,e.lanes=i,e;case ae:return Hs(n,s,i,t);default:if(typeof e=="object"&&e!==null)switch(e.$$typeof){case ee:h=10;break e;case W:h=9;break e;case Z:h=11;break e;case X:h=14;break e;case $:h=16,o=null;break e}throw Error(a(130,e==null?e:typeof e,""))}return t=mn(h,n,t,s),t.elementType=e,t.type=o,t.lanes=i,t}function Lr(e,t,n,o){return e=mn(7,e,o,t),e.lanes=n,e}function Hs(e,t,n,o){return e=mn(22,e,o,t),e.elementType=ae,e.lanes=n,e.stateNode={isHidden:!1},e}function Fl(e,t,n){return e=mn(6,e,null,t),e.lanes=n,e}function zl(e,t,n){return t=mn(4,e.children!==null?e.children:[],e.key,t),t.lanes=n,t.stateNode={containerInfo:e.containerInfo,pendingChildren:null,implementation:e.implementation},t}function Of(e,t,n,o,s){this.tag=t,this.containerInfo=e,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=Ee(0),this.expirationTimes=Ee(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Ee(0),this.identifierPrefix=o,this.onRecoverableError=s,this.mutableSourceEagerHydrationData=null}function Tl(e,t,n,o,s,i,h,S,E){return e=new Of(e,t,n,S,E),t===1?(t=1,i===!0&&(t|=8)):t=0,i=mn(3,null,null,t),e.current=i,i.stateNode=e,i.memoizedState={element:o,isDehydrated:n,cache:null,transitions:null,pendingSuspenseBoundaries:null},Za(i),e}function Bf(e,t,n){var o=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:k,key:o==null?null:""+o,children:e,containerInfo:t,implementation:n}}function bu(e){if(!e)return sr;e=e._reactInternals;e:{if(Ke(e)!==e||e.tag!==1)throw Error(a(170));var t=e;do{switch(t.tag){case 3:t=t.stateNode.context;break e;case 1:if(Yt(t.type)){t=t.stateNode.__reactInternalMemoizedMergedChildContext;break e}}t=t.return}while(t!==null);throw Error(a(171))}if(e.tag===1){var n=e.type;if(Yt(n))return Zi(e,n,t)}return t}function ju(e,t,n,o,s,i,h,S,E){return e=Tl(n,o,!0,e,s,i,h,S,E),e.context=bu(null),n=e.current,o=Ut(),s=fr(n),i=Xn(o,s),i.callback=t??null,ir(n,i,s),e.current.lanes=s,Le(e,s,o),Gt(e,o),e}function Ys(e,t,n,o){var s=t.current,i=Ut(),h=fr(s);return n=bu(n),t.context===null?t.context=n:t.pendingContext=n,t=Xn(i,h),t.payload={element:e},o=o===void 0?null:o,o!==null&&(t.callback=o),e=ir(s,t,h),e!==null&&(Nn(e,s,h,i),js(e,s,h)),h}function Xs(e){return e=e.current,e.child?(e.child.tag===5,e.child.stateNode):null}function Su(e,t){if(e=e.memoizedState,e!==null&&e.dehydrated!==null){var n=e.retryLane;e.retryLane=n!==0&&n<t?n:t}}function _l(e,t){Su(e,t),(e=e.alternate)&&Su(e,t)}function $f(){return null}var Nu=typeof reportError=="function"?reportError:function(e){console.error(e)};function Al(e){this._internalRoot=e}Vs.prototype.render=Al.prototype.render=function(e){var t=this._internalRoot;if(t===null)throw Error(a(409));Ys(e,t,null,null)},Vs.prototype.unmount=Al.prototype.unmount=function(){var e=this._internalRoot;if(e!==null){this._internalRoot=null;var t=e.containerInfo;Mr(function(){Ys(null,e,null,null)}),t[$n]=null}};function Vs(e){this._internalRoot=e}Vs.prototype.unstable_scheduleHydration=function(e){if(e){var t=li();e={blockedOn:null,target:e,priority:t};for(var n=0;n<er.length&&t!==0&&t<er[n].priority;n++);er.splice(n,0,e),n===0&&ui(e)}};function Ol(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11)}function Gs(e){return!(!e||e.nodeType!==1&&e.nodeType!==9&&e.nodeType!==11&&(e.nodeType!==8||e.nodeValue!==" react-mount-point-unstable "))}function ku(){}function Uf(e,t,n,o,s){if(s){if(typeof o=="function"){var i=o;o=function(){var Q=Xs(h);i.call(Q)}}var h=ju(t,o,e,0,null,!1,!1,"",ku);return e._reactRootContainer=h,e[$n]=h.current,Eo(e.nodeType===8?e.parentNode:e),Mr(),h}for(;s=e.lastChild;)e.removeChild(s);if(typeof o=="function"){var S=o;o=function(){var Q=Xs(E);S.call(Q)}}var E=Tl(e,0,!1,null,null,!1,!1,"",ku);return e._reactRootContainer=E,e[$n]=E.current,Eo(e.nodeType===8?e.parentNode:e),Mr(function(){Ys(t,E,n,o)}),E}function Zs(e,t,n,o,s){var i=n._reactRootContainer;if(i){var h=i;if(typeof s=="function"){var S=s;s=function(){var E=Xs(h);S.call(E)}}Ys(t,h,e,s)}else h=Uf(n,t,e,s,o);return Xs(h)}Bn=function(e){switch(e.tag){case 3:var t=e.stateNode;if(t.current.memoizedState.isDehydrated){var n=On(t.pendingLanes);n!==0&&(ot(t,n|1),Gt(t,Ve()),(We&6)===0&&(so=Ve()+500,ar()))}break;case 13:Mr(function(){var o=Yn(e,1);if(o!==null){var s=Ut();Nn(o,e,1,s)}}),_l(e,1)}},Ar=function(e){if(e.tag===13){var t=Yn(e,134217728);if(t!==null){var n=Ut();Nn(t,e,134217728,n)}_l(e,134217728)}},ho=function(e){if(e.tag===13){var t=fr(e),n=Yn(e,t);if(n!==null){var o=Ut();Nn(n,e,t,o)}_l(e,t)}},li=function(){return _e},ii=function(e,t){var n=_e;try{return _e=e,t()}finally{_e=n}},Tn=function(e,t,n){switch(t){case"input":if(se(e,n),t=n.name,n.type==="radio"&&t!=null){for(n=e;n.parentNode;)n=n.parentNode;for(n=n.querySelectorAll("input[name="+JSON.stringify(""+t)+'][type="radio"]'),t=0;t<n.length;t++){var o=n[t];if(o!==e&&o.form===e.form){var s=fs(o);if(!s)throw Error(a(90));jt(o),se(o,s)}}}break;case"textarea":Ae(e,n);break;case"select":t=n.value,t!=null&&ge(e,!!n.multiple,t,!1)}},yr=Dl,yn=Mr;var Wf={usingClientEntryPoint:!1,Events:[Do,Xr,fs,Zn,Qt,Dl]},Ho={findFiberByHostInstance:wr,bundleType:0,version:"18.3.1",rendererPackageName:"react-dom"},Hf={bundleType:Ho.bundleType,version:Ho.version,rendererPackageName:Ho.rendererPackageName,rendererConfig:Ho.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:U.ReactCurrentDispatcher,findHostInstanceByFiber:function(e){return e=nt(e),e===null?null:e.stateNode},findFiberByHostInstance:Ho.findFiberByHostInstance||$f,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.3.1-next-f1338f8080-20240426"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var Ks=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!Ks.isDisabled&&Ks.supportsFiber)try{Kn=Ks.inject(Hf),un=Ks}catch{}}return Zt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=Wf,Zt.createPortal=function(e,t){var n=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!Ol(t))throw Error(a(200));return Bf(e,t,null,n)},Zt.createRoot=function(e,t){if(!Ol(e))throw Error(a(299));var n=!1,o="",s=Nu;return t!=null&&(t.unstable_strictMode===!0&&(n=!0),t.identifierPrefix!==void 0&&(o=t.identifierPrefix),t.onRecoverableError!==void 0&&(s=t.onRecoverableError)),t=Tl(e,1,!1,null,null,n,!1,o,s),e[$n]=t.current,Eo(e.nodeType===8?e.parentNode:e),new Al(t)},Zt.findDOMNode=function(e){if(e==null)return null;if(e.nodeType===1)return e;var t=e._reactInternals;if(t===void 0)throw typeof e.render=="function"?Error(a(188)):(e=Object.keys(e).join(","),Error(a(268,e)));return e=nt(t),e=e===null?null:e.stateNode,e},Zt.flushSync=function(e){return Mr(e)},Zt.hydrate=function(e,t,n){if(!Gs(t))throw Error(a(200));return Zs(null,e,t,!0,n)},Zt.hydrateRoot=function(e,t,n){if(!Ol(e))throw Error(a(405));var o=n!=null&&n.hydratedSources||null,s=!1,i="",h=Nu;if(n!=null&&(n.unstable_strictMode===!0&&(s=!0),n.identifierPrefix!==void 0&&(i=n.identifierPrefix),n.onRecoverableError!==void 0&&(h=n.onRecoverableError)),t=ju(t,null,e,1,n??null,s,!1,i,h),e[$n]=t.current,Eo(e),o)for(e=0;e<o.length;e++)n=o[e],s=n._getVersion,s=s(n._source),t.mutableSourceEagerHydrationData==null?t.mutableSourceEagerHydrationData=[n,s]:t.mutableSourceEagerHydrationData.push(n,s);return new Vs(t)},Zt.render=function(e,t,n){if(!Gs(t))throw Error(a(200));return Zs(null,e,t,!1,n)},Zt.unmountComponentAtNode=function(e){if(!Gs(e))throw Error(a(40));return e._reactRootContainer?(Mr(function(){Zs(null,null,e,!1,function(){e._reactRootContainer=null,e[$n]=null})}),!0):!1},Zt.unstable_batchedUpdates=Dl,Zt.unstable_renderSubtreeIntoContainer=function(e,t,n,o){if(!Gs(n))throw Error(a(200));if(e==null||e._reactInternals===void 0)throw Error(a(38));return Zs(e,t,n,!1,o)},Zt.version="18.3.1-next-f1338f8080-20240426",Zt}var Ru;function qf(){if(Ru)return Ul.exports;Ru=1;function l(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(l)}catch(c){console.error(c)}}return l(),Ul.exports=Qf(),Ul.exports}var Fu;function Jf(){if(Fu)return Qs;Fu=1;var l=qf();return Qs.createRoot=l.createRoot,Qs.hydrateRoot=l.hydrateRoot,Qs}var eh=Jf();const th=si(eh),nh={},zu=l=>{let c;const a=new Set,d=(v,b)=>{const N=typeof v=="function"?v(c):v;if(!Object.is(N,c)){const P=c;c=b??(typeof N!="object"||N===null)?N:Object.assign({},c,N),a.forEach(j=>j(c,P))}},u=()=>c,f={setState:d,getState:u,getInitialState:()=>p,subscribe:v=>(a.add(v),()=>a.delete(v)),destroy:()=>{(nh?"production":void 0)!=="production"&&console.warn("[DEPRECATED] The `destroy` method will be unsupported in a future version. Instead use unsubscribe function returned by subscribe. Everything will be garbage-collected if store is garbage-collected."),a.clear()}},p=c=l(d,u,f);return f},rh=l=>l?zu(l):zu;var Yl={exports:{}},Xl={},Vl={exports:{}},Gl={};var Tu;function oh(){if(Tu)return Gl;Tu=1;var l=Go();function c(b,N){return b===N&&(b!==0||1/b===1/N)||b!==b&&N!==N}var a=typeof Object.is=="function"?Object.is:c,d=l.useState,u=l.useEffect,y=l.useLayoutEffect,m=l.useDebugValue;function w(b,N){var P=N(),j=d({inst:{value:P,getSnapshot:N}}),C=j[0].inst,M=j[1];return y(function(){C.value=P,C.getSnapshot=N,f(C)&&M({inst:C})},[b,P,N]),u(function(){return f(C)&&M({inst:C}),b(function(){f(C)&&M({inst:C})})},[b]),m(P),P}function f(b){var N=b.getSnapshot;b=b.value;try{var P=N();return!a(b,P)}catch{return!0}}function p(b,N){return N()}var v=typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"?p:w;return Gl.useSyncExternalStore=l.useSyncExternalStore!==void 0?l.useSyncExternalStore:v,Gl}var _u;function sh(){return _u||(_u=1,Vl.exports=oh()),Vl.exports}var Au;function ah(){if(Au)return Xl;Au=1;var l=Go(),c=sh();function a(p,v){return p===v&&(p!==0||1/p===1/v)||p!==p&&v!==v}var d=typeof Object.is=="function"?Object.is:a,u=c.useSyncExternalStore,y=l.useRef,m=l.useEffect,w=l.useMemo,f=l.useDebugValue;return Xl.useSyncExternalStoreWithSelector=function(p,v,b,N,P){var j=y(null);if(j.current===null){var C={hasValue:!1,value:null};j.current=C}else C=j.current;j=w(function(){function D(k){if(!z){if(z=!0,q=k,k=N(k),P!==void 0&&C.hasValue){var F=C.value;if(P(F,k))return U=F}return U=k}if(F=U,d(q,k))return F;var H=N(k);return P!==void 0&&P(F,H)?(q=k,F):(q=k,U=H)}var z=!1,q,U,R=b===void 0?null:b;return[function(){return D(v())},R===null?void 0:function(){return D(R())}]},[v,b,N,P]);var M=u(p,j[0],j[1]);return m(function(){C.hasValue=!0,C.value=M},[M]),f(M),M},Xl}var Ou;function lh(){return Ou||(Ou=1,Yl.exports=ah()),Yl.exports}var ih=lh();const ch=si(ih),rd={},{useDebugValue:uh}=nd,{useSyncExternalStoreWithSelector:dh}=ch;let Bu=!1;const fh=l=>l;function hh(l,c=fh,a){(rd?"production":void 0)!=="production"&&a&&!Bu&&(console.warn("[DEPRECATED] Use `createWithEqualityFn` instead of `create` or use `useStoreWithEqualityFn` instead of `useStore`. They can be imported from 'zustand/traditional'. https://github.com/pmndrs/zustand/discussions/1937"),Bu=!0);const d=dh(l.subscribe,l.getState,l.getServerState||l.getInitialState,c,a);return uh(d),d}const ph=l=>{(rd?"production":void 0)!=="production"&&typeof l!="function"&&console.warn("[DEPRECATED] Passing a vanilla store will be unsupported in a future version. Instead use `import { useStore } from 'zustand'`.");const c=typeof l=="function"?rh(l):l,a=(d,u)=>hh(c,d,u);return Object.assign(a,c),a},gh=l=>ph,Zl={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1},ni=new Map,qs=l=>{const c=ni.get(l);return c?Object.fromEntries(Object.entries(c.stores).map(([a,d])=>[a,d.getState()])):{}},mh=(l,c,a)=>{if(l===void 0)return{type:"untracked",connection:c.connect(a)};const d=ni.get(a.name);if(d)return{type:"tracked",store:l,...d};const u={connection:c.connect(a),stores:{}};return ni.set(a.name,u),{type:"tracked",store:l,...u}},xh=(l,c={})=>(a,d,u)=>{const{enabled:y,anonymousActionType:m,store:w,...f}=c;let p;try{p=(y??(Zl?"production":void 0)!=="production")&&window.__REDUX_DEVTOOLS_EXTENSION__}catch{}if(!p)return(Zl?"production":void 0)!=="production"&&y&&console.warn("[zustand devtools middleware] Please install/enable Redux devtools extension"),l(a,d,u);const{connection:v,...b}=mh(w,p,f);let N=!0;u.setState=(C,M,D)=>{const z=a(C,M);if(!N)return z;const q=D===void 0?{type:m||"anonymous"}:typeof D=="string"?{type:D}:D;return w===void 0?(v?.send(q,d()),z):(v?.send({...q,type:`${w}/${q.type}`},{...qs(f.name),[w]:u.getState()}),z)};const P=(...C)=>{const M=N;N=!1,a(...C),N=M},j=l(u.setState,d,u);if(b.type==="untracked"?v?.init(j):(b.stores[b.store]=u,v?.init(Object.fromEntries(Object.entries(b.stores).map(([C,M])=>[C,C===b.store?j:M.getState()])))),u.dispatchFromDevtools&&typeof u.dispatch=="function"){let C=!1;const M=u.dispatch;u.dispatch=(...D)=>{(Zl?"production":void 0)!=="production"&&D[0].type==="__setState"&&!C&&(console.warn('[zustand devtools middleware] "__setState" action type is reserved to set state from the devtools. Avoid using it.'),C=!0),M(...D)}}return v.subscribe(C=>{var M;switch(C.type){case"ACTION":if(typeof C.payload!="string"){console.error("[zustand devtools middleware] Unsupported action format");return}return Kl(C.payload,D=>{if(D.type==="__setState"){if(w===void 0){P(D.state);return}Object.keys(D.state).length!==1&&console.error(`
                    [zustand devtools middleware] Unsupported __setState action format. 
                    When using 'store' option in devtools(), the 'state' should have only one key, which is a value of 'store' that was passed in devtools(),
                    and value of this only key should be a state object. Example: { "type": "__setState", "state": { "abc123Store": { "foo": "bar" } } }
                    `);const z=D.state[w];if(z==null)return;JSON.stringify(u.getState())!==JSON.stringify(z)&&P(z);return}u.dispatchFromDevtools&&typeof u.dispatch=="function"&&u.dispatch(D)});case"DISPATCH":switch(C.payload.type){case"RESET":return P(j),w===void 0?v?.init(u.getState()):v?.init(qs(f.name));case"COMMIT":if(w===void 0){v?.init(u.getState());return}return v?.init(qs(f.name));case"ROLLBACK":return Kl(C.state,D=>{if(w===void 0){P(D),v?.init(u.getState());return}P(D[w]),v?.init(qs(f.name))});case"JUMP_TO_STATE":case"JUMP_TO_ACTION":return Kl(C.state,D=>{if(w===void 0){P(D);return}JSON.stringify(u.getState())!==JSON.stringify(D[w])&&P(D[w])});case"IMPORT_STATE":{const{nextLiftedState:D}=C.payload,z=(M=D.computedStates.slice(-1)[0])==null?void 0:M.state;if(!z)return;P(w===void 0?z:z[w]),v?.send(null,D);return}case"PAUSE_RECORDING":return N=!N}return}}),j},yh=xh,Kl=(l,c)=>{let a;try{a=JSON.parse(l)}catch(d){console.error("[zustand devtools middleware] Could not parse the received json",d)}a!==void 0&&c(a)},vh=l=>{const c=l.data,a=new Map;for(let d=0;d<c.length;d+=4){const u=c[d],y=c[d+1],m=c[d+2];if(c[d+3]===255){const f=`#${(16777216+(u<<16)+(y<<8)+m).toString(16).slice(1).toUpperCase()}`;a.has(f)||a.set(f,{r:u,g:y,b:m})}}return a},wh=(l,c,a,d)=>{let u="#000000",y={r:0,g:0,b:0},m=1/0;for(const[w,f]of d){const p=Math.sqrt(Math.pow(l-f.r,2)+Math.pow(c-f.g,2)+Math.pow(a-f.b,2));p<m&&(m=p,u=w,y=f)}return{hex:u,...y}},$u=(l,c,a=!0)=>new Promise((d,u)=>{try{const y=new Image;y.onload=()=>{try{const m=document.createElement("canvas");m.width=y.width,m.height=y.height;const w=m.getContext("2d");if(!w){u(new Error("Could not get canvas context"));return}w.drawImage(y,0,0);const f=w.getImageData(0,0,m.width,m.height),p=f.data;let v=null;a&&(v=vh(f));for(let b=0;b<p.length;b+=4){const N=p[b+3];if(N!==0)if(N<c)p[b+3]=0;else{if(a&&v&&v.size>0&&N<255){const P=p[b],j=p[b+1],C=p[b+2],M=wh(P,j,C,v);p[b]=M.r,p[b+1]=M.g,p[b+2]=M.b}p[b+3]=255}}w.putImageData(f,0,0),d(m.toDataURL())}catch(m){console.error("Error processing image data:",m),u(m)}},y.onerror=m=>{console.error("Error loading image for processing:",m),u(new Error("Failed to load image"))},y.src=l}catch(y){console.error("Error initiating image processing:",y),u(y)}}),od=l=>new Promise((c,a)=>{const d=new FileReader;d.onload=u=>{const y=u.target?.result;c(y)},d.onerror=()=>{a(new Error("Failed to read blob"))},d.readAsDataURL(l)}),bh=l=>{const c=l.split(","),a=c[0].match(/:(.*?);/),d=a?a[1]:"image/png",u=atob(c[1]),y=u.length,m=new Uint8Array(y);for(let w=0;w<y;w++)m[w]=u.charCodeAt(w);return new Blob([m],{type:d})},jh=(l,c=30,a=!1)=>new Promise((d,u)=>{try{const y=new Image;y.crossOrigin="anonymous",y.onload=()=>{try{const m=y.naturalWidth,w=y.naturalHeight,f=document.createElement("canvas");f.width=m,f.height=w;const p=f.getContext("2d");if(!p){u(new Error("Could not get canvas context"));return}p.drawImage(y,0,0);const v=p.getImageData(0,0,m,w),b=v.data,N=new Uint8Array(m*w),P=new Uint8Array(m*w),j=(R,k)=>k*m+R,C=(R,k)=>{const F=(k*m+R)*4;return{r:b[F],g:b[F+1],b:b[F+2],a:b[F+3]}},M=(R,k)=>{const F=R.r-k.r,H=R.g-k.g,re=R.b-k.b;return Math.sqrt(F*F+H*H+re*re)},D=[],z=(R,k)=>{for(let F=Math.max(0,k-1);F<=Math.min(w-1,k+1);F++)for(let H=Math.max(0,R-1);H<=Math.min(m-1,R+1);H++)D.push({x:H,y:F})};z(0,0),z(m-1,0),z(0,w-1),z(m-1,w-1);const q=[];for(const R of D){const k=C(R.x,R.y);q.push({x:R.x,y:R.y,base:k})}const U=(R,k)=>R>=0&&R<m&&k>=0&&k<w;for(;q.length>0;){const{x:R,y:k,base:F}=q.shift(),H=j(R,k);if(N[H])continue;N[H]=1;const re=C(R,k);if(M(re,F)<=c){P[H]=1;const W=[{x:R+1,y:k},{x:R-1,y:k},{x:R,y:k+1},{x:R,y:k-1}];for(const Z of W)if(U(Z.x,Z.y)){const J=j(Z.x,Z.y);N[J]||q.push({x:Z.x,y:Z.y,base:F})}}}for(let R=0;R<w;R++)for(let k=0;k<m;k++){const F=(R*m+k)*4;P[j(k,R)]===1?b[F+3]=0:(a&&(b[F]=255,b[F+1]=0,b[F+2]=0),b[F+3]=255)}p.putImageData(v,0,0),d(f.toDataURL())}catch(m){console.error("removeBackground processing error:",m),u(m)}},y.onerror=m=>{console.error("removeBackground load error:",m),u(new Error("Failed to load image"))},y.src=l}catch(y){console.error("removeBackground init error:",y),u(y)}}),Sh=l=>new Promise((c,a)=>{if(l.length===0){a(new Error("No layers to composite"));return}let d=1/0,u=1/0,y=-1/0,m=-1/0;for(const P of l)d=Math.min(d,P.x),u=Math.min(u,P.y),y=Math.max(y,P.x+P.width),m=Math.max(m,P.y+P.height);const w=Math.ceil(y-d),f=Math.ceil(m-u),p=document.createElement("canvas");p.width=w,p.height=f;const v=p.getContext("2d",{willReadFrequently:!0});if(!v){a(new Error("Failed to get canvas context"));return}v.clearRect(0,0,w,f);let b=0,N=!1;for(const P of l){const j=new Image;j.onload=()=>{N||(v.globalAlpha=P.opacity,v.drawImage(j,P.x-d,P.y-u,P.width,P.height),b++,b===l.length&&(v.globalAlpha=1,p.toBlob(C=>{C?c(C):a(new Error("Failed to create blob from canvas"))},"image/png")))},j.onerror=()=>{N=!0,a(new Error(`Failed to load image for layer at (${P.x}, ${P.y})`))},j.src=P.imageData}}),Vo=[{name:"Arial",value:"Arial, sans-serif",category:"system",weights:[400,700]},{name:"Times New Roman",value:'"Times New Roman", Times, serif',category:"system",weights:[400,700]},{name:"Courier New",value:'"Courier New", Courier, monospace',category:"system",weights:[400,700]},{name:"Georgia",value:"Georgia, serif",category:"system",weights:[400,700]},{name:"Verdana",value:"Verdana, sans-serif",category:"system",weights:[400,700]},{name:"Comic Sans MS",value:'"Comic Sans MS", "Comic Sans", cursive',category:"system",weights:[400,700]},{name:"Impact",value:"Impact, Charcoal, sans-serif",category:"system",weights:[400]},{name:"Trebuchet MS",value:'"Trebuchet MS", Helvetica, sans-serif',category:"system",weights:[400,700]},{name:"Jokerman",value:"Jokerman, fantasy",category:"system",weights:[400]}],co=[{name:"Roboto",value:"Roboto, sans-serif",category:"google",googleFontName:"Roboto",weights:[300,400,700]},{name:"Open Sans",value:'"Open Sans", sans-serif',category:"google",googleFontName:"Open+Sans",weights:[300,400,700]},{name:"Lato",value:"Lato, sans-serif",category:"google",googleFontName:"Lato",weights:[300,400,700]},{name:"Montserrat",value:"Montserrat, sans-serif",category:"google",googleFontName:"Montserrat",weights:[300,400,700]},{name:"Poppins",value:"Poppins, sans-serif",category:"google",googleFontName:"Poppins",weights:[300,400,700]},{name:"Oswald",value:"Oswald, sans-serif",category:"google",googleFontName:"Oswald",weights:[300,400,700]},{name:"Raleway",value:"Raleway, sans-serif",category:"google",googleFontName:"Raleway",weights:[300,400,700]},{name:"Ubuntu",value:"Ubuntu, sans-serif",category:"google",googleFontName:"Ubuntu",weights:[300,400,700]},{name:"Nunito",value:"Nunito, sans-serif",category:"google",googleFontName:"Nunito",weights:[300,400,700]},{name:"PT Sans",value:'"PT Sans", sans-serif',category:"google",googleFontName:"PT+Sans",weights:[400,700]},{name:"Merriweather",value:"Merriweather, serif",category:"google",googleFontName:"Merriweather",weights:[300,400,700]},{name:"Playfair Display",value:'"Playfair Display", serif',category:"google",googleFontName:"Playfair+Display",weights:[400,700]},{name:"Lora",value:"Lora, serif",category:"google",googleFontName:"Lora",weights:[400,700]},{name:"PT Serif",value:'"PT Serif", serif',category:"google",googleFontName:"PT+Serif",weights:[400,700]},{name:"Crimson Text",value:'"Crimson Text", serif',category:"google",googleFontName:"Crimson+Text",weights:[400,700]},{name:"EB Garamond",value:'"EB Garamond", serif',category:"google",googleFontName:"EB+Garamond",weights:[400,700]},{name:"Libre Baskerville",value:'"Libre Baskerville", serif',category:"google",googleFontName:"Libre+Baskerville",weights:[400,700]},{name:"Cormorant",value:"Cormorant, serif",category:"google",googleFontName:"Cormorant",weights:[300,400,700]},{name:"Spectral",value:"Spectral, serif",category:"google",googleFontName:"Spectral",weights:[300,400,700]},{name:"Bitter",value:"Bitter, serif",category:"google",googleFontName:"Bitter",weights:[300,400,700]},{name:"Bebas Neue",value:'"Bebas Neue", cursive',category:"google",googleFontName:"Bebas+Neue",weights:[400]},{name:"Pacifico",value:"Pacifico, cursive",category:"google",googleFontName:"Pacifico",weights:[400]},{name:"Righteous",value:"Righteous, cursive",category:"google",googleFontName:"Righteous",weights:[400]},{name:"Bangers",value:"Bangers, cursive",category:"google",googleFontName:"Bangers",weights:[400]},{name:"Permanent Marker",value:'"Permanent Marker", cursive',category:"google",googleFontName:"Permanent+Marker",weights:[400]},{name:"Lobster",value:"Lobster, cursive",category:"google",googleFontName:"Lobster",weights:[400]},{name:"Press Start 2P",value:'"Press Start 2P", cursive',category:"google",googleFontName:"Press+Start+2P",weights:[400]},{name:"Fredoka One",value:'"Fredoka One", cursive',category:"google",googleFontName:"Fredoka+One",weights:[400]},{name:"Alfa Slab One",value:'"Alfa Slab One", cursive',category:"google",googleFontName:"Alfa+Slab+One",weights:[400]},{name:"Rubik Mono One",value:'"Rubik Mono One", sans-serif',category:"google",googleFontName:"Rubik+Mono+One",weights:[400]},{name:"Dancing Script",value:'"Dancing Script", cursive',category:"google",googleFontName:"Dancing+Script",weights:[400,700]},{name:"Caveat",value:"Caveat, cursive",category:"google",googleFontName:"Caveat",weights:[400,700]},{name:"Shadows Into Light",value:'"Shadows Into Light", cursive',category:"google",googleFontName:"Shadows+Into+Light",weights:[400]},{name:"Satisfy",value:"Satisfy, cursive",category:"google",googleFontName:"Satisfy",weights:[400]},{name:"Indie Flower",value:'"Indie Flower", cursive',category:"google",googleFontName:"Indie+Flower",weights:[400]},{name:"Architects Daughter",value:'"Architects Daughter", cursive',category:"google",googleFontName:"Architects+Daughter",weights:[400]},{name:"Kalam",value:"Kalam, cursive",category:"google",googleFontName:"Kalam",weights:[300,400,700]},{name:"Amatic SC",value:'"Amatic SC", cursive',category:"google",googleFontName:"Amatic+SC",weights:[400,700]},{name:"Patrick Hand",value:'"Patrick Hand", cursive',category:"google",googleFontName:"Patrick+Hand",weights:[400]},{name:"Courgette",value:"Courgette, cursive",category:"google",googleFontName:"Courgette",weights:[400]},{name:"Roboto Mono",value:'"Roboto Mono", monospace',category:"google",googleFontName:"Roboto+Mono",weights:[300,400,700]},{name:"Source Code Pro",value:'"Source Code Pro", monospace',category:"google",googleFontName:"Source+Code+Pro",weights:[300,400,700]},{name:"Fira Code",value:'"Fira Code", monospace',category:"google",googleFontName:"Fira+Code",weights:[300,400,700]},{name:"JetBrains Mono",value:'"JetBrains Mono", monospace',category:"google",googleFontName:"JetBrains+Mono",weights:[300,400,700]},{name:"Space Mono",value:'"Space Mono", monospace',category:"google",googleFontName:"Space+Mono",weights:[400,700]},{name:"Courier Prime",value:'"Courier Prime", monospace',category:"google",googleFontName:"Courier+Prime",weights:[400,700]},{name:"Inconsolata",value:"Inconsolata, monospace",category:"google",googleFontName:"Inconsolata",weights:[300,400,700]},{name:"IBM Plex Mono",value:'"IBM Plex Mono", monospace',category:"google",googleFontName:"IBM+Plex+Mono",weights:[300,400,700]},{name:"Anonymous Pro",value:'"Anonymous Pro", monospace',category:"google",googleFontName:"Anonymous+Pro",weights:[400,700]},{name:"Overpass Mono",value:'"Overpass Mono", monospace',category:"google",googleFontName:"Overpass+Mono",weights:[300,400,700]},{name:"Creepster",value:'"Creepster", cursive',category:"google",googleFontName:"Creepster",weights:[400]},{name:"Frijole",value:'"Frijole", cursive',category:"google",googleFontName:"Frijole",weights:[400]},{name:"Spicy Rice",value:'"Spicy Rice", cursive',category:"google",googleFontName:"Spicy+Rice",weights:[400]},{name:"Ranchers",value:'"Ranchers", cursive',category:"google",googleFontName:"Ranchers",weights:[400]},{name:"Chewy",value:'"Chewy", cursive',category:"google",googleFontName:"Chewy",weights:[400]}];function Nh(l){const c="mmmmmmmmmmlli1WWWWW",a="72px",u=document.createElement("canvas").getContext("2d");if(!u)return!0;u.font=`${a} monospace`;const y=u.measureText(c).width,m=l.split(",")[0].trim();if(u.font=`${a} ${m}, monospace`,u.measureText(c).width!==y)return!0;u.font=`${a} sans-serif`;const f=u.measureText(c).width;return u.font=`${a} ${m}, sans-serif`,u.measureText(c).width!==f}let Js=null;function kh(){return Js!==null?Js:typeof document>"u"?Vo:(Js=Vo.filter(l=>Nh(l.value)),Js)}function Ql(){return[...kh(),...co]}const Ch=[...Vo,...co],ri=new Set;async function Eh(l){return ri.has(l)?Promise.resolve():new Promise((c,a)=>{const d=document.createElement("link");d.rel="stylesheet",d.href=`https://fonts.googleapis.com/css2?family=${l}:wght@300;400;700&display=swap`,d.onload=async()=>{ri.add(l);const u=co.find(y=>y.googleFontName===l);if(u){const y=u.value.split(",")[0].trim();try{await document.fonts.load(`400 16px ${y}`)}catch{}}c()},d.onerror=()=>{console.error(`Failed to load Google Font: ${l}`),a(new Error(`Failed to load font: ${l}`))},document.head.appendChild(d)})}let Uu=!1;function Mh(){if(Uu)return Promise.resolve();Uu=!0;const l=co.filter(c=>c.googleFontName).map(c=>`family=${c.googleFontName}:wght@300;400;700`).join("&");return new Promise(c=>{const a=document.createElement("link");a.rel="stylesheet",a.href=`https://fonts.googleapis.com/css2?${l}&display=swap`,a.onload=async()=>{co.forEach(u=>{u.googleFontName&&ri.add(u.googleFontName)});const d=co.map(u=>{const y=u.value.split(",")[0].trim();return document.fonts.load(`400 16px ${y}`).catch(()=>{})});await Promise.allSettled(d),c()},a.onerror=()=>c(),document.head.appendChild(a)})}function Ph(l){return Ch.find(c=>c.value===l)}const sd=4;function Dh(l,c,a,d,u,y=1.2,m=sd,w=0,f="normal"){l.font=`${f} ${a*m}px ${d}`,typeof l.letterSpacing<"u"&&(l.letterSpacing=`${w*m}px`);const p=[],v=c.split(`
`);for(const j of v){if(!j.trim()){p.push("");continue}if(!u){p.push(j);continue}const C=j.split(" ");let M="";for(const D of C){const z=M?`${M} ${D}`:D;l.measureText(z).width/m>u&&M?(p.push(M),M=D):M=z}M&&p.push(M)}let b=0;for(const j of p){const M=l.measureText(j).width/m;b=Math.max(b,M)}const N=a*y,P=p.length*N;return{width:Math.ceil(b),height:Math.ceil(P),lines:p}}async function ta(l){const{text:c,fontSize:a,fontFamily:d,color:u,textAlign:y="left",maxWidth:m,lineHeight:w=1.2,disableTransparency:f=!1,letterSpacing:p=0,fontWeight:v="normal"}=l,b=Ph(d);if(b?.category==="google"&&b.googleFontName)try{await Eh(b.googleFontName);const J=d.split(",")[0].trim();try{await document.fonts.load(`400 ${a}px ${J}`),v!=="normal"&&v!=="400"&&await document.fonts.load(`${v} ${a}px ${J}`).catch(()=>{})}catch{await new Promise(A=>setTimeout(A,200))}}catch(J){console.error("Failed to load Google Font, using fallback:",J)}const P=document.createElement("canvas").getContext("2d",{willReadFrequently:!0});if(!P)throw new Error("Failed to get canvas context");const j=f?1:sd,{width:C,height:M,lines:D}=Dh(P,c,a,d,m,w,j,p,v),z=10,q=z*j,U=(C+z*2)*j,R=(M+z*2)*j,k=document.createElement("canvas");k.width=U,k.height=R;const F=k.getContext("2d",{willReadFrequently:!0});if(!F)throw new Error("Failed to get canvas context");F.font=`${v} ${a*j}px ${d}`,typeof F.letterSpacing<"u"&&(F.letterSpacing=`${p*j}px`),F.fillStyle=u,F.textBaseline="top",F.imageSmoothingEnabled=!f,F.imageSmoothingQuality=f?"low":"high";const H=a*w*j;let re=q;for(const J of D){if(!J){re+=H;continue}let A=q;if(y==="center"){const X=F.measureText(J).width;A=(U-X)/2}else if(y==="right"){const X=F.measureText(J).width;A=U-X-q}F.fillText(J,A,re),re+=H}if(f){const J=F.getImageData(0,0,k.width,k.height),A=J.data,X=parseInt(u.slice(1,3),16),$=parseInt(u.slice(3,5),16),ae=parseInt(u.slice(5,7),16);for(let O=0;O<A.length;O+=4)A[O+3]>=128?(A[O+3]=255,A[O]=X,A[O+1]=$,A[O+2]=ae):A[O+3]=0;F.putImageData(J,0,0)}const ee=document.createElement("canvas");ee.width=C+z*2,ee.height=M+z*2;const W=ee.getContext("2d",{willReadFrequently:!0});if(!W)throw new Error("Failed to get final canvas context");return W.imageSmoothingEnabled=!f,W.imageSmoothingQuality=f?"low":"high",W.drawImage(k,0,0,U,R,0,0,ee.width,ee.height),{dataUrl:ee.toDataURL("image/png"),width:ee.width,height:ee.height}}function Wu(l){return l.textContent!==void 0&&l.textContent!==null}function Lh(l){return l.shapeType!==void 0&&l.shapeType!==null}const Hu={version:"1.0.0",projectName:"Untitled",created:new Date().toISOString(),modified:new Date().toISOString(),canvas:{width:3276,height:3276,backgroundColor:null,borderColor:"#000000",borderWidth:0,borderOpacity:1,borderEnabled:!0,shadowIntensity:.5,showCheckeredBackground:!1,dragInfoEnabled:!0},viewport:{zoom:100,panX:0,panY:0},grid:{enabled:!1,density:4},rulers:{enabled:!1,guides:[]},layers:[],metadata:{author:"",description:"",tags:[]}},ql={past:[],future:[],maxSteps:50},Jl={activeTool:"select",leftClickPan:!1,spaceHeld:!1,showRulers:!1,showSelectionBorders:!0,showSelectionTools:!0,selectionBorderAnimationSpeed:.1,clipboardLayers:[],isDraggingLayer:!1,dragLayerId:null,dragStartX:0,dragStartY:0,dragOffsetX:0,dragOffsetY:0},T=gh()(yh(l=>({project:Hu,selectedLayerIds:[],isDirty:!1,history:ql,ui:Jl,setProjectName:c=>{l(a=>({project:{...a.project,projectName:c,modified:new Date().toISOString()},isDirty:!0}))},setCanvasConfig:c=>{l(a=>({project:{...a.project,canvas:{...a.project.canvas,...c},modified:new Date().toISOString()},isDirty:!0}))},setViewport:c=>{l(a=>({project:{...a.project,viewport:{...a.project.viewport,...c}}}))},setProjectMetadata:c=>{l(a=>({project:{...a.project,metadata:{...a.project.metadata,...c},modified:new Date().toISOString()},isDirty:!0}))},addLayer:c=>{const a=c.id||`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`;l(d=>{const u=d.project.layers.length===0;return{project:{...d.project,layers:[...d.project.layers,{...c,id:a}],modified:new Date().toISOString()},isDirty:!0,...u?{selectedLayerIds:[a]}:{}}})},removeLayer:c=>{l(a=>({project:{...a.project,layers:a.project.layers.filter(d=>d.id!==c),modified:new Date().toISOString()},selectedLayerIds:a.selectedLayerIds.filter(d=>d!==c),isDirty:!0}))},updateLayer:(c,a)=>{l(d=>({project:{...d.project,layers:d.project.layers.map(u=>u.id===c?{...u,...a}:u),modified:new Date().toISOString()},isDirty:!0}))},duplicateLayer:c=>{l(a=>{const d=a.project.layers.find(y=>y.id===c);if(!d)return a;const u={...d,id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`${d.name} (copy)`,zIndex:Math.max(...a.project.layers.map(y=>y.zIndex),0)+1};return{project:{...a.project,layers:[...a.project.layers,u],modified:new Date().toISOString()},isDirty:!0}})},moveLayer:(c,a,d)=>{l(u=>{const y=T.getState(),m=[...y.history.past,y.project];return m.length>y.history.maxSteps&&m.shift(),{project:{...u.project,layers:u.project.layers.map(w=>{if(w.id===c&&!w.locked){const f=Math.floor(w.x+a),p=Math.floor(w.y+d);return{...w,x:f,y:p}}return w}),modified:new Date().toISOString()},history:{...y.history,past:m,future:[]},isDirty:!0}})},reorderLayer:(c,a)=>{l(d=>{const u=d.project.layers.find(p=>p.id===c)?.zIndex;if(u===void 0)return d;const y=d.project.layers.map(p=>p.zIndex).sort((p,v)=>p-v),m=y.indexOf(u);if(a==="up"&&m===y.length-1||a==="down"&&m===0)return d;const w=a==="up"?y[m+1]:y[m-1],f=d.project.layers.find(p=>p.zIndex===w)?.id;return f?{project:{...d.project,layers:d.project.layers.map(p=>p.id===c?{...p,zIndex:w}:p.id===f?{...p,zIndex:u}:p),modified:new Date().toISOString()},isDirty:!0}:d})},reorderSelectedLayers:c=>{l(a=>{if(a.selectedLayerIds.length===0)return a;const d=a.project.layers.map(w=>w.zIndex).sort((w,f)=>w-f),u=a.project.layers.filter(w=>a.selectedLayerIds.includes(w.id)).map(w=>w.zIndex).sort((w,f)=>w-f),y=Math.min(...u),m=Math.max(...u);if(c==="up"&&m===d[d.length-1]||c==="down"&&y===d[0])return a;if(c==="up"){const w=d.find(f=>f>m);return w===void 0?a:{project:{...a.project,layers:a.project.layers.map(f=>a.selectedLayerIds.includes(f.id)?{...f,zIndex:w}:f.zIndex===w?{...f,zIndex:m}:f),modified:new Date().toISOString()},isDirty:!0}}else{const w=[...d].reverse().find(f=>f<y);return w===void 0?a:{project:{...a.project,layers:a.project.layers.map(f=>a.selectedLayerIds.includes(f.id)?{...f,zIndex:w}:f.zIndex===w?{...f,zIndex:y}:f),modified:new Date().toISOString()},isDirty:!0}}})},bringLayerToFront:c=>{l(a=>{const d=Math.max(...a.project.layers.map(u=>u.zIndex),0);return{project:{...a.project,layers:a.project.layers.map(u=>u.id===c?{...u,zIndex:d+1}:u),modified:new Date().toISOString()},isDirty:!0}})},sendLayerToBack:c=>{l(a=>{const d=Math.min(...a.project.layers.map(u=>u.zIndex),0);return{project:{...a.project,layers:a.project.layers.map(u=>u.id===c?{...u,zIndex:d-1}:u),modified:new Date().toISOString()},isDirty:!0}})},selectLayer:(c,a=!1)=>{l(d=>a?{selectedLayerIds:d.selectedLayerIds.includes(c)?d.selectedLayerIds.filter(u=>u!==c):[...d.selectedLayerIds,c]}:{selectedLayerIds:[c]})},selectAllLayers:()=>{l(c=>({selectedLayerIds:c.project.layers.map(a=>a.id)}))},deselectAllLayers:()=>{l({selectedLayerIds:[]})},selectLayerRange:(c,a)=>{l(d=>{const u=d.project.layers.map(v=>v.id),y=u.indexOf(c),m=u.indexOf(a);if(y===-1||m===-1)return d;const[w,f]=y<m?[y,m]:[m,y];return{selectedLayerIds:u.slice(w,f+1)}})},moveSelectedLayers:(c,a)=>{l(d=>({project:{...d.project,layers:d.project.layers.map(u=>{if(d.selectedLayerIds.includes(u.id)&&!u.locked){const y=Math.floor(u.x+c),m=Math.floor(u.y+a);return{...u,x:y,y:m}}return u}),modified:new Date().toISOString()},isDirty:!0}))},deleteSelectedLayers:()=>{l(c=>({project:{...c.project,layers:c.project.layers.filter(a=>!c.selectedLayerIds.includes(a.id)),modified:new Date().toISOString()},selectedLayerIds:[],isDirty:!0}))},toggleVisibilitySelected:()=>{l(c=>{const a=c.selectedLayerIds.every(d=>c.project.layers.find(u=>u.id===d)?.visible);return{project:{...c.project,layers:c.project.layers.map(d=>c.selectedLayerIds.includes(d.id)?{...d,visible:!a}:d),modified:new Date().toISOString()},isDirty:!0}})},startDraggingLayer:(c,a,d)=>{l(u=>({ui:{...u.ui,isDraggingLayer:!0,dragLayerId:c,dragStartX:a,dragStartY:d}}))},updateDragPosition:(c,a)=>{l(d=>{if(!d.ui.isDraggingLayer)return d;let u=c-d.ui.dragStartX,y=a-d.ui.dragStartY;return u=Math.round(u),y=Math.round(y),{ui:{...d.ui,dragOffsetX:u,dragOffsetY:y}}})},stopDraggingLayer:()=>{l(c=>{if(!c.ui.isDraggingLayer||!c.ui.dragLayerId)return c;const a=c.selectedLayerIds.includes(c.ui.dragLayerId)?c.selectedLayerIds:[c.ui.dragLayerId],d=c.ui.dragOffsetX,u=c.ui.dragOffsetY,y=d!==0||u!==0,w={project:{...c.project,layers:c.project.layers.map(f=>a.includes(f.id)&&!f.locked?{...f,x:Math.floor(f.x+d),y:Math.floor(f.y+u)}:f),modified:new Date().toISOString()},ui:{...c.ui,isDraggingLayer:!1,dragLayerId:null,dragOffsetX:0,dragOffsetY:0},isDirty:!0};if(y){const f=T.getState(),{viewport:p,...v}=f.project,b=[...f.history.past,v];return b.length>f.history.maxSteps&&b.shift(),{...w,history:{...f.history,past:b,future:[]},_lastHistoryPushAt:Date.now()}}return w})},pushHistory:()=>{l(c=>{const{viewport:a,...d}=c.project,u=[...c.history.past,d];return u.length>c.history.maxSteps&&u.shift(),{history:{...c.history,past:u,future:[]},_lastHistoryPushAt:Date.now()}})},undo:()=>{l(c=>{if(c.history.past.length===0)return c;const a=[...c.history.past],d=a.pop();if(!d)return c;const{viewport:u,...y}=c.project,m=[y,...c.history.future];return{project:{...d,viewport:c.project.viewport},history:{...c.history,past:a,future:m},_lastHistoryPushAt:Date.now()}})},redo:()=>{l(c=>{if(c.history.future.length===0)return c;const a=[...c.history.future],d=a.shift(),{viewport:u,...y}=c.project,m=[...c.history.past,y];return d?{project:{...d,viewport:c.project.viewport},history:{...c.history,past:m,future:a},_lastHistoryPushAt:Date.now()}:c})},setActiveTool:c=>{l(a=>({ui:{...a.ui,activeTool:c}}))},toggleLeftClickPan:()=>{l(c=>({ui:{...c.ui,leftClickPan:!c.ui.leftClickPan}}))},setSpaceHeld:c=>{l(a=>({ui:{...a.ui,spaceHeld:c}}))},toggleGrid:()=>{l(c=>({project:{...c.project,grid:{...c.project.grid,enabled:!c.project.grid.enabled},modified:new Date().toISOString()},isDirty:!0}))},setGridDensity:c=>{l(a=>({project:{...a.project,grid:{...a.project.grid,density:Math.max(1,Math.min(8,c))},modified:new Date().toISOString()},isDirty:!0}))},toggleRulers:()=>{l(c=>({project:{...c.project,rulers:{...c.project.rulers,enabled:!c.project.rulers.enabled},modified:new Date().toISOString()},isDirty:!0}))},toggleSelectionBorders:()=>{l(c=>({ui:{...c.ui,showSelectionBorders:!c.ui.showSelectionBorders}}))},toggleSelectionTools:()=>{l(c=>({ui:{...c.ui,showSelectionTools:!c.ui.showSelectionTools}}))},setSelectionBorderAnimationSpeed:c=>{l(a=>({ui:{...a.ui,selectionBorderAnimationSpeed:Math.max(0,Math.min(1,c))}}))},copySelectedLayers:()=>{l(c=>({ui:{...c.ui,clipboardLayers:c.project.layers.filter(a=>c.selectedLayerIds.includes(a.id))}}))},copySelectedLayersToClipboard:async()=>{try{const c=T.getState(),a=c.project.layers.filter(y=>c.selectedLayerIds.includes(y.id));if(a.length===0){console.warn("No layers selected to copy");return}let d;if(a.length===1)d=bh(a[0].imageData);else{const y=a.sort((m,w)=>m.zIndex-w.zIndex);d=await Sh(y)}const u=new ClipboardItem({"image/png":d});await navigator.clipboard.write([u])}catch(c){console.error("Failed to copy layers to clipboard:",c)}},pasteSelectedLayers:()=>{l(c=>{const a=Math.max(...c.project.layers.map(u=>u.zIndex),0),d=c.ui.clipboardLayers.map((u,y)=>({...u,id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,x:u.x+10,y:u.y+10,zIndex:a+y+1}));return{project:{...c.project,layers:[...c.project.layers,...d],modified:new Date().toISOString()},selectedLayerIds:d.map(u=>u.id),isDirty:!0}})},pasteFromClipboard:async()=>{try{if(navigator.clipboard){try{const c=await navigator.clipboard.read();for(const a of c){const d=Array.from(a.types).filter(u=>u.startsWith("image/"));if(d.length>0){const u=d[0],y=await a.getType(u),m=await od(y),w=new Image;w.src=m,await new Promise((v,b)=>{w.onload=()=>v(),w.onerror=()=>b(new Error("Failed to load image"))});const f=T.getState(),p=Math.max(...f.project.layers.map(v=>v.zIndex),0);T.setState(v=>({project:{...v.project,layers:[...v.project.layers,{id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:"Pasted Image",imageData:m,x:0,y:0,zIndex:p+1,visible:!0,locked:!1,opacity:1,width:w.naturalWidth,height:w.naturalHeight}],modified:new Date().toISOString()},isDirty:!0}));return}}}catch(c){console.debug("Image paste failed, trying text paste:",c)}try{const c=await navigator.clipboard.readText();if(c.trim()){const a=await ta({text:c,fontSize:16,fontFamily:"Arial",color:"#000000",textAlign:"left",lineHeight:1.2}),d=T.getState(),u=Math.max(...d.project.layers.map(y=>y.zIndex),0);T.setState(y=>({project:{...y.project,layers:[...y.project.layers,{id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`Text: ${c.substring(0,20)}${c.length>20?"...":""}`,imageData:a.dataUrl,x:0,y:0,zIndex:u+1,visible:!0,locked:!1,opacity:1,width:a.width,height:a.height,textContent:c,fontSize:16,fontFamily:"Arial",fontColor:"#000000",textAlign:"left",lineHeight:1.2}],modified:new Date().toISOString()},isDirty:!0}))}}catch(c){console.debug("Text paste failed:",c)}}}catch(c){console.error("Clipboard paste error:",c)}},cropCanvasToLayers:()=>{l(c=>{if(c.project.layers.length===0)return console.warn("[DEBUG] No layers to crop to"),c;let a=1/0,d=1/0,u=-1/0,y=-1/0;c.project.layers.forEach(b=>{a=Math.min(a,b.x),d=Math.min(d,b.y),u=Math.max(u,b.x+b.width),y=Math.max(y,b.y+b.height)});const m=Math.ceil(u-a),w=Math.ceil(y-d),f=a,p=d;if(m<=0||w<=0)return console.warn("[DEBUG] Invalid bounds for crop"),c;console.log(`[DEBUG] Cropping canvas to layers: ${m}x${w} at offset (${f}, ${p})`);const v=c.project.layers.map(b=>({...b,x:b.x-f,y:b.y-p}));return{project:{...c.project,canvas:{...c.project.canvas,width:m,height:w},layers:v,modified:new Date().toISOString()},isDirty:!0}})},resetProject:()=>{l({project:Hu,selectedLayerIds:[],isDirty:!1,history:ql,ui:Jl})},loadProject:c=>{const a={...c,layers:c.layers.filter(d=>d.id!=="__text_canvas_preview__"&&d.id!=="__shape_canvas_preview__")};l({project:a,selectedLayerIds:[],isDirty:!1,history:ql,ui:Jl})},markDirty:()=>{l({isDirty:!0})},markClean:()=>{l({isDirty:!1})}}),{name:"CompositorStore",enabled:!0}));function Ih({canvas:l,gridEnabled:c,viewport:a,canvasWidth:d,canvasHeight:u,gridDensity:y,canvasBorderEnabled:m}){const w=g.useRef(null),f=g.useRef(null);return g.useEffect(()=>{if(!w.current||!l||!f.current)return;const p=w.current,v=p.getContext("2d");if(!v)return;const b=50;if(!c||a.zoom<b){v.clearRect(0,0,p.width,p.height);return}const N=a.zoom/100;p.width=f.current.clientWidth,p.height=f.current.clientHeight,v.clearRect(0,0,p.width,p.height);let P=0;a.zoom<=b?P=0:a.zoom<150?P=(a.zoom-b)/100*.3:P=.4;let j=y;if(N<3){const A=9/(N*3);j=y*A}v.strokeStyle=`rgba(0, 0, 0, ${P})`,v.lineWidth=1;const C=l.getBoundingClientRect(),M=f.current.getBoundingClientRect();let D=C.left-M.left,z=C.top-M.top,q=C.width,U=C.height;const R=m?1:0;D+=R,z+=R,q-=R*2,U-=R*2,v.save(),v.beginPath(),v.rect(D,z,q,U),v.clip();const k=q/d,F=U/u,H=Math.max(0,Math.floor(-D/k)),re=Math.min(d,Math.ceil((p.width-D)/k)),ee=Math.max(0,Math.floor(-z/F)),W=Math.min(u,Math.ceil((p.height-z)/F)),Z=Math.ceil(H/j)*j;for(let A=Z;A<=re;A+=j){const X=Math.round(D+A*k)+.5;v.beginPath(),v.moveTo(X,z),v.lineTo(X,z+U),v.stroke()}const J=Math.ceil(ee/j)*j;for(let A=J;A<=W;A+=j){const X=Math.round(z+A*F)+.5;v.beginPath(),v.moveTo(D,X),v.lineTo(D+q,X),v.stroke()}v.restore()},[c,a,d,u,l,y,m]),r.jsx("div",{ref:f,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",overflow:"hidden"},children:r.jsx("canvas",{ref:w,style:{position:"absolute",top:0,left:0,imageRendering:"pixelated"}})})}const Rh=({offsetX:l,offsetY:c,mouseX:a,mouseY:d})=>r.jsx("div",{style:{position:"fixed",left:`${a+10}px`,top:`${d+10}px`,pointerEvents:"none",zIndex:1e3},children:r.jsxs("div",{className:"bg-panel-bg border border-border rounded px-2 py-1 text-xs text-gray-300 whitespace-nowrap shadow-lg",children:[r.jsxs("div",{children:["X: ",l>0?"+":"",l]}),r.jsxs("div",{children:["Y: ",c>0?"+":"",c]})]})});function Fh(){const l=g.useRef(null),c=g.useRef(null),a=T(x=>x.project),d=T(x=>x.selectedLayerIds),u=T(x=>x.ui.showSelectionBorders),y=T(x=>x.ui.showSelectionTools),m=T(x=>x.ui.selectionBorderAnimationSpeed),w=T(x=>x.ui.isDraggingLayer),f=T(x=>x.ui.dragLayerId),p=T(x=>x.ui.dragOffsetX),v=T(x=>x.ui.dragOffsetY),b=T(x=>x.selectLayer),N=T(x=>x.deselectAllLayers),P=T(x=>x.startDraggingLayer),j=T(x=>x.updateDragPosition),C=T(x=>x.stopDraggingLayer),M=T(x=>x.setViewport),D=T(x=>x.removeLayer),z=T(x=>x.updateLayer),q=T(x=>x.ui.leftClickPan),U=T(x=>x.ui.spaceHeld),R=q!==U,[k,F]=g.useState(new Map),[H,re]=g.useState(!1),[ee,W]=g.useState({x:0,y:0}),[Z,J]=g.useState(null),[A,X]=g.useState({x:0,y:0});g.useEffect(()=>{(async()=>{const I=new Map;for(const ne of a.layers)if(!k.has(ne.id)||k.get(ne.id)?.src!==ne.imageData)try{const K=new Image;K.src=ne.imageData,await new Promise((de,ue)=>{K.onload=()=>de(),K.onerror=()=>ue(new Error(`Failed to load image for layer: ${ne.name}`))}),I.set(ne.id,K)}catch{}F(ne=>new Map([...ne,...I]))})()},[a.layers]),g.useEffect(()=>{const x=c.current,I=l.current;if(!x||!I||a.viewport.zoom!==100||a.viewport.panX!==0||a.viewport.panY!==0)return;const ne=x.clientWidth,K=x.clientHeight,de=a.canvas.width,ue=a.canvas.height,ve=ne/de*100*.9,pe=K/ue*100*.9,Se=Math.min(ve,pe,100);M({zoom:Math.max(Se,10)})},[]),g.useEffect(()=>{const x=l.current;if(!x){console.warn("[DEBUG] Canvas element not found");return}const I=x.getContext("2d");if(!I){console.error("[DEBUG] Failed to get canvas context");return}if(I.imageSmoothingEnabled=!1,I.webkitImageSmoothingEnabled=!1,I.mozImageSmoothingEnabled=!1,x.width=a.canvas.width,x.height=a.canvas.height,I.clearRect(0,0,x.width,x.height),a.canvas.backgroundColor&&(I.fillStyle=a.canvas.backgroundColor,I.fillRect(0,0,x.width,x.height)),a.canvas.showCheckeredBackground&&!a.canvas.backgroundColor){const de=document.createElement("canvas");de.width=16,de.height=16;const ue=de.getContext("2d");if(ue){ue.fillStyle="#ffffff",ue.fillRect(0,0,16,16),ue.fillStyle="#cccccc",ue.fillRect(0,0,8,8),ue.fillRect(8,8,8,8);const ve=I.createPattern(de,"repeat");ve&&(I.fillStyle=ve,I.fillRect(0,0,x.width,x.height))}}if(a.canvas.borderWidth&&a.canvas.borderWidth>0){const K=a.canvas.borderWidth;I.strokeStyle=a.canvas.borderColor,I.globalAlpha=a.canvas.borderOpacity,I.lineWidth=K*2;const de=K/2;I.strokeRect(de,de,x.width-K,x.height-K),I.globalAlpha=1}const ne=[...a.layers].filter(K=>K.visible).sort((K,de)=>K.zIndex-de.zIndex);for(const K of ne){const de=k.get(K.id);if(!de){console.warn(`[DEBUG] Image not loaded for layer: ${K.name}`);continue}const ue=T.getState(),ve=ue.ui.isDraggingLayer&&(ue.ui.dragLayerId===K.id||ue.selectedLayerIds.includes(K.id)&&ue.selectedLayerIds.includes(ue.ui.dragLayerId));let pe=Math.floor(K.x),Se=Math.floor(K.y);ve&&(pe+=ue.ui.dragOffsetX,Se+=ue.ui.dragOffsetY);const Te=I.globalAlpha;I.globalAlpha=K.opacity!==void 0?K.opacity:1,I.drawImage(de,pe,Se),I.globalAlpha=Te}},[a,k,w,f,p,v]);const $=(x,I)=>{const ne=c.current;if(!ne)return{x:0,y:0};const K=ne.getBoundingClientRect(),de=x-K.left-20,ue=I-K.top-20,ve=K.width-40,pe=K.height-40,Se=ve/2,Te=pe/2,De=de-Se,jt=ue-Te,Ge=a.viewport.zoom/100,Qe=De/Ge,Ct=jt/Ge,mt=a.canvas.width/2,se=a.canvas.height/2,Be=mt+Qe+a.viewport.panX,Re=se+Ct+a.viewport.panY;return{x:Be,y:Re}},ae=x=>{if(!l.current){console.warn("[DEBUG] Canvas ref not available");return}const ne=R?x.button===0:x.button===1,K=R?x.button===1:x.button===0;if(ne)return x.preventDefault(),re(!0),W({x:x.clientX,y:x.clientY}),void 0;if(!K)return;R&&x.preventDefault();const{x:de,y:ue}=$(x.clientX,x.clientY),ve=[...a.layers].filter(pe=>pe.visible).sort((pe,Se)=>Se.zIndex-pe.zIndex);for(const pe of ve)if(de>=pe.x&&de<pe.x+pe.width&&ue>=pe.y&&ue<pe.y+pe.height){if(pe.locked){b(pe.id,x.ctrlKey||x.metaKey);return}const Se=x.ctrlKey||x.metaKey;d.includes(pe.id)&&!Se||b(pe.id,Se),P(pe.id,de,ue);return}R||(N(),re(!0),W({x:x.clientX,y:x.clientY}))},O=x=>{if(!l.current)return;X({x:x.clientX,y:x.clientY});const{x:ne,y:K}=$(x.clientX,x.clientY);if(J({x:Math.floor(ne),y:Math.floor(K)}),H){const ue=a.viewport.zoom/100,ve=x.clientX-ee.x,pe=x.clientY-ee.y,Se=a.viewport.panX-ve/ue,Te=a.viewport.panY-pe/ue;M({panX:Se,panY:Te}),W({x:x.clientX,y:x.clientY});return}T.getState().ui.isDraggingLayer&&j(ne,K)},oe=()=>{re(!1),C()},_=x=>{x.preventDefault();const I=x.deltaY>0?-1:1,ne=a.viewport.zoom,K=[25,33,50,66,75,100,125,150,200,400,800,1600,3200];let de=ne;I>0?de=K.find(ue=>ue>ne)||K[K.length-1]:de=[...K].reverse().find(ue=>ue<ne)||K[0],M({zoom:de})};return r.jsxs("div",{ref:c,id:"canvas-renderer",className:`relative w-full h-full bg-canvas-bg overflow-hidden ${R?H?"cursor-grabbing":"cursor-grab":"cursor-crosshair"}`,style:{paddingTop:"20px",paddingLeft:"20px"},onMouseDown:ae,onMouseMove:O,onMouseUp:oe,onMouseLeave:oe,onWheel:_,children:[r.jsxs("div",{className:"w-full h-full flex items-center justify-center",style:{width:"calc(100% - 20px)",height:"calc(100% - 20px)",overflowX:"auto",overflowY:"auto"},children:[r.jsxs("div",{style:{transform:`translate(${-a.viewport.panX*(a.viewport.zoom/100)}px, ${-a.viewport.panY*(a.viewport.zoom/100)}px) scale(${a.viewport.zoom/100})`,transformOrigin:"center center",position:"absolute"},children:[r.jsx("canvas",{ref:l,style:{imageRendering:"pixelated",backfaceVisibility:"hidden",WebkitFontSmoothing:"antialiased",outline:a.canvas.borderEnabled?"1px solid rgb(75, 85, 99)":"none",outlineOffset:"0px",boxShadow:a.canvas.shadowIntensity>0?`0 10px 40px rgba(0, 0, 0, ${.5*a.canvas.shadowIntensity})`:"none"}}),u&&d.length>0&&r.jsxs("svg",{width:a.canvas.width,height:a.canvas.height,style:{position:"absolute",top:0,left:0,pointerEvents:"none",overflow:"visible",display:"block"},children:[a.layers.map(x=>{if(!d.includes(x.id))return null;const I=w&&(f===x.id||d.includes(f));let ne=Math.floor(x.x),K=Math.floor(x.y);I&&(ne+=p,K+=v);const de=x.textContent!==void 0,ue=x.shapeType!==void 0,ve=(de||ue)&&d.length===1;return r.jsxs("g",{children:[r.jsx("rect",{x:ne-.12,y:K-.25,width:x.width+.3,height:x.height+.3,fill:"none",stroke:"#b0b0b0",strokeWidth:"0.25",strokeDasharray:"4,4",style:{animation:m>0?`marching-ants ${8/(.125*m)/1e3}s linear infinite`:"none"}}),r.jsx("rect",{x:ne-.12,y:K-.25,width:x.width+.3,height:x.height+.3,fill:"none",stroke:"#505050",strokeWidth:"0.25",strokeDasharray:"4,4",strokeDashoffset:"2",style:{animation:m>0?`marching-ants ${8/(.125*m)/1e3}s linear infinite`:"none"}}),y&&d.includes(x.id)&&d.length===1&&r.jsxs("g",{className:"selection-tool-icon",transform:`translate(${ne+4}, ${K-14})`,style:{cursor:"pointer",pointerEvents:"auto"},onClick:pe=>{pe.stopPropagation(),D(x.id)},onMouseDown:pe=>pe.stopPropagation(),children:[r.jsx("circle",{cx:"6",cy:"6",r:"5",fill:"none",stroke:"none",pointerEvents:"all"}),r.jsx("path",{d:"M4 4l16 16M20 4l-16 16",stroke:"#9ca3af",strokeWidth:"1",strokeLinecap:"round",strokeLinejoin:"round",transform:"scale(0.4)",pointerEvents:"none"})]}),y&&d.includes(x.id)&&d.length===1&&r.jsxs("g",{className:"selection-tool-icon",transform:`translate(${ne+14}, ${K-14})`,style:{cursor:"pointer",pointerEvents:"auto"},onClick:pe=>{pe.stopPropagation(),z(x.id,{visible:!x.visible})},onMouseDown:pe=>pe.stopPropagation(),children:[r.jsx("circle",{cx:"6",cy:"6",r:"5",fill:"none",stroke:"none",pointerEvents:"all"}),x.visible?r.jsx("path",{d:"M12 4.5C7.244 4.5 3.226 7.662 1.934 12c1.292 4.338 5.31 7.5 10.066 7.5s8.773-3.162 10.065-7.5c-1.292-4.338-5.31-7.5-10.065-7.5zm0 12a4.5 4.5 0 110-9 4.5 4.5 0 010 9z",fill:"#9ca3af",stroke:"#4b5563",strokeWidth:"0.5",transform:"scale(0.4)",pointerEvents:"none"}):r.jsxs("g",{pointerEvents:"none",children:[r.jsx("circle",{cx:"6",cy:"6",r:"4",fill:"none",stroke:"#9ca3af",strokeWidth:"0.5"}),r.jsx("line",{x1:"2",y1:"2",x2:"10",y2:"10",stroke:"#9ca3af",strokeWidth:"0.5"})]})]}),y&&ve&&r.jsxs("g",{className:"selection-tool-icon",transform:`translate(${ne+24}, ${K-14})`,style:{cursor:"pointer",pointerEvents:"auto"},onClick:pe=>{pe.stopPropagation(),de?window.openTextLayerModal?.(x):ue&&window.openShapeModal?.(x)},onMouseDown:pe=>pe.stopPropagation(),children:[r.jsx("circle",{cx:"6",cy:"6",r:"5",fill:"none",stroke:"none",pointerEvents:"all"}),r.jsx("path",{d:"M3 17.25V21h3.75L17.81 9.94l-3.75-3.75L3 17.25zM20.71 7.04c.39-.39.39-1.02 0-1.41l-2.34-2.34c-.39-.39-1.02-.39-1.41 0l-1.83 1.83 3.75 3.75 1.83-1.83z",fill:"#9ca3af",stroke:"#4b5563",strokeWidth:"0.5",transform:"scale(0.4)",pointerEvents:"none"})]})]},x.id)}),r.jsx("style",{children:`
                @keyframes marching-ants {
                  0% {
                    stroke-dashoffset: 0;
                  }
                  100% {
                    stroke-dashoffset: -8;
                  }
                }
                .selection-tool-icon {
                  opacity: 0.6;
                  transition: opacity 0.2s ease, filter 0.2s ease;
                }
                .selection-tool-icon:hover {
                  opacity: 1;
                  filter: drop-shadow(0 0 4px rgba(156, 163, 175, 0.8));
                }
              `})]})]}),r.jsx(Ih,{canvas:l.current,gridEnabled:a.grid.enabled,viewport:a.viewport,canvasWidth:a.canvas.width,canvasHeight:a.canvas.height,gridDensity:a.grid.density,canvasBorderEnabled:a.canvas.borderEnabled})]}),r.jsxs("div",{id:"canvas-status-bar",className:"absolute bottom-4 right-4 bg-panel-bg border border-border rounded px-3 py-2 text-xs text-gray-400 space-y-1","aria-label":"Canvas status",children:[r.jsxs("div",{children:["Canvas: ",a.canvas.width,"x",a.canvas.height]}),r.jsxs("div",{children:["Zoom: ",a.viewport.zoom,"%"]}),r.jsxs("div",{children:["Layers: ",a.layers.length]}),Z&&r.jsxs("div",{children:["Coords: (",Z.x,", ",Z.y,")"]}),r.jsx("div",{className:"text-gray-500 text-xs mt-2 pt-2 border-t border-border",children:"Middle-click to pan"})]}),d.length>0&&r.jsxs("div",{id:"canvas-selection-info",className:"absolute top-4 right-4 bg-panel-bg border border-blue-600 rounded px-3 py-2 text-xs text-blue-400","aria-live":"polite",children:["Selected: ",d.length," layer",d.length!==1?"s":""]}),w&&a.canvas.dragInfoEnabled&&r.jsx(Rh,{offsetX:p,offsetY:v,mouseX:A.x,mouseY:A.y})]})}const zh="1.0.0",ad="1.0.0";function oi(l){const c=l.layers.filter(d=>d.id!=="__text_canvas_preview__"&&d.id!=="__shape_canvas_preview__"),a={...l,layers:c,modified:new Date().toISOString()};return JSON.stringify(a,null,2)}async function na(l){try{const c=JSON.parse(l);if(!c.version)throw new Error("Invalid project file: missing version field");if(!Th(c.version))throw new Error(`Project version ${c.version} is not supported. Current version: ${zh}, minimum supported: ${ad}`);return c.layers&&(c.layers=c.layers.filter(a=>a.id!=="__text_canvas_preview__"&&a.id!=="__shape_canvas_preview__")),_h(c),await Ah(c.layers),c}catch(c){throw console.error("[DEBUG] Project deserialization failed:",c),c}}function Th(l){const[c,a]=l.split(".").map(Number),[d,u]=ad.split(".").map(Number);return c>d||c<d?!1:a>=u}function _h(l){const c=["version","canvas","layers","viewport","grid","rulers"];for(const a of c)if(!(a in l))throw new Error(`Invalid project file: missing required field '${a}'`);if(typeof l.canvas.width!="number"||l.canvas.width<=0)throw new Error("Invalid project file: canvas width must be a positive number");if(typeof l.canvas.height!="number"||l.canvas.height<=0)throw new Error("Invalid project file: canvas height must be a positive number");if(!Array.isArray(l.layers))throw new Error("Invalid project file: layers must be an array");for(let a=0;a<l.layers.length;a++){const d=l.layers[a],u=["id","name","imageData","x","y","zIndex","visible","locked","width","height"];for(const y of u)if(!(y in d))throw new Error(`Invalid layer ${a}: missing required field '${y}'`);if(typeof d.x!="number"||typeof d.y!="number")throw new Error(`Invalid layer ${a}: x and y must be numbers`);if(!d.imageData.startsWith("data:image/"))throw new Error(`Invalid layer ${a}: imageData must be a valid data URL`)}}async function Ah(l){for(let c=0;c<l.length;c++){const a=l[c];try{await ld(a.imageData)}catch(d){throw new Error(`Failed to load image for layer ${c} (${a.name}): ${d instanceof Error?d.message:"Unknown error"}`)}}}function ld(l){return new Promise((c,a)=>{const d=new Image,u=setTimeout(()=>{a(new Error("Image load timeout"))},5e3);d.onload=()=>{clearTimeout(u),c(d)},d.onerror=()=>{clearTimeout(u),a(new Error("Failed to load image"))},d.src=l})}async function Oh(l,c,a,d=1,u=null){const y=document.createElement("canvas");y.width=c*d,y.height=a*d;const m=y.getContext("2d");if(!m)throw new Error("Failed to get canvas context");m.imageSmoothingEnabled=!1,m.webkitImageSmoothingEnabled=!1,m.mozImageSmoothingEnabled=!1,m.scale(d,d),u&&(m.fillStyle=u,m.fillRect(0,0,c,a));const w=[...l].filter(f=>f.visible).sort((f,p)=>f.zIndex-p.zIndex);for(const f of w)try{const p=await ld(f.imageData);m.drawImage(p,f.x,f.y)}catch(p){console.warn(`Failed to export layer ${f.name}:`,p)}return new Promise(f=>{y.toBlob(p=>{if(!p)throw new Error("Failed to create PNG blob");f(p)},"image/png")})}function Yu(){const l=g.useRef(null),c=T(m=>m.addLayer),a=T(m=>m.loadProject),d=T(m=>m.markClean),u=async m=>{const w=m.currentTarget.files;if(!w){console.warn("[DEBUG] No files selected");return}for(const f of Array.from(w))try{if(f.name.toLowerCase().endsWith(".pixcomp"))try{const P=await f.text(),j=await na(P);a(j),d(),l.current&&(l.current.value="");return}catch(P){console.error("[DEBUG] Load project failed:",P),alert(`Error loading project: ${P instanceof Error?P.message:"Unknown error"}`);continue}if(!["image/png","image/gif","image/bmp","image/jpeg"].includes(f.type)){console.warn(`[DEBUG] Unsupported file type: ${f.type}`),alert(`Unsupported file type: ${f.type}. Please use .pixcomp, PNG, GIF, BMP, or JPEG.`);continue}const p=await new Promise((P,j)=>{const C=new FileReader;C.onload=M=>P(M.target?.result),C.onerror=()=>j(new Error("Failed to read file")),C.readAsDataURL(f)}),v=new Image;v.src=p,await new Promise((P,j)=>{v.onload=()=>P(),v.onerror=()=>j(new Error("Failed to load image"))});const b=v.naturalWidth,N=v.naturalHeight;c({name:f.name,imageData:p,x:0,y:0,zIndex:T.getState().project.layers.length,visible:!0,locked:!1,opacity:1,width:b,height:N})}catch(p){alert(`Error loading image ${f.name}: ${p instanceof Error?p.message:"Unknown error"}`)}l.current&&(l.current.value="")},y=async m=>{m.preventDefault();const w=m.clipboardData?.items;if(w){for(let f=0;f<w.length;f++){const p=w[f];if(p.type.startsWith("image/"))try{const v=p.getAsFile();if(!v)continue;const b=await od(v),N=new Image;N.src=b,await new Promise((j,C)=>{N.onload=()=>j(),N.onerror=()=>C(new Error("Failed to load image"))});const P=Math.max(...T.getState().project.layers.map(j=>j.zIndex),0);c({name:"Pasted Image",imageData:b,x:0,y:0,zIndex:P+1,visible:!0,locked:!1,opacity:1,width:N.naturalWidth,height:N.naturalHeight});break}catch(v){console.error("Error pasting image:",v)}}if(m.clipboardData?.types.includes("text/plain"))try{const f=m.clipboardData.getData("text/plain");if(f.trim()){const p=await ta({text:f,fontSize:16,fontFamily:"Arial",color:"#000000",textAlign:"left",lineHeight:1.2}),v=Math.max(...T.getState().project.layers.map(b=>b.zIndex),0);c({id:`layer_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,name:`Text: ${f.substring(0,20)}${f.length>20?"...":""}`,imageData:p.dataUrl,x:0,y:0,zIndex:v+1,visible:!0,locked:!1,opacity:1,width:p.width,height:p.height,textContent:f,fontSize:16,fontFamily:"Arial",fontColor:"#000000",textAlign:"left",lineHeight:1.2})}}catch(f){console.error("Error pasting text:",f)}}};return r.jsxs("div",{id:"canvas-container",className:"w-full h-full flex flex-col relative",onPaste:y,children:[r.jsx("div",{className:"flex-1 relative overflow-hidden","data-region":"canvas",children:r.jsx(Fh,{})}),T(m=>m.project.layers.length===0)&&r.jsx("div",{id:"canvas-upload-zone",onClick:()=>l.current?.click(),className:"absolute inset-0 flex items-center justify-center bg-black bg-opacity-30 cursor-pointer hover:bg-opacity-40 transition-all z-10",role:"button","aria-label":"Upload images",children:r.jsxs("div",{className:"text-center",children:[r.jsx("div",{className:"text-4xl mb-4",children:""}),r.jsx("div",{className:"text-lg font-semibold text-white mb-2",children:"Click to upload images or drag & drop"}),r.jsx("div",{className:"text-sm text-gray-400",children:"Supported: .pixcomp, PNG, GIF, BMP, JPEG"})]})}),r.jsx("input",{ref:l,id:"input-canvas-upload",type:"file",multiple:!0,accept:".pixcomp,image/png,image/gif,image/bmp,image/jpeg",onChange:u,className:"hidden","aria-label":"Upload images"})]})}let kn=null;function Bh({layer:l,isSelected:c}){const a=T(X=>X.selectLayer),d=T(X=>X.selectLayerRange),u=T(X=>X.updateLayer),y=T(X=>X.removeLayer),m=T(X=>X.reorderLayer),w=T(X=>X.bringLayerToFront),f=T(X=>X.sendLayerToBack),p=T(X=>X.duplicateLayer),[v,b]=g.useState(!1),[N,P]=g.useState(l.name),[j,C]=g.useState(!1),M=g.useRef(null);g.useEffect(()=>{const X=()=>{kn&&(kn=null,C(!1))};document.addEventListener("mouseup",X);const $=ae=>{(ae.clientY<0||ae.clientX<0||ae.clientX>window.innerWidth||ae.clientY>window.innerHeight)&&kn&&(kn=null,C(!1))};return document.addEventListener("mousemove",$),()=>{document.removeEventListener("mouseup",X),document.removeEventListener("mousemove",$)}},[]);const D=X=>{const $=X.ctrlKey||X.metaKey;if(X.shiftKey&&T.getState().selectedLayerIds.length>0){const O=T.getState().selectedLayerIds[T.getState().selectedLayerIds.length-1];d(O,l.id)}else a(l.id,$)},z=X=>{X.stopPropagation(),a(l.id,!0)},q=X=>{X.target.closest("button")||v||(kn=l.id,c||a(l.id,!1))},U=()=>{if(!kn||kn===l.id){C(!1);return}C(!0);const X=T.getState().project.layers.find(ae=>ae.id===kn),$=X&&X.zIndex<l.zIndex?"up":"down";m(kn,$)},R=()=>{C(!1)},k=()=>{kn&&(kn=null)},F=X=>{X.stopPropagation(),u(l.id,{visible:!l.visible})},H=X=>{X.stopPropagation(),u(l.id,{locked:!l.locked})},re=()=>{N.trim()?u(l.id,{name:N.trim()}):P(l.name),b(!1)},ee=X=>{X.key==="Enter"?re():X.key==="Escape"&&(P(l.name),b(!1))},W=X=>{X.stopPropagation(),y(l.id)},Z=X=>{X.stopPropagation(),p(l.id)},J=X=>{X.stopPropagation(),w(l.id)},A=X=>{X.stopPropagation(),f(l.id)};return r.jsxs("div",{ref:M,id:`layer-item-${l.id}`,onClick:D,onMouseDown:q,onMouseEnter:U,onMouseLeave:R,onMouseUp:k,title:"Click to select  Ctrl/Cmd+Click for multi-select  Shift+Click for range select","aria-label":`Layer: ${l.name}`,"aria-selected":c,role:"option",className:`group p-2 rounded border transition-all cursor-pointer select-none ${j?"bg-green-900 border-green-400 scale-105":""} ${c?"bg-blue-900 border-blue-500 text-white":"bg-panel-bg border-border text-gray-300 hover:bg-gray-800"}`,children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1",children:[r.jsx("button",{id:`btn-layer-select-${l.id}`,onClick:z,onMouseDown:X=>X.stopPropagation(),className:`w-4 h-4 flex-shrink-0 rounded border-2 flex items-center justify-center transition-colors ${c?"bg-white border-white":"bg-gray-700 border-gray-600 hover:border-gray-500"}`,title:"Select/deselect this layer","aria-label":c?`Deselect ${l.name}`:`Select ${l.name}`,children:c&&r.jsx("svg",{className:"w-3 h-3 text-black",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M16.707 5.293a1 1 0 010 1.414l-8 8a1 1 0 01-1.414 0l-4-4a1 1 0 011.414-1.414L8 12.586l7.293-7.293a1 1 0 011.414 0z",clipRule:"evenodd"})})}),r.jsxs("div",{className:"w-8 h-8 flex-shrink-0 bg-canvas-bg border border-gray-600 rounded overflow-hidden relative",children:[r.jsx("img",{src:l.imageData,alt:l.name,className:"w-full h-full object-contain",style:{imageRendering:"pixelated"}}),Wu(l)&&r.jsx("div",{className:"absolute bottom-0 right-0 bg-blue-600 text-white text-[8px] font-bold px-1 rounded-tl",title:"Text Layer",children:"T"})]}),r.jsx("div",{className:"flex-1 min-w-0",children:v?r.jsx("input",{id:`input-layer-name-${l.id}`,autoFocus:!0,type:"text",value:N,onChange:X=>P(X.target.value),onBlur:re,onKeyDown:ee,onClick:X=>X.stopPropagation(),className:"w-full px-1 py-0 bg-canvas-bg border border-blue-400 rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-300",placeholder:"Layer name...","aria-label":"Layer name"}):r.jsx("span",{className:"text-xs font-medium truncate block",title:l.name,children:l.name})}),!v&&r.jsx("button",{id:`btn-layer-rename-${l.id}`,onClick:X=>{X.stopPropagation(),P(l.name),b(!0)},className:"w-4 h-4 flex items-center justify-center flex-shrink-0 rounded transition-colors hover:bg-gray-600 opacity-0 group-hover:opacity-100",title:"Rename layer","aria-label":`Rename ${l.name}`,children:r.jsx("svg",{className:"w-3 h-3 text-gray-400",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{d:"M13.586 3.586a2 2 0 112.828 2.828l-.793.793-2.828-2.828.793-.793zM11.379 5.793L3 14.172V17h2.828l8.38-8.379-2.83-2.828z"})})}),r.jsx("button",{id:`btn-layer-visibility-${l.id}`,onClick:F,className:"w-5 h-5 flex items-center justify-center flex-shrink-0 rounded transition-colors hover:bg-gray-600",title:l.visible?"Hide layer":"Show layer","aria-label":l.visible?`Hide ${l.name}`:`Show ${l.name}`,children:l.visible?r.jsxs("svg",{className:"w-4 h-4 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20",children:[r.jsx("path",{d:"M10 12a2 2 0 100-4 2 2 0 000 4z"}),r.jsx("path",{fillRule:"evenodd",d:"M.458 10C1.732 5.943 5.522 3 10 3s8.268 2.943 9.542 7c-1.274 4.057-5.064 7-9.542 7S1.732 14.057.458 10zM14 10a4 4 0 11-8 0 4 4 0 018 0z",clipRule:"evenodd"})]}):r.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M3.707 2.293a1 1 0 00-1.414 1.414l14 14a1 1 0 001.414-1.414l-1.473-1.473A10.014 10.014 0 0019.542 10C18.268 5.943 14.478 3 10 3a9.958 9.958 0 00-5.838 1.834l-2.455-2.541zM12.305 15.93A9.959 9.959 0 0110 15c-4.478 0-8.268-2.943-9.542-7a9.88 9.88 0 011.964-2.964l2.386 2.386c-.078.464-.12.94-.12 1.424 0 3.314 2.686 6 6 6a5.975 5.975 0 002.717-.632l2.472 2.472z",clipRule:"evenodd"})})}),r.jsx("button",{id:`btn-layer-lock-${l.id}`,onClick:H,className:"w-5 h-5 flex items-center justify-center flex-shrink-0 rounded transition-colors hover:bg-gray-600",title:l.locked?"Unlock layer":"Lock layer","aria-label":l.locked?`Unlock ${l.name}`:`Lock ${l.name}`,children:l.locked?r.jsx("svg",{className:"w-4 h-4 text-gray-300",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M5 9V7a5 5 0 0110 0v2a2 2 0 012 2v5a2 2 0 01-2 2H5a2 2 0 01-2-2v-5a2 2 0 012-2zm8-2v2H7V7a3 3 0 016 0z",clipRule:"evenodd"})}):r.jsx("svg",{className:"w-4 h-4 text-gray-500",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{d:"M10 2a5 5 0 00-5 5v2a2 2 0 00-2 2v5a2 2 0 002 2h10a2 2 0 002-2v-5a2 2 0 00-2-2V7a5 5 0 00-5-5zm0 2a3 3 0 013 3v2H7V7a3 3 0 013-3z"})})})]}),r.jsxs("div",{className:"text-xs text-gray-500 px-10 mb-2",children:[l.width,"",l.height,"  z:",l.zIndex]}),r.jsxs("div",{className:"flex gap-1 opacity-0 group-hover:opacity-100 transition-opacity",children:[Wu(l)&&r.jsx("button",{id:`btn-layer-edit-text-${l.id}`,onClick:X=>{X.stopPropagation(),window.openTextLayerModal?.(l)},className:"flex-1 px-1 py-1 text-xs bg-blue-700 hover:bg-blue-600 rounded transition-colors flex items-center justify-center",title:"Edit text","aria-label":`Edit text for ${l.name}`,children:r.jsx("span",{className:"font-bold text-sm",children:"T"})}),Lh(l)&&r.jsx("button",{id:`btn-layer-edit-shape-${l.id}`,onClick:X=>{X.stopPropagation(),window.openShapeModal?.(l)},className:"flex-1 px-1 py-1 text-xs bg-purple-700 hover:bg-purple-600 rounded transition-colors flex items-center justify-center",title:"Edit shape","aria-label":`Edit shape for ${l.name}`,children:""}),r.jsx("button",{id:`btn-layer-bring-front-${l.id}`,onClick:J,className:"flex-1 px-1 py-1 text-xs bg-gray-700 hover:bg-gray-600 rounded transition-colors flex items-center justify-center",title:"Bring to front","aria-label":`Bring ${l.name} to front`,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M7 11l5-5m0 0l5 5m-5-5v12"})})}),r.jsx("button",{id:`btn-layer-send-back-${l.id}`,onClick:A,className:"flex-1 px-1 py-1 text-xs bg-gray-700 hover:bg-gray-600 rounded transition-colors flex items-center justify-center",title:"Send to back","aria-label":`Send ${l.name} to back`,children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M13 9l-5 5m0 0l-5-5m5 5V2"})})}),r.jsx("button",{id:`btn-layer-duplicate-${l.id}`,onClick:Z,className:"flex-1 px-1 py-1 text-xs bg-blue-700 hover:bg-blue-600 rounded transition-colors flex items-center justify-center",title:"Duplicate layer","aria-label":`Duplicate ${l.name}`,children:r.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[r.jsx("path",{d:"M4 4a2 2 0 012-2h6a2 2 0 012 2v12a1 1 0 110 2h-6a2 2 0 01-2-2V4z"}),r.jsx("path",{d:"M14 4a2 2 0 00-2-2v12a2 2 0 002 2h2a2 2 0 002-2V4h-4z"})]})}),r.jsx("button",{id:`btn-layer-remove-${l.id}`,onClick:W,className:"flex-1 px-1 py-1 text-xs bg-red-700 hover:bg-red-600 rounded transition-colors flex items-center justify-center",title:"Remove layer","aria-label":`Remove ${l.name}`,children:r.jsx("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:r.jsx("path",{fillRule:"evenodd",d:"M9 2a1 1 0 00-.894.553L7.382 4H4a1 1 0 000 2v10a2 2 0 002 2h8a2 2 0 002-2V6a1 1 0 100-2h-3.382l-.724-1.447A1 1 0 0011 2H9zM7 8a1 1 0 012 0v6a1 1 0 11-2 0V8zm5-1a1 1 0 00-1 1v6a1 1 0 102 0V8a1 1 0 00-1-1z",clipRule:"evenodd"})})})]})]})}const id="pixelconnect-preferences";function ra(){try{const l=localStorage.getItem(id);if(l)return JSON.parse(l)}catch(l){console.warn("[DEBUG] Failed to load preferences from localStorage:",l)}return{}}function ai(l){try{localStorage.setItem(id,JSON.stringify(l))}catch(c){console.warn("[DEBUG] Failed to save preferences to localStorage:",c)}}function $h(){g.useEffect(()=>{const l=ra();l.gridDensity!==void 0&&T.getState().setGridDensity(l.gridDensity),l.gridEnabled!==void 0&&T.getState().project.grid.enabled!==l.gridEnabled&&T.getState().toggleGrid(),l.showSelectionBorders!==void 0&&T.getState().ui.showSelectionBorders!==l.showSelectionBorders&&T.getState().toggleSelectionBorders(),l.selectionBorderAnimationSpeed!==void 0&&T.getState().setSelectionBorderAnimationSpeed(l.selectionBorderAnimationSpeed),l.leftClickPan!==void 0&&T.getState().ui.leftClickPan!==l.leftClickPan&&T.getState().toggleLeftClickPan();const c={};l.canvasBorderColor!==void 0&&(c.borderColor=l.canvasBorderColor),l.canvasBorderWidth!==void 0&&(c.borderWidth=l.canvasBorderWidth),l.canvasBorderOpacity!==void 0&&(c.borderOpacity=l.canvasBorderOpacity),Object.keys(c).length>0&&T.getState().setCanvasConfig(c)},[])}function Uh(){const l=T(j=>j.project.canvas),c=T(j=>j.project.layers),a=T(j=>j.setCanvasConfig),d=T(j=>j.cropCanvasToLayers),[u,y]=g.useState(!1),[m,w]=g.useState(String(l.width)),[f,p]=g.useState(String(l.height)),v=j=>{if(w(j),j!==""&&j!=="-"){const C=parseInt(j,10);!isNaN(C)&&C>0&&a({width:C})}},b=j=>{if(p(j),j!==""&&j!=="-"){const C=parseInt(j,10);!isNaN(C)&&C>0&&a({height:C})}};g.useEffect(()=>{w(String(l.width))},[l.width]),g.useEffect(()=>{p(String(l.height))},[l.height]),g.useEffect(()=>{const j=ra();j.canvasBorderEnabled=l.borderEnabled,j.canvasShadowIntensity=l.shadowIntensity,ai(j)},[l.borderEnabled,l.shadowIntensity]);const N=j=>{j==="transparent"?a({backgroundColor:null}):j.startsWith("#")&&a({backgroundColor:j})},P=j=>{const[C,M]=j.split("x").map(Number);!isNaN(C)&&!isNaN(M)&&C>0&&M>0&&a({width:C,height:M})};return r.jsxs("div",{className:"border-t border-border bg-gray-850","data-region":"canvas-settings",children:[r.jsxs("button",{id:"btn-toggle-canvas-settings",onClick:()=>y(!u),className:"w-full px-3 py-2 flex items-center justify-between text-xs font-semibold text-gray-300 hover:bg-gray-800 transition-colors group","aria-label":u?"Expand canvas settings":"Collapse canvas settings","aria-expanded":!u,children:[r.jsx("span",{children:"Canvas"}),r.jsx("span",{className:`text-gray-400 transition-transform group-hover:drop-shadow-lg group-hover:text-gray-200 ${u?"":"rotate-180"}`,children:""})]}),!u&&r.jsxs("div",{className:"p-3 space-y-3 bg-gray-850",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Common Sizes"}),r.jsxs("select",{id:"select-canvas-size",onChange:j=>P(j.target.value),className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400 cursor-pointer",defaultValue:"","aria-label":"Common canvas sizes",children:[r.jsx("option",{value:"",children:"Select a size..."}),r.jsx("option",{value:"1024x1024",children:"1024x1024"}),r.jsx("option",{value:"2048x2048",children:"2048x2048"}),r.jsx("option",{value:"1920x1080",children:"1920x1080"}),r.jsx("option",{value:"3840x2160",children:"3840x2160 (4K)"}),r.jsx("option",{value:"4632x2316",children:"4632x2316"}),r.jsx("option",{value:"2316x4632",children:"2316x4632 (Vertical)"}),r.jsx("option",{value:"3276x3276",children:"3276x3276"})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Width"}),r.jsx("input",{id:"input-canvas-width",type:"text",inputMode:"numeric",value:m,onChange:j=>v(j.target.value),className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"Width","aria-label":"Canvas width"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Height"}),r.jsx("input",{id:"input-canvas-height",type:"text",inputMode:"numeric",value:f,onChange:j=>b(j.target.value),className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"Height","aria-label":"Canvas height"})]})]}),r.jsx("button",{id:"btn-crop-canvas-to-layers",onClick:()=>{d(),window.fitCanvasToScreen?.()},disabled:c.length===0,className:`w-full px-3 py-2 rounded transition-colors text-xs font-medium ${c.length===0?"bg-gray-700 text-gray-500 cursor-not-allowed":"bg-slate-700 text-white hover:bg-slate-600"}`,title:c.length===0?"Add layers first to crop canvas":"Crop canvas to layer bounds","aria-label":"Crop canvas to layer bounds",children:"Crop Canvas to Layers"}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Background"}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("input",{id:"input-bg-color",type:"color",value:l.backgroundColor||"#ffffff",onChange:j=>N(j.target.value),className:"flex-1 h-8 rounded cursor-pointer border border-border",title:"Pick background color","aria-label":"Background color"}),r.jsx("button",{id:"btn-bg-transparent",onClick:()=>N("transparent"),className:`flex-1 px-2 py-1 text-xs font-medium rounded transition-colors ${l.backgroundColor===null?"bg-blue-600 text-white":"bg-panel-bg text-gray-400 hover:text-gray-300"}`,title:"Set background to transparent","aria-label":"Set background to transparent",children:"Clear"})]})]}),r.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Border"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"input-border-enabled",checked:l.borderEnabled??!0,onChange:j=>a({borderEnabled:j.target.checked}),className:"w-4 h-4 rounded cursor-pointer",title:"Enable or disable canvas border","aria-label":"Enable or disable canvas border"}),r.jsx("label",{htmlFor:"input-border-enabled",className:"text-xs text-gray-400 cursor-pointer flex-1",children:"Show Border"})]})]}),r.jsxs("div",{className:"space-y-2 pt-2 border-t border-border",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Shadow"}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Intensity"}),r.jsx("input",{id:"input-shadow-intensity",type:"range",min:"0",max:"1",step:"0.1",value:l.shadowIntensity??.5,onChange:j=>a({shadowIntensity:parseFloat(j.target.value)}),className:"w-full h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer",title:"Shadow intensity (0 = off, 1 = max)","aria-label":"Shadow intensity"}),r.jsxs("div",{className:"text-xs text-gray-500 mt-1",children:[Math.round((l.shadowIntensity??.5)*100),"%"]})]})]}),r.jsx("div",{className:"space-y-2 pt-2 border-t border-border",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"input-checkered-bg",checked:l.showCheckeredBackground??!1,onChange:j=>a({showCheckeredBackground:j.target.checked}),disabled:l.backgroundColor!==null,className:"w-4 h-4 rounded cursor-pointer disabled:opacity-50",title:"Show checkered pattern for transparency (only available when background is transparent)","aria-label":"Show checkered background"}),r.jsx("label",{htmlFor:"input-checkered-bg",className:`text-xs cursor-pointer flex-1 ${l.backgroundColor!==null?"text-gray-600":"text-gray-400"}`,children:"Checkered Background"})]})}),r.jsx("div",{className:"space-y-2 pt-2 border-t border-border",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"checkbox",id:"input-drag-info",checked:l.dragInfoEnabled??!0,onChange:j=>a({dragInfoEnabled:j.target.checked}),className:"w-4 h-4 rounded cursor-pointer",title:"Show drag translation info when dragging layers","aria-label":"Show drag info tooltip"}),r.jsx("label",{htmlFor:"input-drag-info",className:"text-xs text-gray-400 cursor-pointer flex-1",children:"Show Drag Info"})]})})]})]})}function Xu(){const l=g.useRef(null),c=T(v=>v.project),a=T(v=>v.selectedLayerIds),d=T(v=>v.selectAllLayers),u=T(v=>v.deselectAllLayers),y=T(v=>v.deleteSelectedLayers),m=T(v=>v.addLayer),w=[...c.layers].sort((v,b)=>b.zIndex-v.zIndex),f=()=>{if(a.length===0){console.warn("[DEBUG] No layers selected for deletion");return}window.confirm(`Delete ${a.length} layer${a.length!==1?"s":""}?`)&&y()},p=async v=>{const b=v.currentTarget.files;if(!b){console.warn("[DEBUG] No files selected");return}for(const N of Array.from(b))try{if(!["image/png","image/gif","image/bmp","image/jpeg"].includes(N.type)){console.warn(`[DEBUG] Unsupported file type: ${N.type}`),alert(`Unsupported file type: ${N.type}. Please use PNG, GIF, BMP, or JPEG.`);continue}const P=await new Promise((D,z)=>{const q=new FileReader;q.onload=U=>D(U.target?.result),q.onerror=()=>z(new Error("Failed to read file")),q.readAsDataURL(N)}),j=new Image;j.src=P,await new Promise((D,z)=>{j.onload=()=>D(),j.onerror=()=>z(new Error("Failed to load image"))});const C=j.naturalWidth,M=j.naturalHeight;m({name:N.name,imageData:P,x:0,y:0,zIndex:T.getState().project.layers.length,visible:!0,locked:!1,opacity:1,width:C,height:M})}catch(P){alert(`Error loading image ${N.name}: ${P instanceof Error?P.message:"Unknown error"}`)}l.current&&(l.current.value="")};return r.jsxs("div",{className:"h-full flex flex-col bg-canvas-bg","data-region":"layer-panel",children:[r.jsxs("div",{className:"px-3 py-3 border-b border-border",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-300 mb-3",children:"Layers"}),r.jsxs("div",{className:"flex gap-1 flex-wrap",children:[r.jsx("button",{id:"btn-select-all-layers",onClick:d,disabled:c.layers.length===0,className:"flex-1 min-w-16 px-2 py-1 text-xs font-medium text-gray-400 hover:text-gray-300 bg-panel-bg hover:bg-gray-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Select all layers (Ctrl+A)","aria-label":"Select all layers",children:"All"}),r.jsx("button",{id:"btn-deselect-all-layers",onClick:u,disabled:a.length===0,className:"flex-1 min-w-16 px-2 py-1 text-xs font-medium text-gray-400 hover:text-gray-300 bg-panel-bg hover:bg-gray-700 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Deselect all layers (Ctrl+D)","aria-label":"Deselect all layers",children:"None"}),r.jsx("button",{id:"btn-delete-selected-layers",onClick:f,disabled:a.length===0,className:"flex-1 min-w-16 px-2 py-1 text-xs font-medium text-red-400 hover:text-red-300 bg-panel-bg hover:bg-red-900 rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed",title:"Delete selected layers (Delete)","aria-label":"Delete selected layers",children:"Delete"}),r.jsx("button",{id:"btn-create-text-layer",onClick:()=>window.openTextLayerModal?.(),className:"flex-1 min-w-16 px-2 py-1 text-xs font-medium text-blue-400 hover:text-blue-300 bg-panel-bg hover:bg-blue-900 rounded transition-colors flex items-center justify-center gap-1",title:"Create text layer","aria-label":"Create text layer",children:r.jsx("span",{className:"font-bold",children:"T"})}),r.jsx("button",{id:"btn-create-shape-layer",onClick:()=>window.openShapeModal?.(),className:"flex-1 min-w-16 px-2 py-1 text-xs font-medium text-purple-400 hover:text-purple-300 bg-panel-bg hover:bg-purple-900 rounded transition-colors",title:"Create shape layer","aria-label":"Create shape layer",children:""}),r.jsx("button",{id:"btn-upload-images",onClick:()=>l.current?.click(),className:"flex-1 min-w-16 px-2 py-1 text-xs font-medium text-green-400 hover:text-green-300 bg-panel-bg hover:bg-green-900 rounded transition-colors",title:"Upload additional images","aria-label":"Upload additional images",children:"Add"})]})]}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:w.length===0?r.jsxs("div",{className:"px-3 py-8 text-center text-sm text-gray-500",children:[r.jsx("div",{className:"mb-2",children:"No layers yet"}),r.jsx("div",{className:"text-xs",children:"Upload images to get started"})]}):r.jsx("div",{className:"space-y-1 p-2",children:w.map(v=>r.jsx(Bh,{layer:v,isSelected:a.includes(v.id)},v.id))})}),c.layers.length>0&&r.jsxs("div",{className:"px-3 py-2 border-t border-border text-xs text-gray-500",children:[c.layers.length," layer",c.layers.length!==1?"s":"",a.length>0&&`  ${a.length} selected`]}),r.jsx("div",{className:"border-t border-border px-3 py-2 bg-panel-bg",children:r.jsx(Uh,{})}),r.jsx("input",{ref:l,id:"input-upload-images",type:"file",multiple:!0,accept:"image/png,image/gif,image/bmp,image/jpeg",onChange:p,className:"hidden","aria-label":"Upload images"})]})}function Wh({layer:l}){const c=T(D=>D.updateLayer),a=T(D=>D.pushHistory),d=T(D=>D.ui.isDraggingLayer),u=T(D=>D.ui.dragLayerId),y=T(D=>D.ui.dragOffsetX),m=T(D=>D.ui.dragOffsetY),[w,f]=g.useState(String(l.x)),[p,v]=g.useState(String(l.y)),b=d&&u===l.id,N=b?Math.floor(l.x+y):l.x,P=b?Math.floor(l.y+m):l.y;g.useEffect(()=>{f(String(N))},[N]),g.useEffect(()=>{v(String(P))},[P]);const j=D=>{if(f(D),D!==""&&D!=="-"){const z=parseInt(D,10);isNaN(z)||c(l.id,{x:z})}},C=D=>{if(v(D),D!==""&&D!=="-"){const z=parseInt(D,10);isNaN(z)||c(l.id,{y:z})}},M=()=>{a()};return r.jsxs("div",{className:"bg-panel-bg rounded p-3 space-y-3","data-region":"position-inputs",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Position"}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"X"}),r.jsx("input",{id:"input-layer-x",type:"text",inputMode:"numeric",value:w,onChange:D=>j(D.target.value),onBlur:M,className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"X position","aria-label":"Layer X position"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Y"}),r.jsx("input",{id:"input-layer-y",type:"text",inputMode:"numeric",value:p,onChange:D=>C(D.target.value),onBlur:M,className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"Y position","aria-label":"Layer Y position"})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2 pt-2 border-t border-border",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Width"}),r.jsx("div",{className:"px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-gray-500",children:l.width})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Height"}),r.jsx("div",{className:"px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-gray-500",children:l.height})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Z-Index"}),r.jsx("div",{className:"px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-gray-500",children:l.zIndex})]})]})}function Hh({layer:l}){const c=T(u=>u.updateLayer),a=u=>{const y=Math.max(0,Math.min(1,u/100));c(l.id,{opacity:y})},d=l.opacity!==void 0?l.opacity:1;return r.jsxs("div",{className:"bg-panel-bg rounded p-3 space-y-2","data-region":"opacity-control",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Opacity"}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("input",{id:"input-layer-opacity",type:"range",min:"0",max:"100",value:d*100,onChange:u=>a(parseInt(u.target.value)),className:"w-full h-2 bg-canvas-bg rounded appearance-none cursor-pointer accent-blue-400","aria-label":"Layer opacity"}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-xs text-gray-400",children:[(d*100).toFixed(0),"%"]}),r.jsxs("div",{className:"flex gap-1",children:[r.jsx("button",{id:"btn-opacity-50",onClick:()=>a(50),className:"px-2 py-1 text-xs bg-canvas-bg hover:bg-border rounded transition",title:"50% opacity","aria-label":"Set 50% opacity",children:"50%"}),r.jsx("button",{id:"btn-opacity-100",onClick:()=>a(100),className:"px-2 py-1 text-xs bg-canvas-bg hover:bg-border rounded transition",title:"100% opacity (fully opaque)","aria-label":"Set 100% opacity",children:"100%"})]})]})]})]})}function Yh({layer:l}){const[c,a]=g.useState(null),[d,u]=g.useState(null),[y,m]=g.useState(!1),[w,f]=g.useState(new Set),[p,v]=g.useState(new Set),b=g.useRef(null),N=g.useRef(null),P=g.useRef(28);g.useEffect(()=>{a(null),u(null),f(new Set),v(new Set)},[l.id]);const j=()=>{if(!b.current||!c)return;const U=b.current,R=U.scrollTop,k=U.clientHeight,F=P.current,H=Math.max(0,Math.floor(R/F)-2),re=Math.min(c.length,Math.ceil((R+k)/F)+2),ee=new Set;for(let W=H;W<re;W++)ee.add(W);f(ee)},C=()=>{if(!N.current||!d)return;const U=N.current,R=U.scrollTop,k=U.clientHeight,F=P.current,H=Math.max(0,Math.floor(R/F)-2),re=Math.min(d.length,Math.ceil((R+k)/F)+2),ee=new Set;for(let W=H;W<re;W++)ee.add(W);v(ee)};g.useEffect(()=>{const U=b.current;if(U)return U.addEventListener("scroll",j),j(),()=>U.removeEventListener("scroll",j)},[c]),g.useEffect(()=>{const U=N.current;if(U)return U.addEventListener("scroll",C),C(),()=>U.removeEventListener("scroll",C)},[d]);const M=async U=>{m(!0);try{const R=new Image;R.onload=()=>{const k=document.createElement("canvas");k.width=R.width,k.height=R.height;const F=k.getContext("2d");if(!F){console.error("Failed to get canvas context"),m(!1);return}F.drawImage(R,0,0);const re=F.getImageData(0,0,k.width,k.height).data;if(U){const ee=new Map;let W=0;for(let J=0;J<re.length;J+=4){const A=re[J],X=re[J+1],$=re[J+2],ae=re[J+3];if(ae===0)continue;W++;const oe=`${`#${((1<<24)+(A<<16)+(X<<8)+$).toString(16).slice(1).toUpperCase()}`}${ae.toString(16).padStart(2,"0").toUpperCase()}`;ee.set(oe,(ee.get(oe)||0)+1)}W=Math.max(1,W);const Z=Array.from(ee.entries()).map(([J,A])=>{const X=J.substring(0,7),$=parseInt(J.substring(7),16);return{hex:X,count:A,percent:A/W*100,hasAlpha:!0,alpha:$}}).filter(J=>!(J.hex==="#000000"&&J.alpha===0)).sort((J,A)=>A.count-J.count);u(Z),v(new Set)}else{const ee=new Map;let W=0;for(let J=0;J<re.length;J+=4){const A=re[J],X=re[J+1],$=re[J+2];if(re[J+3]!==255)continue;W++;const O=`#${((1<<24)+(A<<16)+(X<<8)+$).toString(16).slice(1).toUpperCase()}`;ee.set(O,(ee.get(O)||0)+1)}W=Math.max(1,W);const Z=Array.from(ee.entries()).map(([J,A])=>({hex:J,count:A,percent:A/W*100,hasAlpha:!1,alpha:void 0})).sort((J,A)=>A.count-J.count);a(Z),f(new Set)}},R.onerror=()=>{console.error("Failed to load image for color analysis"),m(!1)},R.src=l.imageData}finally{m(!1)}},D=U=>{navigator.clipboard.writeText(U).catch(()=>{console.error("Failed to copy to clipboard")})},z=(U,R)=>{if(!U||U.length===0)return;const F=U.map(H=>R&&H.alpha!==void 0?`${H.hex}${H.alpha.toString(16).toUpperCase().padStart(2,"0")}`:H.hex).join(`
`);D(F)},q=(U,R,k)=>{if(!U||U.length===0)return r.jsx("p",{className:"text-xs text-gray-500 p-2",children:"No colors found"});const F=[],H=Array.from(R).sort((J,A)=>J-A);for(const J of H){const A=U[J];A&&F.push(r.jsxs("div",{className:"flex items-center gap-2 px-2 py-1 text-xs hover:bg-gray-700 border-b border-gray-700/50 last:border-b-0 transition-colors",style:{height:`${P.current}px`},children:[r.jsx("div",{className:"w-4 h-4 rounded border border-gray-600 flex-shrink-0",style:{backgroundColor:A.hex},title:A.hex}),r.jsx("span",{className:"font-mono text-gray-300 min-w-fit text-xs",children:A.hex}),A.hasAlpha&&A.alpha!==void 0&&r.jsxs("span",{className:"font-mono text-gray-500 text-xs",children:["",A.alpha.toString(16).toUpperCase().padStart(2,"0")]}),r.jsxs("div",{className:"ml-auto flex items-center gap-1 flex-shrink-0",children:[r.jsx("span",{className:"font-mono text-gray-400 text-xs",children:A.count}),r.jsxs("span",{className:"text-gray-600 text-xs",children:["(",A.percent.toFixed(2),"%)"]})]})]},`${A.hex}-${J}`))}const re=R.size>0?Math.min(...R):0,ee=R.size>0?Math.max(...R):0,W=Math.max(0,re)*P.current,Z=Math.max(0,U.length-(ee+1))*P.current;return r.jsxs("div",{ref:k,className:"max-h-64 overflow-y-auto bg-gray-800/50 rounded border border-gray-700 text-xs",style:{height:"256px"},children:[r.jsx("div",{style:{height:W}}),F,r.jsx("div",{style:{height:Z}})]})};return r.jsxs("div",{className:"bg-panel-bg rounded p-3 space-y-2","data-region":"color-analysis",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Analyze Colors"}),r.jsx("button",{id:"btn-analyze-rgb",onClick:()=>M(!1),disabled:y,className:"w-full px-3 py-1 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-700 disabled:cursor-not-allowed text-xs font-medium text-blue-400 rounded transition-colors","aria-label":"Analyze RGB colors",children:y?"Analyzing...":"Get Colors..."}),c&&r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[r.jsxs("span",{children:[c.length," colors (RGB)  ",Math.floor(c.reduce((U,R)=>U+R.count,0))," pixels"]}),r.jsx("button",{id:"btn-copy-rgb-colors",onClick:()=>z(c,!1),className:"p-1 text-gray-500 hover:text-gray-300 transition-colors flex-shrink-0",title:"Copy all colors to clipboard","aria-label":"Copy all RGB colors to clipboard",children:r.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[r.jsx("path",{d:"M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2z"}),r.jsx("path",{fillOpacity:"0.5",d:"M2 6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-2h-2v2H2V8h2V6H2z"})]})})]}),q(c,w,b)]}),c&&r.jsx("div",{className:"my-2 border-t border-gray-700"}),r.jsx("button",{id:"btn-analyze-rgba",onClick:()=>M(!0),disabled:y,className:"w-full px-3 py-1 bg-gray-700 hover:bg-gray-600 disabled:bg-gray-700 disabled:cursor-not-allowed text-xs font-medium text-purple-400 rounded transition-colors","aria-label":"Analyze RGBA colors",children:y?"Analyzing...":"Get Colors (inc. transparent pixels)..."}),d&&r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex items-center justify-between text-xs text-gray-400",children:[r.jsxs("span",{children:[d.length," colors (RGBA)  ",Math.floor(d.reduce((U,R)=>U+R.count,0))," pixels"]}),r.jsx("button",{id:"btn-copy-rgba-colors",onClick:()=>z(d,!0),className:"p-1 text-gray-500 hover:text-gray-300 transition-colors flex-shrink-0",title:"Copy all colors to clipboard","aria-label":"Copy all RGBA colors to clipboard",children:r.jsxs("svg",{className:"w-4 h-4",fill:"currentColor",viewBox:"0 0 20 20",children:[r.jsx("path",{d:"M4 2a2 2 0 0 1 2-2h8a2 2 0 0 1 2 2v10a2 2 0 0 1-2 2H6a2 2 0 0 1-2-2V2z"}),r.jsx("path",{fillOpacity:"0.5",d:"M2 6a2 2 0 0 0-2 2v8a2 2 0 0 0 2 2h8a2 2 0 0 0 2-2v-2h-2v2H2V8h2V6H2z"})]})})]}),q(d,p,N)]})]})}function Xh(l,c){const{shapeType:a,stretchX:d,stretchY:u}=l;let y=1/0,m=-1/0,w=1/0,f=-1/0;const p=(b,N)=>{y=Math.min(y,b),m=Math.max(m,b),w=Math.min(w,N),f=Math.max(f,N)};if(a==="rectangle"||a==="circle"){const b=c*2*d,N=c*2*u;return{minX:-b/2,maxX:b/2,minY:-N/2,maxY:N/2}}let v=3;if(a==="hexagon"&&(v=6),a==="octagon"&&(v=8),a==="star"){const N=c*d,P=c*.4*d,j=Math.PI*2/10;let C=-Math.PI/2;for(let M=0;M<10;M++){const D=C+j*M,q=M%2===0?N:P,U=Math.cos(D)*q,R=Math.sin(D)*q*u;p(U,R)}}else{const b=Math.PI*2/v;let N=-Math.PI/2;for(let P=0;P<v;P++){const j=N+b*P,C=Math.cos(j)*c,M=Math.sin(j)*c;p(C*d,M*u)}}return{minX:y,maxX:m,minY:w,maxY:f}}async function Ir(l){const{shapeType:c,size:a,stretchX:d,stretchY:u,color:y}=l,w=a*1/2,f=Xh(l,w),p=f.maxX-f.minX,v=f.maxY-f.minY,b=0,N=Math.ceil(p+b*2),P=Math.ceil(v+b*2),j=document.createElement("canvas");j.width=N,j.height=P;const C=j.getContext("2d");if(!C)throw new Error("Failed to get canvas context");switch(C.imageSmoothingEnabled=!1,C.imageSmoothingQuality="low",C.fillStyle=y,C.translate(b-f.minX,b-f.minY),c){case"rectangle":Vh(C,0,0,w,d,u);break;case"circle":Gh(C,0,0,w,d,u);break;case"triangle":ei(C,0,0,w,3,d,u);break;case"hexagon":ei(C,0,0,w,6,d,u);break;case"octagon":ei(C,0,0,w,8,d,u);break;case"star":Zh(C,0,0,w,d,u);break}const M=C.getImageData(0,0,j.width,j.height),D=M.data,z=parseInt(y.slice(1,3),16),q=parseInt(y.slice(3,5),16),U=parseInt(y.slice(5,7),16);for(let k=0;k<D.length;k+=4)D[k+3]>=128?(D[k+3]=255,D[k]=z,D[k+1]=q,D[k+2]=U):D[k+3]=0;return C.putImageData(M,0,0),{dataUrl:j.toDataURL("image/png"),width:N,height:P,offsetX:0,offsetY:0}}function Vh(l,c,a,d,u,y){const m=d*2*u,w=d*2*y;l.fillRect(c-m/2,a-w/2,m,w)}function Gh(l,c,a,d,u,y){l.beginPath(),u===y?l.arc(c,a,d*u,0,Math.PI*2):l.ellipse(c,a,d*u,d*y,0,0,Math.PI*2),l.fill()}function ei(l,c,a,d,u,y,m){l.beginPath();const w=Math.PI*2/u;let f=-Math.PI/2;for(let p=0;p<u;p++){const v=f+w*p,b=c+Math.cos(v)*d*y,N=a+Math.sin(v)*d*m;p===0?l.moveTo(b,N):l.lineTo(b,N)}l.closePath(),l.fill()}function Zh(l,c,a,d,u,y){const w=d*u,f=d*.4*u;l.beginPath();const p=Math.PI*2/10;let v=-Math.PI/2;for(let b=0;b<10;b++){const N=v+p*b,j=b%2===0?w:f,C=c+Math.cos(N)*j,M=a+Math.sin(N)*j*y;b===0?l.moveTo(C,M):l.lineTo(C,M)}l.closePath(),l.fill()}function Kh({layer:l}){const c=T(f=>f.updateLayer);if(!l.shapeType)return null;const a=async f=>{if(f)try{const p=await Ir({shapeType:f,size:l.shapeSize||200,stretchX:l.shapeStretchX||1,stretchY:l.shapeStretchY||1,color:l.shapeColor||"#FFFFFF"});c(l.id,{imageData:p.dataUrl,width:p.width,height:p.height,x:l.x-p.offsetX,y:l.y-p.offsetY,shapeType:f})}catch(p){console.error("Failed to update shape type:",p)}},d=async f=>{try{if(!l.shapeType)return;const p=await Ir({shapeType:l.shapeType,size:f,stretchX:l.shapeStretchX||1,stretchY:l.shapeStretchY||1,color:l.shapeColor||"#FFFFFF"});c(l.id,{imageData:p.dataUrl,width:p.width,height:p.height,x:l.x-p.offsetX,y:l.y-p.offsetY,shapeSize:f})}catch(p){console.error("Failed to update shape size:",p)}},u=async f=>{try{if(!l.shapeType)return;const p=await Ir({shapeType:l.shapeType,size:l.shapeSize||200,stretchX:f,stretchY:l.shapeStretchY||1,color:l.shapeColor||"#FFFFFF"});c(l.id,{imageData:p.dataUrl,width:p.width,height:p.height,x:l.x-p.offsetX,y:l.y-p.offsetY,shapeStretchX:f})}catch(p){console.error("Failed to update shape stretch X:",p)}},y=async f=>{try{if(!l.shapeType)return;const p=await Ir({shapeType:l.shapeType,size:l.shapeSize||200,stretchX:l.shapeStretchX||1,stretchY:f,color:l.shapeColor||"#FFFFFF"});c(l.id,{imageData:p.dataUrl,width:p.width,height:p.height,x:l.x-p.offsetY,y:l.y-p.offsetY,shapeStretchY:f})}catch(p){console.error("Failed to update shape stretch Y:",p)}},m=async f=>{try{if(!l.shapeType)return;const p=await Ir({shapeType:l.shapeType,size:l.shapeSize||200,stretchX:l.shapeStretchX||1,stretchY:l.shapeStretchY||1,color:f});c(l.id,{imageData:p.dataUrl,width:p.width,height:p.height,x:l.x-p.offsetX,y:l.y-p.offsetY,shapeColor:f})}catch(p){console.error("Failed to update shape color:",p)}},w=["rectangle","circle","triangle","hexagon","octagon","star"];return r.jsxs("div",{className:"bg-panel-bg rounded p-3 space-y-3","data-region":"shape-properties",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Shape Properties"}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Type"}),r.jsx("select",{id:"select-shape-type",value:l.shapeType,onChange:f=>a(f.target.value),className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400","aria-label":"Shape type",children:w.map(f=>r.jsx("option",{value:f,children:f.charAt(0).toUpperCase()+f.slice(1)},f))})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"text-xs text-gray-400 block mb-1",children:["Size: ",l.shapeSize||200,"px"]}),r.jsx("input",{id:"input-shape-size",type:"range",min:"10",max:"500",value:l.shapeSize||200,onChange:f=>d(Number(f.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer","aria-label":"Shape size"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"text-xs text-gray-400 block mb-1",children:["Stretch X: ",(l.shapeStretchX||1).toFixed(2),"x"]}),r.jsx("input",{id:"input-shape-stretch-x",type:"range",min:"0.1",max:"20",step:"0.1",value:l.shapeStretchX||1,onChange:f=>u(Number(f.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer","aria-label":"Shape stretch X"})]}),r.jsxs("div",{children:[r.jsxs("label",{className:"text-xs text-gray-400 block mb-1",children:["Stretch Y: ",(l.shapeStretchY||1).toFixed(2),"x"]}),r.jsx("input",{id:"input-shape-stretch-y",type:"range",min:"0.1",max:"20",step:"0.1",value:l.shapeStretchY||1,onChange:f=>y(Number(f.target.value)),className:"w-full h-2 bg-slate-700 rounded-lg appearance-none cursor-pointer","aria-label":"Shape stretch Y"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Color"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{id:"input-shape-color",type:"color",value:l.shapeColor||"#FFFFFF",onChange:f=>m(f.target.value),className:"w-12 h-8 rounded cursor-pointer border border-border","aria-label":"Shape color"}),r.jsx("input",{id:"input-shape-color-hex",type:"text",value:l.shapeColor||"#FFFFFF",onChange:f=>{/^#[0-9A-F]{6}$/i.test(f.target.value)&&m(f.target.value)},placeholder:"#FFFFFF",className:"flex-1 px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400","aria-label":"Shape color hex value"})]})]}),r.jsx("button",{id:"btn-edit-shape",onClick:()=>window.openShapeModal?.(l),className:"w-full px-3 py-2 bg-purple-600 hover:bg-purple-700 text-white text-xs font-medium rounded transition-colors","aria-label":"Edit shape in modal",children:"Edit Shape"})]})}function Rr(){const[l,c]=g.useState(()=>window.innerHeight>window.innerWidth);return g.useEffect(()=>{const a=()=>c(window.innerHeight>window.innerWidth);window.addEventListener("resize",a),window.addEventListener("orientationchange",a);const d=window.matchMedia("(orientation: portrait)"),u=y=>c(y.matches);return d.addEventListener("change",u),()=>{window.removeEventListener("resize",a),window.removeEventListener("orientationchange",a),d.removeEventListener("change",u)}},[]),l}const fo=({isOpen:l,onClose:c,title:a,children:d,initialPosition:u={x:100,y:100},noPadding:y=!1,modalId:m})=>{const[w,f]=g.useState(u),[p,v]=g.useState(!1),[b,N]=g.useState({width:1100,height:900}),[P,j]=g.useState(!1),C=g.useRef(null),M=g.useRef(null);g.useEffect(()=>{if(l){const z=window.innerWidth,q=window.innerHeight,U=Math.min(1100,Math.round(z*.9)),R=Math.min(900,Math.round(q*.9));N({width:U,height:R}),f({x:Math.max(0,Math.round((z-U)/2)),y:Math.max(0,Math.round((q-R)/2))})}},[l]),g.useEffect(()=>{const z=U=>{if(p&&C.current){const R=U.clientX-C.current.x,k=U.clientY-C.current.y;f(F=>{const H=F.x+R,re=F.y+k,ee=-(b.width-100),W=window.innerWidth-100,Z=0,J=window.innerHeight-40;return{x:Math.max(ee,Math.min(W,H)),y:Math.max(Z,Math.min(J,re))}}),C.current={x:U.clientX,y:U.clientY}}},q=()=>{v(!1),C.current=null};return p&&(window.addEventListener("mousemove",z),window.addEventListener("mouseup",q)),()=>{window.removeEventListener("mousemove",z),window.removeEventListener("mouseup",q)}},[p]);const D=g.useCallback(z=>q=>{q.preventDefault(),q.stopPropagation(),j(!0),M.current={x:q.clientX,y:q.clientY,startWidth:b.width,startHeight:b.height,startPosX:w.x,startPosY:w.y,direction:z}},[b,w]);return g.useEffect(()=>{const U=k=>{if(P&&M.current){const{x:F,y:H,startWidth:re,startHeight:ee,startPosX:W,startPosY:Z,direction:J}=M.current,A=k.clientX-F,X=k.clientY-H;let $=re,ae=ee,O=W,oe=Z;J.includes("e")?$=Math.max(400,re+A):J.includes("w")&&($=Math.max(400,re-A),O=W+re-$),J.includes("s")?ae=Math.max(300,ee+X):J.includes("n")&&(ae=Math.max(300,ee-X),oe=Z+ee-ae),N({width:$,height:ae}),f({x:O,y:oe})}},R=()=>{j(!1),M.current=null};return P&&(window.addEventListener("mousemove",U),window.addEventListener("mouseup",R)),()=>{window.removeEventListener("mousemove",U),window.removeEventListener("mouseup",R)}},[P]),l?r.jsx(Qh,{modalId:m,title:a,onClose:c,position:w,setPosition:f,size:b,setSize:N,noPadding:y,isDragging:p,setIsDragging:v,dragStartRef:C,isResizing:P,handleResizeMouseDown:D,children:typeof d=="function"?d(b):d}):null},Qh=({modalId:l,title:c,onClose:a,position:d,size:u,noPadding:y,setIsDragging:m,dragStartRef:w,handleResizeMouseDown:f,children:p})=>Rr()?r.jsxs("div",{className:"fixed inset-0 z-[300] flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:a}),r.jsxs("div",{id:l,role:"dialog","aria-modal":"true","aria-label":c,"data-region":l||"modal",className:"relative flex flex-col bg-panel-bg border border-border rounded-lg shadow-2xl overflow-hidden",style:{width:"95vw",height:"90vh",maxWidth:"1200px",maxHeight:"95vh",zIndex:301},children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-canvas-bg border-b border-border select-none flex-shrink-0",children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:c}),r.jsx("button",{id:l?`${l}-close`:void 0,onClick:a,className:"text-gray-400 hover:text-white focus:outline-none p-1 rounded hover:bg-gray-700 transition-colors","aria-label":`Close ${c}`,children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx("div",{className:`${y?"":"p-4"} text-gray-300 ${y?"overflow-hidden":"overflow-auto"} flex-1`,children:p})]})]}):r.jsxs("div",{id:l,role:"dialog","aria-modal":"true","aria-label":c,"data-region":l||"modal",className:"fixed flex flex-col bg-panel-bg border border-border rounded shadow-lg overflow-hidden",style:{left:d.x,top:d.y,zIndex:50,width:`${u.width}px`,height:`${u.height}px`,position:"absolute"},children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 bg-canvas-bg border-b border-border cursor-move select-none",onMouseDown:b=>{m(!0),w.current={x:b.clientX,y:b.clientY}},children:[r.jsx("h3",{className:"text-sm font-semibold text-gray-200",children:c}),r.jsx("button",{id:l?`${l}-close`:void 0,onClick:a,className:"text-gray-400 hover:text-white focus:outline-none p-1 rounded hover:bg-gray-700 transition-colors","aria-label":`Close ${c}`,children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx("div",{className:`${y?"":"p-4"} text-gray-300 ${y?"overflow-hidden":"overflow-auto"} flex-1`,children:p}),r.jsx("div",{onMouseDown:f("n"),className:"absolute top-0 left-3 right-3 h-[5px] cursor-ns-resize"}),r.jsx("div",{onMouseDown:f("s"),className:"absolute bottom-0 left-3 right-3 h-[5px] cursor-ns-resize"}),r.jsx("div",{onMouseDown:f("w"),className:"absolute left-0 top-3 bottom-3 w-[5px] cursor-ew-resize"}),r.jsx("div",{onMouseDown:f("e"),className:"absolute right-0 top-3 bottom-3 w-[5px] cursor-ew-resize"}),r.jsx("div",{onMouseDown:f("nw"),className:"absolute top-0 left-0 w-3 h-3 cursor-nwse-resize z-10"}),r.jsx("div",{onMouseDown:f("ne"),className:"absolute top-0 right-0 w-3 h-3 cursor-nesw-resize z-10"}),r.jsx("div",{onMouseDown:f("sw"),className:"absolute bottom-0 left-0 w-3 h-3 cursor-nesw-resize z-10"}),r.jsx("div",{onMouseDown:f("se"),className:"absolute bottom-0 right-0 w-3 h-3 cursor-nwse-resize z-10"}),r.jsx("div",{onMouseDown:f("se"),className:"absolute bottom-0 right-0 w-4 h-4 cursor-nwse-resize bg-gray-600 hover:bg-gray-500 transition-colors z-10","aria-label":"Resize modal",role:"separator",style:{clipPath:"polygon(100% 0, 100% 100%, 0 100%)"}})]}),qh=({isOpen:l,onClose:c,layer:a})=>{const[d,u]=g.useState(128),[y,m]=g.useState(null),[w,f]=g.useState(!1),[p,v]=g.useState(1),[b,N]=g.useState(null),[P,j]=g.useState(!0),[C,M]=g.useState(!1),D=g.useRef(null),z=g.useRef(null),q=T(Z=>Z.updateLayer),U=T(Z=>Z.project.layers),R=T(Z=>Z.cropCanvasToLayers);g.useEffect(()=>{if(!l||!a.imageData)return;const Z=setTimeout(async()=>{f(!0);try{const J=await $u(a.imageData,d,!1);m(J)}catch(J){console.error("Failed to apply transparency mask:",J)}finally{f(!1)}},100);return M(!1),()=>clearTimeout(Z)},[d,a.imageData,l]);const k=async()=>{if(a.imageData)try{const Z=await $u(a.imageData,d,P);q(a.id,{imageData:Z}),U.length===1&&setTimeout(()=>{R(),window.fitCanvasToScreen?.()},50),c()}catch(Z){console.error("Failed to apply transparency mask with palette reduction:",Z)}},F=()=>{v(Z=>Math.min(Z+.25,3))},H=()=>{v(Z=>Math.max(Z-.25,.1))},re=(Z,J)=>{if(!D.current)return 1;const A=D.current.clientWidth,X=D.current.clientHeight;if(A<=0||X<=0)return 1;const $=A/Z,ae=X/J,O=Math.min($,ae);return Math.max(.1,O*.9)},ee=()=>{v(b?re(b.width,b.height):1)},W=Z=>{const J=Z.currentTarget;N({width:J.naturalWidth,height:J.naturalHeight})};return g.useEffect(()=>{b&&D.current&&!C&&setTimeout(()=>{const Z=re(b.width,b.height);v(Z),M(!0)},100)},[b,C]),r.jsx(fo,{isOpen:l,title:"Transparency Mask",onClose:c,modalId:"modal-transparency-mask",children:r.jsxs("div",{className:"flex flex-col h-full p-4 gap-4 text-gray-200",children:[r.jsxs("div",{className:"flex-1 flex flex-col min-h-0 gap-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"text-sm font-medium",children:"Preview"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{id:"btn-tmask-zoom-out",onClick:H,disabled:p<=.1,className:"p-1 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Zoom out","aria-label":"Zoom out",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM13 10H7"})})}),r.jsxs("span",{className:"text-xs text-gray-400 min-w-[45px] text-center",children:[Math.round(p*100),"%"]}),r.jsx("button",{id:"btn-tmask-zoom-in",onClick:F,disabled:p>=3,className:"p-1 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Zoom in","aria-label":"Zoom in",children:r.jsx("svg",{className:"w-4 h-4",fill:"none",stroke:"currentColor",viewBox:"0 0 24 24",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0zM10 7v6m3-3H7"})})}),r.jsx("button",{id:"btn-tmask-zoom-reset",onClick:ee,className:"text-xs px-2 py-1 text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Reset zoom","aria-label":"Reset zoom",children:"Reset"})]})]}),r.jsxs("div",{ref:D,className:"flex-1 relative w-full bg-gray-900 rounded border border-gray-700 overflow-auto",children:[w&&r.jsx("div",{className:"absolute inset-0 flex items-center justify-center bg-black/50 z-10",children:r.jsx("span",{className:"text-white font-medium",children:"Processing..."})}),y?r.jsx("div",{style:{display:"inline-block",padding:"10px"},children:r.jsx("img",{ref:z,src:y,alt:"Preview",onLoad:W,style:{width:b?`${b.width*p}px`:"auto",height:b?`${b.height*p}px`:"auto",transition:"width 0.1s ease-out, height 0.1s ease-out",maxWidth:"none"}})}):r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-gray-500",children:"No preview available"})})]})]}),r.jsxs("div",{className:"flex flex-col gap-4 pt-4 border-t border-gray-700",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"flex justify-between text-sm",children:r.jsxs("label",{htmlFor:"input-tmask-threshold",children:["Mask Threshold: ",d]})}),r.jsx("input",{id:"input-tmask-threshold",type:"range",min:"0",max:"255",value:d,onChange:Z=>u(Number(Z.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500","aria-label":"Mask threshold"}),r.jsx("p",{className:"text-xs text-gray-400",children:"0=Opaque, 255=Transparent"})]}),r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{id:"input-tmask-template-colors",type:"checkbox",checked:P,onChange:Z=>j(Z.target.checked),className:"w-4 h-4 rounded bg-gray-700 border-gray-600 accent-blue-500 cursor-pointer","aria-label":"Use template colors"}),r.jsx("label",{htmlFor:"input-tmask-template-colors",className:"text-sm text-gray-300 cursor-pointer",children:"Use template colors"})]}),r.jsxs("div",{className:"flex space-x-2",children:[r.jsx("button",{id:"btn-tmask-cancel",onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 transition-colors","aria-label":"Cancel transparency mask",children:"Cancel"}),r.jsx("button",{id:"btn-tmask-apply",onClick:k,disabled:!y||w,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Apply transparency mask",children:"Apply"})]})]})]})]})})},Jh="modulepreload",ep=function(l){return"/"+l},Vu={},tp=function(c,a,d){let u=Promise.resolve();if(a&&a.length>0){let f=function(p){return Promise.all(p.map(v=>Promise.resolve(v).then(b=>({status:"fulfilled",value:b}),b=>({status:"rejected",reason:b}))))};document.getElementsByTagName("link");const m=document.querySelector("meta[property=csp-nonce]"),w=m?.nonce||m?.getAttribute("nonce");u=f(a.map(p=>{if(p=ep(p),p in Vu)return;Vu[p]=!0;const v=p.endsWith(".css"),b=v?'[rel="stylesheet"]':"";if(document.querySelector(`link[href="${p}"]${b}`))return;const N=document.createElement("link");if(N.rel=v?"stylesheet":Jh,v||(N.as="script"),N.crossOrigin="",N.href=p,w&&N.setAttribute("nonce",w),document.head.appendChild(N),v)return new Promise((P,j)=>{N.addEventListener("load",P),N.addEventListener("error",()=>j(new Error(`Unable to preload CSS for ${p}`)))})}))}function y(m){const w=new Event("vite:preloadError",{cancelable:!0});if(w.payload=m,window.dispatchEvent(w),!w.defaultPrevented)throw m}return u.then(m=>{for(const w of m||[])w.status==="rejected"&&y(w.reason);return c().catch(y)})};function np(l){const[c,a]=l.split(","),d=c.match(/:(.*?);/)?.[1]||"image/png",u=atob(a),y=new Uint8Array(u.length);for(let m=0;m<u.length;m++)y[m]=u.charCodeAt(m);return new Blob([y],{type:d})}function oa(l){return new Promise((c,a)=>{const d=new Image;d.onload=()=>c(d),d.onerror=a,d.src=l})}function cd(l){return l.toDataURL("image/png")}const mr=8;function rp(l,c,a){for(let d=0;d<a;d+=mr)for(let u=0;u<c;u+=mr)l.fillStyle=(u/mr+d/mr)%2===0?"#3a3a3a":"#2a2a2a",l.fillRect(u,d,mr,mr)}function op(l,c,a,d){return new Promise(async(u,y)=>{try{const m=await oa(l),w=m.naturalWidth,f=m.naturalHeight,p=document.createElement("canvas");p.width=w,p.height=f;const v=p.getContext("2d");v.drawImage(m,0,0);const b=v.getImageData(0,0,w,f),N=b.data,P=Math.round(c),j=Math.round(a);if(P<0||P>=w||j<0||j>=f){u(l);return}const C=(j*w+P)*4,M=N[C],D=N[C+1],z=N[C+2],q=new Uint8Array(w*f),U=[P,j],R=d*d;for(;U.length>0;){const k=U.pop(),F=U.pop(),H=k*w+F;if(q[H])continue;q[H]=1;const re=H*4,ee=N[re]-M,W=N[re+1]-D,Z=N[re+2]-z;ee*ee+W*W+Z*Z<=R&&(N[re+3]=0,F>0&&U.push(F-1,k),F<w-1&&U.push(F+1,k),k>0&&U.push(F,k-1),k<f-1&&U.push(F,k+1))}v.putImageData(b,0,0),u(cd(p))}catch(m){y(m)}})}async function sp(l,c,a){const d=await oa(l),u=document.createElement("canvas");u.width=c,u.height=a;const y=u.getContext("2d");y.drawImage(d,0,0);const m=y.getImageData(0,0,c,a).data,w=new Uint8Array(c*a);for(let f=0;f<w.length;f++)w[f]=m[f*4+3];return w}async function Gu(l,c,a,d){const u=await oa(l),y=document.createElement("canvas");y.width=a,y.height=d;const m=y.getContext("2d");m.drawImage(u,0,0);const w=m.getImageData(0,0,a,d);for(let f=0;f<c.length;f++)w.data[f*4+3]=c[f];return m.putImageData(w,0,0),cd(y)}const ap=({isOpen:l,onClose:c,layer:a})=>{const d=T(G=>G.updateLayer),u=T(G=>G.project.layers),y=T(G=>G.cropCanvasToLayers),[m,w]=g.useState("click"),[f,p]=g.useState(!1),[v,b]=g.useState(null),[N,P]=g.useState(null),[j,C]=g.useState(null),[M,D]=g.useState(null),[z,q]=g.useState(null),U=g.useRef(null),R=g.useRef([]),k=g.useRef([]),[F,H]=g.useState(!1),[re,ee]=g.useState(!1),W=g.useCallback(G=>{R.current.push(G),k.current=[],H(!0),ee(!1)},[]),Z=g.useCallback(()=>{if(R.current.length===0||!M)return;k.current.push(M);const G=R.current.pop();D(G),H(R.current.length>0),ee(!0)},[M]),J=g.useCallback(()=>{if(k.current.length===0||!M)return;R.current.push(M);const G=k.current.pop();D(G),ee(k.current.length>0),H(!0)},[M]),[A,X]=g.useState(30),[$,ae]=g.useState(!1),[O,oe]=g.useState(16),[_,x]=g.useState("erase"),[I,ne]=g.useState(!1),[K,de]=g.useState(1),[ue,ve]=g.useState({x:0,y:0}),[pe,Se]=g.useState(!1),Te=g.useRef({x:0,y:0,panX:0,panY:0}),[De,jt]=g.useState(null),Ge=g.useRef(null),Qe=g.useRef(null),Ct=g.useRef(null),mt=g.useRef(null),se=g.useRef(!1),Be=g.useRef(null),Re=g.useRef(null),[te,ge]=g.useState(!1),be=g.useRef([]),[xe,Ae]=g.useState("erase");g.useEffect(()=>{l&&a?.imageData&&(D(a.imageData),q(a.imageData),P(null),b(null),C(null),ae(!1),ve({x:0,y:0}),U.current=null,R.current=[],k.current=[],H(!1),ee(!1),se.current=!1)},[l,a?.imageData]),g.useEffect(()=>{if(!l)return;const G=fe=>{(fe.ctrlKey||fe.metaKey)&&!fe.altKey&&(fe.key==="z"&&!fe.shiftKey?(fe.preventDefault(),fe.stopPropagation(),Z()):(fe.key==="z"&&fe.shiftKey||fe.key==="y")&&(fe.preventDefault(),fe.stopPropagation(),J()))};return window.addEventListener("keydown",G,!0),()=>window.removeEventListener("keydown",G,!0)},[l,Z,J]);const He=g.useCallback(async()=>{const G=Qe.current;if(!(!G||!M))try{const fe=await oa(M),Ne=fe.naturalWidth,Fe=fe.naturalHeight;G.width=Ne,G.height=Fe,jt({w:Ne,h:Fe});const ze=G.getContext("2d");rp(ze,Ne,Fe),ze.drawImage(fe,0,0)}catch{}},[M]);g.useEffect(()=>{He()},[He]),g.useEffect(()=>{M&&De&&sp(M,De.w,De.h).then(G=>{U.current=G})},[M,De]),g.useEffect(()=>{m!=="brush"&&Be.current&&(Be.current.style.display="none")},[m]),g.useEffect(()=>{if(De&&Ge.current&&!se.current){const G=Ge.current.clientWidth,fe=Ge.current.clientHeight;if(G>0&&fe>0){const Ne=Math.max(.05,Math.min(G/De.w,fe/De.h)*.9);de(Ne),ve({x:(G-De.w*Ne)/2,y:(fe-De.h*Ne)/2}),se.current=!0}}},[De]);const at=async()=>{if(M){p(!0),P(null),b("Loading AI model (first run downloads ~40 MB)..."),C(0);try{const{removeBackground:G}=await tp(async()=>{const{removeBackground:ze}=await import("./index-CqpL_VU9.js");return{removeBackground:ze}},[]);b("Processing image...");const fe=np(M);W(M);const Ne=await G(fe,{model:"isnet_quint8",output:{format:"image/png",quality:1},progress:(ze,$e,Ye)=>{if(Ye>0){const Ze=Math.round($e/Ye*100);C(Ze),ze.includes("onnx")||ze.includes("model")?b(`Downloading model... ${Ze}%`):b(`Processing... ${Ze}%`)}}}),Fe=new FileReader;Fe.onload=()=>{D(Fe.result),b(null),C(null),p(!1)},Fe.readAsDataURL(Ne)}catch(G){console.error("AI BG removal failed:",G),P(`AI background removal failed to load: ${G?.message||"Unknown error"}. Try the Click or Brush tools instead.`),b(null),C(null),p(!1)}}},ut=async()=>{if(M){p(!0),P(null),b("Processing...");try{W(M);const G=await jh(M,A,$);D(G)}catch(G){P(`Corner flood-fill failed: ${G?.message||"Unknown error"}`)}finally{p(!1),b(null)}}},xt=async G=>{if(m!=="click"||f||!M||!Qe.current)return;const fe=Qe.current.getBoundingClientRect(),Ne=Qe.current.width/fe.width,Fe=Qe.current.height/fe.height,ze=(G.clientX-fe.left)*Ne,$e=(G.clientY-fe.top)*Fe;p(!0),b("Removing region...");try{W(M);const Ye=await op(M,ze,$e,A);D(Ye)}catch(Ye){P(`Click removal failed: ${Ye?.message||"Unknown error"}`)}finally{p(!1),b(null)}},lt=G=>{const fe=Qe.current;if(!fe)return null;const Ne=fe.getBoundingClientRect(),Fe=fe.width/Ne.width,ze=fe.height/Ne.height;return{x:(G.clientX-Ne.left)*Fe,y:(G.clientY-Ne.top)*ze}},Et=(G,fe,Ne,Fe,ze,$e)=>{const Ye=O/2,Ze=Ye*Ye,ft=Math.max(0,Math.floor(G-Ye)),Ke=Math.max(0,Math.floor(fe-Ye)),Ue=Math.min(Fe-1,Math.ceil(G+Ye)),pt=Math.min(ze-1,Math.ceil(fe+Ye));for(let vt=Ke;vt<=pt;vt++)for(let nt=ft;nt<=Ue;nt++){const St=nt-G,Rt=vt-fe;St*St+Rt*Rt<=Ze&&(Ne[vt*Fe+nt]=$e)}return{x0:ft,y0:Ke,x1:Ue,y1:pt}},yt=(G,fe,Ne,Fe)=>{const ze=Qe.current,$e=U.current,Ye=Re.current;if(!ze||!$e||!Ye||!De)return;const{w:Ze}=De,ft=ze.getContext("2d"),Ke=Ye.data,Ue=Ne-G+1,pt=Fe-fe+1,vt=ft.getImageData(G,fe,Ue,pt),nt=vt.data;for(let St=0;St<pt;St++){const Rt=fe+St,Je=Rt*Ze;for(let qt=0;qt<Ue;qt++){const Pn=G+qt,Ve=$e[Je+Pn],Wt=(St*Ue+qt)*4;if(Ve===0){const Ln=(Math.floor(Pn/mr)+Math.floor(Rt/mr))%2===0?58:42;nt[Wt]=Ln,nt[Wt+1]=Ln,nt[Wt+2]=Ln,nt[Wt+3]=255}else{const Dn=(Rt*Ze+Pn)*4;nt[Wt]=Ke[Dn],nt[Wt+1]=Ke[Dn+1],nt[Wt+2]=Ke[Dn+2],nt[Wt+3]=255}}}ft.putImageData(vt,G,fe)},sn=(G,fe)=>{const Ne=U.current;if(!Ne||!De)return;const{w:Fe,h:ze}=De,$e=_==="erase"?0:255,{x0:Ye,y0:Ze,x1:ft,y1:Ke}=Et(G,fe,Ne,Fe,ze,$e);yt(Ye,Ze,ft,Ke)},Mt=(G,fe)=>{const Ne=U.current;if(!Ne||!De)return;const{w:Fe,h:ze}=De,$e=_==="erase"?0:255,Ye=fe.x-G.x,Ze=fe.y-G.y,ft=Math.sqrt(Ye*Ye+Ze*Ze),Ke=Math.max(1,O/4),Ue=Math.ceil(ft/Ke);let pt=1/0,vt=1/0,nt=-1/0,St=-1/0;for(let Rt=0;Rt<=Ue;Rt++){const Je=Ue===0?0:Rt/Ue,qt=Et(G.x+Ye*Je,G.y+Ze*Je,Ne,Fe,ze,$e);pt=Math.min(pt,qt.x0),vt=Math.min(vt,qt.y0),nt=Math.max(nt,qt.x1),St=Math.max(St,qt.y1)}pt<=nt&&vt<=St&&yt(pt,vt,nt,St)};g.useEffect(()=>{if(z){const G=new Image;G.onload=()=>{window.__bgRemovalOrigImg=G;const fe=document.createElement("canvas");fe.width=G.naturalWidth,fe.height=G.naturalHeight;const Ne=fe.getContext("2d");Ne.drawImage(G,0,0),Re.current=Ne.getImageData(0,0,G.naturalWidth,G.naturalHeight)},G.src=z}return()=>{delete window.__bgRemovalOrigImg,Re.current=null}},[z]);const Pt=G=>{if(m!=="brush"||f||G.button!==0)return;G.preventDefault();const fe=lt(G);fe&&(ne(!0),mt.current=fe,sn(fe.x,fe.y))},Cn=G=>{if(!I||m!=="brush")return;const fe=lt(G);fe&&(mt.current&&Mt(mt.current,fe),mt.current=fe)},Bt=()=>{I&&m==="brush"&&dt(),ne(!1),mt.current=null},dt=async()=>{const G=U.current;if(!G||!z||!De||!M)return;W(M);const fe=await Gu(z,G,De.w,De.h);D(fe)},xr=()=>{const G=Ct.current,fe=Qe.current;if(!G||!fe)return;G.width=fe.width,G.height=fe.height;const Ne=G.getContext("2d");Ne.clearRect(0,0,G.width,G.height);const Fe=be.current;if(!(Fe.length<2)){Ne.beginPath(),Ne.moveTo(Fe[0].x,Fe[0].y);for(let ze=1;ze<Fe.length;ze++)Ne.lineTo(Fe[ze].x,Fe[ze].y);Ne.lineTo(Fe[0].x,Fe[0].y),Ne.fillStyle=xe==="erase"?"rgba(255, 0, 0, 0.15)":"rgba(0, 255, 0, 0.15)",Ne.fill(),Ne.strokeStyle=xe==="erase"?"rgba(255, 80, 80, 0.9)":"rgba(80, 255, 80, 0.9)",Ne.lineWidth=2,Ne.setLineDash([6,4]),Ne.stroke()}},Kt=G=>{if(m!=="lasso"||f||G.button!==0)return;G.preventDefault();const fe=lt(G);fe&&(ge(!0),be.current=[fe])},Tn=G=>{if(!te||m!=="lasso")return;const fe=lt(G);fe&&(be.current.push(fe),xr())},an=async()=>{if(!te||m!=="lasso")return;ge(!1);const G=be.current;if(G.length<3||!De||!M||!z){be.current=[];const Ue=Ct.current;if(Ue){const pt=Ue.getContext("2d");pt&&pt.clearRect(0,0,Ue.width,Ue.height)}return}const{w:fe,h:Ne}=De,Fe=U.current;if(!Fe)return;const ze=document.createElement("canvas");ze.width=fe,ze.height=Ne;const $e=ze.getContext("2d");$e.beginPath(),$e.moveTo(G[0].x,G[0].y);for(let Ue=1;Ue<G.length;Ue++)$e.lineTo(G[Ue].x,G[Ue].y);$e.closePath(),$e.fillStyle="#fff",$e.fill();const Ye=$e.getImageData(0,0,fe,Ne).data,Ze=xe==="erase"?0:255;for(let Ue=0;Ue<fe*Ne;Ue++)Ye[Ue*4+3]>0&&(Fe[Ue]=Ze);W(M);const ft=await Gu(z,Fe,fe,Ne);D(ft),be.current=[];const Ke=Ct.current;if(Ke){const Ue=Ke.getContext("2d");Ue&&Ue.clearRect(0,0,Ke.width,Ke.height)}},En=G=>{G.preventDefault();const fe=Ge.current;if(!fe)return;const Ne=fe.getBoundingClientRect(),Fe=G.clientX-Ne.left,ze=G.clientY-Ne.top,$e=G.deltaY>0?1/1.12:1.12;de(Ye=>{const Ze=Math.max(.05,Math.min(10,Ye*$e)),ft=Ze/Ye;return ve(Ke=>({x:Fe-ft*(Fe-Ke.x),y:ze-ft*(ze-Ke.y)})),Ze})},ln=G=>{(G.button===1||G.button===2)&&(G.preventDefault(),Se(!0),Te.current={x:G.clientX,y:G.clientY,panX:ue.x,panY:ue.y})},Zn=G=>{if(!pe)return;const fe=G.clientX-Te.current.x,Ne=G.clientY-Te.current.y;ve({x:Te.current.panX+fe,y:Te.current.panY+Ne})},Qt=()=>{Se(!1)},yr=G=>{if(G.button===1||G.button===2){ln(G);return}m==="brush"&&Pt(G),m==="lasso"&&Kt(G)},yn=G=>{if(pe){Zn(G);return}m==="brush"&&I&&Cn(G),m==="lasso"&&te&&Tn(G)},_n=()=>{if(pe){Qt();return}m==="brush"&&Bt(),m==="lasso"&&an()},Mn=()=>{!M||M===z||(d(a.id,{imageData:M}),u.length===1&&setTimeout(()=>{y(),window.fitCanvasToScreen?.()},50),c())},An=()=>{z&&M&&(W(M),D(z),P(null),b(null),U.current=null)},cn=()=>pe?"cursor-grabbing":m==="click"?"cursor-crosshair":m==="brush"?"cursor-none":m==="lasso"?"cursor-crosshair":"cursor-default";return r.jsx(fo,{isOpen:l,title:"Background Removal",onClose:c,modalId:"modal-bg-removal",children:r.jsxs("div",{className:"flex flex-col h-full text-gray-200",children:[r.jsx("div",{className:"flex border-b border-gray-700 bg-gray-800/50",children:[{key:"click",label:"Click Remove"},{key:"lasso",label:"Lasso"},{key:"brush",label:"Brush Refine"},{key:"ai",label:"AI Auto"}].map(({key:G,label:fe})=>r.jsx("button",{onClick:()=>w(G),className:`flex-1 px-3 py-2.5 text-xs font-medium transition-colors border-b-2 ${m===G?"border-blue-500 text-blue-400 bg-gray-700/50":"border-transparent text-gray-400 hover:text-gray-200 hover:bg-gray-700/30"}`,children:fe},G))}),N&&r.jsxs("div",{className:"px-4 py-2 bg-red-900/40 border-b border-red-700 text-xs text-red-300 flex items-start gap-2",children:[r.jsx("span",{className:"font-bold text-red-400 mt-px",children:"!"}),r.jsx("span",{className:"flex-1",children:N}),r.jsx("button",{onClick:()=>P(null),className:"text-red-400 hover:text-red-200 shrink-0",children:""})]}),r.jsxs("div",{className:"flex-1 min-h-0 relative",children:[(f||v)&&r.jsxs("div",{className:"absolute inset-0 z-20 flex flex-col items-center justify-center bg-black/60 gap-3",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-5 h-5 border-2 border-blue-500 border-t-transparent rounded-full animate-spin"}),r.jsx("span",{className:"text-sm font-medium text-white",children:v||"Processing..."})]}),j!==null&&j<100&&r.jsx("div",{className:"w-48 h-2 bg-gray-700 rounded-full overflow-hidden",children:r.jsx("div",{className:"h-full bg-blue-500 transition-all duration-300",style:{width:`${j}%`}})})]}),r.jsxs("div",{ref:Ge,className:"w-full h-full overflow-hidden bg-gray-900 relative",onWheel:En,onMouseDown:ln,onMouseMove:G=>{if(Zn(G),m==="brush"&&Ge.current&&Be.current){const fe=Ge.current.getBoundingClientRect(),Ne=G.clientX-fe.left,Fe=G.clientY-fe.top,ze=O*K,$e=Be.current;$e.style.left=`${Ne-ze/2}px`,$e.style.top=`${Fe-ze/2}px`,$e.style.width=`${ze}px`,$e.style.height=`${ze}px`,$e.style.display="block"}},onMouseUp:Qt,onMouseLeave:()=>{Qt(),Be.current&&(Be.current.style.display="none")},onContextMenu:G=>G.preventDefault(),children:[r.jsxs("div",{style:{transform:`translate(${ue.x}px, ${ue.y}px) scale(${K})`,transformOrigin:"0 0",display:"inline-block",position:"relative"},children:[r.jsx("canvas",{ref:Qe,className:cn(),onClick:m==="click"&&!f?xt:void 0,onMouseDown:yr,onMouseMove:yn,onMouseUp:_n,onMouseLeave:_n,style:{display:"block",imageRendering:K>2?"pixelated":"auto"}}),r.jsx("canvas",{ref:Ct,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",pointerEvents:"none",imageRendering:K>2?"pixelated":"auto"}})]}),r.jsx("div",{ref:Be,style:{position:"absolute",display:"none",border:"1.5px solid rgba(255, 255, 255, 0.8)",borderRadius:"50%",pointerEvents:"none",zIndex:10,boxShadow:"0 0 0 1px rgba(0, 0, 0, 0.5)",willChange:"left, top, width, height"}})]})]}),r.jsxs("div",{className:"border-t border-gray-700 px-4 py-3 space-y-3",children:[r.jsxs("div",{className:"flex items-center gap-2 text-xs",children:[r.jsx("button",{onClick:()=>de(G=>Math.max(.05,G-.25)),className:"px-1.5 py-0.5 text-gray-400 hover:text-white bg-gray-700 rounded",children:""}),r.jsxs("span",{className:"text-gray-400 min-w-[40px] text-center",children:[Math.round(K*100),"%"]}),r.jsx("button",{onClick:()=>de(G=>Math.min(10,G+.25)),className:"px-1.5 py-0.5 text-gray-400 hover:text-white bg-gray-700 rounded",children:"+"}),r.jsx("button",{onClick:()=>{if(De&&Ge.current){const G=Math.min(Ge.current.clientWidth/De.w,Ge.current.clientHeight/De.h)*.9;de(Math.max(.05,G)),ve({x:0,y:0})}},className:"text-gray-400 hover:text-white bg-gray-700 rounded px-2 py-0.5",children:"Fit"}),r.jsx("span",{className:"text-gray-500 ml-1",children:"Middle-click to pan, scroll to zoom"})]}),m==="ai"&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-400",children:"Uses a neural network to automatically detect and remove the background. The model (~40 MB) downloads on first use and is cached by the browser."}),r.jsx("button",{onClick:at,disabled:f,className:"w-full px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:f?"Processing...":"Remove Background (AI)"})]}),m==="click"&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-400",children:"Click on any region to flood-fill remove it. Adjust tolerance to control how aggressively similar colors are erased."}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:["Tolerance: ",A]}),r.jsx("input",{type:"range",min:"1",max:"255",value:A,onChange:G=>X(Number(G.target.value)),className:"flex-1 h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"})]}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("button",{onClick:ut,disabled:f,className:"px-3 py-1.5 text-xs font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-50 transition-colors",children:"Auto-Remove from Corners"}),r.jsxs("label",{className:"flex items-center gap-1.5 text-xs text-gray-400 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:$,onChange:G=>ae(G.target.checked),className:"w-3.5 h-3.5 rounded bg-gray-700 border-gray-600 accent-blue-500"}),"Heatmap"]})]})]}),m==="lasso"&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-400",children:"Draw a freehand selection around an area to erase or restore it. The region fills when you release the mouse."}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex rounded overflow-hidden border border-gray-600",children:[r.jsx("button",{onClick:()=>Ae("erase"),className:`px-3 py-1.5 text-xs font-medium transition-colors ${xe==="erase"?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Erase"}),r.jsx("button",{onClick:()=>Ae("restore"),className:`px-3 py-1.5 text-xs font-medium transition-colors ${xe==="restore"?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Restore"})]}),r.jsx("span",{className:"text-xs text-gray-500",children:"Draw around an area, then release to apply"})]})]}),m==="brush"&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("p",{className:"text-xs text-gray-400",children:"Paint over areas to erase or restore them. Use after AI or Click removal to refine edges."}),r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsxs("div",{className:"flex rounded overflow-hidden border border-gray-600",children:[r.jsx("button",{onClick:()=>x("erase"),className:`px-3 py-1.5 text-xs font-medium transition-colors ${_==="erase"?"bg-red-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Erase"}),r.jsx("button",{onClick:()=>x("restore"),className:`px-3 py-1.5 text-xs font-medium transition-colors ${_==="restore"?"bg-green-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:"Restore"})]}),r.jsxs("label",{className:"text-xs text-gray-400 whitespace-nowrap",children:["Size: ",O,"px"]}),r.jsx("input",{type:"range",min:"1",max:"100",value:O,onChange:G=>oe(Number(G.target.value)),className:"flex-1 h-1.5 bg-gray-700 rounded-lg appearance-none cursor-pointer accent-blue-500"})]})]}),r.jsxs("div",{className:"flex items-center justify-between pt-1",children:[r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:An,disabled:f||M===z,className:"px-3 py-1.5 text-xs font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-30 transition-colors",children:"Reset"}),r.jsx("button",{onClick:Z,disabled:f||!F,className:"px-2.5 py-1.5 text-xs font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-30 transition-colors",title:"Undo (Ctrl+Z)",children:"Undo"}),r.jsx("button",{onClick:J,disabled:f||!re,className:"px-2.5 py-1.5 text-xs font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 disabled:opacity-30 transition-colors",title:"Redo (Ctrl+Y / Ctrl+Shift+Z)",children:"Redo"})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 transition-colors",children:"Cancel"}),r.jsx("button",{onClick:Mn,disabled:f||M===z,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors",children:"Apply"})]})]})]})]})})},lp=({isOpen:l,onClose:c,imageDataUrl:a,onAddColors:d})=>{const u=g.useRef(null),y=g.useRef(null),m=g.useRef(null),w=Rr(),[f,p]=g.useState([]),[v,b]=g.useState(null),[N,P]=g.useState({x:0,y:0}),[j,C]=g.useState(1),[M,D]=g.useState({x:0,y:0}),[z,q]=g.useState(!1),[U,R]=g.useState({x:0,y:0}),[k,F]=g.useState(!1),[H,re]=g.useState({w:0,h:0});g.useEffect(()=>{if(!l||!a)return;const _=new Image;_.onload=()=>{m.current=_,re({w:_.naturalWidth,h:_.naturalHeight}),F(!0),p([]),C(1),D({x:0,y:0})},_.src=a},[l,a]),g.useEffect(()=>{if(!k||!y.current)return;const _=y.current.clientWidth-40,x=y.current.clientHeight-40;if(_<=0||x<=0||H.w<=0||H.h<=0)return;const I=Math.min(_/H.w,x/H.h,4);C(I)},[k,H]);const ee=g.useCallback(()=>{const _=u.current,x=y.current,I=m.current;if(!_||!x||!I||!k)return;_.width=x.clientWidth,_.height=x.clientHeight;const ne=_.getContext("2d");if(!ne)return;ne.imageSmoothingEnabled=!1,ne.clearRect(0,0,_.width,_.height);const K=8,de=document.createElement("canvas");de.width=K*2,de.height=K*2;const ue=de.getContext("2d");ue.fillStyle="#3a3a3a",ue.fillRect(0,0,K*2,K*2),ue.fillStyle="#2a2a2a",ue.fillRect(0,0,K,K),ue.fillRect(K,K,K,K);const ve=H.w*j,pe=H.h*j,Se=(_.width-ve)/2+M.x,Te=(_.height-pe)/2+M.y;ne.save(),ne.beginPath(),ne.rect(Se,Te,ve,pe),ne.clip();const De=ne.createPattern(de,"repeat");De&&(ne.fillStyle=De,ne.fillRect(Se,Te,ve,pe)),ne.restore(),ne.drawImage(I,Se,Te,ve,pe)},[k,H,j,M]);g.useEffect(()=>{ee()},[ee]),g.useEffect(()=>{const _=y.current;if(!_)return;const x=new ResizeObserver(()=>ee());return x.observe(_),()=>x.disconnect()},[ee]);const W=g.useRef(null),Z=g.useRef({w:0,h:0});g.useEffect(()=>{if(!k||!m.current)return;const _=m.current,x=document.createElement("canvas");x.width=_.naturalWidth,x.height=_.naturalHeight;const I=x.getContext("2d");I.drawImage(_,0,0),W.current=I.getImageData(0,0,x.width,x.height),Z.current={w:x.width,h:x.height}},[k,a]);const J=g.useCallback((_,x)=>{const I=u.current;if(!I||!k||!W.current)return null;const ne=I.getBoundingClientRect(),K=_-ne.left,de=x-ne.top,ue=H.w*j,ve=H.h*j,pe=(I.width-ue)/2+M.x,Se=(I.height-ve)/2+M.y;if(K<pe||K>=pe+ue||de<Se||de>=Se+ve)return null;const Te=Math.floor((K-pe)/j),De=Math.floor((de-Se)/j),jt=W.current,Ge=Z.current.w;if(Te<0||Te>=Ge||De<0||De>=Z.current.h)return null;const Qe=(De*Ge+Te)*4,Ct=jt.data[Qe],mt=jt.data[Qe+1],se=jt.data[Qe+2];return"#"+[Ct,mt,se].map(Be=>Be.toString(16).padStart(2,"0")).join("").toUpperCase()},[k,H,j,M]),A=_=>{if(P({x:_.clientX,y:_.clientY}),z){const I=_.clientX-U.x,ne=_.clientY-U.y;D(K=>({x:K.x+I,y:K.y+ne})),R({x:_.clientX,y:_.clientY}),b(null);return}const x=J(_.clientX,_.clientY);b(x)},X=_=>{if(_.button===1||_.button===2){_.preventDefault(),q(!0),R({x:_.clientX,y:_.clientY});return}if(_.button===0){const x=J(_.clientX,_.clientY);x&&!f.includes(x)&&p(I=>[...I,x])}},$=()=>{q(!1)},ae=_=>{_.preventDefault();const x=_.deltaY>0?-1:1;C(I=>{const ne=x>0?I*1.2:I/1.2;return Math.max(.1,Math.min(50,ne))})},O=_=>{p(x=>x.filter(I=>I!==_))},oe=()=>{d(f),c()};return l?r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",onClick:_=>{_.target===_.currentTarget&&c()},children:[r.jsx("div",{className:"absolute inset-0 bg-black/80"}),r.jsxs("div",{className:"relative z-10 bg-gray-800 border border-gray-600 rounded-lg shadow-2xl flex flex-col overflow-hidden",style:{width:"90vw",height:"85vh",maxWidth:"1400px"},children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-900 border-b border-gray-700 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-sm font-semibold text-white",children:" Eyedropper  Pick Colors from Image"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Click to pick  Scroll to zoom  Middle-drag to pan"})]}),r.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white text-lg px-2","aria-label":"Close eyedropper",children:""})]}),r.jsxs("div",{className:`${w?"flex flex-col":"flex"} flex-1 overflow-hidden`,children:[r.jsxs("div",{ref:y,className:"flex-1 relative overflow-hidden bg-gray-950 cursor-crosshair",children:[r.jsx("canvas",{ref:u,className:"absolute inset-0",onMouseMove:A,onMouseDown:X,onMouseUp:$,onMouseLeave:()=>{q(!1),b(null)},onWheel:ae,onContextMenu:_=>_.preventDefault()}),r.jsxs("div",{className:"absolute top-3 left-3 bg-gray-900/80 border border-gray-700 rounded px-2 py-1 text-xs text-gray-300 pointer-events-none",children:[Math.round(j*100),"%"]}),v&&!z&&r.jsxs("div",{style:{position:"fixed",left:N.x+20,top:N.y+20,zIndex:99999,pointerEvents:"none"},className:"bg-gray-900 border border-gray-600 rounded-lg p-2 shadow-xl flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded border border-gray-500 flex-shrink-0",style:{backgroundColor:v}}),r.jsx("span",{className:"font-mono text-sm text-white font-bold",children:v})]})]}),r.jsxs("div",{className:`${w?"h-48 border-t w-full":"w-56 border-l"} border-gray-700 flex flex-col bg-gray-800 flex-shrink-0`,children:[r.jsx("div",{className:"px-3 py-2 border-b border-gray-700",children:r.jsxs("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:["Picked Colors (",f.length,")"]})}),r.jsx("div",{className:`flex-1 overflow-y-auto p-2 ${w?"flex flex-wrap gap-1":"space-y-1"}`,children:f.length===0?r.jsx("div",{className:"text-xs text-gray-500 text-center py-4 w-full",children:"Click on the image to pick colors"}):f.map((_,x)=>r.jsxs("div",{className:`flex items-center gap-2 bg-gray-900 rounded px-2 py-1.5 group ${w?"flex-shrink-0":""}`,children:[r.jsx("div",{className:"w-6 h-6 rounded border border-gray-600 flex-shrink-0",style:{backgroundColor:_}}),r.jsx("span",{className:"font-mono text-xs text-white flex-1",children:_}),r.jsx("button",{onClick:()=>O(_),className:"text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity text-sm","aria-label":`Remove ${_}`,children:""})]},x))}),r.jsxs("div",{className:`${w?"flex items-center gap-2 p-2":"p-3 space-y-2"} border-t border-gray-700 flex-shrink-0`,children:[r.jsx("button",{onClick:oe,disabled:f.length===0,className:`${w?"flex-1":"w-full"} px-3 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm font-semibold rounded transition-colors`,children:"Add Colors to Palette"}),r.jsx("button",{onClick:()=>p([]),disabled:f.length===0,className:`${w?"flex-shrink-0":"w-full"} px-3 py-1.5 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-300 text-xs rounded transition-colors`,children:"Clear All"})]})]})]})]})]}):null},ip="https://geopixels.net/GetUserProfile";function cp(l){return"#"+Math.max(0,Math.min(16777215,l)).toString(16).padStart(6,"0").toUpperCase()}function up(l){return l.toLocaleString()}const dp=({isOpen:l,onClose:c,onAddColors:a})=>{const[d,u]=g.useState(""),[y,m]=g.useState(!1),[w,f]=g.useState(null),[p,v]=g.useState(null),[b,N]=g.useState([]),[P,j]=g.useState(null),[C,M]=g.useState(null),D=g.useCallback(async()=>{const U=parseInt(d.trim()||"3228",10);if(isNaN(U)||U<=0){f("Please enter a valid user ID (positive integer).");return}m(!0),f(null),v(null),N([]);try{const R=await fetch(ip,{method:"POST",headers:{"Content-Type":"application/json"},body:JSON.stringify({targetId:U})});if(!R.ok)throw new Error(`API returned ${R.status}: ${R.statusText}`);const k=await R.json();if(!k.name)throw new Error("User not found or invalid response.");if(v(k),k.colors&&typeof k.colors=="string"){const F=k.colors.split(",").map(ee=>ee.trim()).filter(ee=>ee!=="").map(ee=>parseInt(ee,10)).filter(ee=>!isNaN(ee)),H=new Set,re=[];for(const ee of F){const W=cp(ee);H.has(W)||(H.add(W),re.push(W))}N(re)}}catch(R){f(R.message||"Failed to fetch user profile.")}finally{m(!1)}},[d]),z=()=>{b.length>0&&(a(b),c())},q=U=>{U.key==="Enter"&&D()};return l?r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:c}),r.jsxs("div",{className:"relative bg-gray-800 border border-gray-600 rounded-lg shadow-2xl w-full max-w-lg max-h-[85vh] flex flex-col overflow-hidden",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-900 border-b border-gray-700 flex-shrink-0",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-200",children:" GeoPixels  Get Your Owned Colors"}),r.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white text-lg leading-none px-1",title:"Close",children:""})]}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-4 space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs text-gray-400 block",children:"Enter your GeoPixels User ID to fetch your owned color palette."}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"text",inputMode:"numeric",value:d,onChange:U=>u(U.target.value),onKeyDown:q,placeholder:"3228",className:"flex-1 bg-gray-900 border border-gray-600 rounded px-3 py-2 text-sm text-gray-200 placeholder-gray-500 focus:border-blue-500 focus:outline-none",autoFocus:!0}),r.jsx("button",{onClick:D,disabled:y,className:"px-4 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm font-medium rounded transition-colors flex items-center gap-2",children:y?r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-3 h-3 border-2 border-white/30 border-t-white rounded-full animate-spin"}),"Fetching..."]}):"Fetch"})]}),r.jsxs("p",{className:"text-xs text-gray-500",children:["Find your ID on ",r.jsx("a",{href:"https://geopixels.net",target:"_blank",rel:"noopener noreferrer",className:"text-blue-400 hover:underline",children:"geopixels.net"}),"  it's shown in your profile URL."]})]}),w&&r.jsx("div",{className:"bg-red-900/30 border border-red-700 rounded p-3 text-xs text-red-300",children:w}),p&&r.jsxs("div",{className:"space-y-4",children:[r.jsxs("div",{className:"bg-gray-900 border border-gray-700 rounded-lg p-4 space-y-3",children:[r.jsxs("div",{className:"flex items-start justify-between",children:[r.jsxs("div",{children:[r.jsx("h3",{className:"text-base font-bold text-white",children:p.name}),r.jsxs("div",{className:"text-xs text-gray-400 mt-0.5",children:["ID: ",p.id]})]}),r.jsxs("div",{className:"text-right",children:[r.jsxs("div",{className:"text-sm font-semibold text-yellow-400",children:["Level ",p.level]}),r.jsxs("div",{className:"text-xs text-gray-500",children:[up(p.experience)," XP"]})]})]}),r.jsxs("div",{className:"flex gap-3 flex-wrap",children:[r.jsxs("span",{className:"text-xs bg-gray-800 border border-gray-600 rounded px-2 py-0.5 text-gray-300",children:["Profile Lvl ",p.profileLevel]}),r.jsxs("span",{className:"text-xs bg-gray-800 border border-gray-600 rounded px-2 py-0.5 text-gray-300",children:["Banners Lvl ",p.bannersLevel]}),p.moderator&&r.jsx("span",{className:"text-xs bg-red-900 border border-red-700 rounded px-2 py-0.5 text-red-300 font-semibold",children:" Moderator"}),p.isGuildOwner&&r.jsx("span",{className:"text-xs bg-amber-900 border border-amber-700 rounded px-2 py-0.5 text-amber-300 font-semibold",children:" Guild Owner"})]}),(p.discordUser||p.xUser||p.redditUser)&&r.jsxs("div",{className:"flex gap-3 flex-wrap text-xs text-gray-400",children:[p.discordUser&&r.jsxs("span",{title:"Discord",children:[" ",p.discordUser]}),p.xUser&&r.jsxs("span",{title:"X / Twitter",children:[" @",p.xUser]}),p.redditUser&&r.jsxs("span",{title:"Reddit",children:[" u/",p.redditUser]})]})]}),b.length>0&&r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("h4",{className:"text-xs font-semibold text-gray-400 uppercase",children:["Owned Colors ",r.jsxs("span",{className:"text-gray-500 font-normal",children:["(",b.length," unique)"]})]}),r.jsx("button",{onClick:()=>navigator.clipboard.writeText(b.join(", ")),className:"text-gray-400 hover:text-white p-1 rounded hover:bg-gray-700 transition-colors",title:"Copy hex palette to clipboard",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m2 4h3a2 2 0 012 2v3m-3-3V5a2 2 0 012-2h3.071a2 2 0 011.414.586l1.414 1.414A2 2 0 0118 6.414V9m-3-3h3"})})})]}),r.jsx("div",{className:"flex flex-wrap gap-0 bg-gray-900 p-1.5 rounded border border-gray-700",children:b.map((U,R)=>r.jsx("div",{className:"w-5 h-5 cursor-crosshair hover:z-10 hover:scale-150 transition-transform duration-75 border border-transparent hover:border-white",style:{backgroundColor:U},title:U,onMouseEnter:k=>{j(U),M({x:k.clientX,y:k.clientY})},onMouseLeave:()=>{j(null),M(null)},onMouseMove:k=>{M({x:k.clientX,y:k.clientY})}},R))}),P&&C&&r.jsx("div",{style:{position:"fixed",left:C.x+15,top:C.y+15,zIndex:99999,pointerEvents:"none"},className:"bg-gray-900 border border-gray-600 rounded p-2 shadow-xl text-xs min-w-[100px]",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("div",{className:"w-4 h-4 border border-gray-500 rounded-sm",style:{backgroundColor:P}}),r.jsx("span",{className:"font-mono font-bold text-white",children:P})]})}),r.jsxs("button",{onClick:z,className:"w-full px-4 py-2.5 bg-teal-600 hover:bg-teal-500 text-white text-sm font-semibold rounded transition-colors flex items-center justify-center gap-2",children:[r.jsx("span",{children:""}),"Add Palette to Pixelator"]})]})]})]})]})]}):null},fp=({isOpen:l,onClose:c,imageDataUrl:a,onAddColors:d})=>{const u=g.useRef(null),y=g.useRef(null),m=g.useRef(null),w=Rr(),[f,p]=g.useState(1),[v,b]=g.useState({x:0,y:0}),[N,P]=g.useState(!1),[j,C]=g.useState({x:0,y:0}),[M,D]=g.useState(!1),[z,q]=g.useState({w:0,h:0}),[U,R]=g.useState(null),[k,F]=g.useState({x:0,y:0}),[H,re]=g.useState(!1),[ee,W]=g.useState(null),[Z,J]=g.useState(null),[A,X]=g.useState([]),[$,ae]=g.useState(10),[O,oe]=g.useState([]),_=g.useRef(null),x=g.useRef({w:0,h:0});g.useEffect(()=>{if(!l||!a)return;const te=new Image;te.onload=()=>{m.current=te,q({w:te.naturalWidth,h:te.naturalHeight}),D(!0),p(1),b({x:0,y:0}),X([]),oe([]),W(null),J(null)},te.src=a},[l,a]),g.useEffect(()=>{if(!M||!y.current)return;const te=y.current.clientWidth-40,ge=y.current.clientHeight-40;if(te<=0||ge<=0||z.w<=0||z.h<=0)return;const be=Math.min(te/z.w,ge/z.h,4);p(be)},[M,z]),g.useEffect(()=>{if(!M||!m.current)return;const te=m.current,ge=document.createElement("canvas");ge.width=te.naturalWidth,ge.height=te.naturalHeight;const be=ge.getContext("2d");be.drawImage(te,0,0),_.current=be.getImageData(0,0,ge.width,ge.height),x.current={w:ge.width,h:ge.height}},[M,a]);const I=g.useCallback(()=>{const te=u.current;if(!te)return{ox:0,oy:0,drawW:0,drawH:0};const ge=z.w*f,be=z.h*f,xe=(te.width-ge)/2+v.x,Ae=(te.height-be)/2+v.y;return{ox:xe,oy:Ae,drawW:ge,drawH:be}},[z,f,v]),ne=g.useCallback((te,ge)=>{const be=u.current;if(!be||!M)return null;const xe=be.getBoundingClientRect(),Ae=te-xe.left,He=ge-xe.top,{ox:at,oy:ut,drawW:xt,drawH:lt}=I();return Ae<at||Ae>=at+xt||He<ut||He>=ut+lt?null:{x:Math.floor((Ae-at)/f),y:Math.floor((He-ut)/f)}},[M,f,I]),K=g.useCallback((te,ge)=>{const be=_.current;if(!be)return null;const xe=x.current.w,Ae=x.current.h;if(te<0||te>=xe||ge<0||ge>=Ae)return null;const He=(ge*xe+te)*4,at=be.data[He],ut=be.data[He+1],xt=be.data[He+2];return"#"+[at,ut,xt].map(lt=>lt.toString(16).padStart(2,"0")).join("").toUpperCase()},[]),de=g.useCallback((te,ge)=>{const be=ne(te,ge);return be?K(be.x,be.y):null},[ne,K]),ue=g.useCallback((te,ge,be,xe)=>{const Ae=[];let He=Math.abs(be-te),at=Math.abs(xe-ge);const ut=te<be?1:-1,xt=ge<xe?1:-1;let lt=He-at,Et=te,yt=ge;for(;Ae.push({x:Et,y:yt}),!(Et===be&&yt===xe);){const sn=2*lt;sn>-at&&(lt-=at,Et+=ut),sn<He&&(lt+=He,yt+=xt)}return Ae},[]),ve=g.useCallback((te,ge)=>{const be=ue(te.x,te.y,ge.x,ge.y),xe=[];for(const Ae of be){const He=K(Ae.x,Ae.y);He&&xe.push(He)}return xe},[ue,K]),pe=g.useCallback((te,ge)=>{if(te.length===0)return[];if(ge>=te.length)return[...te];if(ge===1)return[te[0]];if(ge===2)return[te[0],te[te.length-1]];const be=[];for(let xe=0;xe<ge;xe++){const Ae=Math.round(xe/(ge-1)*(te.length-1));be.push(te[Ae])}return be},[]),Se=A.length>0?pe(A,$):[],Te=g.useCallback(()=>{const te=u.current,ge=y.current,be=m.current;if(!te||!ge||!be||!M)return;te.width=ge.clientWidth,te.height=ge.clientHeight;const xe=te.getContext("2d");if(!xe)return;xe.imageSmoothingEnabled=!1,xe.clearRect(0,0,te.width,te.height);const Ae=8,He=document.createElement("canvas");He.width=Ae*2,He.height=Ae*2;const at=He.getContext("2d");at.fillStyle="#3a3a3a",at.fillRect(0,0,Ae*2,Ae*2),at.fillStyle="#2a2a2a",at.fillRect(0,0,Ae,Ae),at.fillRect(Ae,Ae,Ae,Ae);const{ox:ut,oy:xt,drawW:lt,drawH:Et}=I();xe.save(),xe.beginPath(),xe.rect(ut,xt,lt,Et),xe.clip();const yt=xe.createPattern(He,"repeat");if(yt&&(xe.fillStyle=yt,xe.fillRect(ut,xt,lt,Et)),xe.restore(),xe.drawImage(be,ut,xt,lt,Et),ee&&Z){const sn=ut+(ee.x+.5)*f,Mt=xt+(ee.y+.5)*f,Pt=ut+(Z.x+.5)*f,Cn=xt+(Z.y+.5)*f;xe.save(),xe.strokeStyle="rgba(0,0,0,0.5)",xe.lineWidth=3,xe.beginPath(),xe.moveTo(sn,Mt),xe.lineTo(Pt,Cn),xe.stroke(),xe.strokeStyle="#ffffff",xe.lineWidth=1.5,xe.setLineDash([4,4]),xe.beginPath(),xe.moveTo(sn,Mt),xe.lineTo(Pt,Cn),xe.stroke(),xe.setLineDash([]),xe.fillStyle="#22c55e",xe.beginPath(),xe.arc(sn,Mt,4,0,Math.PI*2),xe.fill(),xe.strokeStyle="#fff",xe.lineWidth=1,xe.stroke(),xe.fillStyle="#ef4444",xe.beginPath(),xe.arc(Pt,Cn,4,0,Math.PI*2),xe.fill(),xe.strokeStyle="#fff",xe.lineWidth=1,xe.stroke(),xe.restore()}},[M,z,f,v,I,ee,Z]);g.useEffect(()=>{Te()},[Te]),g.useEffect(()=>{const te=y.current;if(!te)return;const ge=new ResizeObserver(()=>Te());return ge.observe(te),()=>ge.disconnect()},[Te]);const De=te=>{if(F({x:te.clientX,y:te.clientY}),N){const be=te.clientX-j.x,xe=te.clientY-j.y;b(Ae=>({x:Ae.x+be,y:Ae.y+xe})),C({x:te.clientX,y:te.clientY}),R(null);return}if(H){const be=ne(te.clientX,te.clientY);be&&J(be);return}const ge=de(te.clientX,te.clientY);R(ge)},jt=te=>{if(te.button===1||te.button===2){te.preventDefault(),P(!0),C({x:te.clientX,y:te.clientY});return}if(te.button===0){const ge=ne(te.clientX,te.clientY);ge&&(re(!0),W(ge),J(ge),X([]))}},Ge=te=>{if(N){P(!1);return}if(H&&ee){re(!1);const ge=ne(te.clientX,te.clientY);if(ge){J(ge);const be=ve(ee,ge);X(be)}}},Qe=te=>{te.preventDefault();const ge=te.deltaY>0?-1:1;p(be=>{const xe=ge>0?be*1.2:be/1.2;return Math.max(.1,Math.min(50,xe))})},Ct=()=>{Se.length!==0&&(oe(te=>[...te,{raw:A,sampled:Se}]),X([]),W(null),J(null))},mt=te=>{oe(ge=>ge.filter((be,xe)=>xe!==te))},se=()=>{const te=[];for(const ge of O)for(const be of ge.sampled)te.includes(be)||te.push(be);for(const ge of Se)te.includes(ge)||te.push(ge);te.length>0&&d(te),c()},Be=()=>{X([]),W(null),J(null)};if(!l)return null;const Re=Math.max(2,A.length);return r.jsxs("div",{className:"fixed inset-0 z-[9999] flex items-center justify-center",onClick:te=>{te.target===te.currentTarget&&c()},children:[r.jsx("div",{className:"absolute inset-0 bg-black/80"}),r.jsxs("div",{className:"relative z-10 bg-gray-800 border border-gray-600 rounded-lg shadow-2xl flex flex-col overflow-hidden",style:{width:"90vw",height:"85vh",maxWidth:"1400px"},children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-900 border-b border-gray-700 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-sm font-semibold text-white",children:" Gradient Picker  Drag across image to capture gradients"}),r.jsx("span",{className:"text-xs text-gray-500",children:"Drag to sample  Scroll to zoom  Middle-drag to pan"})]}),r.jsx("button",{onClick:c,className:"text-gray-400 hover:text-white text-lg px-2","aria-label":"Close gradient picker",children:""})]}),r.jsxs("div",{className:`${w?"flex flex-col":"flex"} flex-1 overflow-hidden`,children:[r.jsxs("div",{ref:y,className:"flex-1 relative overflow-hidden bg-gray-950 cursor-crosshair",children:[r.jsx("canvas",{ref:u,className:"absolute inset-0",onMouseMove:De,onMouseDown:jt,onMouseUp:Ge,onMouseLeave:()=>{if(P(!1),R(null),H&&ee){re(!1);const te=ve(ee,Z||ee);X(te)}},onWheel:Qe,onContextMenu:te=>te.preventDefault()}),r.jsxs("div",{className:"absolute top-3 left-3 bg-gray-900/80 border border-gray-700 rounded px-2 py-1 text-xs text-gray-300 pointer-events-none",children:[Math.round(f*100),"%"]}),H&&A.length===0&&r.jsx("div",{className:"absolute top-3 right-3 bg-blue-900/80 border border-blue-600 rounded px-2 py-1 text-xs text-blue-200 pointer-events-none",children:"Release to capture gradient..."}),U&&!N&&!H&&r.jsxs("div",{style:{position:"fixed",left:k.x+20,top:k.y+20,zIndex:99999,pointerEvents:"none"},className:"bg-gray-900 border border-gray-600 rounded-lg p-2 shadow-xl flex items-center gap-3",children:[r.jsx("div",{className:"w-8 h-8 rounded border border-gray-500 flex-shrink-0",style:{backgroundColor:U}}),r.jsx("span",{className:"font-mono text-sm text-white font-bold",children:U})]})]}),r.jsxs("div",{className:`${w?"h-56 border-t w-full":"w-72 border-l"} border-gray-700 flex flex-col bg-gray-800 flex-shrink-0`,children:[r.jsx("div",{className:"px-3 py-2 border-b border-gray-700",children:r.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Gradient Builder"})}),r.jsxs("div",{className:"flex-1 overflow-y-auto p-3 space-y-3",children:[A.length>0?r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"text-xs text-gray-400",children:["Captured ",r.jsx("span",{className:"text-white font-mono",children:A.length})," pixels along line"]}),r.jsx("div",{className:"h-4 rounded border border-gray-600 overflow-hidden flex",children:A.map((te,ge)=>r.jsx("div",{className:"flex-1 h-full",style:{backgroundColor:te}},ge))}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[r.jsx("span",{children:"Sample count"}),r.jsx("span",{className:"text-white font-mono",children:$})]}),r.jsx("input",{type:"range",min:"2",max:Re,value:Math.min($,Re),onChange:te=>ae(Number(te.target.value)),className:"w-full"})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"text-xs text-gray-500",children:["Sampled colors (",Se.length,")"]}),r.jsx("div",{className:"flex flex-wrap gap-1 bg-gray-900 p-1.5 rounded border border-gray-700",children:Se.map((te,ge)=>r.jsx("div",{className:"w-6 h-6 rounded border border-gray-500 cursor-pointer hover:border-white",style:{backgroundColor:te},title:te,onClick:()=>navigator.clipboard.writeText(te)},ge))})]}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("button",{onClick:Ct,className:"flex-1 px-2 py-1.5 bg-green-700 hover:bg-green-600 text-white text-xs font-medium rounded transition-colors",children:"Save Gradient"}),r.jsx("button",{onClick:Be,className:"px-2 py-1.5 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs rounded transition-colors",children:"Clear"})]})]}):r.jsx("div",{className:"text-xs text-gray-500 text-center py-4",children:"Click and drag across the image to capture a gradient line."}),O.length>0&&r.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-2",children:[r.jsxs("div",{className:"text-xs font-semibold text-gray-400 uppercase",children:["Saved Gradients (",O.length,")"]}),O.map((te,ge)=>r.jsxs("div",{className:"bg-gray-900 rounded p-2 space-y-1 group",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsxs("span",{className:"text-xs text-gray-400",children:["#",ge+1,"  ",te.sampled.length," colors"]}),r.jsx("button",{onClick:()=>mt(ge),className:"text-gray-500 hover:text-red-400 opacity-0 group-hover:opacity-100 transition-opacity text-sm",children:""})]}),r.jsx("div",{className:"h-3 rounded overflow-hidden flex",children:te.raw.map((be,xe)=>r.jsx("div",{className:"flex-1 h-full",style:{backgroundColor:be}},xe))}),r.jsx("div",{className:"flex flex-wrap gap-0.5",children:te.sampled.map((be,xe)=>r.jsx("div",{className:"w-4 h-4 border border-gray-600 cursor-pointer hover:border-white",style:{backgroundColor:be},title:be,onClick:()=>navigator.clipboard.writeText(be)},xe))})]},ge))]})]}),r.jsxs("div",{className:`${w?"flex items-center gap-2 p-2":"p-3 space-y-2"} border-t border-gray-700 flex-shrink-0`,children:[r.jsx("button",{onClick:se,disabled:O.length===0&&Se.length===0,className:`${w?"flex-1":"w-full"} px-3 py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-sm font-semibold rounded transition-colors`,children:"Add to Palette"}),r.jsx("button",{onClick:()=>{oe([]),Be()},disabled:O.length===0&&A.length===0,className:`${w?"flex-shrink-0":"w-full"} px-3 py-1.5 bg-gray-700 hover:bg-gray-600 disabled:opacity-50 disabled:cursor-not-allowed text-gray-300 text-xs rounded transition-colors`,children:"Clear All"})]})]})]})]})]})};function hp(l){return new Worker("/assets/pixelator.worker-DjkfRDh8.js",{name:l?.name})}const Zu=["#FFFFFF","#F4F59F","#FFCA3A","#FF9F1C","#FF595E","#E71D36","#F3BBC2","#FF85A1","#BD637D","#CDB4DB","#6A4C93","#4D194D","#A8D0DC","#2EC4B6","#1A535C","#6D9DCD","#1982C4","#A1C181","#8AC926","#A0A0A0","#6B4226","#505050","#CFD078","#145A7A","#8B1D24","#C07F7A","#C49A6C","#5B7B1C","#000000"],pp=["#000000","#3c3c3c","#787878","#aaaaaa","#d2d2d2","#ffffff","#600018","#a50e1e","#ed1c24","#fa8072","#e45c1a","#ff7f27","#f6aa09","#f9dd3b","#fffabc","#9c8431","#c5ad31","#e8d45f","#4a6b3a","#5a944a","#84c573","#0eb968","#13e67b","#87ff5e","#0c816e","#10aea6","#13e1be","#0f799f","#60f7f2","#bbfaf2","#28509e","#4093e4","#7dc7ff","#4d31b8","#6b50f6","#99b1fb","#4a4284","#7a71c4","#b5aef1","#780c99","#aa38b9","#e09ff9","#cb007a","#ec1f80","#f38da9","#9b5249","#d18078","#fab6a4","#684634","#95682a","#dba463","#7b6352","#9c846b","#d6b594","#d18051","#f8b277","#ffc5a5","#6d643f","#948c6b","#cdc59e","#333941","#6d758d","#b3b9d1"],gp=["#000000","#3c3c3c","#787878","#d2d2d2","#ffffff","#600018","#ed1c24","#ff7f27","#f6aa09","#f9dd3b","#fffabc","#0eb968","#13e67b","#87ff5e","#0c816e","#10aea6","#13e1be","#60f7f2","#28509e","#4093e4","#6b50f6","#99b1fb","#780c99","#aa38b9","#e09ff9","#cb007a","#ec1f80","#f38da9","#684634","#95682a","#f8b277"],Ku=[{value:"oklab",label:"OKLab (perceptual)",desc:"Modern perceptual  best all-round accuracy"},{value:"ciede2000",label:"CIEDE2000",desc:"Gold standard  great for skin tones and gradients"},{value:"cie94",label:"CIE94 (graphics)",desc:"Industry standard  weights chroma/hue over lightness"},{value:"cie76",label:"CIE76 (euclidean)",desc:"Simple Euclidean in Lab space  fast but less accurate"},{value:"redmean",label:"Redmean (turbo)",desc:"Fastest  weighted RGB, no color space conversion needed"}],mp=[{value:"none",label:"None (Nearest Color)"},{value:"floyd-steinberg",label:"Floyd-Steinberg"},{value:"burkes",label:"Burkes"},{value:"stucki",label:"Stucki"},{value:"sierra-2",label:"Sierra-2"},{value:"sierra-lite",label:"Sierra Lite"},{value:"atkinson",label:"Atkinson"},{value:"bayer-4x4",label:"Bayer 4x4"},{value:"bayer-8x8",label:"Bayer 8x8"},{value:"halftone-dot",label:"Halftone Dot"},{value:"diagonal-line",label:"Diagonal Line"},{value:"cross-hatch",label:"Cross Hatch"},{value:"grid",label:"Grid"}],Qu=[64,100,128,150,200,250,256,300,350,400,450,500,512,550,600,650,700,750,800,850,900,950,1e3],xp=({isOpen:l,onClose:c,layer:a})=>{const d=T(V=>V.updateLayer),u=T(V=>V.project.layers),y=T(V=>V.cropCanvasToLayers),m=Rr(),[w,f]=g.useState(128),[p,v]=g.useState(128),[b,N]=g.useState("bilinear"),[P,j]=g.useState("none"),[C,M]=g.useState(100),[D,z]=g.useState("none"),[q,U]=g.useState(50),[R,k]=g.useState("geopixels"),[F,H]=g.useState(""),[re,ee]=g.useState(null),[W,Z]=g.useState(null),[J,A]=g.useState(!1),[X,$]=g.useState(1),[ae,O]=g.useState(null),[oe,_]=g.useState(String(w)),[x,I]=g.useState(!0),[ne,K]=g.useState(!1),[de,ue]=g.useState(16),[ve,pe]=g.useState([]),[Se,Te]=g.useState(8),[De,jt]=g.useState(!1),[Ge,Qe]=g.useState(!0),[Ct,mt]=g.useState(!1),[se,Be]=g.useState(!0),[Re,te]=g.useState(new Map),[ge,be]=g.useState(null),[xe,Ae]=g.useState(null),[He,at]=g.useState([]),[ut,xt]=g.useState(!1),[lt,Et]=g.useState(!0),[yt,sn]=g.useState(!1),[Mt,Pt]=g.useState(.1),[Cn,Bt]=g.useState("0.1"),[dt,xr]=g.useState("percent"),[Kt,Tn]=g.useState(100),[an,En]=g.useState(!1),[ln,Zn]=g.useState(0),[Qt,yr]=g.useState(0),[yn,_n]=g.useState(0),[Mn,An]=g.useState("oklab"),[cn,G]=g.useState(0),[fe,Ne]=g.useState(!1),[Fe,ze]=g.useState(!1),[$e,Ye]=g.useState(!1),Ze=g.useRef(null),ft=g.useRef(null),Ke=g.useRef(null),Ue=g.useRef(null),pt=g.useRef(null),vt=g.useRef(!1),nt=g.useRef(0),St=g.useRef(!1),Rt=g.useRef(R),Je=g.useRef(750),qt=V=>{const me=V.data,Ee=new Map;let Le=0;for(let ot=0;ot<me.length;ot+=4){const _e=me[ot],en=me[ot+1],Bn=me[ot+2];if(me[ot+3]===0)continue;const ho=`#${((1<<24)+(_e<<16)+(en<<8)+Bn).toString(16).slice(1).toUpperCase()}`;Ee.set(ho,(Ee.get(ho)||0)+1),Le++}const rt=new Map;Ee.forEach((ot,_e)=>{rt.set(_e,{count:ot,percent:Le>0?ot/Le*100:0})}),te(rt)},Pn=g.useCallback(()=>{Ze.current?.terminate();const V=new hp;return V.onmessage=me=>{const{type:Ee,imageData:Le,message:rt,suggestions:ot,generatedPalette:_e}=me.data;if(Ee==="success"){const en=document.createElement("canvas");en.width=Le.width,en.height=Le.height;const Bn=en.getContext("2d");if(Bn){if(Bn.putImageData(Le,0,0),O({width:Le.width,height:Le.height}),Z({width:Le.width,height:Le.height}),lt){const Ar=Ln(Le.width,Le.height);$(Ar)}ee(en.toDataURL()),qt(Le),at(_e||[])}}else Ee==="suggestions"?(pe(ot),jt(!1)):(console.error("Pixelator Worker Error:",rt),jt(!1));A(!1)},Ze.current=V,V},[lt]);g.useEffect(()=>(Pn(),()=>{Ze.current?.terminate()}),[Pn]),g.useEffect(()=>{_(String(w))},[w]),g.useEffect(()=>{const V=localStorage.getItem("pixelator_custom_palette");V&&H(V)},[]),g.useEffect(()=>{if(l&&a.imageData){const V=new Image;V.onload=()=>{v(V.height),f(128)},V.src=a.imageData}},[l,a.imageData]),g.useEffect(()=>{F.trim()&&localStorage.setItem("pixelator_custom_palette",F)},[F]);const Ve=g.useCallback(()=>{if(R==="none")return[];if(R==="geopixels")return Zu;if(R==="wplace")return pp;if(R==="wplace-free")return gp;const V=F.trim();let me=[];if(V&&(me=V.split(/[\s,]+/).filter(Le=>Le.trim()!=="").map(Le=>{const rt=Le.trim();if(/^\d+$/.test(rt)){const ot=parseInt(rt,10);if(ot>=0&&ot<=16777215)return"#"+ot.toString(16).padStart(6,"0").toUpperCase()}return/^#?[0-9A-F]{6}$/i.test(rt)?rt.startsWith("#")?rt.toUpperCase():"#"+rt.toUpperCase():null}).filter(Le=>Le!==null)),R==="custom")return me;if(R==="geopixels+custom"){const Ee=[...Zu];for(const Le of me)Ee.includes(Le.toUpperCase())||Ee.push(Le.toUpperCase());return Ee}return[]},[R,F]);g.useEffect(()=>{Rt.current==="none"&&R!=="none"?ne?(St.current=!0,K(!1)):St.current=!1:Rt.current!=="none"&&R==="none"?St.current&&K(!0):R!=="none"&&ne&&K(!1),Rt.current=R},[R,ne]);const Wt=g.useCallback(()=>{if(!a.imageData)return;Pn();const V=++nt.current;A(!0);const me=new Image;me.onload=()=>{if(V!==nt.current)return;const Ee=document.createElement("canvas");Ee.width=me.width,Ee.height=me.height;const Le=Ee.getContext("2d");if(!Le)return;Le.drawImage(me,0,0);const rt=Le.getImageData(0,0,me.width,me.height);mt(aa(rt));const ot=Ve(),_e=me.width/me.height,en=Math.round(w*_e);Ze.current?.postMessage({imageData:rt,settings:{targetWidth:en,targetHeight:w,ditherMethod:P,ditherStrength:C,palette:ot,resamplingMethod:b,useKmeans:ne,kmeansColors:de,brightness:ln,contrast:Qt,saturation:yn,preprocessingMethod:D,preprocessingStrength:q,filterTrivialColors:yt,trivialThreshold:Mt,trivialThresholdMode:dt,colorMatchAlgorithm:Mn,preserveDetailThreshold:cn,colorStats:[]}})},me.src=a.imageData},[a.imageData,w,P,C,Ve,b,ne,de,ln,Qt,yn,D,q,yt,Mt,dt,Mn,cn,Pn]);g.useEffect(()=>{if(!l||!se)return;const V=setTimeout(()=>{Wt(),Je.current=750},Je.current);return()=>clearTimeout(V)},[l,se,w,P,C,R,F,b,ne,de,ln,Qt,yn,D,q,yt,Mt,dt,Mn,cn,Wt]);const Dn=()=>{re&&W&&(d(a.id,{imageData:re,width:W.width,height:W.height}),u.length===1&&setTimeout(()=>{y(),window.fitCanvasToScreen?.()},50),c())},Ln=g.useCallback((V,me)=>{if(!ft.current)return 1;const Ee=ft.current.clientWidth,Le=ft.current.clientHeight,rt=Ee-40,ot=Le-40;if(rt<=0||ot<=0)return 1;const _e=rt/V,en=ot/me,Bn=Math.min(_e,en);return Math.max(.1,Bn)},[]),Fr=()=>$(V=>Math.min(V+.5,20)),sa=()=>$(V=>Math.max(V-.5,.5)),Ko=()=>$(1),Kn=g.useCallback(()=>{ae&&$(Ln(ae.width,ae.height))},[ae,Ln]);g.useEffect(()=>{ae&&ft.current&&(ut||setTimeout(()=>{Kn(),xt(!0)},50))},[ae,ut,Kn]);const un=()=>f(p),aa=V=>{const me=V.data;for(let Ee=3;Ee<me.length;Ee+=4){const Le=me[Ee];if(Le>0&&Le<255)return!0}return!1},Jt=V=>{const me=V.currentTarget;O({width:me.naturalWidth,height:me.naturalHeight})},la=g.useCallback(()=>{if(!Ze.current||!a.imageData)return;if(Ve().length===0){alert("Please select a palette first to find missing colors.");return}jt(!0);const me=new Image;me.onload=()=>{const Ee=document.createElement("canvas");Ee.width=me.width,Ee.height=me.height;const Le=Ee.getContext("2d");if(!Le)return;Le.drawImage(me,0,0);const rt=Le.getImageData(0,0,me.width,me.height);Ze.current?.postMessage({type:"suggest",imageData:rt,settings:{palette:Ve(),numSuggestions:Se,preferDistinct:Ge}})},me.src=a.imageData},[a.imageData,Ve,Se,Ge]),ia=()=>{const V=F.trim(),me=ve.join(", ");H(V===""?me:`${V}, ${me}`)},zr=g.useMemo(()=>{let V=Ve();return R==="none"&&ne&&He.length>0&&(V=He),Re.size===0?V:[...V].sort((me,Ee)=>{const Le=Re.get(me)?.count||0,rt=Re.get(Ee)?.count||0;return Le!==rt?rt-Le:0})},[Ve,Re,He,R,ne]),Tr=()=>{zr.length>0&&navigator.clipboard.writeText(zr.join(", "))},_r=g.useCallback(V=>{vt.current=!0,V.preventDefault()},[]),On=g.useCallback(V=>{if(!pt.current)return;const me=pt.current.getBoundingClientRect(),Ee=V-me.left,Le=Math.max(0,Math.min(100,Ee/me.width*100));Tn(Le)},[]);g.useEffect(()=>{const V=Ee=>{vt.current&&On(Ee.clientX)},me=()=>{vt.current=!1};return window.addEventListener("mousemove",V),window.addEventListener("mouseup",me),()=>{window.removeEventListener("mousemove",V),window.removeEventListener("mouseup",me)}},[On]);const vr=V=>{if(V.length===0)return;const me=V.join(", "),Ee=F.trim();H(Ee===""?me:`${Ee}, ${me}`),R!=="custom"&&R!=="geopixels+custom"&&(Je.current=100,k("geopixels+custom"))},ca=V=>{if(V.length===0)return;const me=V.join(", "),Ee=F.trim();H(Ee===""?me:`${Ee}, ${me}`),R!=="custom"&&R!=="geopixels+custom"&&(Je.current=100,k("geopixels+custom"))},ua=()=>{if(He.length===0)return;const V=He.join(", "),me=F.trim();H(me===""?V:`${me}, ${V}`),Je.current=100,k("geopixels+custom")};return r.jsx(fo,{isOpen:l,title:"Pixelator",onClose:c,noPadding:!0,modalId:"modal-pixelator",children:()=>r.jsxs("div",{className:`${m?"flex flex-col-reverse":"flex"} text-gray-200 h-full w-full overflow-hidden`,children:[r.jsxs("div",{className:`${m?"border-t max-h-[45vh]":"w-72 border-r"} border-gray-700 flex-shrink-0 flex flex-col overflow-hidden`,children:[r.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-6 text-gray-200",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Dimensions"}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex gap-2 items-end",children:[r.jsxs("div",{className:"flex-1",children:[r.jsx("label",{className:"text-xs text-gray-500",children:"Height (px)"}),r.jsx("input",{type:"text",inputMode:"numeric",value:oe,onChange:V=>{if(_(V.target.value),V.target.value!==""&&V.target.value!=="-"){const me=Number(V.target.value);!isNaN(me)&&me>0&&f(me)}},className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-sm"})]}),r.jsxs("select",{className:"flex-1 bg-gray-800 border border-gray-600 rounded px-2 py-1 text-xs text-gray-400",onChange:V=>{V.target.value&&(Je.current=100,f(Number(V.target.value)))},value:Qu.includes(w)?w:"",children:[r.jsx("option",{value:"",disabled:!0,children:"common sizes"}),Qu.map(V=>r.jsxs("option",{value:V,children:[V,"px"]},V))]}),r.jsx("button",{onClick:un,className:"text-xs px-2 py-1 text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 rounded transition-colors whitespace-nowrap flex-shrink-0",title:"Reset height to default",children:"Reset"})]}),W&&r.jsxs("div",{className:"text-xs text-gray-400 bg-gray-800 px-2 py-1 rounded whitespace-nowrap",children:[W.width,"  ",W.height," ",r.jsx("span",{className:"text-gray-600 mx-1",children:"|"})," ",(W.width*W.height).toLocaleString()," px"]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500",children:"Resampling"}),r.jsxs("select",{value:b,onChange:V=>N(V.target.value),className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-sm",children:[r.jsx("option",{value:"nearest",children:"Nearest Neighbor (Sharp)"}),r.jsx("option",{value:"bilinear",children:"Bilinear (Smooth)"}),r.jsx("option",{value:"lanczos",children:"Lanczos (High Quality)"})]})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500",children:"Color Matching"}),r.jsx("select",{value:Mn,onChange:V=>{Je.current=100,An(V.target.value)},className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-sm",title:Ku.find(V=>V.value===Mn)?.desc,children:Ku.map(V=>r.jsx("option",{value:V.value,children:V.label},V.value))})]})]}),Ct&&r.jsxs("div",{className:"bg-yellow-900/30 border border-yellow-700 rounded p-3 flex gap-3",children:[r.jsx("div",{className:"text-yellow-500 text-xl flex-shrink-0",children:""}),r.jsxs("div",{className:"text-xs text-yellow-300",children:[r.jsx("p",{className:"font-semibold mb-1",children:"Semi-transparent pixels detected"}),r.jsx("p",{children:"Apply a transparency mask first for better results"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Palette"}),R==="geopixels+custom"&&r.jsxs("div",{className:"group relative",children:[r.jsx("span",{className:"cursor-help text-xs text-blue-400",children:"Fun Fact?"}),r.jsxs("div",{className:"absolute bottom-full right-0 mb-2 w-64 p-2 bg-gray-900 border border-gray-600 rounded shadow-xl text-xs text-gray-300 hidden group-hover:block z-50",children:["If you play on Geopixels, you can export your palette by typing ",r.jsx("code",{className:"text-yellow-400",children:"userData.colors"})," in the browser console. Paste the result here!"]})]})]}),r.jsxs("div",{className:"flex flex-col space-y-1",children:[r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"palette",checked:R==="geopixels",onChange:()=>{Je.current=100,k("geopixels")}}),r.jsx("span",{className:"text-sm",children:"Geopixels Base"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"palette",checked:R==="wplace-free",onChange:()=>{Je.current=100,k("wplace-free")}}),r.jsxs("span",{className:"text-sm",children:["WPlace Free ",r.jsx("span",{className:"text-gray-500 text-xs",children:"(31 colors)"})]})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"palette",checked:R==="wplace",onChange:()=>{Je.current=100,k("wplace")}}),r.jsxs("span",{className:"text-sm",children:["WPlace All ",r.jsx("span",{className:"text-gray-500 text-xs",children:"(63 colors)"})]})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"palette",checked:R==="custom",onChange:()=>{Je.current=100,k("custom")}}),r.jsx("span",{className:"text-sm",children:"Custom"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"palette",checked:R==="geopixels+custom",onChange:()=>{Je.current=100,k("geopixels+custom")}}),r.jsx("span",{className:"text-sm",children:"Geopixels Base + Custom"})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"radio",name:"palette",checked:R==="none",onChange:()=>{Je.current=100,k("none")}}),r.jsx("span",{className:"text-sm",children:"No Recoloring (Resize Only)"})]})]}),(R==="custom"||R==="geopixels+custom")&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("textarea",{value:F,onChange:V=>H(V.target.value),placeholder:"#FFFFFF, #000000 or 16777215, 0",className:"w-full h-24 bg-gray-800 border border-gray-600 rounded p-2 text-xs font-mono"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>Ne(!0),className:"flex-1 px-3 py-1.5 bg-gray-700 hover:bg-gray-600 text-white text-xs font-medium rounded transition-colors",children:"Eyedropper"}),r.jsx("button",{onClick:()=>ze(!0),className:"flex-1 px-3 py-1.5 bg-indigo-700 hover:bg-indigo-600 text-white text-xs font-medium rounded transition-colors",title:"Fetch your owned colors from GeoPixels",children:" My Colors"}),r.jsxs("div",{className:"group relative",children:[r.jsx("span",{className:"cursor-help text-xs text-blue-400",children:"?"}),r.jsx("div",{className:"absolute bottom-full right-0 mb-2 w-52 p-2 bg-gray-900 border border-gray-600 rounded shadow-xl text-xs text-gray-300 hidden group-hover:block z-50",children:"Select colors to use from template image"})]})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{onClick:()=>Ye(!0),className:"flex-1 px-3 py-1.5 bg-purple-700 hover:bg-purple-600 text-white text-xs font-medium rounded transition-colors",title:"Drag across the image to capture gradient colors",children:" Gradients"}),r.jsx("div",{className:"flex-1"})]})]}),r.jsxs("div",{className:"border-t border-gray-700 pt-2",children:[r.jsxs("div",{className:"flex items-center justify-between mb-2",children:[r.jsxs("button",{onClick:()=>I(!x),className:"flex items-center text-xs text-gray-400 hover:text-gray-300",children:[r.jsx("span",{children:"Palette Preview"}),r.jsx("span",{className:"ml-1",children:x?"":""})]}),r.jsx("button",{onClick:Tr,className:"text-gray-400 hover:text-white p-1 rounded hover:bg-gray-700",title:"Copy palette to clipboard",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3 w-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M8 5H6a2 2 0 00-2 2v12a2 2 0 002 2h10a2 2 0 002-2v-1M8 5a2 2 0 002 2h2a2 2 0 002-2M8 5a2 2 0 012-2h2a2 2 0 012 2m2 4h3a2 2 0 012 2v3m-3-3V5a2 2 0 012-2h3.071a2 2 0 011.414.586l1.414 1.414A2 2 0 0118 6.414V9m-3-3h3"})})})]}),x&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"flex flex-wrap gap-0 bg-gray-900 p-1 rounded border border-gray-700",children:zr.length>0?zr.map((V,me)=>r.jsx("div",{className:"w-4 h-4 cursor-crosshair hover:z-10 hover:scale-125 transition-transform duration-75 border border-transparent hover:border-white",style:{backgroundColor:V},onMouseEnter:Ee=>{be(V),Ae({x:Ee.clientX,y:Ee.clientY})},onMouseLeave:()=>{be(null),Ae(null)},onMouseMove:Ee=>{Ae({x:Ee.clientX,y:Ee.clientY})}},me)):r.jsx("div",{className:"text-xs text-gray-500 p-2",children:"No palette selected"})}),ge&&xe&&r.jsxs("div",{style:{position:"fixed",left:xe.x+15,top:xe.y+15,zIndex:9999,pointerEvents:"none"},className:"bg-gray-900 border border-gray-600 rounded p-2 shadow-xl text-xs min-w-[120px]",children:[r.jsxs("div",{className:"flex items-center gap-2 mb-1 pb-1 border-b border-gray-700",children:[r.jsx("div",{className:"w-3 h-3 border border-gray-500",style:{backgroundColor:ge}}),r.jsx("span",{className:"font-mono font-bold text-white",children:ge})]}),Re.has(ge)?r.jsxs("div",{className:"text-gray-300 space-y-0.5",children:[r.jsxs("div",{className:"flex justify-between gap-4",children:[r.jsx("span",{children:"Count:"}),r.jsx("span",{className:"text-white font-mono",children:Re.get(ge)?.count.toLocaleString()})]}),r.jsxs("div",{className:"flex justify-between gap-4",children:[r.jsx("span",{children:"Usage:"}),r.jsxs("span",{className:"text-white font-mono",children:[Re.get(ge)?.percent.toFixed(2),"%"]})]})]}):r.jsx("div",{className:"text-gray-500 italic",children:"Not used in preview"})]}),R!=="none"&&r.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-2 pb-0",children:[r.jsx("div",{className:"flex items-center gap-2",children:r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer flex-shrink-0",children:[r.jsx("input",{type:"checkbox",checked:yt,onChange:V=>sn(V.target.checked),className:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-800",title:dt==="percent"?`Ignore colors below ${Mt}% usage during processing`:`Ignore colors with fewer than ${Mt} pixels during processing`}),r.jsx("span",{className:"text-xs text-gray-400",children:"Filter trivial colors"})]})}),r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("span",{className:"text-xs text-gray-500",children:"<"}),r.jsxs("div",{className:"flex items-center",children:[r.jsx("input",{type:"text",value:Cn,onChange:V=>{Bt(V.target.value);const me=parseFloat(V.target.value);dt==="percent"?!isNaN(me)&&me>0&&me<=100&&Pt(me):!isNaN(me)&&me>0&&Number.isFinite(me)&&Pt(me)},onBlur:()=>{const V=parseFloat(Cn);if(dt==="percent")isNaN(V)||V<=0?(Pt(.1),Bt("0.1")):Bt(String(V));else if(isNaN(V)||V<=0)Pt(1),Bt("1");else{const me=Math.round(V);Pt(me),Bt(String(me))}},className:"w-14 bg-gray-800 border border-gray-600 rounded-l px-1.5 py-0.5 text-xs text-center font-mono",title:dt==="percent"?"Threshold percentage for trivial color filtering":"Minimum pixel count for a color to be kept"}),r.jsxs("div",{className:"flex flex-col",children:[r.jsx("button",{onClick:()=>{const V=dt==="percent"?.01:1,Ee=Math.min(dt==="percent"?100:999999,dt==="percent"?Math.round((Mt+V)*100)/100:Mt+V);Pt(Ee),Bt(String(Ee))},className:"bg-gray-700 hover:bg-gray-600 border border-gray-600 border-l-0 rounded-tr px-1 leading-none text-[9px] text-gray-300 h-[11px] flex items-center",title:dt==="percent"?"Increase by 0.01%":"Increase by 1 pixel",children:""}),r.jsx("button",{onClick:()=>{const V=dt==="percent"?.01:1,Ee=Math.max(dt==="percent"?.01:1,dt==="percent"?Math.round((Mt-V)*100)/100:Mt-V);Pt(Ee),Bt(String(Ee))},className:"bg-gray-700 hover:bg-gray-600 border border-gray-600 border-l-0 border-t-0 rounded-br px-1 leading-none text-[9px] text-gray-300 h-[11px] flex items-center",title:dt==="percent"?"Decrease by 0.01%":"Decrease by 1 pixel",children:""})]})]}),r.jsxs("select",{value:dt,onChange:V=>{const me=V.target.value;xr(me),me==="percent"?(Pt(.1),Bt("0.1")):(Pt(1),Bt("1"))},className:"bg-gray-800 border border-gray-600 rounded px-1 py-0.5 text-xs text-gray-400",title:"Choose threshold unit",children:[r.jsx("option",{value:"percent",children:"%"}),r.jsx("option",{value:"pixels",children:"px"})]})]})]}),(R==="custom"||R==="geopixels+custom")&&r.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-2",children:[r.jsxs("div",{className:"flex items-center justify-between gap-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase whitespace-nowrap",children:"Suggest Colors"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("input",{type:"number",min:"1",max:"32",value:Se,onChange:V=>Te(Math.max(1,Math.min(32,Number(V.target.value)))),className:"w-12 bg-gray-800 border border-gray-600 rounded px-1 py-0.5 text-xs text-center",title:"Number of colors to suggest"}),r.jsx("button",{onClick:la,disabled:De,className:"px-3 py-1 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white text-xs rounded transition-colors",children:De?"...":"Go"})]})]}),r.jsxs("label",{className:"flex items-center space-x-2 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:Ge,onChange:V=>Qe(V.target.checked),className:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-800",title:"Prioritize colors that are distinct from each other"}),r.jsx("span",{className:"text-xs text-gray-400",children:"Prefer distinct color suggestions"})]}),ve.length>0&&r.jsxs("div",{className:"space-y-2",children:[r.jsx("div",{className:"flex flex-wrap gap-1 bg-gray-900 p-2 rounded border border-gray-700",children:ve.map((V,me)=>r.jsx("div",{className:"w-8 h-8 rounded border border-gray-500 cursor-pointer hover:border-white",style:{backgroundColor:V},title:`${V} - Click to copy`,onClick:()=>{navigator.clipboard.writeText(V)}},me))}),r.jsx("button",{onClick:ia,className:"w-full px-2 py-1 bg-gray-700 hover:bg-gray-600 text-white text-xs rounded transition-colors",children:"Add to Custom Palette"})]}),r.jsx("p",{className:"text-xs text-gray-500",children:"Analyzes the image to find dominant colors missing from your palette."})]})]})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Dithering"}),r.jsx("select",{value:P,onChange:V=>{Je.current=100,j(V.target.value)},className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-sm",children:mp.map(V=>r.jsx("option",{value:V.value,children:V.label},V.value))}),P!=="none"&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[r.jsx("span",{children:"Strength"}),r.jsxs("span",{children:[C,"%"]})]}),r.jsx("input",{type:"range",min:"0",max:"100",value:C,onChange:V=>M(Number(V.target.value)),className:"w-full"})]})]}),r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"group relative inline-block w-full",children:[r.jsxs("label",{className:`flex items-center space-x-2 ${R!=="none"?"cursor-not-allowed opacity-50":"cursor-pointer"}`,children:[r.jsx("input",{type:"checkbox",checked:ne,onChange:V=>K(V.target.checked),disabled:R!=="none"}),r.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:"K-Means Color Reduction"})]}),R!=="none"&&r.jsx("div",{className:"absolute bottom-full left-0 mb-2 w-64 p-2 bg-gray-900 border border-gray-600 rounded shadow-xl text-xs text-gray-300 hidden group-hover:block z-50",children:`K-Means is only available when "No Recoloring" is selected. It's used to reduce the color space when you're not providing a specific palette.`})]}),ne&&r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-500",children:"Number of Colors"}),r.jsx("input",{type:"number",min:"2",max:"256",value:de,onChange:V=>ue(Number(V.target.value)),className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-sm"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Reduces image to N dominant colors before applying palette/dithering."}),He.length>0&&r.jsx("button",{onClick:ua,className:"w-full mt-2 px-3 py-1.5 bg-teal-700 hover:bg-teal-600 text-white text-xs font-medium rounded transition-colors",title:"Send K-Means palette to Geopixels Base + Custom",children:"Send Colors to Geopixels Custom Palette"})]})]}),r.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-2",children:[r.jsxs("button",{onClick:()=>En(!an),className:"flex items-center justify-between w-full text-xs font-semibold text-gray-400 hover:text-gray-300 uppercase",children:[r.jsx("span",{children:"Extra Features"}),r.jsx("span",{children:an?"":""})]}),an&&r.jsxs("div",{className:"space-y-3 pt-2",children:[r.jsxs("div",{className:"border-b border-gray-700 pb-3",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase mb-2 block",children:"Pre-processing (Experimental)"}),r.jsxs("select",{value:D,onChange:V=>{Je.current=100,z(V.target.value)},className:"w-full bg-gray-800 border border-gray-600 rounded px-2 py-1 text-sm mb-2",title:"Apply filters before pixelation to improve results (may impact performance)",children:[r.jsx("option",{value:"none",children:"None"}),r.jsx("option",{value:"kuwahara",children:"Kuwahara (Oil Paint / Flatten)"}),r.jsx("option",{value:"median",children:"Median (De-noise / Smooth)"}),r.jsx("option",{value:"bilateral",children:"Bilateral (Soft Blur)"})]}),D!=="none"&&r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500 mb-2",children:[r.jsx("span",{children:"Intensity"}),r.jsxs("span",{children:[q,"%"]})]}),r.jsx("input",{type:"range",min:"0",max:"100",value:q,onChange:V=>{Je.current=100,U(Number(V.target.value))},className:"w-full"}),r.jsxs("p",{className:"text-xs text-gray-500 mt-2",children:[D==="bilateral"&&"Smooths surfaces while keeping edges. Good for photographs.",D==="kuwahara"&&'Best for Pixel Art. Creates flat, "painted" clusters of color.',D==="median"&&"Removes noise and small details. Great for cleaning up JPEGs before pixelating."]})]})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[r.jsx("span",{children:"Brightness"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{children:ln}),r.jsx("button",{onClick:()=>Zn(0),className:"text-gray-500 hover:text-white disabled:opacity-0 transition-opacity",title:"Reset Brightness",disabled:ln===0,children:""})]})]}),r.jsx("input",{type:"range",min:"-100",max:"100",value:ln,onChange:V=>Zn(Number(V.target.value)),className:"w-full"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[r.jsx("span",{children:"Contrast"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{children:Qt}),r.jsx("button",{onClick:()=>yr(0),className:"text-gray-500 hover:text-white disabled:opacity-0 transition-opacity",title:"Reset Contrast",disabled:Qt===0,children:""})]})]}),r.jsx("input",{type:"range",min:"-100",max:"100",value:Qt,onChange:V=>yr(Number(V.target.value)),className:"w-full"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[r.jsx("span",{children:"Saturation"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{children:yn}),r.jsx("button",{onClick:()=>_n(0),className:"text-gray-500 hover:text-white disabled:opacity-0 transition-opacity",title:"Reset Saturation",disabled:yn===0,children:""})]})]}),r.jsx("input",{type:"range",min:"-100",max:"100",value:yn,onChange:V=>_n(Number(V.target.value)),className:"w-full"})]}),r.jsxs("div",{className:"border-t border-gray-700 pt-3",children:[r.jsxs("div",{className:"flex justify-between text-xs text-gray-500",children:[r.jsx("span",{children:"Preserve Detail"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{children:["E",cn.toFixed(1)]}),r.jsx("button",{onClick:()=>G(0),className:"text-gray-500 hover:text-white disabled:opacity-0 transition-opacity",title:"Reset Preserve Detail",disabled:cn===0,children:""})]})]}),r.jsx("input",{type:"range",min:"0",max:"5",step:"0.1",value:cn,onChange:V=>{Je.current=100,G(Number(V.target.value))},className:"w-full"}),r.jsx("p",{className:"text-xs text-gray-500 mt-1",children:"Pixels within this E threshold keep their original color instead of snapping to palette. Higher = more detail preserved."})]})]})]})]}),!se&&r.jsx("div",{className:"p-4 border-t border-gray-700 bg-gray-800/30 flex-shrink-0",children:r.jsxs("button",{onClick:Wt,className:"w-full bg-green-600 hover:bg-green-500 text-white py-2 rounded font-semibold transition-colors flex items-center justify-center gap-2",children:[r.jsx("span",{children:""}),r.jsx("span",{children:"Execute"})]})})]}),r.jsxs("div",{className:"flex-1 bg-gray-900 relative overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between px-4 py-3 bg-gray-800/50 border-b border-gray-700 flex-shrink-0",children:[r.jsxs("div",{className:"flex items-center gap-3",children:[r.jsx("span",{className:"text-xs text-gray-400",children:"Preview"}),r.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:se,onChange:V=>Be(V.target.checked),className:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-800"}),r.jsx("span",{className:"text-xs text-gray-400 select-none",children:"Auto-update"})]}),r.jsxs("label",{className:"flex items-center gap-1 cursor-pointer",title:"Always fit preview to screen",children:[r.jsx("input",{type:"checkbox",checked:lt,onChange:V=>Et(V.target.checked),className:"rounded border-gray-600 bg-gray-700 text-blue-600 focus:ring-blue-500 focus:ring-offset-gray-800"}),r.jsx("span",{className:"text-xs text-gray-400 select-none",children:"Pin Fit"})]}),r.jsxs("div",{className:"flex items-center gap-1 ml-2 border-l border-gray-700 pl-2",children:[r.jsx("button",{onClick:()=>Tn(0),className:"bg-gray-700 px-1.5 py-0.5 rounded hover:bg-gray-600 text-xs text-gray-300",title:"Show original (before)",children:" Before"}),r.jsx("button",{onClick:()=>Tn(100),className:"bg-gray-700 px-1.5 py-0.5 rounded hover:bg-gray-600 text-xs text-gray-300",title:"Show pixelated (after)",children:"After "})]})]}),r.jsxs("div",{className:"flex space-x-2 items-center",children:[r.jsx("button",{onClick:sa,className:"bg-gray-700 p-1 rounded hover:bg-gray-600 text-sm font-bold",title:"Zoom out",children:""}),r.jsxs("span",{className:"bg-gray-700 px-2 py-1 rounded text-sm font-mono min-w-[50px] text-center",children:[Math.round(X*100),"%"]}),r.jsx("button",{onClick:Fr,className:"bg-gray-700 p-1 rounded hover:bg-gray-600 text-sm font-bold",title:"Zoom in",children:"+"}),r.jsx("button",{onClick:Kn,className:"bg-gray-700 px-2 py-1 rounded hover:bg-gray-600 text-xs",title:"Fit to screen",children:"Fit"}),r.jsx("button",{onClick:Ko,className:"bg-gray-700 px-2 py-1 rounded hover:bg-gray-600 text-xs",title:"Reset zoom",children:"Reset"})]})]}),J&&r.jsx("div",{className:"absolute top-14 right-4 z-20 pointer-events-none",children:r.jsxs("div",{className:"bg-gray-900/90 border border-gray-700 text-gray-200 text-xs px-3 py-1.5 rounded shadow-lg flex items-center gap-2",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Generating..."]})}),r.jsx("div",{ref:ft,className:"flex-1 overflow-auto bg-gray-900",children:re?r.jsx("div",{style:{display:"inline-block",padding:"20px"},children:r.jsxs("div",{ref:pt,className:"relative select-none",style:{width:ae?`${ae.width*X}px`:"auto",height:ae?`${ae.height*X}px`:"auto",cursor:vt.current?"ew-resize":void 0},onMouseDown:V=>{(V.target===pt.current||V.target.closest("[data-compare-area]"))&&(vt.current=!0,On(V.clientX))},children:[r.jsx("img",{ref:Ue,src:a.imageData,alt:"Original",draggable:!1,"data-compare-area":!0,style:{position:"absolute",top:0,left:0,width:"100%",height:"100%",objectFit:"fill",imageRendering:"pixelated",pointerEvents:"none"}}),r.jsx("img",{ref:Ke,src:re,alt:"Preview",draggable:!1,onLoad:Jt,"data-compare-area":!0,style:{position:"relative",width:"100%",height:"100%",maxWidth:"none",imageRendering:"pixelated",clipPath:`polygon(0 0, ${Kt}% 0, ${Kt}% 100%, 0 100%)`,pointerEvents:"none"}}),Kt>0&&Kt<100&&r.jsx("div",{style:{position:"absolute",top:0,left:`${Kt}%`,transform:"translateX(-50%)",width:"2px",height:"100%",background:"white",boxShadow:"0 0 4px rgba(0,0,0,0.7)",cursor:"ew-resize",zIndex:10},onMouseDown:_r,children:r.jsx("div",{style:{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",width:"24px",height:"24px",background:"white",borderRadius:"50%",boxShadow:"0 0 6px rgba(0,0,0,0.5)",display:"flex",alignItems:"center",justifyContent:"center",cursor:"ew-resize"},children:r.jsx("span",{style:{fontSize:"10px",color:"#333",fontWeight:"bold",userSelect:"none"},children:""})})}),Kt>5&&Kt<95&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"absolute top-2 left-2 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none",style:{zIndex:11},children:"After"}),r.jsx("div",{className:"absolute top-2 right-2 bg-black/60 text-white text-[10px] px-1.5 py-0.5 rounded pointer-events-none",style:{zIndex:11},children:"Before"})]})]})}):r.jsx("div",{className:"absolute inset-0 flex items-center justify-center text-gray-500",children:"Click Execute to generate preview"})}),r.jsx("div",{className:"px-4 py-3 bg-gray-800/50 border-t border-gray-700 flex-shrink-0",children:r.jsx("button",{onClick:Dn,disabled:!re,className:"w-full bg-blue-600 hover:bg-blue-500 disabled:bg-gray-600 disabled:cursor-not-allowed text-white py-2 rounded font-semibold transition-colors",children:"Apply Pixelation"})})]}),r.jsx(lp,{isOpen:fe,onClose:()=>Ne(!1),imageDataUrl:a.imageData,onAddColors:vr}),r.jsx(dp,{isOpen:Fe,onClose:()=>ze(!1),onAddColors:ca}),r.jsx(fp,{isOpen:$e,onClose:()=>Ye(!1),imageDataUrl:a.imageData,onAddColors:vr})]})})},ea=5,yp=({isOpen:l,onClose:c,layer:a})=>{const d=T(Z=>Z.updateLayer),u=T(Z=>Z.project.layers),y=T(Z=>Z.cropCanvasToLayers),[m,w]=g.useState(null),[f,p]=g.useState(null),[v,b]=g.useState(1),[N,P]=g.useState(null),[j,C]=g.useState(!1),M=g.useRef(null),D=g.useRef(null),z=g.useRef(null),q=g.useRef({cropRect:null,zoom:1,imageDimensions:null,isDragging:!1});g.useEffect(()=>{q.current.cropRect=N,q.current.zoom=v,q.current.imageDimensions=f},[N,v,f]),g.useEffect(()=>{!l||!a.imageData||(w(a.imageData),b(1),P(null),C(!1))},[l,a.imageData]);const U=Z=>{const J=Z.currentTarget,A={width:J.naturalWidth,height:J.naturalHeight};p(A),P({x:0,y:0,width:A.width,height:A.height})},R=(Z,J)=>{if(!z.current)return 1;const A=z.current.clientWidth,X=z.current.clientHeight;if(A<=0||X<=0)return 1;const $=A/Z,ae=X/J,O=Math.min($,ae);return Math.max(.1,O*.9)};g.useEffect(()=>{f&&z.current&&!j&&setTimeout(()=>{const Z=R(f.width,f.height);b(Z),C(!0)},100)},[f,j]);const k=(Z,J)=>{if(Z.preventDefault(),!D.current||!q.current.cropRect||!q.current.imageDimensions)return;q.current.isDragging=!0;const A=Z.clientX,X=Z.clientY,$={...q.current.cropRect},ae=q.current.zoom,O=q.current.imageDimensions,oe=x=>{if(!q.current.isDragging)return;const I=(x.clientX-A)/ae,ne=(x.clientY-X)/ae;let K={...$};J==="move"?(K.x=$.x+I,K.y=$.y+ne):(J.includes("n")&&(K.y=$.y+ne,K.height=$.height-ne),J.includes("s")&&(K.height=$.height+ne),J.includes("w")&&(K.x=$.x+I,K.width=$.width-I),J.includes("e")&&(K.width=$.width+I)),K.x=Math.max(0,Math.min(K.x,O.width-ea)),K.y=Math.max(0,Math.min(K.y,O.height-ea)),K.width=Math.max(ea,Math.min(K.width,O.width-K.x)),K.height=Math.max(ea,Math.min(K.height,O.height-K.y)),P(K),q.current.cropRect=K},_=()=>{q.current.isDragging=!1,document.removeEventListener("mousemove",oe),document.removeEventListener("mouseup",_)};document.addEventListener("mousemove",oe),document.addEventListener("mouseup",_)},F=()=>b(Z=>Math.min(5,Z+.25)),H=()=>b(Z=>Math.max(.1,Z-.25)),re=()=>{b(f?R(f.width,f.height):1)},ee=async()=>{if(!m||!f)return;const Z=new Image;Z.src=m,await new Promise(I=>{Z.onload=I,Z.onerror=I});const J=document.createElement("canvas");J.width=f.width,J.height=f.height;const A=J.getContext("2d");if(!A)return;A.drawImage(Z,0,0);const $=A.getImageData(0,0,f.width,f.height).data;let ae=f.width,O=f.height,oe=-1,_=-1;for(let I=0;I<$.length;I+=4)if($[I+3]>0){const K=I/4,de=K%f.width,ue=Math.floor(K/f.width);ae=Math.min(ae,de),O=Math.min(O,ue),oe=Math.max(oe,de),_=Math.max(_,ue)}if(oe<ae||_<O)return;const x={x:ae,y:O,width:oe-ae+1,height:_-O+1};P(x),q.current.cropRect=x},W=async()=>{if(!N||!f||!m)return;const Z=new Image;Z.src=m,await new Promise($=>{Z.onload=$,Z.onerror=$});const J=document.createElement("canvas");J.width=Math.round(N.width),J.height=Math.round(N.height);const A=J.getContext("2d");if(!A)return;A.imageSmoothingQuality="high",A.drawImage(Z,Math.round(N.x),Math.round(N.y),Math.round(N.width),Math.round(N.height),0,0,Math.round(N.width),Math.round(N.height));const X=J.toDataURL();d(a.id,{imageData:X,width:Math.round(N.width),height:Math.round(N.height)}),u.length===1&&setTimeout(()=>{y(),window.fitCanvasToScreen?.()},50),c()};return r.jsx(fo,{isOpen:l,title:"Crop",onClose:c,modalId:"modal-crop",children:r.jsxs("div",{className:"flex flex-col h-full p-4 gap-4 text-gray-200",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("label",{className:"text-sm font-medium",children:"Preview"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("button",{id:"btn-crop-zoom-out",onClick:H,disabled:v<=.1,className:"p-1 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Zoom out","aria-label":"Zoom out",children:""}),r.jsxs("span",{className:"text-xs text-gray-400 min-w-[45px] text-center",children:[Math.round(v*100),"%"]}),r.jsx("button",{id:"btn-crop-zoom-in",onClick:F,disabled:v>=5,className:"p-1 text-gray-400 hover:text-white disabled:opacity-30 disabled:cursor-not-allowed transition-colors",title:"Zoom in","aria-label":"Zoom in",children:"+"}),r.jsx("button",{id:"btn-crop-zoom-reset",onClick:re,className:"text-xs px-2 py-1 text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Reset zoom","aria-label":"Reset zoom",children:"Reset"}),r.jsx("button",{id:"btn-crop-auto",onClick:ee,className:"text-xs px-2 py-1 text-cyan-200 bg-cyan-900 hover:bg-cyan-800 rounded transition-colors",title:"Auto-crop to remove transparent edges","aria-label":"Auto-crop transparent edges",children:"Auto"})]})]}),r.jsxs("div",{className:"flex gap-4 text-xs text-gray-400",children:[r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Original:"})," ",f?`${f.width}${f.height}`:""]}),r.jsxs("div",{children:[r.jsx("span",{className:"text-gray-500",children:"Crop:"})," ",N?`${Math.round(N.width)}${Math.round(N.height)}`:""]})]}),r.jsx("div",{className:"flex-1 relative w-full bg-gray-900 rounded border border-gray-700 overflow-auto",ref:z,children:m?r.jsxs("div",{ref:M,style:{display:"inline-block",padding:10,position:"relative"},children:[r.jsx("img",{ref:D,src:m,alt:"Preview",onLoad:U,style:{width:f?`${f.width*v}px`:"auto",height:f?`${f.height*v}px`:"auto",display:"block",maxWidth:"none",userSelect:"none"}}),f&&N&&r.jsxs("div",{style:{position:"absolute",left:10+N.x*v,top:10+N.y*v,width:Math.max(0,N.width*v),height:Math.max(0,N.height*v),boxSizing:"border-box",border:"2px dashed rgba(100,200,255,0.8)",pointerEvents:"none"},children:[r.jsx("div",{onMouseDown:Z=>k(Z,"move"),style:{position:"absolute",inset:0,cursor:"move",pointerEvents:"auto",background:"rgba(100,200,255,0.05)"}}),[{type:"nw",left:-6,top:-6,cursorStyle:"nw-resize"},{type:"n",left:"50%",top:-6,transform:"translateX(-50%)",cursorStyle:"n-resize"},{type:"ne",right:-6,top:-6,cursorStyle:"ne-resize"},{type:"e",right:-6,top:"50%",transform:"translateY(-50%)",cursorStyle:"e-resize"},{type:"se",right:-6,bottom:-6,cursorStyle:"se-resize"},{type:"s",left:"50%",bottom:-6,transform:"translateX(-50%)",cursorStyle:"s-resize"},{type:"sw",left:-6,bottom:-6,cursorStyle:"sw-resize"},{type:"w",left:-6,top:"50%",transform:"translateY(-50%)",cursorStyle:"w-resize"}].map(({type:Z,cursorStyle:J,...A})=>r.jsx("div",{onMouseDown:X=>k(X,Z),style:{position:"absolute",width:12,height:12,background:"#fff",border:"1px solid #000",borderRadius:2,cursor:J,pointerEvents:"auto",boxSizing:"border-box",...A}},Z))]})]}):r.jsx("div",{className:"absolute inset-0 flex items-center justify-center",children:r.jsx("div",{className:"text-gray-500",children:"No preview available"})})}),r.jsxs("div",{className:"flex items-center justify-end gap-2 pt-4 border-t border-gray-700",children:[r.jsx("button",{id:"btn-crop-cancel",onClick:c,className:"px-4 py-2 text-sm font-medium text-gray-300 bg-gray-700 rounded hover:bg-gray-600 transition-colors","aria-label":"Cancel crop",children:"Cancel"}),r.jsx("button",{id:"btn-crop-apply",onClick:W,disabled:!N,className:"px-4 py-2 text-sm font-medium text-white bg-blue-600 rounded hover:bg-blue-500 disabled:opacity-50 disabled:cursor-not-allowed transition-colors","aria-label":"Apply crop",children:"Apply"})]})]})})};function qu(){const l=T(b=>b.project),c=T(b=>b.selectedLayerIds),a=l.layers.filter(b=>c.includes(b.id)),[d,u]=g.useState(!1),[y,m]=g.useState(!1),[w,f]=g.useState(!1),[p,v]=g.useState(!1);return r.jsxs("div",{className:"h-full flex flex-col bg-canvas-bg overflow-hidden","data-region":"property-panel",children:[r.jsx("div",{className:"px-3 py-3 border-b border-border",children:r.jsx("h2",{className:"text-sm font-semibold text-gray-300",children:"Properties"})}),r.jsx("div",{className:"flex-1 overflow-y-auto",children:c.length===0?r.jsxs("div",{className:"p-4 text-center text-sm text-gray-500",children:[r.jsx("div",{className:"mb-2",children:"No layer selected"}),r.jsx("div",{className:"text-xs",children:"Select a layer to edit properties"})]}):r.jsxs("div",{className:"p-3 space-y-4",children:[r.jsxs("div",{className:"bg-panel-bg rounded p-2 text-xs text-gray-400",children:[r.jsx("div",{className:"font-semibold text-gray-300 mb-1",children:"Selected"}),a.map(b=>r.jsx("div",{className:"truncate",children:b.name},b.id))]}),c.length===1&&a.length>0&&r.jsx(Wh,{layer:a[0]}),c.length===1&&a.length>0&&r.jsx(Hh,{layer:a[0]}),c.length===1&&a.length>0&&r.jsx(Yh,{layer:a[0]}),c.length===1&&a.length>0&&a[0].shapeType&&r.jsx(Kh,{layer:a[0]}),c.length===1&&a.length>0&&r.jsxs("div",{"data-region":"actions-menu",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300 mb-2",children:"Modify"}),r.jsxs("div",{className:"flex flex-col gap-0.5",id:"modify-actions",children:[r.jsxs("button",{id:"btn-open-transparency-modal",onClick:()=>u(!0),className:"flex items-center gap-2 w-full text-left px-2 py-1.5 text-xs text-gray-300 hover:bg-slate-700/50 hover:text-white rounded transition-colors","aria-label":"Open transparency masking",children:[r.jsxs("svg",{className:"w-4 h-4 flex-shrink-0 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M12 22C6.477 22 2 17.523 2 12S6.477 2 12 2s10 4.477 10 10"}),r.jsx("path",{d:"M12 2v20"}),r.jsx("path",{d:"M22 12H12"}),r.jsx("path",{d:"M19 15l3-3-3-3"})]}),r.jsx("span",{children:"Transparency Mask"})]}),r.jsxs("button",{id:"btn-open-crop-modal",onClick:()=>f(!0),className:"flex items-center gap-2 w-full text-left px-2 py-1.5 text-xs text-gray-300 hover:bg-slate-700/50 hover:text-white rounded transition-colors","aria-label":"Open crop tool",children:[r.jsxs("svg",{className:"w-4 h-4 flex-shrink-0 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M6 2v14a2 2 0 002 2h14"}),r.jsx("path",{d:"M18 22V8a2 2 0 00-2-2H2"})]}),r.jsx("span",{children:"Crop"})]}),r.jsxs("button",{id:"btn-open-pixelator-modal",onClick:()=>m(!0),className:"flex items-center gap-2 w-full text-left px-2 py-1.5 text-xs text-gray-300 hover:bg-slate-700/50 hover:text-white rounded transition-colors","aria-label":"Open pixelator / resize",children:[r.jsxs("svg",{className:"w-4 h-4 flex-shrink-0 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("rect",{x:"2",y:"2",width:"8",height:"8",rx:"1"}),r.jsx("rect",{x:"14",y:"2",width:"8",height:"8",rx:"1"}),r.jsx("rect",{x:"2",y:"14",width:"8",height:"8",rx:"1"}),r.jsx("rect",{x:"14",y:"14",width:"4",height:"4",rx:"0.5"})]}),r.jsx("span",{children:"Pixelator / Resize"})]}),r.jsxs("button",{id:"btn-open-bg-removal-modal",onClick:()=>v(!0),className:"flex items-center gap-2 w-full text-left px-2 py-1.5 text-xs text-gray-300 hover:bg-slate-700/50 hover:text-white rounded transition-colors","aria-label":"Open background removal",children:[r.jsxs("svg",{className:"w-4 h-4 flex-shrink-0 text-gray-400",viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:"2",strokeLinecap:"round",strokeLinejoin:"round",children:[r.jsx("path",{d:"M5 3a2 2 0 00-2 2v14a2 2 0 002 2h14a2 2 0 002-2V5a2 2 0 00-2-2H5z"}),r.jsx("path",{d:"M9 3v18"}),r.jsx("path",{d:"M3 9h6"}),r.jsx("path",{d:"M3 15h6"})]}),r.jsx("span",{children:"BG Removal"})]})]})]}),c.length===1&&a.length>0&&r.jsx(qh,{isOpen:d,onClose:()=>u(!1),layer:a[0]}),c.length===1&&a.length>0&&r.jsx(xp,{isOpen:y,onClose:()=>m(!1),layer:a[0]}),c.length===1&&a.length>0&&r.jsx(ap,{isOpen:p,onClose:()=>v(!1),layer:a[0]}),c.length===1&&a.length>0&&r.jsx(yp,{isOpen:w,onClose:()=>f(!1),layer:a[0]}),c.length>1&&r.jsx(vp,{})]})})]})}function vp(){const l=T(d=>d.moveSelectedLayers),c=T(d=>d.selectedLayerIds),a=(d,u)=>{console.log(`[DEBUG] Moving ${c.length} layers by (${d}, ${u})`),l(d,u)};return r.jsxs("div",{className:"bg-panel-bg rounded p-3 space-y-3",children:[r.jsx("div",{className:"text-xs font-semibold text-gray-300",children:"Move Selected"}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Offset X"}),r.jsx("input",{id:"input-bulk-offset-x",type:"number",defaultValue:0,onKeyDown:d=>{if(d.key==="Enter"){const u=parseInt(d.target.value)||0;a(u,0),d.target.value="0"}},className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"Pixels","aria-label":"Offset X pixels"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-xs text-gray-400 block mb-1",children:"Offset Y"}),r.jsx("input",{id:"input-bulk-offset-y",type:"number",defaultValue:0,onKeyDown:d=>{if(d.key==="Enter"){const u=parseInt(d.target.value)||0;a(0,u),d.target.value="0"}},className:"w-full px-2 py-1 bg-canvas-bg border border-border rounded text-xs text-white focus:outline-none focus:ring-1 focus:ring-blue-400",placeholder:"Pixels","aria-label":"Offset Y pixels"})]})]}),r.jsxs("div",{className:"flex gap-1 text-xs",children:[r.jsx("button",{id:"btn-bulk-move-left",onClick:()=>a(-1,0),className:"flex-1 px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Move left 1px (Shift+)","aria-label":"Move left 1 pixel",children:""}),r.jsx("button",{id:"btn-bulk-move-right",onClick:()=>a(1,0),className:"flex-1 px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Move right 1px (Shift+)","aria-label":"Move right 1 pixel",children:""}),r.jsx("button",{id:"btn-bulk-move-up",onClick:()=>a(0,-1),className:"flex-1 px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Move up 1px (Shift+)","aria-label":"Move up 1 pixel",children:""}),r.jsx("button",{id:"btn-bulk-move-down",onClick:()=>a(0,1),className:"flex-1 px-2 py-1 bg-gray-700 hover:bg-gray-600 rounded transition-colors",title:"Move down 1px (Shift+)","aria-label":"Move down 1 pixel",children:""})]})]})}function Ju(){const l=T(p=>p.project.viewport),c=T(p=>p.project.canvas),a=T(p=>p.setViewport),d=[25,33,50,66,75,100,125,150,200,400,800,1600,3200],u=()=>{const p=document.querySelector('[data-region="canvas"]');if(!p)return 100;const v=p.clientWidth,b=p.clientHeight;if(v<=0||b<=0||c.width<=0||c.height<=0)return 100;const N=v/c.width,P=b/c.height,j=Math.min(N,P)*100,C=d.reduce((z,q)=>Math.abs(q-j)<Math.abs(z-j)?q:z),M=d.indexOf(C);return M>0?d[M-1]:C},y=p=>{a({zoom:p})},m=()=>{const p=l.zoom,v=d.find(b=>b>p)||d[d.length-1];y(v)},w=()=>{const p=l.zoom,v=[...d].reverse().find(b=>b<p)||d[0];y(v)},f=()=>{const p=u();a({zoom:p,panX:0,panY:0})};return r.jsxs("div",{className:"flex items-center gap-2 bg-canvas-bg rounded px-2 py-1","data-region":"zoom-controls",children:[r.jsx("button",{id:"btn-zoom-out",onClick:w,className:"px-2 py-1 text-sm font-medium text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700 rounded transition-colors",title:"Zoom Out","aria-label":"Zoom out",children:""}),r.jsxs("div",{className:"relative group",children:[r.jsxs("button",{id:"btn-zoom-level",className:"px-3 py-1 text-sm font-medium text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700 rounded transition-colors min-w-16 text-right",title:"Click to select zoom level","aria-label":`Current zoom: ${l.zoom}%`,children:[l.zoom,"%"]}),r.jsx("div",{className:"absolute right-0 mt-1 w-24 bg-panel-bg border border-border rounded shadow-lg opacity-0 invisible group-hover:opacity-100 group-hover:visible transition-all z-50",children:d.map(p=>r.jsxs("button",{id:`btn-zoom-preset-${p}`,onClick:()=>y(p),className:`w-full text-left px-3 py-1 text-sm transition-colors ${l.zoom===p?"bg-blue-600 text-white":"text-gray-300 hover:text-white hover:bg-gray-700"}`,"aria-label":`Set zoom to ${p}%`,children:[p,"%"]},p))})]}),r.jsx("button",{id:"btn-zoom-in",onClick:m,className:"px-2 py-1 text-sm font-medium text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700 rounded transition-colors",title:"Zoom In","aria-label":"Zoom in",children:"+"}),r.jsx("div",{className:"w-px h-4 bg-border"}),r.jsx("button",{id:"btn-zoom-reset",onClick:f,className:"px-2 py-1 text-xs font-medium text-gray-400 hover:text-gray-300 hover:bg-gray-700 rounded transition-colors",title:"Fit canvas to screen","aria-label":"Fit canvas to screen",children:"Reset"})]})}const wp="pixelconnect_projects",bp=1,xn="projects";function Zo(){return new Promise((l,c)=>{const a=indexedDB.open(wp,bp);a.onupgradeneeded=()=>{const d=a.result;d.objectStoreNames.contains(xn)||d.createObjectStore(xn,{keyPath:"id"})},a.onsuccess=()=>l(a.result),a.onerror=()=>c(a.error)})}async function jp(){const l=await Zo();return new Promise((c,a)=>{const y=l.transaction(xn,"readonly").objectStore(xn).getAll();y.onsuccess=()=>{const m=y.result.map(({id:w,name:f,savedAt:p,sizeBytes:v,thumbnailDataUrl:b,layerCount:N,canvasWidth:P,canvasHeight:j})=>({id:w,name:f,savedAt:p,sizeBytes:v,thumbnailDataUrl:b,layerCount:N,canvasWidth:P,canvasHeight:j}));m.sort((w,f)=>new Date(f.savedAt).getTime()-new Date(w.savedAt).getTime()),c(m)},y.onerror=()=>a(y.error)})}async function Sp(l){const c=await Zo();return new Promise((a,d)=>{const u=c.transaction(xn,"readwrite");u.objectStore(xn).put(l),u.oncomplete=()=>a(),u.onerror=()=>d(u.error)})}async function Np(l){const c=await Zo();return new Promise((a,d)=>{const m=c.transaction(xn,"readonly").objectStore(xn).get(l);m.onsuccess=()=>a(m.result),m.onerror=()=>d(m.error)})}async function kp(l){const c=await Zo();return new Promise((a,d)=>{const u=c.transaction(xn,"readwrite");u.objectStore(xn).delete(l),u.oncomplete=()=>a(),u.onerror=()=>d(u.error)})}async function Cp(l,c){const a=await Zo();return new Promise((d,u)=>{const y=a.transaction(xn,"readwrite"),m=y.objectStore(xn),w=m.get(l);w.onsuccess=()=>{const f=w.result;if(!f){u(new Error("Project not found"));return}f.name=c,m.put(f)},y.oncomplete=()=>d(),y.onerror=()=>u(y.error)})}function Ep(l,c,a,d=128){return new Promise(u=>{const y=document.createElement("canvas"),m=Math.min(d/c,d/a,1);y.width=Math.round(c*m),y.height=Math.round(a*m);const w=y.getContext("2d");w.scale(m,m);const f=[...l].filter(v=>v.visible).sort((v,b)=>v.zIndex-b.zIndex);let p=0;if(f.length===0){u(y.toDataURL("image/png"));return}f.forEach(v=>{const b=new Image;b.onload=()=>{p++,p===f.length&&(f.forEach(N=>{const P=new Image;P.src=N.imageData,w.globalAlpha=N.opacity,w.drawImage(P,N.x,N.y,N.width,N.height)}),w.globalAlpha=1,u(y.toDataURL("image/png")))},b.onerror=()=>{p++,p===f.length&&u(y.toDataURL("image/png"))},b.src=v.imageData})})}function Mp(l){return l<1024?`${l} B`:l<1024*1024?`${(l/1024).toFixed(1)} KB`:`${(l/(1024*1024)).toFixed(1)} MB`}function Pp(){const l=g.useRef(null),[c,a]=g.useState(1),[d,u]=g.useState(!1),[y,m]=g.useState(!1),[w,f]=g.useState(!1),p=T(F=>F.project),v=T(F=>F.resetProject),b=T(F=>F.loadProject),N=T(F=>F.markClean),P=g.useRef(null),j=g.useRef(null);g.useEffect(()=>{const F=H=>{P.current&&!P.current.contains(H.target)&&u(!1),j.current&&!j.current.contains(H.target)&&m(!1)};return document.addEventListener("mousedown",F),()=>document.removeEventListener("mousedown",F)},[]),g.useEffect(()=>{const F=H=>{const re=H.ctrlKey||H.metaKey;re&&H.key==="s"&&(H.preventDefault(),C()),re&&H.key==="o"&&(H.preventDefault(),l.current?.click())};return window.addEventListener("keydown",F),()=>window.removeEventListener("keydown",F)},[p]);const C=async()=>{u(!1);try{const F=oi(p),H=new Blob([F],{type:"application/json"}),re=URL.createObjectURL(H),ee=document.createElement("a");ee.href=re,ee.download=`${p.projectName||"untitled"}.pixcomp`,document.body.appendChild(ee),ee.click(),document.body.removeChild(ee),URL.revokeObjectURL(re),N()}catch(F){alert(`Error saving project: ${F instanceof Error?F.message:"Unknown error"}`)}},M=async()=>{u(!1);try{const F=await Oh(p.layers,p.canvas.width,p.canvas.height,c,p.canvas.backgroundColor),H=URL.createObjectURL(F),re=document.createElement("a");re.href=H,re.download=`${p.projectName||"composite"}_${c}x.png`,document.body.appendChild(re),re.click(),document.body.removeChild(re),URL.revokeObjectURL(H)}catch(F){alert(`Error exporting PNG: ${F instanceof Error?F.message:"Unknown error"}`)}},D=async()=>{u(!1);try{const F=oi(p),H=new Blob([F]).size,re=await Ep(p.layers,p.canvas.width,p.canvas.height),ee={id:`proj_${Date.now()}_${Math.random().toString(36).substr(2,6)}`,name:p.projectName||"Untitled",savedAt:new Date().toISOString(),sizeBytes:H,thumbnailDataUrl:re,layerCount:p.layers.length,canvasWidth:p.canvas.width,canvasHeight:p.canvas.height,projectJson:F};await Sp(ee),N(),alert(`Project saved locally: ${ee.name}`)}catch(F){alert(`Error saving locally: ${F instanceof Error?F.message:"Unknown error"}`)}},z=()=>{m(!1),l.current?.click()},q=()=>{m(!1),f(!0)},U=async F=>{const H=F.target.files;if(!(!H||H.length===0)){for(const re of Array.from(H))if(re.name.toLowerCase().endsWith(".pixcomp")||re.name.toLowerCase().endsWith(".json"))try{const ee=await re.text(),W=await na(ee);b(W),N()}catch(ee){alert(`Error loading project: ${ee instanceof Error?ee.message:"Unknown error"}`)}else if(re.type.startsWith("image/"))try{const ee=await new Promise((J,A)=>{const X=new FileReader;X.onload=$=>J($.target?.result),X.onerror=()=>A(new Error("Failed to read file")),X.readAsDataURL(re)}),W=new Image;W.src=ee,await new Promise((J,A)=>{W.onload=()=>J(),W.onerror=()=>A(new Error("Failed to load image"))});const Z=T.getState().addLayer;Z({name:re.name,imageData:ee,x:0,y:0,zIndex:T.getState().project.layers.length,visible:!0,locked:!1,opacity:1,width:W.naturalWidth,height:W.naturalHeight})}catch(ee){alert(`Error loading image ${re.name}: ${ee instanceof Error?ee.message:"Unknown error"}`)}l.current&&(l.current.value="")}},R=()=>{T.getState().isDirty&&!window.confirm("You have unsaved changes. Create new project anyway?")||v()},k=async F=>{try{const H=await Np(F);if(!H){alert("Project not found");return}const re=await na(H.projectJson);b(re),N(),f(!1)}catch(H){alert(`Error loading project: ${H instanceof Error?H.message:"Unknown error"}`)}};return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"flex items-center gap-1","data-region":"file-operations",children:[r.jsx("button",{onClick:R,className:"px-3 py-1 text-sm font-medium text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700 rounded transition-colors",title:"New project",children:"New"}),r.jsxs("div",{ref:P,className:"relative",children:[r.jsxs("button",{onClick:()=>{u(!d),m(!1)},className:"px-3 py-1 text-sm font-medium text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700 rounded transition-colors flex items-center gap-1",title:"Save options",children:["Save",r.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:r.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),d&&r.jsxs("div",{className:"absolute left-0 mt-1 w-52 bg-panel-bg border border-border rounded shadow-lg z-50",children:[r.jsxs("button",{onClick:C,className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700 transition-colors rounded-t",children:[r.jsx("div",{className:"font-medium",children:"Export Project"}),r.jsx("div",{className:"text-xs text-gray-500",children:".pixcomp file download"})]}),r.jsxs("button",{onClick:M,className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700 transition-colors",children:[r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("div",{className:"font-medium",children:"Export Image"}),r.jsx("select",{onClick:F=>F.stopPropagation(),value:c,onChange:F=>a(parseInt(F.target.value)),className:"bg-gray-700 text-xs rounded px-1 py-0.5 text-gray-300 border border-gray-600",children:[1,2,4,8].map(F=>r.jsxs("option",{value:F,children:[F,"x"]},F))})]}),r.jsxs("div",{className:"text-xs text-gray-500",children:["PNG at ",c,"x scale"]})]}),r.jsx("div",{className:"border-t border-border"}),r.jsxs("button",{onClick:D,className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700 transition-colors rounded-b",children:[r.jsx("div",{className:"font-medium",children:"Save Local"}),r.jsx("div",{className:"text-xs text-gray-500",children:"Store in browser cache"})]})]})]}),r.jsxs("div",{ref:j,className:"relative",children:[r.jsxs("button",{onClick:()=>{m(!y),u(!1)},className:"px-3 py-1 text-sm font-medium text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700 rounded transition-colors flex items-center gap-1",title:"Load options (Ctrl+O)",children:["Load",r.jsx("svg",{className:"w-3 h-3",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:r.jsx("path",{d:"M19 9l-7 7-7-7"})})]}),y&&r.jsxs("div",{className:"absolute left-0 mt-1 w-52 bg-panel-bg border border-border rounded shadow-lg z-50",children:[r.jsxs("button",{onClick:z,className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700 transition-colors rounded-t",children:[r.jsx("div",{className:"font-medium",children:"Load File"}),r.jsx("div",{className:"text-xs text-gray-500",children:".pixcomp, PNG, GIF, BMP, JPEG"})]}),r.jsx("div",{className:"border-t border-border"}),r.jsxs("button",{onClick:q,className:"w-full text-left px-3 py-2 text-sm text-gray-300 hover:text-white hover:bg-gray-700 transition-colors rounded-b",children:[r.jsx("div",{className:"font-medium",children:"Load Local"}),r.jsx("div",{className:"text-xs text-gray-500",children:"From browser cache"})]})]})]}),r.jsx("input",{ref:l,type:"file",multiple:!0,accept:".pixcomp,.json,image/png,image/gif,image/bmp,image/jpeg",onChange:U,className:"hidden"})]}),w&&r.jsx(Dp,{onClose:()=>f(!1),onLoad:k})]})}function Dp({onClose:l,onLoad:c}){const[a,d]=g.useState([]),[u,y]=g.useState(!0),[m,w]=g.useState(null),[f,p]=g.useState(""),v=g.useCallback(async()=>{y(!0);try{const j=await jp();d(j)}catch(j){console.error("Failed to list saved projects:",j)}y(!1)},[]);g.useEffect(()=>{v()},[v]);const b=async(j,C)=>{window.confirm(`Delete saved project "${C}"?`)&&(await kp(j),v())},N=(j,C)=>{w(j),p(C)},P=async j=>{f.trim()&&(await Cp(j,f.trim()),v()),w(null)};return r.jsxs("div",{className:"fixed inset-0 z-[400] flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:l}),r.jsxs("div",{className:"relative bg-panel-bg border border-border rounded-lg shadow-2xl w-[600px] max-h-[80vh] overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-border",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-200",children:"Saved Projects (Local)"}),r.jsx("button",{onClick:l,className:"text-gray-400 hover:text-white p-1 rounded hover:bg-gray-700",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsx("div",{className:"overflow-y-auto flex-1 p-4",children:u?r.jsx("div",{className:"text-center text-gray-400 py-8",children:"Loading..."}):a.length===0?r.jsxs("div",{className:"text-center text-gray-500 py-12",children:[r.jsx("div",{className:"text-3xl mb-2",children:""}),r.jsx("div",{className:"text-sm",children:"No saved projects yet"}),r.jsx("div",{className:"text-xs text-gray-600 mt-1",children:"Use Save  Save Local to store projects in your browser"})]}):r.jsx("div",{className:"space-y-2",children:a.map(j=>r.jsxs("div",{className:"flex items-center gap-3 p-3 bg-gray-800/50 hover:bg-gray-700/50 rounded-lg transition-colors group",children:[r.jsx("div",{className:"w-14 h-14 rounded bg-gray-900 overflow-hidden flex-shrink-0 border border-gray-700",children:j.thumbnailDataUrl?r.jsx("img",{src:j.thumbnailDataUrl,alt:"",className:"w-full h-full object-contain",style:{imageRendering:"pixelated"}}):r.jsx("div",{className:"w-full h-full flex items-center justify-center text-gray-600 text-lg",children:"?"})}),r.jsxs("div",{className:"flex-1 min-w-0",children:[m===j.id?r.jsx("input",{autoFocus:!0,value:f,onChange:C=>p(C.target.value),onBlur:()=>P(j.id),onKeyDown:C=>{C.key==="Enter"&&P(j.id),C.key==="Escape"&&w(null)},className:"bg-gray-900 border border-blue-500 rounded px-2 py-0.5 text-sm text-white w-full focus:outline-none focus:ring-1 focus:ring-blue-400"}):r.jsx("div",{className:"text-sm font-medium text-gray-200 truncate",children:j.name}),r.jsxs("div",{className:"text-xs text-gray-500 mt-0.5",children:[Mp(j.sizeBytes),"  ",j.layerCount," layer",j.layerCount!==1?"s":"","  ",j.canvasWidth,"",j.canvasHeight]}),r.jsxs("div",{className:"text-xs text-gray-600",children:[new Date(j.savedAt).toLocaleDateString()," ",new Date(j.savedAt).toLocaleTimeString()]})]}),r.jsxs("div",{className:"flex items-center gap-1 opacity-0 group-hover:opacity-100 transition-opacity flex-shrink-0",children:[r.jsx("button",{onClick:()=>c(j.id),className:"px-3 py-1.5 text-xs font-medium bg-blue-600 hover:bg-blue-500 text-white rounded transition-colors",title:"Load this project",children:"Load"}),r.jsx("button",{onClick:()=>N(j.id,j.name),className:"p-1.5 text-gray-400 hover:text-white hover:bg-gray-600 rounded transition-colors",title:"Rename",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:r.jsx("path",{d:"M11 5H6a2 2 0 00-2 2v11a2 2 0 002 2h11a2 2 0 002-2v-5m-1.414-9.414a2 2 0 112.828 2.828L11.828 15H9v-2.828l8.586-8.586z"})})}),r.jsx("button",{onClick:()=>b(j.id,j.name),className:"p-1.5 text-gray-400 hover:text-red-400 hover:bg-gray-600 rounded transition-colors",title:"Delete",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-3.5 w-3.5",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:r.jsx("path",{d:"M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"})})})]})]},j.id))})})]})]})}function Lp(){const l=T(w=>w.history),c=T(w=>w.undo),a=T(w=>w.redo),d=l.past.length>0,u=l.future.length>0,y=()=>{c()},m=()=>{a()};return r.jsxs("div",{className:"flex items-center gap-1","data-region":"history-controls",children:[r.jsx("button",{id:"btn-undo",onClick:y,disabled:!d,className:`px-3 py-1 text-sm font-medium rounded transition-colors ${d?"text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700":"text-gray-600 bg-panel-bg cursor-not-allowed opacity-50"}`,title:`Undo (${l.past.length} operation${l.past.length!==1?"s":""} available) - Ctrl+Z`,"aria-label":"Undo",children:""}),r.jsx("button",{id:"btn-redo",onClick:m,disabled:!u,className:`px-3 py-1 text-sm font-medium rounded transition-colors ${u?"text-gray-300 hover:text-white bg-panel-bg hover:bg-gray-700":"text-gray-600 bg-panel-bg cursor-not-allowed opacity-50"}`,title:`Redo (${l.future.length} operation${l.future.length!==1?"s":""} available) - Ctrl+Shift+Z`,"aria-label":"Redo",children:""})]})}function Ip(){const l=T(u=>u.project.grid.enabled),c=T(u=>u.project.grid.density),a=T(u=>u.toggleGrid),d=T(u=>u.setGridDensity);return g.useEffect(()=>{const u=ra();u.gridEnabled=l,u.gridDensity=c,ai(u)},[l,c]),r.jsxs("div",{className:"flex items-center gap-1","data-region":"grid-toggle",children:[r.jsx("button",{id:"btn-toggle-grid",onClick:a,className:`px-2 py-1 rounded transition-colors ${l?"bg-gray-600 text-white hover:bg-gray-500":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,title:"Toggle pixel grid (shows lines between pixels)","aria-label":l?"Disable pixel grid":"Enable pixel grid","aria-pressed":l,children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[r.jsx("path",{d:"M3 3v18h18",strokeLinecap:"round",strokeLinejoin:"round"}),r.jsx("path",{d:"M3 9h18M3 15h18M9 3v18M15 3v18",strokeLinecap:"round"})]})}),l&&r.jsxs("div",{className:"flex items-center gap-1",children:[r.jsx("label",{className:"text-xs text-gray-400",children:"Density:"}),r.jsx("input",{id:"input-grid-density",type:"range",min:"1",max:"8",value:c,onChange:u=>d(parseInt(u.target.value)),className:"w-24 h-1 bg-gray-700 rounded-lg appearance-none cursor-pointer",title:`Grid density: every ${c} pixel(s)`,"aria-label":"Grid density"}),r.jsx("span",{className:"text-xs text-gray-400 w-6",children:c})]})]})}function Rp({onHelpClick:l}){const c=T(D=>D.project),a=T(D=>D.setProjectName),d=T(D=>D.ui.showSelectionBorders);T(D=>D.toggleSelectionBorders),T(D=>D.ui.showSelectionTools),T(D=>D.toggleSelectionTools);const u=T(D=>D.ui.leftClickPan),y=T(D=>D.toggleLeftClickPan),m=T(D=>D.ui.selectionBorderAnimationSpeed);T(D=>D.setSelectionBorderAnimationSpeed);const[w,f]=g.useState(!1),[p,v]=g.useState(!1),[b,N]=g.useState(c.projectName),P=Rr();g.useEffect(()=>{const D=ra();D.showSelectionBorders=d,D.selectionBorderAnimationSpeed=m,D.leftClickPan=u,ai(D)},[d,m,u]);const j=()=>{b.trim()?a(b.trim()):N(c.projectName),f(!1)},C=D=>{D.key==="Enter"?j():D.key==="Escape"&&(N(c.projectName),f(!1))},M=r.jsxs(r.Fragment,{children:[r.jsx(Ip,{}),r.jsx("button",{id:"btn-toggle-left-click-pan",onClick:y,title:u?"Pan mode ON: Left-click pans the canvas. Middle-click to drag layers. Hold Space to temporarily switch back. Click to toggle.":"Pan mode OFF: Left-click drags layers. Middle-click to pan. Hold Space to temporarily pan with left-click. Click to toggle.","aria-label":u?"Disable left-click panning":"Enable left-click panning","aria-pressed":u,className:`px-2 py-1 rounded transition-colors ${u?"bg-blue-600 text-white hover:bg-blue-500":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",d:"M7 11.5V14m0-2.5v-6a1.5 1.5 0 113 0m-3 6a1.5 1.5 0 00-3 0v2a7.5 7.5 0 0015 0v-5a1.5 1.5 0 00-3 0m-6-3V11m0-5.5v-1a1.5 1.5 0 013 0v1m0 0V11m0-5.5a1.5 1.5 0 013 0v3m0 0V11"})})}),!1]});return r.jsxs(r.Fragment,{children:[r.jsxs("div",{className:"bg-panel-bg border-b border-border px-4 py-2","data-region":"toolbar",children:[r.jsxs("div",{className:"flex items-center gap-2 flex-wrap",children:[r.jsxs("div",{className:"flex items-center gap-3 min-w-0",children:[r.jsxs("div",{className:"text-lg font-semibold whitespace-nowrap",children:[r.jsx("span",{className:"text-red-500",children:"Pi"}),r.jsx("span",{className:"text-sky-400 hidden sm:inline",children:"xelConnect"})]}),r.jsx("div",{className:"text-gray-500 hidden sm:block",children:"|"}),w?r.jsx("input",{id:"input-project-name",autoFocus:!0,type:"text",value:b,onChange:D=>N(D.target.value),onBlur:j,onKeyDown:C,className:"flex-1 px-2 py-1 bg-canvas-bg border border-blue-500 rounded text-sm text-white focus:outline-none focus:ring-2 focus:ring-blue-400",placeholder:"Project name...","aria-label":"Project name"}):r.jsx("button",{id:"btn-rename-project",onClick:()=>{N(c.projectName),f(!0)},className:"flex-1 text-left px-2 py-1 text-gray-300 hover:text-white hover:bg-canvas-bg rounded transition-colors truncate",title:"Click to rename project","aria-label":"Rename project",children:c.projectName})]}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx(Pp,{}),r.jsx("div",{className:"w-px h-6 bg-border"}),r.jsx(Lp,{}),r.jsx("div",{className:"w-px h-6 bg-border"}),r.jsx("button",{onClick:()=>v(!0),className:"px-2 py-1 rounded text-sm font-medium text-gray-300 hover:text-white hover:bg-gray-700 transition-colors",title:"Keyboard shortcuts","aria-label":"Keyboard shortcuts",children:r.jsxs("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",strokeWidth:2,children:[r.jsx("rect",{x:"2",y:"6",width:"20",height:"12",rx:"2"}),r.jsx("path",{d:"M6 10h0m4 0h0m4 0h0m4 0h0M8 14h8",strokeLinecap:"round"})]})}),l&&r.jsx(r.Fragment,{children:r.jsx("button",{onClick:l,className:"px-2 py-1 rounded text-sm font-bold text-blue-400 hover:text-white hover:bg-gray-700 transition-colors",title:"Open tutorial","aria-label":"Open tutorial",children:"?"})})]}),!P&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-px h-6 bg-border"}),r.jsx("div",{className:"flex items-center gap-2",children:M}),r.jsx("div",{className:"flex items-center gap-2 ml-auto",children:r.jsx(Ju,{})})]})]}),P&&r.jsxs("div",{className:"flex items-center gap-2 flex-wrap mt-2 pt-2 border-t border-border justify-between",children:[r.jsx("div",{className:"flex items-center gap-2 flex-wrap",children:M}),r.jsx(Ju,{})]})]}),p&&r.jsxs("div",{className:"fixed inset-0 z-[400] flex items-center justify-center",children:[r.jsx("div",{className:"absolute inset-0 bg-black/60",onClick:()=>v(!1)}),r.jsxs("div",{className:"relative bg-panel-bg border border-border rounded-lg shadow-2xl w-[520px] max-h-[80vh] overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex items-center justify-between px-5 py-3 border-b border-border",children:[r.jsx("h2",{className:"text-sm font-semibold text-gray-200",children:"Keyboard Shortcuts"}),r.jsx("button",{onClick:()=>v(!1),className:"text-gray-400 hover:text-white p-1 rounded hover:bg-gray-700",children:r.jsx("svg",{xmlns:"http://www.w3.org/2000/svg",className:"h-4 w-4",fill:"none",viewBox:"0 0 24 24",stroke:"currentColor",children:r.jsx("path",{strokeLinecap:"round",strokeLinejoin:"round",strokeWidth:2,d:"M6 18L18 6M6 6l12 12"})})})]}),r.jsxs("div",{className:"overflow-y-auto p-5 space-y-4 text-sm",children:[r.jsxs(Xo,{title:"General",children:[r.jsx(bt,{keys:"Ctrl + S",desc:"Save project"}),r.jsx(bt,{keys:"Ctrl + O",desc:"Open / load project"}),r.jsx(bt,{keys:"Ctrl + Z",desc:"Undo"}),r.jsx(bt,{keys:"Ctrl + Shift + Z",desc:"Redo"}),r.jsx(bt,{keys:"Ctrl + Y",desc:"Redo (alt)"})]}),r.jsxs(Xo,{title:"Layers",children:[r.jsx(bt,{keys:"Ctrl + A",desc:"Select all layers"}),r.jsx(bt,{keys:"Ctrl + D",desc:"Deselect all"}),r.jsx(bt,{keys:"Ctrl + C",desc:"Copy selected layers"}),r.jsx(bt,{keys:"Ctrl + V",desc:"Paste from clipboard"}),r.jsx(bt,{keys:"Delete / Backspace",desc:"Delete selected layers"}),r.jsx(bt,{keys:"Shift +  / ",desc:"Reorder layer up / down"})]}),r.jsxs(Xo,{title:"Movement",children:[r.jsx(bt,{keys:"Arrow keys",desc:"Nudge selected layer (1 px)"}),r.jsx(bt,{keys:"Hold arrow keys",desc:"Continuous nudge"})]}),r.jsxs(Xo,{title:"Viewport",children:[r.jsx(bt,{keys:"+ / ",desc:"Zoom in / out"}),r.jsx(bt,{keys:"0",desc:"Reset zoom to 100%"}),r.jsx(bt,{keys:"Scroll wheel",desc:"Zoom in / out (canvas)"}),r.jsx(bt,{keys:"Middle-click drag",desc:"Pan canvas"}),r.jsx(bt,{keys:"Space + drag",desc:"Pan canvas"})]}),r.jsxs(Xo,{title:"Other",children:[r.jsx(bt,{keys:"Ctrl + Shift + D",desc:"Debug history modal"}),r.jsx(bt,{keys:"Drop image file",desc:"Add as new layer"})]})]})]})]})]})}function Xo({title:l,children:c}){return r.jsxs("div",{children:[r.jsx("h3",{className:"text-xs font-semibold text-gray-400 uppercase mb-2",children:l}),r.jsx("div",{className:"space-y-1.5",children:c})]})}function bt({keys:l,desc:c}){return r.jsxs("div",{className:"flex items-center justify-between",children:[r.jsx("span",{className:"text-gray-300",children:c}),r.jsx("span",{className:"flex gap-1",children:l.split(" + ").map((a,d)=>r.jsxs(g.Fragment,{children:[d>0&&r.jsx("span",{className:"text-gray-500",children:"+"}),r.jsx("kbd",{className:"px-1.5 py-0.5 bg-gray-700 border border-gray-600 rounded text-xs font-mono text-gray-200",children:a.trim()})]},d))})]})}function Fp({isOpen:l,onClose:c}){const a=T(p=>p.history),d=T(p=>p.project),[u,y]=g.useState(null);if(!l)return null;const m=p=>`${p.projectName} | ${p.layers.length} layer(s) | Modified: ${new Date(p.modified).toLocaleTimeString()}`,w=(p,v)=>{const b=[];p.layers.length!==v.layers.length&&b.push(`Layer count: ${p.layers.length}  ${v.layers.length}`);for(let N=0;N<Math.max(p.layers.length,v.layers.length);N++){const P=p.layers[N],j=v.layers[N];P?j?(P.x!==j.x||P.y!==j.y||P.width!==j.width||P.height!==j.height)&&b.push(`${P.name}: (${P.x}, ${P.y})  (${j.x}, ${j.y})`):b.push(`Layer ${N}: added (${P.name})`):b.push(`Layer ${N}: removed`)}return b.length>0?b:["No layer changes"]},f=p=>{p.key==="Escape"&&c()};return r.jsx("div",{className:"fixed inset-0 bg-black/50 flex items-center justify-center z-50",onClick:c,onKeyDown:f,role:"dialog","aria-modal":"true","aria-label":"Debug History Modal",tabIndex:0,children:r.jsxs("div",{className:"bg-slate-900 border border-slate-700 rounded-lg shadow-2xl w-full max-w-2xl max-h-[80vh] flex flex-col",onClick:p=>p.stopPropagation(),children:[r.jsxs("div",{className:"bg-slate-800 px-6 py-4 border-b border-slate-700 flex justify-between items-center",children:[r.jsxs("h2",{className:"text-lg font-semibold text-white flex items-center gap-2",children:[r.jsx("span",{className:"text-yellow-400",children:""}),"Debug History"]}),r.jsx("button",{onClick:c,className:"text-slate-400 hover:text-white transition-colors","aria-label":"Close debug menu",children:""})]}),r.jsxs("div",{className:"flex-1 overflow-hidden flex flex-col",children:[r.jsxs("div",{className:"flex-1 overflow-auto p-4 space-y-2",children:[r.jsxs("div",{className:"bg-slate-800 rounded p-3 border border-slate-700 sticky top-0",children:[r.jsx("div",{className:"text-sm font-semibold text-cyan-400 mb-1",children:"Current State"}),r.jsx("div",{className:"text-xs text-slate-300",children:m(d)})]}),a.past.length===0&&a.future.length===0?r.jsx("div",{className:"text-center text-slate-400 py-8",children:r.jsx("p",{className:"text-sm",children:"No history entries yet"})}):r.jsxs(r.Fragment,{children:[a.past.length>0&&r.jsxs("div",{children:[r.jsxs("div",{className:"text-xs font-semibold text-green-400 mb-2 px-1",children:["UNDO STACK (",a.past.length,")"]}),r.jsx("div",{className:"space-y-1",children:a.past.map((p,v)=>r.jsxs("div",{children:[r.jsx("button",{onClick:()=>y(u===`past-${v}`?null:`past-${v}`),className:"w-full text-left bg-slate-800 hover:bg-slate-700 rounded px-3 py-2 text-xs transition-colors border border-slate-700 hover:border-slate-600",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-green-400",children:""}),r.jsx("span",{className:"text-slate-300 flex-1",children:m(p)}),r.jsx("span",{className:"text-slate-500",children:u===`past-${v}`?"":""})]})}),u===`past-${v}`&&r.jsx("div",{className:"bg-slate-800/50 border-l-2 border-green-400 ml-4 mt-1 p-2 rounded text-xs text-slate-300 space-y-1",children:w(a.past[v+1]||d,p).map((b,N)=>r.jsxs("div",{className:"text-slate-400",children:[" ",b]},N))})]},`past-${v}`))})]}),a.future.length>0&&r.jsxs("div",{children:[r.jsxs("div",{className:"text-xs font-semibold text-blue-400 mb-2 px-1 mt-4",children:["REDO STACK (",a.future.length,")"]}),r.jsx("div",{className:"space-y-1",children:a.future.map((p,v)=>r.jsxs("div",{children:[r.jsx("button",{onClick:()=>y(u===`future-${v}`?null:`future-${v}`),className:"w-full text-left bg-slate-800 hover:bg-slate-700 rounded px-3 py-2 text-xs transition-colors border border-slate-700 hover:border-slate-600",children:r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsx("span",{className:"text-blue-400",children:""}),r.jsx("span",{className:"text-slate-300 flex-1",children:m(p)}),r.jsx("span",{className:"text-slate-500",children:u===`future-${v}`?"":""})]})}),u===`future-${v}`&&r.jsx("div",{className:"bg-slate-800/50 border-l-2 border-blue-400 ml-4 mt-1 p-2 rounded text-xs text-slate-300 space-y-1",children:w(d,p).map((b,N)=>r.jsxs("div",{className:"text-slate-400",children:[" ",b]},N))})]},`future-${v}`))})]})]})]}),r.jsxs("div",{className:"bg-slate-800 px-6 py-3 border-t border-slate-700 text-xs text-slate-400",children:[r.jsxs("div",{className:"flex justify-between",children:[r.jsxs("span",{children:["Stack size: ",a.past.length+a.future.length]}),r.jsxs("span",{children:["Max steps: ",a.maxSteps]})]}),r.jsx("div",{className:"text-slate-500 text-xs mt-1",children:"Press ESC or click overlay to close"})]})]})]})})}const lo="__text_canvas_preview__",zp=({isOpen:l,onClose:c,existingLayer:a})=>{const d=T(se=>se.addLayer),u=T(se=>se.updateLayer),y=T(se=>se.removeLayer),[m,w]=g.useState("Enter your text here"),[f,p]=g.useState(48),[v,b]=g.useState(Vo[0].value),[N,P]=g.useState("#FFCDD2"),[j,C]=g.useState("left"),[M,D]=g.useState(null),[z,q]=g.useState(!1),[U,R]=g.useState(""),[k,F]=g.useState(!1),[H,re]=g.useState(!1),[ee,W]=g.useState(!0),[Z,J]=g.useState(1.2),[A,X]=g.useState(0),[$,ae]=g.useState("normal"),[O,oe]=g.useState(0),[_,x]=g.useState(0),I=g.useRef(null),ne=g.useRef(null),K=g.useRef(!0);g.useEffect(()=>{if(a&&a.textContent!==void 0){w(a.textContent),p(a.fontSize||48),b(a.fontFamily||Vo[0].value),P(a.fontColor||"#FFCDD2"),C(a.textAlign||"left"),W(a.disableTransparency||!1),J(a.lineHeight||1.2),X(a.letterSpacing||0);const se=a.fontWeight||"normal";ae(se==="lighter"?"300":se),oe(a.x),x(a.y),K.current=a.visible}},[a]),g.useEffect(()=>{l&&Mh()},[l]),g.useEffect(()=>{!l||!m.trim()||de()},[m,f,v,N,j,ee,Z,A,$,l]),g.useEffect(()=>{if(H&&m.trim()&&M){if(a){const Be=T.getState().project.layers.find(Re=>Re.id===a.id);Be&&Be.visible&&u(a.id,{visible:!1})}ue()}else ve()},[H,M,m,O,_]),g.useEffect(()=>{if(!H)return;const se=T.subscribe(Be=>{const Re=Be.project.layers.find(te=>te.id===lo);Re&&(Math.abs(Re.x-O)>.1||Math.abs(Re.y-_)>.1)&&(oe(Re.x),x(Re.y))});return()=>{se()}},[H,O,_]),g.useEffect(()=>{l||ve()},[l]),g.useEffect(()=>{const se=Be=>{I.current&&!I.current.contains(Be.target)&&F(!1)};return document.addEventListener("mousedown",se),()=>document.removeEventListener("mousedown",se)},[]),g.useEffect(()=>{const Be=Ql().find(Re=>Re.value===v)?.weights||[400,700];($==="300"&&!Be.includes(300)||$==="bold"&&!Be.includes(700))&&ae("normal")},[v]);const de=async()=>{if(m.trim()){q(!0);try{const se=await ta({text:m,fontSize:f,fontFamily:v,color:N,textAlign:j,lineHeight:Z,disableTransparency:ee,letterSpacing:A,fontWeight:$});D(se.dataUrl)}catch(se){console.error("Failed to generate text preview:",se)}finally{q(!1)}}},ue=()=>{!M||!H||(ne.current!==null&&clearTimeout(ne.current),ne.current=window.setTimeout(()=>{const se=new Image;se.src=M,se.onload=()=>{if(T.getState().project.layers.find(te=>te.id===lo))u(lo,{imageData:M,width:se.naturalWidth,height:se.naturalHeight,opacity:.7,x:O,y:_});else if(H){const te={id:lo,name:" Canvas Preview (Temporary)",imageData:M,x:O,y:_,zIndex:Date.now()+1e6,visible:!0,locked:!1,opacity:.7,width:se.naturalWidth,height:se.naturalHeight};d(te)}}},50))},ve=()=>{ne.current!==null&&(clearTimeout(ne.current),ne.current=null);const se=T.getState().project.layers;if(se.find(Re=>Re.id===lo)&&y(lo),a){const Re=se.find(te=>te.id===a.id);Re&&!Re.visible&&u(a.id,{visible:!0})}},pe=async()=>{if(!m.trim()){alert("Please enter some text");return}q(!0);try{const se=await ta({text:m,fontSize:f,fontFamily:v,color:N,textAlign:j,lineHeight:Z,disableTransparency:ee,letterSpacing:A,fontWeight:$}),Be=H||a?O:0,Re=H||a?_:0;if(a)u(a.id,{imageData:se.dataUrl,width:se.width,height:se.height,x:Be,y:Re,textContent:m,fontSize:f,fontFamily:v,fontColor:N,textAlign:j,disableTransparency:ee,name:a.name,...Z!==1.2&&{lineHeight:Z},...A!==0&&{letterSpacing:A},...$!=="normal"&&{fontWeight:$}});else{const te={id:crypto.randomUUID(),name:`Text: ${m.substring(0,20)}${m.length>20?"...":""}`,imageData:se.dataUrl,x:Be,y:Re,zIndex:Date.now(),visible:!0,locked:!1,opacity:1,width:se.width,height:se.height,textContent:m,fontSize:f,fontFamily:v,fontColor:N,textAlign:j,disableTransparency:ee,...Z!==1.2&&{lineHeight:Z},...A!==0&&{letterSpacing:A},...$!=="normal"&&{fontWeight:$}};d(te)}ve(),c()}catch(se){console.error("Failed to create text layer:",se),alert("Failed to create text layer. Please try again.")}finally{q(!1)}},Se=Ql().filter(se=>se.name.toLowerCase().includes(U.toLowerCase())),Te=Se.filter(se=>se.category==="system"),De=Se.filter(se=>se.category==="google"),jt=Ql().find(se=>se.value===v),Ge=jt?.weights||[400,700],Qe=Ge.includes(300),Ct=Ge.includes(700),mt=!Qe&&!Ct;return r.jsx(fo,{isOpen:l,onClose:c,title:a?"Edit Text Layer":"Create Text Layer",noPadding:!0,modalId:"modal-text-layer",children:r.jsxs("div",{className:"flex text-gray-200 h-full w-full overflow-hidden",children:[r.jsxs("div",{className:"w-80 border-r border-gray-700 flex-shrink-0 flex flex-col overflow-hidden bg-gray-800",children:[r.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-5",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Content"}),r.jsxs("span",{className:"text-xs text-gray-500",children:[m.length," chars"]})]}),r.jsx("textarea",{value:m,onChange:se=>w(se.target.value),placeholder:"Enter text...",className:"w-full h-20 px-3 py-2 bg-gray-900 border border-gray-600 rounded text-white text-sm resize-none focus:outline-none focus:ring-1 focus:ring-blue-500"}),r.jsx("button",{onClick:()=>navigator.clipboard.writeText(m),disabled:!m.trim(),className:"w-full py-1 text-xs text-gray-400 hover:text-white bg-gray-700 hover:bg-gray-600 rounded transition-colors",children:"Copy Text"})]}),r.jsxs("div",{className:"space-y-3 border-t border-gray-700 pt-3",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Typography"}),r.jsxs("div",{className:"relative",ref:I,children:[r.jsxs("button",{onClick:()=>F(!k),className:"w-full px-3 py-1.5 bg-gray-900 border border-gray-600 rounded text-white text-sm text-left flex items-center justify-between hover:bg-gray-700",children:[r.jsx("span",{className:"truncate",children:jt?.name||"Arial"}),r.jsx("span",{className:"text-gray-500 text-xs",children:""})]}),k&&r.jsxs("div",{className:"absolute top-full left-0 right-0 mt-1 bg-gray-800 border border-gray-600 rounded shadow-xl z-50 max-h-60 overflow-y-auto",children:[r.jsx("div",{className:"p-2 sticky top-0 bg-gray-800 border-b border-gray-700",children:r.jsx("input",{type:"text",value:U,onChange:se=>R(se.target.value),placeholder:"Search...",className:"w-full px-2 py-1 bg-gray-900 border border-gray-600 rounded text-white text-xs focus:outline-none focus:border-blue-500",onClick:se=>se.stopPropagation(),autoFocus:!0})}),Te.length>0&&r.jsxs("div",{children:[r.jsx("div",{className:"px-2 py-1 text-[10px] font-bold text-gray-500 uppercase bg-gray-800/50",children:"System"}),Te.map(se=>r.jsx("button",{onClick:()=>{b(se.value),F(!1),R("")},className:`w-full px-3 py-1.5 text-left text-sm hover:bg-blue-600 hover:text-white ${v===se.value?"bg-blue-600 text-white":"text-gray-300"}`,style:{fontFamily:se.value},children:se.name},se.value))]}),De.length>0&&r.jsxs("div",{children:[r.jsx("div",{className:"px-2 py-1 text-[10px] font-bold text-gray-500 uppercase bg-gray-800/50 border-t border-gray-700",children:"Google Fonts"}),De.map(se=>r.jsx("button",{onClick:()=>{b(se.value),F(!1),R("")},className:`w-full px-3 py-1.5 text-left text-sm hover:bg-blue-600 hover:text-white ${v===se.value?"bg-blue-600 text-white":"text-gray-300"}`,style:{fontFamily:se.value},children:se.name},se.value))]})]})]}),r.jsxs("div",{className:"grid grid-cols-2 gap-2",children:[r.jsxs("div",{children:[r.jsx("label",{className:"text-[10px] text-gray-500 mb-1 block",children:"Size"}),r.jsx("input",{type:"number",value:f,onChange:se=>p(Math.max(1,Math.min(2e3,parseInt(se.target.value)||48))),className:"w-full px-2 py-1 bg-gray-900 border border-gray-600 rounded text-white text-sm"})]}),r.jsxs("div",{children:[r.jsx("label",{className:"text-[10px] text-gray-500 mb-1 block",children:"Weight"}),r.jsxs("select",{value:$,onChange:se=>ae(se.target.value),className:"w-full px-2 py-1 bg-gray-900 border border-gray-600 rounded text-white text-sm",disabled:mt,title:mt?"This font only has one weight":"",children:[Qe&&r.jsx("option",{value:"300",children:"Light"}),r.jsx("option",{value:"normal",children:"Normal"}),Ct&&r.jsx("option",{value:"bold",children:"Bold"})]}),mt&&r.jsx("span",{className:"text-[9px] text-gray-600 mt-0.5 block",children:"Single weight font"})]})]}),r.jsx("div",{className:"flex flex-wrap gap-1",children:[16,24,32,48,64,96].map(se=>r.jsx("button",{onClick:()=>p(se),className:`px-2 py-0.5 rounded text-[10px] border transition-colors ${f===se?"bg-blue-600 border-blue-500 text-white":"bg-gray-700 border-gray-600 text-gray-400 hover:bg-gray-600 hover:text-gray-200"}`,children:se},se))})]}),r.jsxs("div",{className:"space-y-3 border-t border-gray-700 pt-3",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Appearance"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"color",value:N,onChange:se=>P(se.target.value),className:"w-8 h-8 rounded cursor-pointer bg-transparent border-0 p-0"}),r.jsx("input",{type:"text",value:N,onChange:se=>P(se.target.value),className:"flex-1 px-2 py-1 bg-gray-900 border border-gray-600 rounded text-white text-sm font-mono uppercase"})]}),r.jsx("div",{className:"space-y-1",children:[["#FFFFFF","#E0E0E0","#C0C0C0","#A0A0A0","#808080","#606060","#404040","#202020","#000000"],["#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#D32F2F","#C62828","#B71C1C"],["#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FF9800","#FB8C00","#F57C00","#EF6C00","#E65100"],["#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FFEB3B","#FDD835","#FBC02D","#F9A825","#F57F17"],["#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32","#1B5E20"],["#B2EBF2","#80DEEA","#4DD0E1","#26C6DA","#00BCD4","#00ACC1","#0097A7","#00838F","#006064"],["#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0","#0D47A1"],["#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#7B1FA2","#6A1B9A","#4A148C"],["#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#C2185B","#AD1457","#880E4F"]].map((se,Be)=>r.jsx("div",{className:"flex gap-1",children:se.map(Re=>r.jsx("button",{onClick:()=>P(Re),className:`flex-1 aspect-square rounded-sm border ${N===Re?"border-white scale-110 z-10":"border-gray-600 hover:border-gray-400"}`,style:{backgroundColor:Re},title:Re},Re))},Be))}),r.jsxs("div",{children:[r.jsx("label",{className:"text-[10px] text-gray-500 mb-1 block",children:"Alignment"}),r.jsx("div",{className:"bg-gray-900 rounded border border-gray-600 p-0.5 flex",children:["left","center","right"].map(se=>r.jsx("button",{onClick:()=>C(se),className:`flex-1 py-1 rounded text-xs capitalize ${j===se?"bg-gray-700 text-white shadow-sm":"text-gray-400 hover:text-gray-300"}`,title:`Align ${se}`,children:se},se))})]})]}),r.jsxs("div",{className:"space-y-3 border-t border-gray-700 pt-3",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Spacing"}),r.jsxs("div",{className:"space-y-3",children:[r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mb-1",children:[r.jsx("span",{children:"Line Height"}),r.jsx("span",{children:Z.toFixed(1)})]}),r.jsx("input",{type:"range",min:"0.8",max:"2.0",step:"0.1",value:Z,onChange:se=>J(parseFloat(se.target.value)),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"})]}),r.jsxs("div",{children:[r.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500 mb-1",children:[r.jsx("span",{children:"Letter Spacing"}),r.jsxs("span",{children:[A,"px"]})]}),r.jsx("input",{type:"range",min:"-5",max:"10",step:"0.5",value:A,onChange:se=>X(parseFloat(se.target.value)),className:"w-full h-1 bg-gray-600 rounded-lg appearance-none cursor-pointer"})]})]})]}),r.jsx("div",{className:"pt-2",children:r.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-300 cursor-pointer hover:text-white select-none",children:[r.jsx("input",{type:"checkbox",checked:ee,onChange:se=>W(se.target.checked),className:"rounded bg-gray-700 border-gray-600 text-blue-600 focus:ring-offset-gray-800"}),r.jsx("span",{children:"Pixel Perfect (No AA)"})]})})]}),r.jsx("div",{className:"p-4 border-t border-gray-700 bg-gray-800/50",children:r.jsx("button",{onClick:pe,disabled:z||!m.trim(),className:"w-full py-2 bg-blue-600 hover:bg-blue-500 disabled:bg-gray-700 disabled:text-gray-500 rounded text-white font-semibold transition-colors text-sm",children:a?"Update Layer":"Create Layer"})})]}),r.jsxs("div",{className:"flex-1 bg-gray-900 relative flex flex-col min-w-0",children:[r.jsxs("div",{className:"h-10 border-b border-gray-700 flex items-center justify-between px-4 bg-gray-800/30",children:[r.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Preview"}),r.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-400 cursor-pointer hover:text-gray-200 select-none",children:[r.jsx("input",{type:"checkbox",checked:H,onChange:se=>re(se.target.checked),className:"rounded bg-gray-700 border-gray-600 text-blue-600 focus:ring-offset-gray-800"}),r.jsx("span",{children:"Show on Canvas"})]})]}),r.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-8 bg-[url('/grid-pattern.png')] bg-repeat",children:z?r.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Rendering..."]}):M?r.jsx("div",{className:"relative",children:r.jsx("img",{src:M,alt:"Text preview",className:"max-w-full max-h-full object-contain",style:{imageRendering:"pixelated"}})}):r.jsx("div",{className:"text-gray-600 text-sm italic",children:"Enter text to generate preview"})})]})]})})},io="__shape_canvas_preview__",Tp=["rectangle","circle","triangle","hexagon","octagon","star"],_p=({isOpen:l,onClose:c,existingLayer:a})=>{const d=T($=>$.addLayer),u=T($=>$.updateLayer),y=T($=>$.removeLayer),[m,w]=g.useState("rectangle"),[f,p]=g.useState(200),[v,b]=g.useState(1),[N,P]=g.useState(1),[j,C]=g.useState("#FFFFFF"),[M,D]=g.useState(null),[z,q]=g.useState(!1),[U,R]=g.useState(!0),[k,F]=g.useState(0),[H,re]=g.useState(0),ee=g.useRef(null),W=g.useRef(!0);g.useEffect(()=>{a&&a.shapeType!==void 0&&(w(a.shapeType),p(a.shapeSize||200),b(a.shapeStretchX||1),P(a.shapeStretchY||1),C(a.shapeColor||"#FFFFFF"),F(a.x),re(a.y),W.current=a.visible)},[a]),g.useEffect(()=>{l&&Z()},[m,f,v,N,j,l]),g.useEffect(()=>{if(U&&M){if(a){const ae=T.getState().project.layers.find(O=>O.id===a.id);ae&&ae.visible&&u(a.id,{visible:!1})}J()}else A()},[U,M,k,H]),g.useEffect(()=>{if(!U)return;const $=T.subscribe(ae=>{const O=ae.project.layers.find(oe=>oe.id===io);O&&(Math.abs(O.x-k)>.1||Math.abs(O.y-H)>.1)&&(F(O.x),re(O.y))});return()=>{$()}},[U,k,H]),g.useEffect(()=>{l||A()},[l]);const Z=async()=>{q(!0);try{const $=await Ir({shapeType:m,size:f,stretchX:v,stretchY:N,color:j});D($.dataUrl)}catch($){console.error("Failed to generate shape preview:",$)}finally{q(!1)}},J=()=>{!M||!U||(ee.current!==null&&clearTimeout(ee.current),ee.current=window.setTimeout(()=>{const $=new Image;$.src=M,$.onload=()=>{if(T.getState().project.layers.find(oe=>oe.id===io))u(io,{imageData:M,width:$.naturalWidth,height:$.naturalHeight,opacity:.7,x:k,y:H});else if(U){const oe={id:io,name:" Canvas Preview (Temporary)",imageData:M,x:k,y:H,zIndex:Date.now()+1e6,visible:!0,locked:!1,opacity:.7,width:$.naturalWidth,height:$.naturalHeight};d(oe)}}},50))},A=()=>{if(ee.current!==null&&(clearTimeout(ee.current),ee.current=null),T.getState().project.layers.find(O=>O.id===io)&&y(io),a){const O=T.getState().project.layers.find(oe=>oe.id===a.id);O&&!O.visible&&u(a.id,{visible:W.current})}},X=async()=>{if(M){q(!0);try{const $=await Ir({shapeType:m,size:f,stretchX:v,stretchY:N,color:j}),ae=U?k:-$.offsetX,O=U?H:-$.offsetY;if(a)u(a.id,{imageData:$.dataUrl,width:$.width,height:$.height,x:ae,y:O,shapeType:m,shapeSize:f,shapeStretchX:v,shapeStretchY:N,shapeColor:j,name:a.name});else{const oe={id:crypto.randomUUID(),name:`Shape: ${m}`,imageData:$.dataUrl,x:ae,y:O,zIndex:Date.now(),visible:!0,locked:!1,opacity:1,width:$.width,height:$.height,shapeType:m,shapeSize:f,shapeStretchX:v,shapeStretchY:N,shapeColor:j};d(oe)}A(),c()}catch($){console.error("Failed to create shape layer:",$),alert("Failed to create shape layer. Please try again.")}finally{q(!1)}}};return r.jsx(fo,{isOpen:l,onClose:c,title:a?"Edit Shape Layer":"Create Shape Layer",noPadding:!0,modalId:"modal-shape",children:r.jsxs("div",{className:"flex text-gray-200 h-full w-full overflow-hidden",children:[r.jsxs("div",{className:"w-80 border-r border-gray-700 flex-shrink-0 flex flex-col overflow-hidden bg-gray-800",children:[r.jsxs("div",{className:"overflow-y-auto flex-1 p-4 space-y-4",children:[r.jsxs("div",{className:"space-y-2",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Shape"}),r.jsx("div",{className:"grid grid-cols-3 gap-1",children:Tp.map($=>r.jsx("button",{onClick:()=>w($),className:`px-2 py-2 text-[10px] font-medium rounded transition-colors capitalize ${m===$?"bg-blue-600 text-white":"bg-gray-700 text-gray-300 hover:bg-gray-600"}`,children:$},$))})]}),r.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-3",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Size"}),r.jsxs("div",{className:"space-y-1",children:[r.jsx("input",{type:"range",min:"1",max:"500",value:f,onChange:$=>p(Number($.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"}),r.jsxs("div",{className:"flex items-center gap-2",children:[r.jsxs("span",{className:"text-xs text-gray-500",children:[f,"px"]}),r.jsx("input",{type:"number",value:f,onChange:$=>p(Math.max(1,Math.min(500,parseInt($.target.value)||f))),className:"flex-1 px-2 py-1 bg-gray-900 border border-gray-600 rounded text-xs text-white"})]})]}),r.jsx("div",{className:"flex flex-wrap gap-1",children:[50,100,150,200,300,400].map($=>r.jsx("button",{onClick:()=>p($),className:`px-2 py-0.5 rounded text-[10px] border transition-colors ${f===$?"bg-blue-600 border-blue-500 text-white":"bg-gray-700 border-gray-600 text-gray-400 hover:bg-gray-600"}`,children:$},$))})]}),r.jsxs("div",{className:"space-y-2 border-t border-gray-700 pt-3",children:[r.jsxs("div",{className:"flex justify-between items-center",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Stretch"}),r.jsx("button",{onClick:()=>{b(1),P(1)},className:"text-[10px] text-blue-400 hover:text-blue-300",children:"Reset"})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500",children:[r.jsx("span",{children:"Horizontal"}),r.jsxs("span",{children:[v.toFixed(2),"x"]})]}),r.jsx("input",{type:"range",min:"0.1",max:"20",step:"0.1",value:v,onChange:$=>b(Number($.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"})]}),r.jsxs("div",{className:"space-y-1",children:[r.jsxs("div",{className:"flex justify-between text-[10px] text-gray-500",children:[r.jsx("span",{children:"Vertical"}),r.jsxs("span",{children:[N.toFixed(2),"x"]})]}),r.jsx("input",{type:"range",min:"0.1",max:"20",step:"0.1",value:N,onChange:$=>P(Number($.target.value)),className:"w-full h-2 bg-gray-700 rounded-lg appearance-none cursor-pointer"})]})]}),r.jsxs("div",{className:"space-y-3 border-t border-gray-700 pt-3",children:[r.jsx("label",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Appearance"}),r.jsxs("div",{className:"flex gap-2",children:[r.jsx("input",{type:"color",value:j,onChange:$=>C($.target.value),className:"w-8 h-8 rounded cursor-pointer bg-transparent border-0 p-0"}),r.jsx("input",{type:"text",value:j,onChange:$=>C($.target.value),className:"flex-1 px-2 py-1 bg-gray-900 border border-gray-600 rounded text-white text-sm font-mono uppercase"})]}),r.jsx("div",{className:"space-y-1",children:[["#FFFFFF","#E0E0E0","#C0C0C0","#A0A0A0","#808080","#606060","#404040","#202020","#000000"],["#FFCDD2","#EF9A9A","#E57373","#EF5350","#F44336","#E53935","#D32F2F","#C62828","#B71C1C"],["#FFE0B2","#FFCC80","#FFB74D","#FFA726","#FF9800","#FB8C00","#F57C00","#EF6C00","#E65100"],["#FFF9C4","#FFF59D","#FFF176","#FFEE58","#FFEB3B","#FDD835","#FBC02D","#F9A825","#F57F17"],["#C8E6C9","#A5D6A7","#81C784","#66BB6A","#4CAF50","#43A047","#388E3C","#2E7D32","#1B5E20"],["#B2EBF2","#80DEEA","#4DD0E1","#26C6DA","#00BCD4","#00ACC1","#0097A7","#00838F","#006064"],["#BBDEFB","#90CAF9","#64B5F6","#42A5F5","#2196F3","#1E88E5","#1976D2","#1565C0","#0D47A1"],["#E1BEE7","#CE93D8","#BA68C8","#AB47BC","#9C27B0","#8E24AA","#7B1FA2","#6A1B9A","#4A148C"],["#F8BBD0","#F48FB1","#F06292","#EC407A","#E91E63","#D81B60","#C2185B","#AD1457","#880E4F"]].map(($,ae)=>r.jsx("div",{className:"flex gap-1",children:$.map(O=>r.jsx("button",{onClick:()=>C(O),className:`flex-1 aspect-square rounded-sm border ${j===O?"border-white scale-110 z-10":"border-gray-600 hover:border-gray-400"}`,style:{backgroundColor:O},title:O},O))},ae))})]}),r.jsx("div",{className:"space-y-2 border-t border-gray-700 pt-3",children:r.jsxs("label",{className:"flex items-center gap-2 text-xs font-semibold text-gray-400 uppercase cursor-pointer",children:[r.jsx("input",{type:"checkbox",checked:U,onChange:$=>R($.target.checked),className:"rounded cursor-pointer"}),"Preview on Canvas"]})})]}),r.jsxs("div",{className:"border-t border-gray-700 p-3 space-y-2",children:[r.jsx("button",{onClick:X,disabled:z,className:"w-full px-4 py-2 bg-blue-600 hover:bg-blue-700 text-white text-xs font-semibold rounded transition-colors disabled:opacity-50 disabled:cursor-not-allowed uppercase",children:z?"Processing...":a?"Update":"Create"}),r.jsx("button",{onClick:c,className:"w-full px-4 py-2 bg-gray-700 hover:bg-gray-600 text-gray-300 text-xs font-semibold rounded transition-colors uppercase",children:"Cancel"})]})]}),r.jsxs("div",{className:"flex-1 bg-gray-900 relative flex flex-col min-w-0",children:[r.jsxs("div",{className:"h-10 border-b border-gray-700 flex items-center justify-between px-4 bg-gray-800/30",children:[r.jsx("span",{className:"text-xs font-semibold text-gray-400 uppercase",children:"Preview"}),r.jsxs("label",{className:"flex items-center gap-2 text-xs text-gray-400 cursor-pointer hover:text-gray-200 select-none",children:[r.jsx("input",{type:"checkbox",checked:U,onChange:$=>R($.target.checked),className:"rounded bg-gray-700 border-gray-600 text-blue-600 focus:ring-offset-gray-800"}),r.jsx("span",{children:"Show on Canvas"})]})]}),r.jsx("div",{className:"flex-1 overflow-auto flex items-center justify-center p-8 bg-[url('/grid-pattern.png')] bg-repeat",children:z?r.jsxs("div",{className:"flex items-center gap-2 text-gray-400 text-sm",children:[r.jsx("div",{className:"w-2 h-2 bg-blue-500 rounded-full animate-pulse"}),"Rendering..."]}):M?r.jsx("div",{className:"relative",children:r.jsx("img",{src:M,alt:"Shape preview",className:"max-w-full max-h-full object-contain",style:{imageRendering:"pixelated"}})}):r.jsx("div",{className:"text-gray-600 text-sm italic",children:"Configure shape to generate preview"})})]})]})})};function Ap(){const l=T(k=>k.project),c=T(k=>k.selectedLayerIds),a=T(k=>k.selectAllLayers),d=T(k=>k.deselectAllLayers),u=T(k=>k.deleteSelectedLayers),y=T(k=>k.moveSelectedLayers),m=T(k=>k.setViewport),w=T(k=>k.undo),f=T(k=>k.redo),p=T(k=>k.copySelectedLayers),v=T(k=>k.copySelectedLayersToClipboard),b=T(k=>k.pasteSelectedLayers),N=T(k=>k.pasteFromClipboard),P=T(k=>k.reorderSelectedLayers),j=T(k=>k.setSpaceHeld),C=g.useRef(!1),M=g.useRef(0),D=g.useRef(0),z=g.useRef(new Set),q=g.useRef(null),U=()=>{q.current===null&&c.length!==0&&(q.current=window.setInterval(()=>{let k=0,F=0;const H={ArrowUp:[0,-1],ArrowDown:[0,1],ArrowLeft:[-1,0],ArrowRight:[1,0]};for(const[re,[ee,W]]of Object.entries(H))z.current.has(re)&&(k+=ee,F+=W);(z.current.has("ShiftLeft")||z.current.has("ShiftRight"))&&(k*=10,F*=10),(k!==0||F!==0)&&y(k,F)},50))},R=()=>{q.current!==null&&(clearInterval(q.current),q.current=null)};g.useEffect(()=>{const k=W=>{if((W.target instanceof HTMLInputElement||W.target instanceof HTMLTextAreaElement)&&!((W.ctrlKey||W.metaKey)&&(W.key==="s"||W.key==="o")))return;const Z=W.ctrlKey||W.metaKey,J=W.shiftKey;if(W.code==="Space"&&!W.repeat){W.preventDefault(),C.current=!0,j(!0);return}if(J&&!Z&&(W.key==="ArrowUp"||W.key==="ArrowDown")){if(c.length>0){W.preventDefault();const A=W.key==="ArrowUp"?"up":"down";P(A)}return}if(!J&&["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].includes(W.key)){W.preventDefault(),z.current.add(W.key),(z.current.has("ShiftLeft")||z.current.has("ShiftRight"))&&z.current.add("ShiftLeft"),U();return}if(W.key==="Shift"){z.current.add(W.code);return}if(Z&&W.key.toLowerCase()==="z"&&!J){W.preventDefault(),w();return}if(Z&&W.key.toLowerCase()==="z"&&J){W.preventDefault(),f();return}if(Z&&W.key.toLowerCase()==="y"){W.preventDefault(),f();return}if(W.key==="Delete"||W.key==="Backspace"){c.length>0&&(W.preventDefault(),window.confirm(`Delete ${c.length} layer${c.length!==1?"s":""}?`)&&u());return}if(Z&&W.key==="a"){W.preventDefault(),l.layers.length>0&&a();return}if(Z&&W.key==="d"){W.preventDefault(),d();return}if(Z&&W.key==="c"){c.length>0&&(W.preventDefault(),p(),v());return}if(Z&&W.key==="v"){W.preventDefault(),N();return}if((W.key==="+"||W.key==="=")&&!Z){W.preventDefault();const A=l.viewport.zoom,X=[25,50,100,200,400,800,1600],$=X.find(ae=>ae>A)||X[X.length-1];m({zoom:$});return}if(W.key==="-"&&!Z){W.preventDefault();const A=l.viewport.zoom,X=[25,50,100,200,400,800,1600],$=[...X].reverse().find(ae=>ae<A)||X[0];m({zoom:$});return}if(W.key==="0"){W.preventDefault(),m({zoom:100});return}},F=W=>{W.code==="Space"&&(C.current=!1,j(!1)),z.current.delete(W.key),z.current.delete(W.code),["ArrowUp","ArrowDown","ArrowLeft","ArrowRight"].some(J=>z.current.has(J))||R()},H=W=>{if(C.current){if(T.getState().ui.leftClickPan)return;M.current=W.clientX,D.current=W.clientY}},re=W=>{if(C.current&&(W.buttons&1)===1){if(T.getState().ui.leftClickPan)return;const J=W.clientX-M.current,A=W.clientY-D.current,X=l.viewport.zoom/100,$=-J/X,ae=-A/X;m({panX:l.viewport.panX+$,panY:l.viewport.panY+ae}),M.current=W.clientX,D.current=W.clientY}};window.addEventListener("keydown",k),window.addEventListener("keyup",F),window.addEventListener("mousedown",H),window.addEventListener("mousemove",re);const ee=()=>{C.current=!1,j(!1)};return window.addEventListener("blur",ee),()=>{window.removeEventListener("keydown",k),window.removeEventListener("keyup",F),window.removeEventListener("mousedown",H),window.removeEventListener("mousemove",re),window.removeEventListener("blur",ee),R(),C.current=!1,j(!1)}},[c,l,a,d,u,y,m,w,f,p,v,b,N,P,j])}function ed(l){const{viewport:c,...a}=l;return a}function Op(){const l=T(y=>y.project),c=T(y=>y.pushHistory),a=T(y=>y._lastHistoryPushAt),d=g.useRef(l),u=g.useRef(null);g.useEffect(()=>{u.current&&clearTimeout(u.current);const y=ed(l),m=ed(d.current);if(JSON.stringify(y)!==JSON.stringify(m)){if(a&&Date.now()-a<100){d.current=l;return}u.current=setTimeout(()=>{c(),d.current=l},500)}return()=>{u.current&&clearTimeout(u.current)}},[l,c,a])}function Bp(){const[l,c]=g.useState(!1);return g.useEffect(()=>{const a=d=>{(d.ctrlKey||d.metaKey)&&d.shiftKey&&d.key==="D"&&(d.preventDefault(),c(u=>!u))};return window.addEventListener("keydown",a),()=>window.removeEventListener("keydown",a)},[]),{isOpen:l,setIsOpen:c,toggle:()=>c(a=>!a)}}const $p="PixelConnectDB",uo="projects",ud="current_project",Up=1,dd=()=>new Promise((l,c)=>{const a=indexedDB.open($p,Up);a.onerror=()=>c(a.error),a.onsuccess=()=>l(a.result),a.onupgradeneeded=d=>{const u=d.target.result;u.objectStoreNames.contains(uo)||u.createObjectStore(uo)}}),Wp=async l=>{try{const c=await dd(),a=oi(l);return new Promise((d,u)=>{const w=c.transaction(uo,"readwrite").objectStore(uo).put(a,ud);w.onsuccess=()=>d(),w.onerror=()=>u(w.error)})}catch(c){console.error("Failed to save to cache:",c)}},Hp=async()=>{try{const l=await dd();return new Promise((c,a)=>{const y=l.transaction(uo,"readonly").objectStore(uo).get(ud);y.onsuccess=async()=>{const m=y.result;if(m)try{const w=await na(m);c(w)}catch(w){a(w)}else c(null)},y.onerror=()=>a(y.error)})}catch(l){return console.error("Failed to load from cache:",l),null}},Yp=2e3;function Xp(){const l=T(u=>u.project),c=T(u=>u.loadProject),a=g.useRef(),d=g.useRef(!1);g.useEffect(()=>{(async()=>{if(!d.current)try{const y=await Hp();if(y){console.log("[AutoSave] Restoring cached project...");const m={...y,layers:y.layers.filter(w=>w.id!=="__text_canvas_preview__"&&w.id!=="__shape_canvas_preview__")};c(m)}}catch(y){console.error("[AutoSave] Failed to restore project:",y)}finally{d.current=!0}})()},[c]),g.useEffect(()=>{if(d.current)return a.current&&clearTimeout(a.current),a.current=setTimeout(()=>{const u={...l,layers:l.layers.filter(y=>y.id!=="__text_canvas_preview__"&&y.id!=="__shape_canvas_preview__")};Wp(u)},Yp),()=>{a.current&&clearTimeout(a.current)}},[l])}const ti=[25,33,50,66,75,100,125,150,200,400,800,1600,3200];function td(l,c){const a=document.querySelector('[data-region="canvas"]');if(!a)return 100;const d=a.clientWidth,u=a.clientHeight;if(d<=0||u<=0||l<=0||c<=0)return 100;const y=d/l,m=u/c,w=Math.min(y,m)*100,f=ti.reduce((v,b)=>Math.abs(b-w)<Math.abs(v-w)?b:v),p=ti.indexOf(f);return p>0?ti[p-1]:f}function Vp(){const l=T(u=>u.project.layers),c=T(u=>u.cropCanvasToLayers),a=g.useRef(!1),d=g.useCallback(()=>{setTimeout(()=>{const u=T.getState(),y=td(u.project.canvas.width,u.project.canvas.height);u.setViewport({zoom:y,panX:0,panY:0})},50)},[]);g.useEffect(()=>(window.fitCanvasToScreen=d,()=>{delete window.fitCanvasToScreen}),[d]),g.useEffect(()=>{const u=l.length>0;if(u&&!a.current){a.current=!0;const y=setTimeout(()=>{c(),setTimeout(()=>{const m=T.getState(),w=td(m.project.canvas.width,m.project.canvas.height);m.setViewport({zoom:w,panX:0,panY:0})},50)},50);return()=>clearTimeout(y)}u||(a.current=!1)},[l.length,c])}const Gp=[{target:null,title:"Welcome to PixelConnect",description:"A pixel-art compositor and image editor. This quick tour will walk you through the key features. Press Next to continue or Skip to dismiss.",placement:"center"},{target:'[data-region="toolbar"]',title:"Toolbar",description:"Your main control bar. Rename your project, save/load files, undo/redo, toggle the grid overlay, selection borders, and layer tools from here.",placement:"bottom"},{target:'[data-region="layer-panel"]',title:"Layers Panel",description:"All your layers live here. Drag to reorder, click the eye to toggle visibility, or use the lock icon. Use the + buttons at the bottom to add image, text, or shape layers.",placement:"right"},{target:'[data-region="canvas"]',title:"Canvas",description:"Your workspace. Click a layer to select it, drag to move. Middle-click (or two-finger) to pan, scroll wheel (or pinch) to zoom. Drop images here to add them as layers.",placement:"bottom"},{target:'[data-region="property-panel"]',title:"Properties Panel",description:"Adjust the selected layer's opacity, position, and dimensions. Change canvas size, background color, and shadow settings at the bottom.",placement:"left"},{target:'[data-region="actions-menu"]',title:"Modify Tools",description:`With a layer selected, these tools are always available:

 Transparency Mask  Remove a chosen color and make it transparent.
 Crop  Trim the layer to a smaller region.
 Pixelator / Resize  Resize an image or convert it into pixel art with palette matching and dithering.
 BG Removal  Remove backgrounds with click, brush, or AI tools.`,placement:"left"},{target:'[data-region="zoom-controls"]',title:"Zoom Controls",description:"Zoom in/out with preset levels or use Fit to Screen to auto-center everything. The keyboard shortcut Ctrl+0 also resets zoom.",placement:"bottom"},{target:'[data-region="file-operations"]',title:"Save & Export",description:"Save projects as .pixcomp files to reload later. Export to PNG for sharing. Your work also auto-saves to the browser's local storage.",placement:"bottom"},{target:null,title:"Keyboard Shortcuts",description:`Ctrl+Z / Ctrl+Y  Undo/Redo
Ctrl+S  Save project
Delete  Remove selected layers
Arrow keys  Nudge selected layers
Ctrl+Click  Multi-select layers`,placement:"center"},{target:null,title:"You're all set!",description:"Drop an image onto the canvas to get started, or use the Pixelator tool (in File menu) to convert images to pixel art. You can reopen this tour anytime from the ? button.",placement:"center"}],Zp=[{target:null,title:"Welcome to PixelConnect",description:"A pixel-art compositor and image editor, optimized for mobile. This quick tour will show you around. Tap Next to continue.",placement:"center"},{target:'[data-region="toolbar"]',title:"Toolbar",description:"Two rows: top has project name, file ops, and undo/redo. Bottom row has grid, borders, tools toggles, and zoom controls.",placement:"bottom"},{target:'[data-region="canvas"]',title:"Canvas",description:"One-finger to pan, pinch to zoom. Tap a layer to select it, then drag to move. Drop or upload images to add layers.",placement:"center"},{target:"#btn-mobile-layers-toggle",title:"Layers Panel ()",description:"Tap the  button in the bottom-left corner to open the layers drawer. Reorder layers, toggle visibility, and create text or shape layers from here.",placement:"top"},{target:"#btn-mobile-properties-toggle",title:"Properties Panel ()",description:"Tap the  button in the bottom-right corner. Adjust opacity, position, canvas size, and background color.",placement:"top"},{target:"#btn-mobile-properties-toggle",title:"Modify Tools",description:`With a layer selected, open Properties () to find the Modify section with these tools:

 Transparency Mask  Remove a color and make it transparent.
 Crop  Trim the layer to a smaller region.
 Pixelator / Resize  Resize an image or convert it to pixel art with palette matching and dithering.
 BG Removal  Remove backgrounds with click, brush, or AI tools.`,placement:"top"},{target:'[data-region="zoom-controls"]',title:"Zoom Controls",description:"Use Fit to Screen to auto-center your canvas, or tap +/ for fine control. Pinch gestures work on the canvas too.",placement:"top"},{target:null,title:"You're all set!",description:"Drop an image onto the canvas to get started, or use the Pixelator tool (in the file menu) to convert images to pixel art. Reopen this tour anytime from the ? button in the toolbar.",placement:"center"}],fd="pixelconnect_tutorial_seen";function Kp({isOpen:l,onClose:c}){const a=Rr(),d=a?Zp:Gp,[u,y]=g.useState(0),[m,w]=g.useState(null),f=g.useRef(null),p=d[u],v=g.useCallback(()=>{if(!l)return;const D=a&&p.mobileTarget!==void 0?p.mobileTarget:p.target;if(!D){w(null);return}const z=document.querySelector(D);w(z?z.getBoundingClientRect():null)},[l,p,a]);if(g.useEffect(()=>(v(),window.addEventListener("resize",v),()=>window.removeEventListener("resize",v)),[v]),g.useEffect(()=>{l&&y(0)},[l]),g.useEffect(()=>{if(l)return p.onEnter?.(),()=>{p.onExit?.()}},[u,l]),!l)return null;const b=()=>{u<d.length-1?y(u+1):P()},N=()=>{u>0&&y(u-1)},P=()=>{localStorage.setItem(fd,"true"),c()},j=a&&p.mobilePlacement?p.mobilePlacement:p.placement||"bottom",C=()=>{if(!m||j==="center")return{position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"};const D=16,z=Math.min(360,window.innerWidth-32),q=f.current?f.current.offsetHeight:280,U=window.innerWidth,R=window.innerHeight,k=re=>Math.max(16,Math.min(re,U-z-16)),F=re=>Math.max(16,Math.min(re,R-q-16));let H;switch(j){case"bottom":H={position:"fixed",top:F(m.bottom+D),left:k(m.left),maxWidth:z};break;case"top":H={position:"fixed",top:F(m.top-D-q),left:k(m.left),maxWidth:z};break;case"right":{const re=m.right+D,ee=re+z>U?k(m.left+16):re;H={position:"fixed",top:F(m.top+(m.height-q)/2),left:ee,maxWidth:z};break}case"left":{const re=U-m.left+D,ee=m.left-D-z<0?void 0:re;H={position:"fixed",top:F(m.top+(m.height-q)/2),...ee!==void 0?{right:ee,maxWidth:z}:{left:k(m.right-z),maxWidth:z}};break}default:H={position:"fixed",top:"50%",left:"50%",transform:"translate(-50%, -50%)"}}return H},M=()=>{if(!m)return{};const D=6,z=m.left-D,q=m.top-D,U=m.width+D*2,R=m.height+D*2,k=8;return{clipPath:`polygon(
        0% 0%, 100% 0%, 100% 100%, 0% 100%, 0% 0%,
        ${z}px ${q+k}px,
        ${z+k}px ${q}px,
        ${z+U-k}px ${q}px,
        ${z+U}px ${q+k}px,
        ${z+U}px ${q+R-k}px,
        ${z+U-k}px ${q+R}px,
        ${z+k}px ${q+R}px,
        ${z}px ${q+R-k}px,
        ${z}px ${q+k}px
      )`}};return r.jsxs("div",{className:"fixed inset-0 z-[400]",role:"dialog","aria-modal":"true","aria-label":"Tutorial",children:[r.jsx("div",{className:"absolute inset-0 bg-black/70 transition-all duration-300",style:M(),onClick:P}),m&&r.jsx("div",{className:"absolute border-2 border-blue-400/60 rounded-lg pointer-events-none transition-all duration-300",style:{left:m.left-6,top:m.top-6,width:m.width+12,height:m.height+12,boxShadow:"0 0 20px rgba(96, 165, 250, 0.3)"}}),r.jsxs("div",{ref:f,className:"bg-gray-900 border border-gray-600 rounded-xl shadow-2xl p-5 z-[401] text-gray-200 flex flex-col",style:(()=>{const D=C(),z=Math.min(380,window.innerWidth-32),q=typeof D.top=="number"?D.top:16,U=D.transform?window.innerHeight-32:window.innerHeight-q-16;return{...D,maxWidth:z,maxHeight:U}})(),children:[r.jsxs("div",{className:"flex items-center justify-between mb-3 flex-shrink-0",children:[r.jsxs("span",{className:"text-xs text-gray-500 font-mono",children:[u+1," / ",d.length]}),r.jsx("button",{onClick:P,className:"text-xs text-gray-500 hover:text-gray-300 transition-colors",children:"Skip tour"})]}),r.jsx("h3",{className:"text-base font-bold text-white mb-2 flex-shrink-0",children:p.title}),r.jsx("p",{className:"text-sm text-gray-300 leading-relaxed whitespace-pre-line mb-4 overflow-y-auto flex-shrink min-h-0",children:p.description}),r.jsx("div",{className:"flex items-center justify-center gap-1.5 mb-4 flex-shrink-0",children:d.map((D,z)=>r.jsx("div",{className:`w-2 h-2 rounded-full transition-colors ${z===u?"bg-blue-500":z<u?"bg-blue-800":"bg-gray-600"}`},z))}),r.jsxs("div",{className:"flex items-center justify-between gap-3 flex-shrink-0",children:[r.jsx("button",{onClick:N,disabled:u===0,className:"px-4 py-2 text-sm font-medium rounded-lg transition-colors disabled:opacity-30 disabled:cursor-not-allowed bg-gray-700 hover:bg-gray-600 text-gray-200",children:"Previous"}),r.jsx("button",{onClick:b,className:"px-4 py-2 text-sm font-semibold rounded-lg transition-colors bg-blue-600 hover:bg-blue-500 text-white",children:u===d.length-1?"Finish":"Next"})]})]})]})}function Qp(){const[l,c]=g.useState(!1),[a,d]=g.useState(!1);return g.useEffect(()=>{if(!localStorage.getItem(fd)){d(!0);const y=setTimeout(()=>c(!0),800);return()=>clearTimeout(y)}},[]),{showTutorial:l,setShowTutorial:c,isFirstVisit:a}}function qp(){const l=T(A=>A.project),c=T(A=>A.isDirty),[a,d]=g.useState(!1),[u,y]=g.useState(void 0),[m,w]=g.useState(!1),[f,p]=g.useState(void 0),v=Rr(),{showTutorial:b,setShowTutorial:N,isFirstVisit:P}=Qp(),[j,C]=g.useState(!1),[M,D]=g.useState(!1);$h(),Ap(),Op(),Xp();const z=T(A=>A.addLayer),q=T(A=>A.selectLayer);g.useEffect(()=>{if(!P)return;const A=setTimeout(async()=>{if(!(T.getState().project.layers.length>0))try{const X=await fetch("/kanoe.jpg");if(!X.ok)return;const $=await X.blob(),ae=await new Promise(_=>{const x=new FileReader;x.onload=()=>_(x.result),x.readAsDataURL($)}),O=new Image;O.src=ae,await new Promise(_=>{O.onload=()=>_()}),z({name:"kanoe.jpg",imageData:ae,x:0,y:0,zIndex:0,visible:!0,locked:!1,opacity:1,width:O.naturalWidth,height:O.naturalHeight});const oe=T.getState().project.layers;oe.length>0&&q(oe[oe.length-1].id,!1)}catch{}},500);return()=>clearTimeout(A)},[P,z,q]),Vp();const[U,R]=g.useState(!1),k=g.useRef(null),F=g.useCallback(async A=>{for(const X of Array.from(A))if(X.type.startsWith("image/"))try{const $=await new Promise((_,x)=>{const I=new FileReader;I.onload=ne=>_(ne.target?.result),I.onerror=()=>x(new Error("Failed to read file")),I.readAsDataURL(X)}),ae=new Image;ae.src=$,await new Promise((_,x)=>{ae.onload=()=>_(),ae.onerror=()=>x(new Error("Failed to load image"))});const O=T.getState();O.addLayer({name:X.name,imageData:$,x:0,y:0,zIndex:O.project.layers.length,visible:!0,locked:!1,opacity:1,width:ae.naturalWidth,height:ae.naturalHeight});const oe=T.getState().project.layers;oe.length>0&&T.getState().selectLayer(oe[oe.length-1].id,!1)}catch($){console.error(`Error loading dropped image ${X.name}:`,$)}},[]);g.useEffect(()=>{let A=0;const X=oe=>{oe.preventDefault(),A++,oe.dataTransfer?.types.includes("Files")&&R(!0)},$=oe=>{if(oe.preventDefault(),oe.dataTransfer){const _=k.current;_&&_.contains(oe.target)?oe.dataTransfer.dropEffect="copy":oe.dataTransfer.dropEffect="none"}},ae=oe=>{oe.preventDefault(),A--,A<=0&&(A=0,R(!1))},O=oe=>{oe.preventDefault(),A=0,R(!1);const _=k.current;_&&_.contains(oe.target)&&oe.dataTransfer?.files&&oe.dataTransfer.files.length>0&&F(oe.dataTransfer.files)};return window.addEventListener("dragenter",X),window.addEventListener("dragover",$),window.addEventListener("dragleave",ae),window.addEventListener("drop",O),()=>{window.removeEventListener("dragenter",X),window.removeEventListener("dragover",$),window.removeEventListener("dragleave",ae),window.removeEventListener("drop",O)}},[F]);const{isOpen:H,setIsOpen:re}=Bp(),ee=A=>{y(A),d(!0)},W=()=>{d(!1),y(void 0)},Z=A=>{p(A),w(!0)},J=()=>{w(!1),p(void 0)};return g.useEffect(()=>(window.openTextLayerModal=ee,()=>{delete window.openTextLayerModal}),[]),g.useEffect(()=>(window.openShapeModal=Z,()=>{delete window.openShapeModal}),[]),g.useEffect(()=>{const A=X=>{c&&(X.preventDefault(),X.returnValue="",console.warn("[DEBUG] Unsaved changes detected - warning user before closing"))};return window.addEventListener("beforeunload",A),()=>window.removeEventListener("beforeunload",A)},[c]),g.useEffect(()=>{const A=c?` ${l.projectName} - PixelConnect`:`${l.projectName} - PixelConnect`;document.title=A},[l.projectName,c]),r.jsxs("div",{className:"h-screen flex flex-col bg-canvas-bg text-white overflow-hidden",children:[r.jsx(Rp,{onHelpClick:()=>N(!0)}),r.jsx("div",{className:"flex flex-1 gap-0 overflow-hidden relative",children:v?r.jsxs(r.Fragment,{children:[r.jsxs("div",{ref:k,className:"flex-1 overflow-hidden relative",children:[r.jsx(Yu,{}),U&&r.jsx("div",{className:"absolute inset-0 z-[300] bg-black/60 flex items-center justify-center pointer-events-none rounded",children:r.jsxs("div",{className:"border-4 border-dashed border-blue-400 rounded-2xl px-12 py-10 bg-gray-900/80 text-center",children:[r.jsx("div",{className:"text-5xl mb-3",children:""}),r.jsx("div",{className:"text-xl font-semibold text-blue-300",children:"Drop image(s) here"}),r.jsx("div",{className:"text-sm text-gray-400 mt-1",children:"PNG, JPG, GIF, WebP, SVG"})]})})]}),r.jsx("button",{id:"btn-mobile-layers-toggle",onClick:()=>{C(!j),D(!1)},className:`fixed bottom-4 left-4 z-[200] w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-lg transition-colors ${j?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,"aria-label":j?"Close layers panel":"Open layers panel",children:""}),r.jsx("button",{id:"btn-mobile-properties-toggle",onClick:()=>{D(!M),C(!1)},className:`fixed bottom-4 right-4 z-[200] w-12 h-12 rounded-full shadow-lg flex items-center justify-center text-lg transition-colors ${M?"bg-blue-600 text-white":"bg-gray-700 text-gray-200 hover:bg-gray-600"}`,"aria-label":M?"Close properties panel":"Open properties panel",children:""}),j&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 z-[150]",onClick:()=>C(!1)}),r.jsxs("div",{id:"mobile-layers-drawer",className:"fixed top-16 left-0 bottom-0 w-72 bg-panel-bg border-r border-border z-[160] overflow-hidden flex flex-col animate-slide-in-left shadow-2xl",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-300",children:"Layers"}),r.jsx("button",{onClick:()=>C(!1),className:"text-gray-400 hover:text-white text-lg px-1",children:""})]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx(Xu,{})})]})]}),M&&r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"fixed inset-0 bg-black/50 z-[150]",onClick:()=>D(!1)}),r.jsxs("div",{id:"mobile-properties-drawer",className:"fixed top-16 right-0 bottom-0 w-72 bg-panel-bg border-l border-border z-[160] overflow-hidden flex flex-col animate-slide-in-right shadow-2xl",children:[r.jsxs("div",{className:"flex items-center justify-between px-3 py-2 border-b border-border",children:[r.jsx("span",{className:"text-sm font-semibold text-gray-300",children:"Properties"}),r.jsx("button",{onClick:()=>D(!1),className:"text-gray-400 hover:text-white text-lg px-1",children:""})]}),r.jsx("div",{className:"flex-1 overflow-hidden",children:r.jsx(qu,{})})]})]})]}):r.jsxs(r.Fragment,{children:[r.jsx("div",{className:"w-64 border-r border-border overflow-hidden flex flex-col",children:r.jsx(Xu,{})}),r.jsxs("div",{ref:k,className:"flex-1 overflow-hidden relative",children:[r.jsx(Yu,{}),U&&r.jsx("div",{className:"absolute inset-0 z-[300] bg-black/60 flex items-center justify-center pointer-events-none rounded",children:r.jsxs("div",{className:"border-4 border-dashed border-blue-400 rounded-2xl px-12 py-10 bg-gray-900/80 text-center",children:[r.jsx("div",{className:"text-5xl mb-3",children:""}),r.jsx("div",{className:"text-xl font-semibold text-blue-300",children:"Drop image(s) here"}),r.jsx("div",{className:"text-sm text-gray-400 mt-1",children:"PNG, JPG, GIF, WebP, SVG"})]})})]}),r.jsx("div",{className:"w-64 border-l border-border overflow-hidden flex flex-col",children:r.jsx(qu,{})})]})}),r.jsx(Fp,{isOpen:H,onClose:()=>re(!1)}),r.jsx(zp,{isOpen:a,onClose:W,existingLayer:u}),r.jsx(_p,{isOpen:m,onClose:J,existingLayer:f}),r.jsx(Kp,{isOpen:b,onClose:()=>N(!1)})]})}th.createRoot(document.getElementById("root")).render(r.jsx(nd.StrictMode,{children:r.jsx(qp,{})}));export{tp as _};
//# sourceMappingURL=index-Ck6ZkpjA.js.map
